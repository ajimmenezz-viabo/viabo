import{j as e,C as x,r as m,a7 as de,S as E,T as C,a8 as b,d as ue,g as pe,a9 as B,n as me,B as j,p as ge,U as H,I as w,E as he,$ as O,k as fe,P as xe,a4 as Ce,a5 as Se,a6 as Ae,aa as q,ab as $}from"./index-bdd855b5.js";import{A as W,u as Ee}from"./build-7131a13d.js";import{r as ve,i as je,a as Ie,b as be,H as _e}from"./build-32ca2d6f.js";import{B as ye}from"./build-154f657a.js";import{F as Te,g as we}from"./build-2f8408b4.js";import{C as Oe}from"./build-06b9a778.js";import{g as Pe}from"./build-7452ecd6.js";import{c as De}from"./build-6fe4a8d9.js";import{M as Fe,S as Le,F as Ne,a as Re,b as ze}from"./build-862d7228.js";import{L as Ue,a as Me}from"./build-d8980c8c.js";import{M as Ve}from"./build-a93e0b00.js";import{L as ke}from"./build-dd047424.js";import{C as He}from"./build-a4aed6ca.js";import{A as Be}from"./build-d38030ee.js";const qe=t=>{const i=Pe(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);if(i&&Array.isArray(i)){const n=i==null?void 0:i.map(u=>Oe(u)),s=De(n,"id","cardUserNumber")||[];return{data:s,meta:{total:(s==null?void 0:s.length)??0}}}throw new Error("No se pueden obtener las tarjetas")};var D={},$e=je;Object.defineProperty(D,"__esModule",{value:!0});var K=D.default=void 0,We=$e(ve()),Ke=e,Qe=(0,We.default)((0,Ke.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");K=D.default=Qe;const Q=({open:t,anchorEl:i,handlePopoverClose:n,data:s})=>{var u,a,p;return s?e.jsx(de,{id:"mouse-over-popover",sx:{pointerEvents:"none"},open:t,anchorEl:i,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},onClose:n,disableRestoreFocus:!0,slotProps:{paper:{sx:{mt:1.5,ml:.5,overflow:"inherit",boxShadow:d=>d.customShadows.z20,border:d=>`solid 1px ${d.palette.grey[5008]}`,width:200}}},children:e.jsxs(E,{spacing:2,p:2,children:[e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s):"}),e.jsx(C,{variant:"body2",children:((u=s==null?void 0:s.assignUser)==null?void 0:u.name)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos:"}),e.jsx(C,{variant:"body2",children:((a=s==null?void 0:s.assignUser)==null?void 0:a.lastName)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"TelÃ©fono:"}),e.jsx(C,{variant:"body2",children:((p=s==null?void 0:s.assignUser)==null?void 0:p.phone)??"-"})]})]})}):null};Q.propTypes={anchorEl:x.any,data:x.shape({assignUser:x.shape({lastName:x.string,name:x.string,phone:x.string})}),handlePopoverClose:x.any,open:x.any};const Ge=m.memo(Q),Je=async(t,i)=>{const{columnFilters:n,globalFilter:s,pageIndex:u,pageSize:a,sorting:p}=t,d=new URL("/api/cards/commerce",window.location.origin);d.searchParams.set("start",`${u*a}`),d.searchParams.set("size",`${a}`),d.searchParams.set("filters",JSON.stringify(n??[])),d.searchParams.set("globalFilter",s??""),d.searchParams.set("sorting",JSON.stringify(p??[]));const{data:I}=await b.get(d.href,{signal:i});return qe(I)},As=async t=>(await b.put("/api/assign/commerce-card/to/user",t),t),Es=async t=>{const{data:i}=await b.put("/api/card-owner/data/update",t);return i},vs=async t=>{const{data:i}=await b.put(`/api/card-owner/password/reset/${t.id}`);return i},Ye=(t={},i={})=>{const{columnFilters:n,globalFilter:s,pageIndex:u,pageSize:a,sorting:p}=t,[d,I]=m.useState(null);return{...ue({queryKey:[W.LIST,n,s,u,a,p],queryFn:async({signal:v})=>Je(t,v),keepPreviousData:!0,onError:v=>{const _=pe(v,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");I(_)},staleTime:6e4,refetchOnWindowFocus:!1,...i}),error:d||null}},Xe={cardInfo:null,openUserInfo:!1,hoverInfo:null,hoverElement:null},Ze=(t,i)=>({...Xe,setOpenUserInfo:n=>{t(s=>({openUserInfo:n}),!1,"SET_OPEN_USER_INFO_MODAL")},setCardInfo:n=>{t(s=>({cardInfo:n}),!1,"SET_CARD_INFO")},setHoverInfo:n=>{t(s=>({hoverInfo:n}),!1,"SET_HOVER_INFO")},setHoverElement:n=>{t(s=>({hoverElement:n}),!1,"SET_HOVER_ElEMENT")}}),G=B(Ze),es={cards:[],rows:[],openAssign:!1},ss=(t,i)=>({...es,setSelectedCard:n=>{const{cards:s}=i(),u=s.indexOf(n);let a=[];u===-1?a=a.concat(s,n):u===0?a=a.concat(s.slice(1)):u===s.length-1?a=a.concat(s.slice(0,-1)):u>0&&(a=a.concat(s.slice(0,u),s.slice(u+1))),t(p=>({cards:a}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:n=>{t(s=>({cards:n}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:n=>{t(s=>({rows:n}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:n=>{t(s=>({openAssign:n}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(n=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),P=B(ss),rs=({refCommerceCardsTable:t})=>{var V;const[i,n]=m.useState([]),[s,u]=m.useState(""),[a,p]=m.useState([]),[d,I]=m.useState({pageIndex:0,pageSize:10}),[F,v]=m.useState({}),{setOpenUserInfo:_,setCardInfo:J}=G(r=>r),Y=P(r=>r.setOpenAssign),X=P(r=>r.setAllCards),Z=me(),{data:A,isLoading:y,isFetching:ee,isError:L,error:se,refetch:re}=Ye({columnFilters:i??[],globalFilter:s??"",pageIndex:(d==null?void 0:d.pageIndex)??0,pageSize:(d==null?void 0:d.pageSize)??10,sorting:a??[]}),{mutate:te,isLoading:ne}=Ee(),[N,R]=m.useState(null),[ae,z]=m.useState(null),[oe,T]=m.useState(null),le=r=>{R(r.currentTarget)},U=()=>{R(null),z(null)},M=!!N,S=m.useMemo(()=>[{id:"cardNumber",accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,size:120,Cell:({cell:r,column:o,row:c})=>{var f,g;const{original:l}=c;return e.jsxs(E,{direction:"row",spacing:1,alignItems:"center",children:[(l==null?void 0:l.cardType)==="Carnet"?e.jsx(Ie,{sx:{width:25,height:25}}):e.jsx(Ve,{sx:{width:25,height:25}}),e.jsx(C,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:(g=l==null?void 0:l.cardNumber)==null?void 0:g.substr(((f=l==null?void 0:l.cardNumber)==null?void 0:f.length)-4)})]})}},{id:"assigned",accessorFn:r=>{var o;return((o=r==null?void 0:r.assignUser)==null?void 0:o.fullName)||null},Cell:({cell:r,column:o,row:c,renderedCellValue:l})=>{const{original:f}=c;return l!=="-"?e.jsx(E,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(ke,{color:"info.main",underline:"always",sx:{cursor:"pointer"},variant:"subtitle2",component:C,"aria-owns":M?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:g=>{le(g),z(f)},onMouseLeave:U,onClick:()=>{J(f),_(!0)},children:l})}):l},header:"Asignado",minSize:150},{id:"status",accessorFn:r=>{var o;return((o=r==null?void 0:r.cardStatus)==null?void 0:o.name)||null},header:"Estado",filterVariant:"select",minSize:100,Cell:({cell:r,column:o,row:c,renderedCellValue:l})=>{var g;const{original:f}=c;return l?e.jsx(j,{sx:{display:"flex",pt:1},children:e.jsx(Ue,{variant:Z.palette.mode==="light"?"ghost":"filled",color:(g=f==null?void 0:f.cardStatus)!=null&&g.isActive?"success":"error",sx:{textTransform:"capitalize"},children:l})}):null}}],[]),ie=r=>()=>{var g;const o=((g=r.getSelectedRowModel().flatRows)==null?void 0:g.map(h=>h.original))??[],c=o.some(h=>(h==null?void 0:h.cvv)==="")&&(o==null?void 0:o.length)>1,l=o.some(h=>{var k;return((k=h==null?void 0:h.assignUser)==null?void 0:k.id)!==""});o.every(h=>(h==null?void 0:h.cvv)==="")&&(o==null?void 0:o.length)>1?O.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):c?O.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):l?O.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):(X(o),Y(!0))},ce=r=>()=>{try{const o=r.getSortedRowModel().rows.map(c=>(S==null?void 0:S.map(l=>c.getValue(l.accessorKey)))||[])??[];we((S==null?void 0:S.map(c=>c.header))||[],o,"Stock del comercio")}catch{}};return e.jsx(j,{maxWidth:"lg",children:e.jsxs(He,{children:[e.jsx(Ge,{anchorEl:N,open:M,handlePopoverClose:U,data:ae}),e.jsx(Fe,{tableInstanceRef:t,enablePinning:!0,enableColumnOrdering:!1,enableColumnFilterModes:!1,enableStickyHeader:!0,enableRowVirtualization:!0,enableRowActions:!0,positionActionsColumn:"last",enableDensityToggle:!1,enableFacetedValues:!0,columns:S,data:(A==null?void 0:A.data)||[],isError:L,textError:se,selectAllMode:"all",onRowSelectionChange:v,rowCount:((V=A==null?void 0:A.meta)==null?void 0:V.total)??0,initialState:{density:"compact",sorting:[{id:"assigned",desc:!0}]},state:{isLoading:y,showAlertBanner:L,showProgressBars:ee,rowSelection:F??{}},enableRowSelection:!0,displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:15,muiTableHeadCellProps:({column:r})=>({align:"center"})},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:r})=>e.jsx(j,{sx:{display:"flex",gap:"1rem"},children:e.jsx(ge,{onClick:ie(r),disabled:!r.getIsSomeRowsSelected(),startIcon:e.jsx(Be,{width:24,height:24}),children:"Asociar"})}),muiTableBodyRowProps:({row:r})=>({sx:o=>({backgroundColor:o.palette.background.paper})}),renderToolbarInternalActions:({table:r})=>e.jsxs(j,{children:[e.jsx(H,{arrow:!0,title:"Actualizar",children:e.jsx(w,{onClick:()=>re(),children:e.jsx(K,{})})}),e.jsx(Le,{table:r}),e.jsx(H,{title:"Descargar",children:e.jsx(w,{disabled:r.getPrePaginationRowModel().rows.length===0,onClick:ce(r),children:e.jsx(Te,{})})}),e.jsx(Ne,{table:r}),e.jsx(Re,{table:r}),e.jsx(ze,{table:r})]}),renderRowActions:({row:r,table:o})=>{var g;const{original:c}=r,l=(g=c==null?void 0:c.cardStatus)==null?void 0:g.isActive,f=ne&&oe===(c==null?void 0:c.id);return e.jsxs(j,{sx:{display:"flex",flex:1,justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:[e.jsx(w,{size:"small",color:"primary",disabled:y,children:e.jsx(ye,{})}),f?e.jsx(he,{size:15,containerProps:{display:"flex",ml:1}}):e.jsx(Me,{disabled:y,size:"sm",color:l?"success":"error",checked:l||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{T(c==null?void 0:c.id),te({...c,cardON:!l},{onSuccess:()=>{T(null)},onError:()=>{T(null)}})}})]})}})]})})},ts=q(m.lazy(()=>$(()=>import("./build-ad43ebe5.js"),["assets/js/build-ad43ebe5.js","assets/js/index-bdd855b5.js","assets/css/build-f63bc8fe.css","assets/js/build-3560c14e.js","assets/js/build-a4aed6ca.js","assets/js/build-1ce81c34.js","assets/js/build-b107af18.js","assets/js/build-7452ecd6.js","assets/js/build-3dba308d.js","assets/js/build-7131a13d.js","assets/js/build-1d4df834.js","assets/js/build-06b9a778.js","assets/js/build-8874a07b.js","assets/js/build-bee6630b.js","assets/js/build-dd514942.js","assets/js/build-32ca2d6f.js","assets/js/build-2fd9b8cd.js","assets/js/build-dd047424.js","assets/js/build-6fe4a8d9.js","assets/js/build-e49d3437.js","assets/js/build-154f657a.js","assets/js/build-308e4d81.js","assets/js/build-2f8408b4.js","assets/js/build-862d7228.js","assets/js/build-aa2972c6.js","assets/js/build-6330c89b.js","assets/js/build-e8f7d6a3.js","assets/js/build-5c9eacf1.js","assets/js/build-8b507d93.js","assets/js/build-d8980c8c.js","assets/js/build-5caa65b9.js","assets/js/build-a93e0b00.js","assets/js/build-d38030ee.js"]))),ns=q(m.lazy(()=>$(()=>import("./build-102fd690.js"),["assets/js/build-102fd690.js","assets/js/index-bdd855b5.js","assets/css/build-f63bc8fe.css","assets/js/build-3560c14e.js","assets/js/build-a4aed6ca.js","assets/js/build-1ce81c34.js","assets/js/build-b107af18.js"])));function as(){const{openAssign:t,setOpenAssign:i}=P(p=>p),{openUserInfo:n,setOpenUserInfo:s}=G(p=>p),u=fe(),a=m.useRef(null);return m.useEffect(()=>()=>{const p=Object.values(W);u.cancelQueries(p)},[]),e.jsx(e.Fragment,{children:e.jsx(xe,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(be,{sx:{height:"100%"},children:[e.jsx(_e,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Ce.root},{name:"Viabo Card",href:Se.allCards},{name:Ae.allCards.name}]}),e.jsx(rs,{refCommerceCardsTable:a}),e.jsx(ts,{open:t,handleClose:()=>{i(!1)},handleSuccess:()=>{var p;i(!1),(p=a==null?void 0:a.current)==null||p.resetRowSelection()}}),e.jsx(ns,{open:n,handleClose:()=>{s(!1)},handleSuccess:()=>{s(!1)}})]})})})}const js=Object.freeze(Object.defineProperty({__proto__:null,default:as},Symbol.toStringTag,{value:"Module"}));export{js as A,As as a,Es as b,G as c,vs as r,P as u};
