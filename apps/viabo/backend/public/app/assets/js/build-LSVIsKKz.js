import{z as G,j as r,r as b,S as c,T as C,p as D,D as U,B as R,E as v,dq as k,dr as q,I as W,O as j}from"./index-x-tL3MOy.js";import{u as Z,d as J,g as K}from"./build-RTCxoqUU.js";import{c as y,b as Q,a as X}from"./build-Nd1r18oH.js";import{u as Y}from"./build-ptapPBg_.js";import{F as _,M as rr}from"./build-eCwt9U-A.js";import{R as er}from"./build-7Rmqxzyl.js";import{R as $}from"./build-LZHsYRLc.js";import{A as tr}from"./build-yw6dnA5g.js";import{T as nr}from"./build-mZf3ZGCw.js";import{I as sr}from"./build-P_JIiLI3.js";import{A as or}from"./build-gviGgo-L.js";import"./build-iPi1GP4n.js";import"./build-EUAVn8Jf.js";import"./build-zw289rNM.js";import"./build-SWnGRRxs.js";import"./build-GKTonalM.js";import"./build-r-MJ89TZ.js";import"./build-Kbx5ZuUJ.js";import"./build-Uc7vb3zK.js";import"./build-Q1bOWlNZ.js";import"./build-rDZAP2eW.js";import"./build-E9ETIoCq.js";import"./build-WksAqt8r.js";import"./build-oEjEmA2z.js";import"./build-KFw_9xKb.js";import"./build-3y5AuJst.js";import"./build-1BhicGFt.js";import"./build-XMbFjTpc.js";import"./build-2TgacLCq.js";import"./build-NIRfJG7v.js";import"./build-TmPCBBAV.js";import"./build-G8xLV4ng.js";import"./build-EckPbxwb.js";import"./build-OVyPJnWA.js";import"./build-PRa05QHt.js";import"./build-aXq1ykHm.js";import"./build-3JmeY1AD.js";import"./build-Pt2-zlVs.js";import"./build-fO9Z8l-Y.js";import"./build-YUdFPXK7.js";const ir=G(r.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");function ar({cards:M,setCurrentBalance:V,insufficient:w,isBinCard:u,onSuccess:E}){const I=b.useRef(null),B=window.crypto||window.msCrypto,N=new Uint32Array(1),S=B.getRandomValues(N)[0],[d,g]=b.useState(M),a=Y(t=>t==null?void 0:t.selectedCards),H=y().shape({transactions:Q().of(y().shape({amount:X().test("maxAmount","Monto m√°ximo de transferencia $50,000",function(t){return parseFloat(t==null?void 0:t.replace(/,/g,""))<=5e4}).required("La cantidad es requerida"),card:y().nullable().required("La tarjeta es requerida")}))}),F=Z({initialValues:{transactions:(a==null?void 0:a.length)>0&&u&&(a==null?void 0:a.map(t=>({id:Math.random(),card:{value:t==null?void 0:t.value,label:t==null?void 0:t.label,...t},amount:""})))||[{id:S,card:null,amount:""}],concept:""},validateOnChange:!1,validationSchema:H,onSubmit:t=>w?P(!1):(P(!1),E(t))}),{isSubmitting:L,setFieldValue:A,values:p,setSubmitting:P,errors:O,touched:lr}=F,x=L;return b.useEffect(()=>{if(a&&u){const t=a==null?void 0:a.map(n=>({...n,isDisabled:!0}));g(t)}},[a,u]),b.useEffect(()=>{var l;const n=((l=p.transactions)==null?void 0:l.reduce((m,h)=>{const f=h.amount.trim()!==""?parseFloat(h.amount.replace(/,/g,"")):0;return isNaN(f)?m:m+f},0)).toFixed(2);V(n)},[p.transactions]),r.jsxs(r.Fragment,{children:[r.jsxs(c,{px:3,spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[r.jsx(C,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),r.jsx(c,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!u&&r.jsx(D,{type:"button",size:"small",variant:"outlined",startIcon:r.jsx(tr,{}),disabled:x,onClick:()=>I.current.push({id:S,card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Agregar"})]}),r.jsx(U,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(_,{formik:F,children:r.jsxs(R,{sx:{p:3},children:[r.jsx(J,{name:"transactions",render:t=>(I.current=t,r.jsx(c,{divider:r.jsx(v,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:p==null?void 0:p.transactions.map((n,l)=>{const m=`transactions[${l}].card`,h=K(O,m),f=`transactions[${l}].amount`;return r.jsx(c,{alignItems:"flex-end",spacing:1.5,children:r.jsxs(c,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[r.jsx(C,{variant:"overline",color:"text.disabled",children:l+1}),r.jsx(er,{name:m,disabled:x||u,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:d||[],onChange:(s,e)=>{const i=d==null?void 0:d.map(o=>{var T,z;return!(e!=null&&e.value)&&o.value===((T=n==null?void 0:n.card)==null?void 0:T.value)?{...o,isDisabled:!1}:o.value===(e==null?void 0:e.value)?{...o,isDisabled:!0}:o.value===((z=n==null?void 0:n.card)==null?void 0:z.value)?{...o,isDisabled:!1}:o});g(i),A(m,e)},renderOption:(s,e)=>{const i=k(e==null?void 0:e.label);return r.jsx(R,{component:"li",...s,children:r.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(q,{src:e.label!==""?e.label:"",alt:e.label,color:i==null?void 0:i.color,sx:{width:25,height:25,fontSize:12},children:i==null?void 0:i.name}),r.jsx("span",{children:e.label})]})})},renderInput:s=>{var i,o;const e=k(((i=s==null?void 0:s.inputProps)==null?void 0:i.value)||"");return r.jsx(nr,{...s,size:"small",placeholder:"Seleccionar ...",label:"Tarjeta",inputProps:{...s.inputProps},error:!!h,helperText:h||"",required:!0,InputProps:{...s.InputProps,startAdornment:r.jsx(sr,{position:"start",children:r.jsx(q,{src:"",alt:((o=s.inputProps)==null?void 0:o.value)||"avatar",color:e==null?void 0:e.color,sx:{width:25,height:25,fontSize:12},children:(e==null?void 0:e.name)!=="undefined"?e==null?void 0:e.name:null})})}})},sx:{width:{xs:1,lg:.6}}}),r.jsx($,{sx:{width:{xs:1,lg:.4}},size:"small",name:f,required:!0,label:"Cantidad",placeholder:"0.00",disabled:x,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:rr,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,scale:2,value:n.amount,onAccept:s=>{A(f,s)}}}}),l!==0&&!u&&r.jsx(W,{size:"small",color:"error",title:"Borrar",disabled:x,onClick:()=>{const s=d==null?void 0:d.map((e,i)=>{var o;return e.value===((o=n==null?void 0:n.card)==null?void 0:o.value)?{...e,isDisabled:!1}:e});g(s),t.remove(l)},children:r.jsx(ir,{})})]})},n.id)})}))}),r.jsx(v,{sx:{my:3,borderStyle:"dashed"}}),r.jsx(c,{sx:{width:1},children:r.jsx($,{name:"concept",multiline:!0,disabled:x,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),r.jsx(c,{sx:{pt:3},children:r.jsx(D,{variant:"outlined",color:"primary",disabled:w,fullWidth:!0,type:"submit",startIcon:r.jsx(or,{}),children:"Siguiente"})})]})})})]})}ar.propTypes={cards:j.any,insufficient:j.any,isBinCard:j.any,onSuccess:j.func,setCurrentBalance:j.func};export{ar as default};
