import{r as j,x as O,a9 as J,ae as ee,j as e,ac as w,ab as te,bc as se,bd as _,o as R,a as N,b as ne,g as P,az as oe,k as re,aA as L,l as ie,a2 as ae,S as u,T as x,c as le,U as ce,V as k,L as de,B as M,aS as me,I as ue,aT as he,e as pe,a4 as xe,b4 as ge,b5 as fe}from"./build-b398f610.js";import{C as Ce,H as je}from"./build-e5b70eda.js";import{g as Ee,a as Se,h as be,f as ve,R as Ae,C as Te,b as ye,e as we,M as Ie}from"./build-9c5b1c07.js";import{c as Re,d as _e}from"./build-390e2d0a.js";import{C as B}from"./build-4f0afa8a.js";import{a as Le,A as De,C as ze}from"./build-9794df2a.js";import{u as Oe}from"./build-00913d97.js";import{F as Ne}from"./build-90232120.js";import{c as Pe,a as I}from"./build-e5a8d440.js";import{s as ke}from"./build-9563ddbe.js";import{C as Me,D as Be}from"./build-c6ac8032.js";import{C as He}from"./build-132ee0f6.js";import{R as D}from"./build-34de88a1.js";import{M as Ve}from"./build-fd68546e.js";import{I as Fe}from"./build-9051198d.js";import{E as Ue}from"./build-acbb6a33.js";import{T as qe,a as z}from"./build-b498e0bd.js";import"./build-d5294d4e.js";import"./build-ecaf0d13.js";import"./build-b3c266c9.js";import"./build-bee6630b.js";import"./build-8bcb7677.js";import"./build-67d40c67.js";import"./build-49a73190.js";import"./build-7530f3a7.js";const We=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],$e={entering:{transform:"none"},entered:{transform:"none"}},Ge=j.forwardRef(function(o,n){const r=O(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:s,appear:d=!0,children:l,easing:a,in:c,onEnter:p,onEntered:S,onEntering:C,onExit:g,onExited:v,onExiting:F,style:T,timeout:y=i,TransitionComponent:U=te}=o,q=J(o,We),A=j.useRef(null),W=ee(A,l.ref,n),E=m=>f=>{if(m){const b=A.current;f===void 0?m(b):m(b,f)}},$=E(C),G=E((m,f)=>{se(m);const b=_({style:T,timeout:y,easing:a},{mode:"enter"});m.style.webkitTransition=r.transitions.create("transform",b),m.style.transition=r.transitions.create("transform",b),p&&p(m,f)}),Q=E(S),Z=E(F),K=E(m=>{const f=_({style:T,timeout:y,easing:a},{mode:"exit"});m.style.webkitTransition=r.transitions.create("transform",f),m.style.transition=r.transitions.create("transform",f),g&&g(m)}),Y=E(v),X=m=>{s&&s(A.current,m)};return e.jsx(U,w({appear:d,in:c,nodeRef:A,onEnter:G,onEntered:Q,onEntering:$,onExit:K,onExited:Y,onExiting:Z,addEndListener:X,timeout:y},q,{children:(m,f)=>j.cloneElement(l,w({style:w({transform:"scale(0)",visibility:m==="exited"&&!c?"hidden":void 0},$e[m],T,l.props.style),ref:W},f))}))}),Qe=Ge,Ze=R(e.jsx("path",{d:"M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"}),"Apps"),H=R(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"}),"AssignmentIndRounded"),Ke=R(e.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"}),"FormatListBulleted"),V={LIST:"unassignedCardsCommerce"},Ye=(t,o)=>{const{phone:n,email:r,name:i}=t,s={name:i,phone:n,email:r,cards:(o==null?void 0:o.map(d=>d==null?void 0:d.id))||[]};return Ee(s)},Xe=async()=>{const{data:t}=await N.get("/api/disabled-cards/commerce");return Se(t)},Je=async t=>(await N.put("/api/assign/commerce-card/to/user",t),t),et=(t={})=>{const[o,n]=j.useState(null);return{...ne([V.LIST],Xe,{staleTime:6e4,onError:i=>{const s=P(i,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");n(s)},...t}),error:o||null}},tt=(t={})=>{const o=oe(),n=re(Je,t);return{...n,mutate:async(i,s)=>{const{onSuccess:d,onError:l,mutationOptions:a}=s;try{await L.promise(n.mutateAsync(i,a),{pending:"Asignando Tarjetas ...",success:{render({data:c}){return o.invalidateQueries([V.LIST]),o.invalidateQueries([Me.CARDS_COMMERCE_LIST]),d(),"Se asignaron las tarjetas con éxito"}}})}catch(c){const p=P(c,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");l(p),L.error(p,{type:ie(c)})}}}},st=(t,o)=>({cards:[],rows:[],openAssign:!1,setSelectedCard:n=>{const{cards:r}=o(),i=r.indexOf(n);let s=[];i===-1?s=s.concat(r,n):i===0?s=s.concat(r.slice(1)):i===r.length-1?s=s.concat(r.slice(0,-1)):i>0&&(s=s.concat(r.slice(0,i),r.slice(i+1))),t(d=>({cards:s}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:n=>{t(r=>({cards:n}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:n=>{t(r=>({rows:n}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:n=>{t(r=>({openAssign:n}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(n=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),h=Re(_e(st));function nt({cards:t}){const o=h(a=>a.cards),n=h(a=>a.setAllCards),r=h(a=>a.resetCards),i=h(a=>a.setOpenAssign),s=(o==null?void 0:o.length)||0,d=(t==null?void 0:t.length)||0,l=a=>{if(a){n(t);return}r()};return e.jsx(e.Fragment,{children:e.jsx(ae,{sx:a=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:a.customShadows.z8,backgroundColor:a.palette.info.lighter,color:"white"}),children:e.jsxs(u,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(u,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(B,{indeterminate:s>0&&s<d,checked:d>0&&s===d,onChange:a=>l(a.target.checked),color:"success"}),e.jsx(x,{color:"success.main",variant:"subtitle1",children:s===1?`${s} Tarjeta`:`${s} Tarjetas`})]}),e.jsx(u,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(le,{startIcon:e.jsx(H,{}),variant:"outlined",color:"info",onClick:()=>i(!0),children:"Asignar"})})]})})})}function ot({card:t}){const o=h(s=>s.setSelectedCard),n=h(s=>s.cards),r=n==null?void 0:n.some(s=>(s==null?void 0:s.id)===(t==null?void 0:t.id)),i=s=>{s.stopPropagation(),o(t)};return e.jsx(ce.div,{onClick:i,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(be,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(u,{flexDirection:"row",gap:1,children:[e.jsx(B,{onClick:i,edge:"start",checked:r,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(u,{children:[e.jsx(x,{variant:"subtitle2",sx:{opacity:.72},children:"Viabo Card"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(ve,{card:t,disableShow:!0}),e.jsxs(u,{direction:"row",spacing:5,children:[e.jsxs(u,{children:[e.jsx(x,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(x,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(Le,{card:t,disableShow:!0})]})]})})}function rt({cards:t,onSuccess:o}){const{mutate:n,isLoading:r}=tt(),i=Pe({name:I().required("El nombre es requerido"),email:I().email("Ingresa un correo valido").required("El correo es requerido"),phone:I().test("longitud","El telefono es muy corto",g=>!(g&&g.replace(/[\s+]/g,"").length<10))}),s=Oe({initialValues:{name:"",phone:"",email:""},validationSchema:i,onSubmit:g=>{const v=Ye(g,t);n(v,{onSuccess:()=>{S(!1),o()},onError:()=>{S(!1)}})}}),{errors:d,touched:l,isSubmitting:a,setFieldValue:c,values:p,setSubmitting:S}=s,C=a||r;return e.jsx(k,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Ne,{formik:s,children:e.jsxs(u,{spacing:3,sx:{p:3},children:[e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:C})]}),e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:C,InputProps:{startAdornment:e.jsx(Fe,{position:"start",children:e.jsx(Ue,{})})}})]}),e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Ve,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:p.phone||"+52",disabled:C,onChange:(g,v)=>{c("phone",g)},error:l.phone&&!!d.phone,helperText:l.phone&&d.phone})]}),e.jsx(u,{sx:{pt:3},children:e.jsx(de,{loading:a,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(De,{}),children:"Asignar"})})]})})})}function it({open:t,handleClose:o,handleSuccess:n}){const r=h(i=>i.cards);return e.jsxs(Ae,{open:t,handleClose:o,title:"Asignar Tarjetas",children:[e.jsx(u,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",p:3,children:r==null?void 0:r.map(i=>e.jsx(Te,{icon:e.jsx(ye,{}),label:i==null?void 0:i.cardNumberHidden},i==null?void 0:i.id))}),e.jsx(rt,{cards:r,onSuccess:n})]})}function at({unassignedCards:t}){const o=t==null?void 0:t.data,n=h(l=>l.cards),r=h(l=>l.setIndexCards,ke),i=O(),s=j.useMemo(()=>(n==null?void 0:n.map(l=>o.findIndex(a=>a.id===l.id)))||[],[n,o]);j.useEffect(()=>{r(s)},[s]);const d={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen};return e.jsx(u,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(u,{sx:l=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(Qe,{in:(n==null?void 0:n.length)>0,timeout:d,style:{transitionDelay:`${(n==null?void 0:n.length)>0?d.exit:0}ms`},unmountOnExit:!0,children:e.jsx(M,{children:e.jsx(nt,{cards:t==null?void 0:t.data})})}),e.jsx(k,{children:e.jsx(ze,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:ot,my:3})})]})})}function lt({handleAssign:t}){return e.jsx(M,{sx:{marginRight:3},children:e.jsx(me,{title:"Asginar",children:e.jsx(ue,{onClick:t,children:e.jsx(H,{sx:{color:o=>o.palette.info.main},width:24,height:24})})})})}function ct({isLoading:t,cards:o=[],rows:n=[]}){const r=h(l=>l.setAllCards),i=h(l=>l.setOpenAssign),s=h(l=>l.setIndexCards),d=[{name:"cardNumberHidden",label:"Tarjeta",options:{customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:c==null?void 0:c.cardNumberHidden})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsxs(u,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(he,{sx:p=>({width:45,height:45,color:p.palette.primary.contrastText,backgroundColor:p.palette.primary.light}),children:(c==null?void 0:c.cardType)==="Carnet"?e.jsx(we,{sx:{width:30},color:"white"}):e.jsx(Ie,{sx:{width:30}})}),e.jsx(x,{variant:"subtitle2",children:c==null?void 0:c.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"register",label:"Fecha",options:{filterType:"textField",customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsxs(u,{children:[e.jsx(x,{variant:"subtitle2",children:c==null?void 0:c.registerDate}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:c==null?void 0:c.registerTime})]})}}}];return e.jsx(He,{children:e.jsx(Be,{isLoading:t,data:o||[],columns:d,options:{responsive:"simple",rowsSelected:n,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(l,a,c)=>{const p=o==null?void 0:o.filter((S,C)=>c.includes(C));r(p),s(c)},customToolbarSelect:l=>e.jsx(lt,{handleAssign:()=>{i(!0)}})}})})}function Nt(){const t=et(),[o,n]=j.useState("1"),r=(a,c)=>{n(c)},i=h(a=>a.rows),s=h(a=>a.openAssign),d=h(a=>a.setOpenAssign),l=h(a=>a.resetCards);return e.jsx(e.Fragment,{children:e.jsx(pe,{title:"Tarjetas Sin Asignar del Comercio",children:e.jsxs(Ce,{sx:{height:"100%"},children:[e.jsx(je,{name:"Tarjetas Sin Asignar",links:[{name:"Inicio",href:xe.root},{name:"Administracion",href:ge.cards},{name:fe.unassignedCards.name}],buttons:e.jsxs(qe,{size:"small",color:"primary",value:o,exclusive:!0,onChange:r,"aria-label":"Platform",children:[e.jsx(z,{value:"1",children:e.jsx(Ke,{})}),e.jsx(z,{value:"2",children:e.jsx(Ze,{})})]})}),o==="2"&&e.jsx(at,{unassignedCards:t}),o==="1"&&e.jsx(ct,{cards:t.data,isLoading:t.isLoading,rows:i}),e.jsx(it,{open:s,handleClose:()=>{d(!1)},handleSuccess:()=>{d(!1),l()}})]})})})}export{Nt as default};
