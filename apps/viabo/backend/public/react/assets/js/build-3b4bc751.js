import{a as D,$ as A,g as M,b as q,k as G,r as j,aH as H,j as t,a2 as K,S as i,W as X,T as l,L as W,C as J}from"./index-6715ae0f.js";import{u as Z}from"./build-44f6928d.js";import{$ as w}from"./build-d82f31f5.js";import{c as I,a as v}from"./build-742b96fd.js";import{a as ee}from"./build-d1b1f753.js";import{r as te,b as re,c as se}from"./build-790202be.js";import{i as E}from"./build-074907a5.js";import{A as ae}from"./build-4ca2ebe5.js";import{F as ie}from"./build-e6b3b65d.js";import{R as k}from"./build-4dc8fe48.js";import{a as oe}from"./build-7ea4e5f2.js";import{L as ne}from"./build-24bc7ae6.js";import{W as le}from"./build-750c5a9f.js";import"./build-abae6bb8.js";import"./build-cfd7d68f.js";import"./build-77073ae9.js";import"./build-2f561d42.js";import"./build-72a0fd63.js";import"./build-9c237321.js";import"./build-8ea4ad8f.js";import"./build-23dfff69.js";import"./build-e74ed9e1.js";import"./build-2ba33af4.js";import"./build-bee6630b.js";import"./build-19ef9051.js";import"./build-f4ff894e.js";import"./build-3ddeaa15.js";import"./build-2d614291.js";import"./build-c0916129.js";import"./build-aa1d016c.js";import"./build-ac5f6649.js";import"./build-15ea2428.js";import"./build-04a076c1.js";const ce=(r,e)=>{var c;const m={ownerId:(c=e==null?void 0:e.assignUser)==null?void 0:c.id,name:r==null?void 0:r.name,lastName:r==null?void 0:r.lastName,phone:r==null?void 0:r.phone};return ee(m)},me=(r={})=>{const e=D(te,r);return{...e,mutate:async(c,h={})=>{const{onSuccess:p,onError:o,...d}=h;try{await A.promise(e.mutateAsync(c,d),{pending:"Restableciendo Contraseña ...",success:{render({data:n}){return E(p)&&p(n),"Se restableció la contraseña con éxito"}}})}catch(n){const a=M(n,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(o)&&o(a),A.error(a,{type:q(n)})}}}},pe=(r={})=>{const e=G(),m=D(re,r);return{...m,mutate:async(h,p={})=>{const{onSuccess:o,onError:d,...n}=p;try{await A.promise(m.mutateAsync(h,n),{pending:"Actualizando información ...",success:{render({data:a}){return e.invalidateQueries([ae.LIST]),E(o)&&o(a),"Se actualizo con éxito"}}})}catch(a){const u=M(a,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(d)&&d(u),A.error(u,{type:q(a)})}}}},g={UPDATE_USER_INFO:"1",RECOVERY_PASSWORD:"2"},de=({handleSuccess:r})=>{var O,P,T,F,_,f,L,z;const e=se(s=>s.cardInfo),{mutate:m,isLoading:c}=pe(),{mutate:h,isLoading:p}=me(),[o,d]=j.useState(((O=e==null?void 0:e.assignUser)==null?void 0:O.name)||""),[n,a]=j.useState(!1),[u,b]=j.useState(null),V=I({name:v().required("El nombre es requerido"),lastName:v().required("El apellido es requerido"),phone:v().test("longitud","El teléfono es muy corto",s=>!(s&&s.replace(/[\s+]/g,"").length<10))}),R=Z({initialValues:{name:((P=e==null?void 0:e.assignUser)==null?void 0:P.name)||"",phone:((T=e==null?void 0:e.assignUser)==null?void 0:T.phone)||"",lastName:((F=e==null?void 0:e.assignUser)==null?void 0:F.lastName)||""},enableReinitialize:!0,validationSchema:V,onSubmit:(s,{setSubmitting:S})=>{if(u===g.UPDATE_USER_INFO){const Q=ce(s,e);m(Q,{onSuccess:()=>{r(),b(null)}})}u===g.RECOVERY_PASSWORD&&h(e==null?void 0:e.assignUser,{onSuccess:()=>{r(),b(null)}}),S(!1)}}),{values:y,setFieldValue:$,touched:C,errors:N,isSubmitting:Y,handleSubmit:B}=R,x=c||Y||p;j.useEffect(()=>{var s;y.name?d(y.name):d((s=e==null?void 0:e.assignUser)==null?void 0:s.name)},[y.name]);const U=j.useMemo(()=>H(o),[o]);return t.jsxs(t.Fragment,{children:[t.jsx(K,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:t.jsx(ie,{formik:R,children:t.jsxs(i,{spacing:2,sx:{p:3},children:[t.jsx(i,{spacing:.5,children:t.jsxs(i,{justifyContent:"center",alignItems:"center",spacing:1,children:[t.jsx(X,{variant:"rounded",src:"",color:"warning",alt:o,sx:{backgroundColor:s=>{var S;return(S=s.palette[U.color])==null?void 0:S.main},width:80,height:80,color:"white"},children:U.name}),t.jsx(l,{component:ne,href:`mailto:${(_=e==null?void 0:e.assignUser)==null?void 0:_.email}`,variant:"body2",children:((f=e==null?void 0:e.assignUser)==null?void 0:f.email)??"-"}),t.jsx(i,{spacing:.5,alignItems:"center",children:(L=e==null?void 0:e.assignUser)!=null&&L.lastLogged?t.jsxs(t.Fragment,{children:[t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"Último Inicio de Sesión:"}),t.jsx(l,{paragraph:!0,variant:"body2",sx:{color:"text.disabled"},children:((z=e==null?void 0:e.assignUser)==null?void 0:z.lastLogged)??"🚀"})]}):t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"No ha iniciado sesión 🚀"})}),t.jsx(i,{children:t.jsx(W,{variant:"contained",color:"secondary",loading:p,disabled:x,sx:{color:"black"},onClick:()=>{b(g.RECOVERY_PASSWORD),a(!0)},children:"Restablecer Contraseña"})})]})}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s)"}),t.jsx(k,{name:"name",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos"}),t.jsx(k,{name:"lastName",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),t.jsx(w,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:y.phone||"+52",disabled:x,onChange:(s,S)=>{$("phone",s)},error:C.phone&&!!N.phone,helperText:C.phone&&N.phone})]}),t.jsx(i,{pt:2,children:t.jsx(W,{size:"large",variant:"contained",color:"primary",fullWidth:!0,loading:c,disabled:x,onClick:()=>{b(g.UPDATE_USER_INFO),a(!0)},children:"Actualizar"})})]})})}),n&&t.jsx(oe,{title:u===g.UPDATE_USER_INFO?"Actualizar Usuario":"Restablecer Contraseña",typeAlert:"warning",textButtonSuccess:"Si, estoy de acuerdo",onClose:()=>{a(!1)},open:n,isSubmitting:!1,description:t.jsxs(i,{spacing:2,children:[t.jsx(l,{children:u===g.UPDATE_USER_INFO?"¿Está seguro de actualizar la información de este usuario":"¿Está seguro de restablecer la contraseña de este usuario"}),t.jsxs(i,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(le,{}),t.jsx(i,{children:t.jsx(l,{variant:"caption",children:"Se enviara una notificación via correo electrónico con los cambios realizados"})})]})]}),onSuccess:()=>{a(!1),B()},fullWidth:!0,maxWidth:"xs"})]})};de.propTypes={handleSuccess:J.func};export{de as default};
