import{z as Es,j as s,C as K,r as d,_ as q,O as f,S as g,T as I,m as H,aP as Ts,p as Ss,L as ps,aj as Ps,I as ns,V as os,W as ws,B as V,E as Rs,G as k,K as X,ai as J,d as Z,g as m,Q as N,b as v,H as ls,J as cs,Y as Ds,N as $,P as Fs,ab as Os}from"./index-1970f1dc.js";import{a as _s}from"./build-589cfc72.js";import{f as M}from"./build-2b1189e0.js";import"./build-8545fca1.js";import{u as Y,M as As,L as Bs,F as Ls}from"./build-57448001.js";import{R as ks}from"./build-80837f2d.js";import{C as Ws}from"./build-6d0b2fa9.js";import{g as Ns,B as zs,a as Gs}from"./build-24d2f6ad.js";import{C as ss}from"./build-5ad62618.js";import{C as ds}from"./build-449d8105.js";import{C as Q}from"./build-8c99efbb.js";import{D as es}from"./build-643b05e8.js";import{g as us}from"./build-6345f405.js";import{f as $s,a as Hs,H as Vs}from"./build-fcdd56c0.js";import{a as Ks}from"./build-1322f1b7.js";import{A as qs}from"./build-c6f21fca.js";import{s as Us,a as Xs}from"./build-81265b51.js";import{g as Ys}from"./build-9ce8d135.js";import{M as Qs}from"./build-69ad5ac2.js";import{u as Js}from"./build-18e1479d.js";import"./build-7ff0ad56.js";import"./build-d28ff831.js";import"./build-37c20432.js";import"./build-d9ea44f9.js";import"./build-ea21fc0d.js";import"./build-ed9fea26.js";import"./build-ffac7634.js";import"./build-d8157e4c.js";import"./build-5d46946a.js";import"./build-28c3e1ae.js";import"./build-6553a32b.js";import"./build-5de223b4.js";import"./build-ff372fb5.js";import"./build-ba4811c1.js";import"./build-d2dc32af.js";import"./build-c59042b5.js";import"./build-45e36c7b.js";import"./build-2aa26bd2.js";import"./build-7f04195b.js";import"./build-c9ffca00.js";import"./build-8e00bab0.js";import"./build-e594db61.js";import"./build-bee6630b.js";import"./build-c3d0a05d.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-d8f8536d.js";const xs=Es(s.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update"),Zs=K(d.lazy(()=>q(()=>import("./build-16a49432.js"),["assets/js/build-16a49432.js","assets/js/index-1970f1dc.js","assets/css/build-c23c9e36.css","assets/js/build-ffac7634.js","assets/js/build-ea21fc0d.js","assets/js/build-57448001.js","assets/js/build-37c20432.js","assets/js/build-24d2f6ad.js","assets/js/build-fcdd56c0.js","assets/js/build-d28ff831.js","assets/js/build-8e00bab0.js","assets/js/build-6553a32b.js","assets/js/build-7f04195b.js","assets/js/build-c9ffca00.js","assets/js/build-d9ea44f9.js","assets/js/build-c6f21fca.js","assets/js/build-bee6630b.js","assets/js/build-2b1189e0.js","assets/js/build-ed9fea26.js","assets/js/build-d8157e4c.js","assets/js/build-5d46946a.js","assets/js/build-28c3e1ae.js","assets/js/build-5de223b4.js","assets/js/build-69ad5ac2.js","assets/js/build-d8f8536d.js","assets/js/build-c3d0a05d.js","assets/js/build-6345f405.js","assets/js/build-45e36c7b.js","assets/js/build-ff372fb5.js","assets/js/build-1322f1b7.js","assets/js/build-e594db61.js","assets/js/build-ba4811c1.js","assets/js/build-589cfc72.js","assets/js/build-5ad62618.js","assets/js/build-7ff0ad56.js","assets/js/build-8545fca1.js","assets/js/build-d2dc32af.js","assets/js/build-c59042b5.js","assets/js/build-8c99efbb.js","assets/js/build-2aa26bd2.js","assets/js/build-e62fa7a2.js"]))),ms=K(d.lazy(()=>q(()=>import("./build-cd54f99d.js"),["assets/js/build-cd54f99d.js","assets/js/index-1970f1dc.js","assets/css/build-c23c9e36.css","assets/js/build-6345f405.js","assets/js/build-28c3e1ae.js","assets/js/build-d28ff831.js","assets/js/build-45e36c7b.js","assets/js/build-2b1189e0.js","assets/js/build-c7ce8ef2.js","assets/js/build-ff372fb5.js","assets/js/build-1322f1b7.js","assets/js/build-fcdd56c0.js","assets/js/build-8e00bab0.js","assets/js/build-6553a32b.js","assets/js/build-e594db61.js","assets/js/build-ba4811c1.js","assets/js/build-69ad5ac2.js","assets/js/build-d8f8536d.js","assets/js/build-5d46946a.js","assets/js/build-c3d0a05d.js","assets/js/build-d8157e4c.js","assets/js/build-cb0314c1.js"]))),hs=({open:t,setOpen:n,card:r,cardList:o=[]})=>{const[i,a]=d.useState(0),u=d.useMemo(()=>r==null?void 0:r.balance,[r==null?void 0:r.balance]),[e,y]=d.useState(!1),[E,x]=d.useState(null),[C,O]=d.useState(!1),p=d.useMemo(()=>(parseFloat(u)-i).toFixed(2)<0,[i,u]),P=()=>{n(!1),a(0),y(!1),x(null),O(!1)},D=w=>{const U=r==null?void 0:r.id;x({cardOriginId:U,isGlobal:!1,transactions:(w==null?void 0:w.transactions)||[],concept:w==null?void 0:w.concept,balance:u,currentBalance:i}),y(!0)},A=()=>{y(!1)},F=s.jsx(s.Fragment,{children:s.jsx(I,{variant:"h6",children:"Fondear Tarjetas"})}),j=s.jsxs(s.Fragment,{children:[s.jsxs(g,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,pt:2,children:[s.jsx(I,{variant:"subtitle1",children:"Saldo"}),s.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(I,{variant:"h3",color:"success.main",children:M(u)}),s.jsx(I,{variant:"caption",color:"success.main",children:"MXN"})]}),s.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[s.jsxs(I,{variant:"subtitle1",color:"error",children:["- ",M(i)]}),s.jsx(I,{variant:"caption",color:"error",children:"MXN"})]}),p&&s.jsx(I,{variant:"caption",color:"warning.main",textAlign:"center",children:"Saldo insuficiente para realizar la(s) operacion(es)"})]}),s.jsx(Zs,{cards:o,setCurrentBalance:a,insufficient:p,isBinCard:!1,onSuccess:D})]});return s.jsx(_s,{open:t,handleClose:P,titleElement:F,children:t&&s.jsxs(s.Fragment,{children:[s.jsx(H.div,{initial:{opacity:1},animate:{opacity:e?0:1},transition:{duration:.5},style:{display:e?"none":"flex",flex:1,overflow:"hidden",flexDirection:"column"},children:j}),s.jsx(H.div,{initial:{opacity:0},animate:{opacity:e?1:0},transition:{duration:.5},style:{display:e?"flex":"none",flexDirection:"column",flex:1,overflow:"hidden"},children:s.jsx(ms,{data:E,onBack:A,setTransactionLoading:O,transactionLoading:C,onClose:P})})]})})};hs.propTypes={card:f.shape({balance:f.any,id:f.any}),cardList:f.array,open:f.any,setOpen:f.func};function ys({isRefetchingCards:t,commerceCards:n,card:r}){const{isCollapse:o}=Ts(),i=Y(y=>y.setOpenFundingOrder),a=Y(y=>y.setFundingCard),[u,e]=d.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsxs(g,{px:2,py:1,gap:1,flexDirection:{lg:o?"row":"column",xl:"row"},justifyContent:"space-between",children:[s.jsx(Ss,{color:"primary",variant:"text",startIcon:s.jsx(ks,{}),size:"small",onClick:()=>{i(!0),a(r)},children:"Orden Fondeo"}),s.jsx(ps,{size:"small",variant:"text",color:"primary",startIcon:s.jsx(Ws,{}),loading:t,onClick:()=>{e(!0)},children:"Fondear Tarjetas"})]}),s.jsx(hs,{setOpen:e,open:u,card:r,cardList:n})]})}ys.propTypes={card:f.any,commerceCards:f.any,isRefetchingCards:f.any};const vs={card:null,isMaster:!0,movements:[],balanceMovements:"$0.00",income:"$0.00",expenses:"$0.00",expensesWithInvoice:"$0.00",expensesWithoutInvoice:"$0.00",expensesWithoutChecked:"$0.00",totalExpensesOtherCharges:"$0.00",filterPaymentProcessor:null,filterDate:null},se=(t,n)=>({...vs,setGlobalCard:r=>{n(),t(o=>({card:r}),!1,"SET_GLOBAL_CARD")},resetGlobalCard:()=>{t(r=>({card:null}),!1,"RESET_GLOBAL_CARD")},setIsMaster:r=>{t(o=>({isMaster:r}),!1,"SET_IS_MASTER")},setMovements:r=>{t(o=>({movements:(r==null?void 0:r.movements)||[],balanceMovements:(r==null?void 0:r.balanceMovements)||"$0.00",expenses:(r==null?void 0:r.expenses)||"$0.00",income:(r==null?void 0:r.income)||"$0.00",expensesWithInvoice:(r==null?void 0:r.expensesWithInvoice)||"$0.00",expensesWithoutInvoice:(r==null?void 0:r.expensesWithoutInvoice)||"$0.00",expensesWithoutChecked:(r==null?void 0:r.expensesWithoutChecked)||"$0.00",totalExpensesOtherCharges:(r==null?void 0:r.totalExpensesOtherCharges)||"$0.00"}),!1,"SET_MASTER_MOVEMENTS")},getBalance:()=>{const{balanceMovements:r,income:o,expenses:i,expensesWithInvoice:a,expensesWithoutInvoice:u,expensesWithoutChecked:e,totalExpensesOtherCharges:y}=n();return{balanceMovements:r,income:o,expenses:i,expensesWithInvoice:a,expensesWithoutInvoice:u,expensesWithoutChecked:e,totalExpensesOtherCharges:y}},setFilterPaymentProcessor:r=>{t(o=>({filterPaymentProcessor:r}),!1,"SET_FILTER_PAYMENT_PROCESSOR")},setFilterDate:r=>{t(o=>({filterDate:r}),!1,"SET_FILTER_DATE")}}),_=Ps(se),gs=({card:t,cardSelected:n,isRefetchingCards:r,commerceCards:o,disableFilter:i=!1})=>{const[a,u]=d.useState(!1),[e,y]=d.useState(!1),E=Ns(t==null?void 0:t.paymentProcessor),x=E==null?void 0:E.component,C=(n==null?void 0:n.id)===(t==null?void 0:t.id),{setGlobalCard:O,setIsMaster:p,setFilterPaymentProcessor:P}=_(j=>j),D=d.useMemo(()=>o&&o[t==null?void 0:t.paymentProcessorId]||[],[o]),A=(D==null?void 0:D.length)||0,F=j=>w=>{i||(P(j==null?void 0:j.paymentProcessor),p(!1),O(j))};return s.jsx(g,{children:s.jsxs(ss,{sx:{minWidth:{xs:300,md:"auto"},border:C?3:0,borderColor:j=>C?j.palette.mode==="dark"?j.palette.secondary.main:j.palette.primary.main:"inherit"},children:[s.jsx(ds,{title:s.jsxs(g,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"space-between",children:[s.jsx(I,{variant:"caption",children:A===0?"":A+" Tarjetas"}),s.jsxs(g,{flexDirection:"row",alignItems:"center",sx:{flexWrap:"wrap"},gap:0,children:[E&&s.jsx(ns,{variant:"outlined",title:`Copiar Tarjeta - ${t==null?void 0:t.cardNumber}`,color:e?"success":"inherit",onClick:j=>{y(!0),os(t==null?void 0:t.cardNumber),setTimeout(()=>{y(!1)},1e3)},size:"small",sx:{width:40,height:40},children:e?s.jsx(Q,{sx:{color:"success"}}):s.jsx(x,{})}),s.jsx(ns,{variant:"outlined",title:`Copiar SPEI - ${t==null?void 0:t.SPEI}`,color:a?"success":"inherit",size:"small",onClick:j=>{u(!0),os(t==null?void 0:t.SPEI),setTimeout(()=>{u(!1)},1e3)},sx:{width:40,height:40},children:a?s.jsx(Q,{sx:{color:"success"}}):s.jsx(ws,{})})]})]}),sx:{px:2,py:2}}),s.jsx(V,{component:i?"div":H.div,onClick:F(t),...i?{}:{whileTap:{scale:.8},style:{cursor:"pointer"}},children:s.jsxs(g,{alignItems:"center",pb:2,px:2,children:[s.jsxs(g,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(I,{variant:"h6",children:t==null?void 0:t.balanceFormatted}),s.jsx(I,{variant:"caption",children:"MXN"})]}),s.jsxs(g,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(xs,{sx:{width:20,height:20,color:"text.secondary"}}),s.jsxs(g,{alignItems:"center",children:[s.jsx(I,{variant:"subtitle2",children:"En transito"}),s.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(I,{variant:"body2",children:t==null?void 0:t.inTransitFormatted}),s.jsx(I,{variant:"caption",children:"MXN"})]})]})]})]})}),s.jsx(Rs,{sx:{borderStyle:"dashed"}}),s.jsx(ys,{isRefetchingCards:r,commerceCards:D,card:t})]})},t==null?void 0:t.cardId)};gs.propTypes={card:f.shape({SPEI:f.any,balanceFormatted:f.any,cardId:f.any,id:f.any,inTransitFormatted:f.any,paymentProcessor:f.any,paymentProcessorId:f.any,cardNumber:f.any}),cardSelected:f.shape({id:f.any}),commerceCards:f.any,disableFilter:f.bool,isRefetchingCards:f.any};const ee={"MASTER CARD":"1",MASTERCARD:"1",CARNET:"2"},te=t=>{const n=us(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);let r=0,o=0;const i=n==null?void 0:n.map(a=>{var u;return r+=parseFloat(a==null?void 0:a.balance),o+=parseFloat(a==null?void 0:a.inTransit),{...a,paymentProcessorId:ee[(u=a==null?void 0:a.paymentProcessor)==null?void 0:u.toUpperCase()]??null,id:a==null?void 0:a.cardId,SPEI:a==null?void 0:a.spei,balanceFormatted:M(a==null?void 0:a.balance),inTransitFormatted:M(a==null?void 0:a.inTransit),cardNumber:(a==null?void 0:a.cardNumber)||""}});return{master:{balance:r,inTransit:o,balanceFormatted:M(r),inTransitFormatted:M(o)},globals:i}},re=t=>{const n=us(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);let r=0,o=0,i=0,a=0,u=0;return{movements:(n==null?void 0:n.map(e=>{var D,A,F;const y=parseFloat((e==null?void 0:e.amount)||"0");(e==null?void 0:e.type.toLowerCase())==="gasto"&&(r+=y),(e==null?void 0:e.type.toLowerCase())==="ingreso"&&(o+=y);const E=e!=null&&e.receiptFiles?(D=e==null?void 0:e.receiptFiles)==null?void 0:D.split(","):[],x=E==null?void 0:E.reduce((j,w)=>(w.endsWith(".xml")?j.xml=w:w.endsWith(".pdf")&&(j.pdf=w),j),{xml:null,pdf:null}),C=(x==null?void 0:x.xml)!==null&&(x==null?void 0:x.pdf)!==null,O=e!=null&&e.date?k(new Date(e==null?void 0:e.date),"dd MMM yyyy",{locale:X}):"",p=e!=null&&e.date?k(new Date(e==null?void 0:e.date),"p"):"",P=((A=e==null?void 0:e.operationType)==null?void 0:A.toLowerCase())==="otros cargos";return P&&(e!=null&&e.checked)&&C&&(a+=y),P&&(e!=null&&e.checked)&&!C&&(i+=y),P&&!(e!=null&&e.checked)&&(u+=y),{id:e==null?void 0:e.transactionId,fullDate:$s(e==null?void 0:e.date),date:O,time:p,serverDate:e==null?void 0:e.date,description:e==null?void 0:e.description,amount:y,amountFormat:M(y),paymentProcessor:e==null?void 0:e.cardPaymentProcessor,type:e==null?void 0:e.type.toLowerCase(),operationType:(F=e==null?void 0:e.operationType)==null?void 0:F.toUpperCase(),concept:(e==null?void 0:e.concept)??"",cardId:e==null?void 0:e.cardId,commerceId:e==null?void 0:e.cardCommerceId,verified:!!(e!=null&&e.checked),isMainCard:!!(e!=null&&e.cardMain),expensesControl:{id:e==null?void 0:e.receiptId,isInvoice:C,invoiceFiles:x,otherFiles:C?[]:E},original:e}}))??[],income:M(o),expenses:M(r),balanceMovements:M(o-r),expensesWithInvoice:M(a),expensesWithoutInvoice:M(i),expensesWithoutChecked:M(u),totalExpensesOtherCharges:M(a+i+u)}},ie=async()=>{const{data:t}=await J.get("/api/main-cards/information");return te(t)},ae=async(t,n,r)=>{const o=new URL("/api/master-cards/movements",window.location.origin);o.searchParams.set("startDate",t),o.searchParams.set("endDate",n);const{data:i}=await J.get(o.href);return re(i)},ne=async t=>{const n={},r=t.map(o=>J.get(`/api/enabled-cards/commerce?paymentProcessorId=${o}`).then(i=>Ks(i.data)).then(i=>{n[o]=i}));return await Promise.all(r),n},oe=(t,n={})=>{const[r,o]=d.useState(null),i=Z({queryKey:[es.COMMERCE_CARDS],queryFn:({signal:a})=>ne(t),staleTime:6e4,...n});return d.useEffect(()=>{if(i!=null&&i.isError){const a=m(i.error,"No se puede obtener la lista de tarjetas del comercio. Intente nuevamente o reporte a sistemas");o(a),N.error(a,{type:v(i.error)})}},[i.isError,i.error]),{...i,error:r||null}},le=(t={})=>{const[n,r]=d.useState(null),o=Y(a=>a.setMainCard);return{...Z([es.GLOBAL_CARDS],ie,{staleTime:6e4,refetchOnWindowFocus:!1,onError:a=>{const u=m(a,"No se puede obtener la información de las tarjetas principales");r(u),o(null),N.error(u,{type:v(a)})},onSuccess:a=>{o(a)},...t}),error:n||null}},ce=(t,n,r={})=>{if(!t||!n)return null;const o=k(ls(t),"yyyy-MM-dd"),i=k(cs(n),"yyyy-MM-dd"),[a,u]=d.useState(null),{setMovements:e,setFilterDate:y}=_(x=>x);return{...Z([es.MOVEMENTS],({signal:x})=>ae(o,i),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:x=>{const C=m(x,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");u(C),N.error(C,{type:v(x)}),e(null)},onSuccess:x=>{y({startDate:ls(t),endDate:cs(n),text:`${k(t,"dd MMMM yyyy",{locale:X})} - ${k(n,"dd MMMM yyyy",{locale:X})}`})},...r}),error:a||null}};function fs(){var O;const{data:t,isLoading:n}=le(),r=_(p=>p.card),o=_(p=>p.resetGlobalCard),i=_(p=>p.setIsMaster),a=_(p=>p.setFilterPaymentProcessor),u=_(p=>p.isMaster),e=d.useMemo(()=>{var p;return((p=t==null?void 0:t.globals)==null?void 0:p.reduce((P,D)=>(P.push(D.paymentProcessorId),P),[]))||null},[t==null?void 0:t.globals]),{data:y,isRefetching:E}=oe(e,{enabled:!!e}),x=t==null?void 0:t.master,C=t==null?void 0:t.globals;return s.jsx(qs,{children:s.jsxs(g,{spacing:2,flex:1,children:[n&&s.jsx(Ds,{}),!n&&s.jsxs(s.Fragment,{children:[((O=t==null?void 0:t.globals)==null?void 0:O.length)>1&&s.jsx(H.div,{onClick:()=>{i(!0),o(),a(null)},whileHover:{scale:1.03},whileTap:{scale:.8},children:s.jsxs(ss,{sx:{p:0,cursor:"pointer",border:u?3:0,borderColor:p=>u?p.palette.mode==="dark"?p.palette.secondary.main:p.palette.primary.main:"inherit"},children:[s.jsx(ds,{title:s.jsx(g,{flexDirection:"row",gap:1,alignItems:"center",children:s.jsx(I,{variant:"subtitle2",children:"Global [Master]"})}),sx:{px:2,py:2}}),s.jsxs(g,{alignItems:"center",pb:2,px:2,children:[s.jsxs(g,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(I,{variant:"h3",children:x==null?void 0:x.balanceFormatted}),s.jsx(I,{variant:"caption",children:"MXN"})]}),s.jsxs(g,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(xs,{sx:{width:30,height:30,color:"text.secondary"}}),s.jsxs(g,{alignItems:"center",children:[s.jsx(I,{variant:"subtitle2",children:"En transito"}),s.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(I,{variant:"body1",children:x==null?void 0:x.inTransitFormatted}),s.jsx(I,{variant:"caption",children:"MXN"})]})]})]})]})]})}),C==null?void 0:C.map(p=>{var P;return s.jsx(gs,{card:p,cardSelected:r,isRefetchingCards:E,commerceCards:y,disableFilter:((P=t==null?void 0:t.globals)==null?void 0:P.length)<=1},p==null?void 0:p.id)})]})]})})}fs.propTypes={};const pe=K(d.lazy(()=>q(()=>import("./build-4d3e300d.js"),["assets/js/build-4d3e300d.js","assets/js/index-1970f1dc.js","assets/css/build-c23c9e36.css","assets/js/build-589cfc72.js","assets/js/build-5ad62618.js","assets/js/build-7ff0ad56.js","assets/js/build-8545fca1.js"]))),de=K(d.lazy(()=>q(()=>import("./build-5dd18f3c.js"),["assets/js/build-5dd18f3c.js","assets/js/index-1970f1dc.js","assets/css/build-c23c9e36.css","assets/js/build-589cfc72.js","assets/js/build-5ad62618.js","assets/js/build-7ff0ad56.js","assets/js/build-8545fca1.js","assets/js/build-28c3e1ae.js","assets/js/build-d28ff831.js","assets/js/build-69ad5ac2.js","assets/js/build-d8f8536d.js","assets/js/build-5d46946a.js","assets/js/build-fcdd56c0.js","assets/js/build-8e00bab0.js","assets/js/build-6553a32b.js","assets/js/build-c3d0a05d.js","assets/js/build-6345f405.js","assets/js/build-45e36c7b.js","assets/js/build-2b1189e0.js","assets/js/build-d8157e4c.js"])));function ue(){var ts;const t=new Date,n=_(h=>h.filterPaymentProcessor),{setMovements:r,getBalance:o}=_(h=>h),i=_(h=>h.filterDate),a=_(h=>h.movements),u=d.useMemo(()=>i!=null&&i.startDate?new Date(i==null?void 0:i.startDate):Us(t,{days:30}),[i==null?void 0:i.startDate]),e=d.useMemo(()=>i!=null&&i.endDate?new Date(i==null?void 0:i.endDate):t,[i==null?void 0:i.endDate]),y=d.useMemo(()=>o(),[a]),[E,x]=d.useState(u),[C,O]=d.useState(e),[p,P]=d.useState(!1),[D,A]=d.useState(!1),{data:F,isError:j,isLoading:w,isFetching:z,error:U,refetch:Cs}=ce(E,C);d.useEffect(()=>{E&&C&&Cs()},[E,C]),d.useEffect(()=>{var h;if(n){let T=0,b=0,c=0,R=0,S=0;const G=(h=F==null?void 0:F.movements)==null?void 0:h.filter(l=>{var L;return((L=l==null?void 0:l.paymentProcessor)==null?void 0:L.toLowerCase())===(n==null?void 0:n.toLowerCase())});G==null||G.forEach(l=>{var rs,is,as;(l==null?void 0:l.type.toLowerCase())==="gasto"?T+=l==null?void 0:l.amount:b+=l==null?void 0:l.amount;const L=((rs=l==null?void 0:l.operationType)==null?void 0:rs.toLowerCase())==="otros cargos";L&&(l!=null&&l.verified)&&((is=l==null?void 0:l.expensesControl)!=null&&is.isInvoice)&&(R+=l==null?void 0:l.amount),L&&(l!=null&&l.verified)&&!((as=l==null?void 0:l.expensesControl)!=null&&as.isInvoice)&&(c+=l==null?void 0:l.amount),L&&!(l!=null&&l.verified)&&(S+=l==null?void 0:l.amount)}),r({movements:G,income:M(b),expenses:M(T),balanceMovements:M(b-T),expensesWithInvoice:M(R),expensesWithoutInvoice:M(c),expensesWithoutChecked:M(S),totalExpensesOtherCharges:M(R+c+S)})}else r(F)},[n,F]);const js=h=>{const{startDate:T,endDate:b}=h;b!==null&&T!==null&&(O(b),x(T))},bs=h=>()=>{var R;const T=((R=h==null?void 0:h.getSelectedRowModel().flatRows)==null?void 0:R.map(S=>S.original))??[],b=T==null?void 0:T.some(S=>S==null?void 0:S.verified),c=T==null?void 0:T.some(S=>(S==null?void 0:S.operationType)!=="OTROS CARGOS");return b?N.warn("Existen movimientos que ya se encuentran comprobados, verifique los movimientos seleccionados."):c?N.warn("Existen movimientos que no se pueden comprobar, verifique el tipo de movimiento."):P(!0)},Ms=d.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({cell:h,column:T,row:b})=>{const{original:c}=b;return s.jsx(As,{row:c})}},{accessorKey:"serverDate",header:"Fecha",size:120,Cell:({cell:h,column:T,row:b})=>{const{original:c}=b;return s.jsx(g,{children:s.jsx(I,{variant:"subtitle2",children:c==null?void 0:c.fullDate})})}},{accessorKey:"operationType",header:"Tipo",filterVariant:"multi-select",size:100,Cell:({cell:h,column:T,row:b})=>{const{original:c}=b,R=Ys(c==null?void 0:c.operationType),S=R==null?void 0:R.component;return s.jsx(V,{children:R?s.jsx(S,{sx:{width:25,height:25}}):s.jsx(Bs,{size:22})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:h,column:T,row:b})=>{const{original:c}=b,R=(c==null?void 0:c.type)==="ingreso",S=(c==null?void 0:c.type)==="terminal";return s.jsx(I,{variant:"subtitle2",fontWeight:"bold",color:R||S?"success.main":"error",children:R||S?`+ ${c==null?void 0:c.amountFormat}`:`- ${c==null?void 0:c.amountFormat}`})}},{accessorKey:"verified",header:"Comprobación",size:100,Cell:({cell:h,column:T,row:b})=>{const{original:c}=b;return s.jsx(g,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,mr:2,color:"primary",children:c!=null&&c.verified?s.jsx(zs,{color:"green",fontWeight:"bold",fontSize:"18px"}):s.jsx(Gs,{fontSize:"18px",color:"red"})})}}],[]),B=Js(j,U,{columns:Ms,data:a||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:w,showAlertBanner:j,showProgressBars:z},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:h})=>s.jsx(V,{sx:{display:"flex",gap:"1rem"},children:s.jsx(ps,{loading:z,onClick:bs(h),disabled:Is(),startIcon:s.jsx(Q,{width:24,height:24}),variant:"outlined",children:"Comprobar"})}),renderRowActionMenuItems:({row:h})=>[s.jsx($,{onClick:()=>console.info("conciliation"),children:"Conciliación"},"conciliation"),s.jsx($,{onClick:()=>console.info("incidence"),children:"Incidencia"},"incidence"),s.jsx($,{onClick:()=>console.info("communication"),children:"Comunicación"},"communication"),s.jsx($,{onClick:()=>console.info("tag"),children:"Tag"},"tag")]}),W=((ts=B==null?void 0:B.getSelectedRowModel().flatRows)==null?void 0:ts.map(h=>h.original))??[],Is=d.useCallback(()=>{var b;const h=W.length>0?(b=W[0])==null?void 0:b.paymentProcessor:null;return!!!(W.every(c=>c.paymentProcessor===h)&&(B!=null&&B.getIsSomeRowsSelected()))},[W,B]);return s.jsxs(s.Fragment,{children:[s.jsxs(ss,{children:[s.jsx(Xs,{startDate:E,endDate:C,onChangeDateRange:js,onOpenBalance:()=>A(!0),loading:z}),s.jsx(Qs,{table:B})]}),s.jsx(pe,{open:p,setOpen:P,movements:W??[]}),s.jsx(de,{open:D,card:y,dateRange:i==null?void 0:i.text,onClose:()=>{A(!1)}})]})}function nt(){return s.jsx(Fs,{title:"Dashboard Master",children:s.jsxs(Hs,{children:[s.jsx(Vs,{name:"Dashboard Master",links:[{name:"Inicio",href:Os.root},{name:"Dashboard Master"}]}),s.jsx(V,{pb:4,children:s.jsxs(g,{flexDirection:{md:"row"},gap:3,children:[s.jsx(g,{minWidth:300,children:s.jsx(fs,{})}),s.jsx(g,{flex:1,children:s.jsx(ue,{})})]})}),s.jsx(Ls,{})]})})}export{nt as default};
