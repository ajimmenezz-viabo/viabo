import{c as z,f as V,U as C,u as q,i as e,S as t,T as m,B as v,b4 as O,dV as W,e7 as B,e2 as _,e8 as R,aT as U,ds as k,dw as Q,Q as $,P as x}from"./vendor-B39b6gT1.js";import{u as Y}from"./formik.esm-CRn2DIxC.js";import{c as G,a as p,d as w,f as H}from"./index.esm-DHXyn7Aa.js";import{g as L,b as D,a0 as K}from"./index-Kl2QvVyT.js";import{M as N,n as J,S as F,b as X}from"./ViaboSpeiCompanies-C5MoRVEO.js";import{i as A}from"./matchTypes-E5vQDj-t.js";import{V as Z}from"./viabo-card-CcTpX9JZ.js";import{F as y,R as S,a as ee}from"./TextMaxLine-BvJpBV6_.js";import{R as M}from"./RFSelect-CCRetmrq.js";import"./useViaboSpeiBreadCrumbs-DaixJMcW.js";import"./viabo-spei-paths-D6KJcfc8.js";import"./formatNumber-Byfz8vD2.js";import"./MaterialDataTable-BLrn9vSy.js";import"./ModalAlert-DU1WX_NF.js";import"./useMaterialTable-BgHRdWwm.js";import"./HeaderPage-CoeRaeoE.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./formatTime-DnNoLFDr.js";import"./UploadSingleFile-BV6pleIy.js";const re=r=>{var l,o,s,j,b,c,u,f,i;return{fiscalName:(l=r==null?void 0:r.fiscalName)==null?void 0:l.trim(),rfc:(o=r==null?void 0:r.rfc)==null?void 0:o.trim(),commercialName:(s=r==null?void 0:r.commercialName)==null?void 0:s.trim(),isNewUser:(r==null?void 0:r.method)===N.NEW_ADMIN_USER,assignedUsers:((j=r==null?void 0:r.adminUsers)==null?void 0:j.map(d=>d.value))||[],userName:(b=r==null?void 0:r.adminName)==null?void 0:b.trim(),userLastName:(c=r==null?void 0:r.adminLastName)==null?void 0:c.trim(),userEmail:(u=r==null?void 0:r.adminEmail)==null?void 0:u.trim(),userPhone:(f=r==null?void 0:r.adminPhone)==null?void 0:f.trim(),costCenters:((i=r==null?void 0:r.costCenters)==null?void 0:i.map(d=>d.value))||[],hasViaboCard:r==null?void 0:r.hasViaboCard}},se=(r={})=>{const l=z(),o=V(J,r);return{...o,mutate:async(j,b)=>{const{onSuccess:c,onError:u,mutationOptions:f}=b;try{await C.promise(o.mutateAsync(j,f),{pending:"Creando empresa...",success:{render({data:i}){return l.invalidateQueries([F.COMPANIES_LIST]),A(c)&&c(i),"Se creó la empresa con éxito"}}})}catch(i){const d=L(i,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");A(u)&&u(d),C.error(d,{type:D(i)})}}}},ae=(r={})=>{const l=z(),o=V(X,r);return{...o,mutate:async(j,b)=>{const{onSuccess:c,onError:u,mutationOptions:f}=b;try{await C.promise(o.mutateAsync(j,f),{pending:"Actualizando empresa...",success:{render({data:i}){return l.invalidateQueries([F.COMPANIES_LIST]),l.invalidateQueries([F.COMPANY_DETAILS,i==null?void 0:i.id]),A(c)&&c(i),"Se actualizó la empresa con éxito"}}})}catch(i){const d=L(i,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");A(u)&&u(d),C.error(d,{type:D(i)})}}}},ie=({adminCompanyUsers:r,costCenters:l,onSuccess:o,company:s})=>{const{mutate:j,isLoading:b}=se(),{mutate:c,isLoading:u}=ae(),f=G().shape({fiscalName:p().trim().required("Es necesario el nombre fiscal"),rfc:p().trim().required("Es necesario el rfc"),commercialName:p().trim().max(100,"Máximo 100 caracteres"),adminUsers:w().when("method",{is:N.ADMIN_USERS,then:a=>a.min(1,"Es necesario al menos un usuario administrador asignado a la empresa"),otherwise:a=>w()}),adminName:p().trim().when("method",{is:N.NEW_ADMIN_USER,then:a=>a.required("Es necesario el nombre del administrador"),otherwise:a=>p().trim()}),adminLastName:p().trim().when("method",{is:N.NEW_ADMIN_USER,then:a=>a.required("Es necesario los apellidos del administrador"),otherwise:a=>p().trim()}),adminEmail:p().trim().email("Ingrese un correo valido").when("method",{is:N.NEW_ADMIN_USER,then:a=>a.required("Es necesario el correo del administrador"),otherwise:a=>p().trim().email("Ingrese un correo valido")}),adminPhone:p().trim(),hasViaboCard:H(),costCenters:w()}),i=Y({initialValues:{fiscalName:(s==null?void 0:s.fiscalName)||"",commercialName:(s==null?void 0:s.commercialName)||"",rfc:(s==null?void 0:s.rfc)||"",method:N.ADMIN_USERS,adminUsers:(r==null?void 0:r.filter(a=>{var h;return(h=s==null?void 0:s.adminUsers)==null?void 0:h.includes(a==null?void 0:a.value)}))||[],costCenters:(l==null?void 0:l.filter(a=>{var h;return(h=s==null?void 0:s.costCenters)==null?void 0:h.includes(a==null?void 0:a.value)}))||[],adminName:"",adminLastName:"",adminEmail:"",adminPhone:"",hasViaboCard:!1},enableReinitialize:!0,validationSchema:f,onSubmit:(a,{setSubmitting:h,setFieldValue:te})=>{const P=re(a);return s?c({...P,id:s==null?void 0:s.id},{onSuccess:()=>{o(),h(!1)},onError:()=>{h(!1)}}):j(P,{onSuccess:()=>{o(),h(!1)},onError:()=>{h(!1)}})}}),{isSubmitting:d,setFieldValue:E,values:g,setTouched:T}=i,n=d||b||u,I=q();return e.jsx(y,{formik:i,children:e.jsxs(t,{spacing:2,children:[e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre Fiscal",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(S,{required:!0,name:"fiscalName",size:"small",disabled:n,placeholder:"Nombre Fiscal de la Empresa..."})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["RFC",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),s?e.jsx(m,{variant:"subtitle1",children:g==null?void 0:g.rfc}):e.jsx(S,{required:!0,name:"rfc",size:"small",placeholder:"RFC de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre Comercial"}),e.jsx(S,{inputProps:{maxLength:"100"},name:"commercialName",size:"small",placeholder:"Nombre Comercial de la Empresa...",disabled:n})]}),e.jsx(t,{children:e.jsxs(O,{disabled:n,children:[e.jsx(W,{id:"demo-row-radio-buttons-group-label",children:"Seleccione al administrador de la empresa:"}),e.jsxs(B,{value:g.method,onChange:a=>{!s&&E("adminUsers",[]),E("adminName",""),E("adminLastName",""),E("adminEmail",""),E("adminPhone",""),E("method",a.target.value),T({},!1)},row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",children:[e.jsx(_,{value:N.ADMIN_USERS,control:e.jsx(R,{}),label:"Administrador de Empresa Existente"}),e.jsx(_,{value:N.NEW_ADMIN_USER,control:e.jsx(R,{}),label:"Nuevo Administrador de Empresa"})]})]})}),g.method===N.ADMIN_USERS?e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Usuarios Administradores",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(M,{multiple:!0,name:"adminUsers",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:r||[],disabled:n})]}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre (s)",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(S,{name:"adminName",size:"small",required:!0,placeholder:"Nombre Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Apellido (s)",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(S,{name:"adminLastName",size:"small",required:!0,placeholder:"Apellidos del Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{flexDirection:{md:"row"},gap:2,children:[e.jsxs(t,{spacing:1,flex:1,children:[e.jsxs(m,{type:"email",paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Correo",e.jsx(v,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(S,{name:"adminEmail",size:"small",required:!0,placeholder:"admin.company@domino.com...",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(k,{})})},disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),e.jsx(S,{name:"adminPhone",type:"tel",size:"small",placeholder:"55 5555 5555",InputProps:{startAdornment:e.jsx(U,{position:"start",children:e.jsx(Q,{})})},disabled:n})]})]})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Centros de Costos"}),e.jsx(M,{multiple:!0,name:"costCenters",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:l||[],disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Servicios"}),e.jsxs(t,{justifyContent:"space-between",flexDirection:"row",alignItems:"center",children:[e.jsx(K,{disabledEffect:!0,visibleByDefault:!0,alt:"logo",src:Z,sx:{maxWidth:150,width:100,filter:(I==null?void 0:I.palette.mode)==="dark"?"brightness(0) invert(1) grayscale(100%)":"none"}}),e.jsx(ee,{disabled:b,size:"md",color:g.hasViaboCard?"success":"error",checked:!!g.hasViaboCard||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{E("hasViaboCard",!g.hasViaboCard)}})]})]}),e.jsx(t,{sx:{pt:1},children:e.jsx($,{size:"large",loading:n,variant:"contained",color:"primary",fullWidth:!0,type:"submit",children:s?"Actualizar":"Crear"})})]})})};ie.propTypes={adminCompanyUsers:x.array,company:x.shape({adminUsers:x.array,commercialName:x.string,costCenters:x.array,fiscalName:x.string,id:x.any,rfc:x.string}),costCenters:x.array,onSuccess:x.func};export{ie as default};
//# sourceMappingURL=SpeiNewCompanyForm-CTLZdGPW.js.map
