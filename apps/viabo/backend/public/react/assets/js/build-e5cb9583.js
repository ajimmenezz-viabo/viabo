import{t as L,j as e,av as R,r as h,_ as k,B as g,a7 as M,S as y,R as z,L as D,K as I,a as E,b as N,g as F,aA as Y,aB as Z,aC as J,Q as X,o as v,c as B,ad as V,T as b,a8 as m,Z as ss,a9 as es,P as x,ab as ts,a6 as as,af as rs,ai as is,aj as ns,aO as os,l as cs,ak as A,f as ds,al as ls,am as hs,an as ps}from"./index-d80df4f2.js";import{A as us}from"./build-aec534f9.js";import{f as xs,m as fs,E as ys,C as js,H as gs}from"./build-f74d8498.js";import{f as H,L as bs}from"./build-d7476723.js";import{b as Ss,A as Ts,a as Cs,C as Is}from"./build-8fc42554.js";import{D as ws}from"./build-75eddafd.js";import{C as Ls}from"./build-c0d58f38.js";import{S as Es}from"./build-67585b90.js";import{L as Os,S as Ms,a as _s,b as Ds,c as O,d as P}from"./build-bf16a813.js";import"./build-ac3d2487.js";import{I as As}from"./build-d7f513da.js";import{I as Ps}from"./build-1247f810.js";import{S as Rs}from"./build-95542c29.js";const ks=L(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),W=L(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8.46 14.45l-1.36-.62c.28-.61.41-1.24.4-1.86-.01-.63-.14-1.24-.4-1.8l1.36-.63c.35.75.53 1.56.54 2.4.01.86-.17 1.7-.54 2.51zm3.07 1.56-1.3-.74c.52-.92.78-1.98.78-3.15 0-1.19-.27-2.33-.8-3.4l1.34-.67c.64 1.28.96 2.65.96 4.07 0 1.43-.33 2.74-.98 3.89zm3.14 1.32-1.35-.66c.78-1.6 1.18-3.18 1.18-4.69 0-1.51-.4-3.07-1.18-4.64l1.34-.67c.9 1.78 1.34 3.56 1.34 5.31 0 1.74-.44 3.54-1.33 5.35z"}),"ContactlessSharp"),zs=L(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"Link"),Ns=L(e.jsx("path",{d:"M17 2H7c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 4H7V4h10v2zm3 16H4c-1.1 0-2-.9-2-2v-1h20v1c0 1.1-.9 2-2 2zm-1.47-11.81C18.21 9.47 17.49 9 16.7 9H7.3c-.79 0-1.51.47-1.83 1.19L2 18h20l-3.47-7.81zM9.5 16h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5z"}),"PointOfSale"),Fs=R(h.lazy(()=>k(()=>import("./build-c43ef1fe.js"),["assets/js/build-c43ef1fe.js","assets/js/index-d80df4f2.js","assets/css/build-f63bc8fe.css","assets/js/build-7e1065c5.js","assets/js/build-ac3d2487.js","assets/js/build-9cf33696.js","assets/js/build-8687dd75.js","assets/js/build-1247f810.js","assets/js/build-81cea643.js","assets/js/build-a2d34822.js","assets/js/build-7c868d50.js","assets/js/build-d7f513da.js","assets/js/build-d7476723.js","assets/js/build-bee6630b.js","assets/js/build-26ceff91.js","assets/js/build-ff186b5f.js","assets/js/build-92300a8f.js","assets/js/build-c0d58f38.js","assets/js/build-f74d8498.js","assets/js/build-5f0f07db.js","assets/js/build-8fc42554.js","assets/js/build-aec534f9.js","assets/js/build-75eddafd.js","assets/js/build-ec25e499.js","assets/js/build-ba2fcc4d.js","assets/js/build-5bcae247.js","assets/js/build-67585b90.js","assets/js/build-bf16a813.js","assets/js/build-95542c29.js"]))),Bs=R(h.lazy(()=>k(()=>import("./build-a83cb924.js"),["assets/js/build-a83cb924.js","assets/js/index-d80df4f2.js","assets/css/build-f63bc8fe.css","assets/js/build-ac3d2487.js","assets/js/build-9cf33696.js","assets/js/build-8687dd75.js","assets/js/build-1247f810.js","assets/js/build-81cea643.js","assets/js/build-a2d34822.js","assets/js/build-7c868d50.js","assets/js/build-d7f513da.js","assets/js/build-d7476723.js","assets/js/build-bee6630b.js","assets/js/build-20986720.js","assets/js/build-0c15f219.js","assets/js/build-58852775.js","assets/js/build-5b8cc769.js","assets/js/build-26ceff91.js","assets/js/build-ff186b5f.js","assets/js/build-fa3622be.js","assets/js/build-ba2fcc4d.js","assets/js/build-5bcae247.js","assets/js/build-92300a8f.js","assets/js/build-c0d58f38.js","assets/js/build-f74d8498.js","assets/js/build-5f0f07db.js","assets/js/build-aec534f9.js","assets/js/build-8fc42554.js","assets/js/build-75eddafd.js","assets/js/build-ec25e499.js","assets/js/build-67585b90.js","assets/js/build-bf16a813.js","assets/js/build-95542c29.js"]))),Vs=()=>{const[a,t]=h.useState(!1),[s,i]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{mb:2},children:e.jsx(M,{children:e.jsxs(y,{direction:"row",divider:e.jsx(z,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:3},spacing:1,children:[e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(D,{startIcon:e.jsx(zs,{}),variant:"contained",color:"info",onClick:()=>t(!0),children:"Liga de Pago"})}),e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(D,{startIcon:e.jsx(us,{}),color:"info",variant:"contained",onClick:()=>i(!0),children:"Terminal Virtual"})})]})})}),a&&e.jsx(Fs,{open:a,setOpen:t}),s&&e.jsx(Bs,{open:s,setOpen:i})]})},$={LIST:"commerce-terminals",MOVEMENTS:"terminal-movements"},Hs=a=>(a==null?void 0:a.map(t=>{var s,i,n,o;return{id:t==null?void 0:t.id,commerceId:t==null?void 0:t.commerceId,terminalId:t==null?void 0:t.terminalId,terminalON:((s=t==null?void 0:t.apiData)==null?void 0:s.status)===1,country:(i=t==null?void 0:t.apiData)==null?void 0:i.country,date:{created:(n=t==null?void 0:t.apiData)==null?void 0:n.created_at,updated:(o=t==null?void 0:t.apiData)==null?void 0:o.updated_at,register:t==null?void 0:t.registerDate},isVirtual:(t==null?void 0:t.typeId)==="1",name:(t==null?void 0:t.name)!==""?t==null?void 0:t.name.toString().toUpperCase():`TERMINAL-${t==null?void 0:t.terminalId}`,active:(t==null?void 0:t.active)==="1",balanceFormatted:H("0")}}))||[],Ws=a=>{var t;return((t=a==null?void 0:a.movements)==null?void 0:t.map(s=>{const i=parseFloat((s==null?void 0:s.amount)||"0"),n=s!=null&&s.transaction_date?I(new Date(s==null?void 0:s.transaction_date),"dd MMM yyyy"):"",o=s!=null&&s.transaction_date?I(new Date(s==null?void 0:s.transaction_date),"p"):"";return{id:s==null?void 0:s.id,amount:i,amountFormat:H(i),approved:s==null?void 0:s.approved,authNumber:(s==null?void 0:s.authorization_number)===""?"-":s==null?void 0:s.authorization_number,cardType:s==null?void 0:s.card_brand,cardNumber:s==null?void 0:s.card_number,cardBank:s==null?void 0:s.issuer,referenceNumber:s==null?void 0:s.reference,transactionDate:{fullDate:xs(s==null?void 0:s.transaction_date),date:n,time:o},description:`${(s==null?void 0:s.issuer)===""?s==null?void 0:s.card_brand:s==null?void 0:s.issuer}-${s==null?void 0:s.card_number}`.toUpperCase()}}))??[]},$s=async()=>{const{data:a}=await E.get("/api/commerces/terminals");return Hs(a)},xe=async a=>{const{data:t}=await E.post("/api/commerce/pay/new",a);return t},fe=async a=>{const{data:t}=await E.post("/api/commerce/virtual/pay",a);return t},Us=async(a,t,s)=>{const{data:i}=await E.get(`/api/commerces-pay/transactions?fromDate=${t}&toDate=${s}&terminalId=${a}`);return Ws(i)},Qs=(a={})=>{const[t,s]=h.useState(null);return{...N([$.LIST],$s,{staleTime:6e4,refetchOnMount:"always",onError:n=>{const o=F(n,"No se puede obtener la lista de terminales del comercio. Intente nuevamente o reporte a sistemas");s(o)},...a}),error:t||null}},Ks=(a,t,s={})=>{fs[Y(t)];const i=Z(t),n=J(t),o=I(i,"yyyy-MM-dd"),u=I(n,"yyyy-MM-dd"),[d,c]=h.useState(null);return{...N([$.MOVEMENTS,a],({signal:r})=>Us(a,o,u),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:r=>{const p=F(r,"No se puede obtener la lista de movimientos de la terminal. Intente nuevamente o reporte a sistemas");c(p),X.error(p,{type:v(r)})},...s}),error:d||null}},qs={terminal:null},Gs=(a,t)=>({...qs,setTerminal:s=>{const{terminal:i}=t();a(n=>({terminal:{...i,...s}}),!1,"SET_TERMINAL_SELECTED")},resetTerminal:()=>{a(s=>({pos:null}),!1,"RESET_TERMINAL_SELECTED")},addTerminalInfo:s=>{const{terminal:i}=t();a(n=>({terminal:{...i,...s}}),!1,"SET_TERMINAL_INFO")}}),w=B(Gs),Ys={terminals:[],isOpenList:!1,isCollapse:!1},Zs=(a,t)=>({...Ys,setTerminals:s=>{a(i=>({terminals:s}),!1,"SET_TERMINAL")},setOpenList:s=>{a(i=>({isOpenList:s}),!1,"SET_OPEN_LIST")},setCollapse:s=>{a(i=>({isCollapse:s}),!1,"SET_COLLAPSE")}}),f=B(Zs),Js=()=>{const[a,t]=h.useState(new Date),s=w(c=>c.terminal),{data:i,isFetching:n,refetch:o,isError:u}=Ks(s==null?void 0:s.terminalId,a,{enabled:!!(s!=null&&s.terminalId)});h.useEffect(()=>{o()},[a]),h.useEffect(()=>{t(new Date)},[s==null?void 0:s.id]);const d=[{name:"description",label:"Descripción",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c],p=r==null?void 0:r.approved;return e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(g,{sx:{position:"relative"},children:[e.jsx(V,{sx:{width:40,height:40,color:"text.secondary",bgcolor:"background.neutral"},children:e.jsx(Ts,{width:25,height:25})}),e.jsx(g,{sx:{right:0,bottom:0,width:15,height:15,display:"flex",borderRadius:"50%",position:"absolute",alignItems:"center",color:"common.white",bgcolor:"error.main",justifyContent:"center",...p&&{bgcolor:"success.main"}},children:p?e.jsx(Cs,{sx:{width:12,height:12}}):e.jsx(ks,{sx:{width:12,height:12}})})]}),e.jsxs(g,{sx:{ml:2},children:[e.jsxs(b,{variant:"subtitle2",children:[" ",r==null?void 0:r.description]}),e.jsx(b,{variant:"body2",sx:{color:p?"success.main":"error.main"},children:p?"Aprobada":"No Aprobada"})]})]})}}},{name:"cardType",label:"Tarjeta",options:{filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(b,{variant:"body2",children:r==null?void 0:r.cardType})}}},{name:"authNumber",label:"Autorización",options:{filterType:"textField",customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(b,{variant:"subtitle2",children:r==null?void 0:r.authNumber})}}},{name:"referenceNumber",label:"Referencia",options:{filterType:"textField",customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(b,{variant:"subtitle2",children:r==null?void 0:r.referenceNumber})}}},{name:"transactionDate.fullDate",label:"Fecha",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{var p,C;const r=i[c];return e.jsxs(y,{children:[e.jsx(b,{variant:"subtitle2",children:(p=r==null?void 0:r.transactionDate)==null?void 0:p.date}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},children:(C=r==null?void 0:r.transactionDate)==null?void 0:C.time})]})}}},{name:"amountFormat",label:"Cantidad",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(b,{variant:"subtitle2",fontWeight:"bold",children:r==null?void 0:r.amountFormat})}}}];return e.jsxs(Ls,{children:[e.jsx(Ss,{currentMonth:a,setCurrentMonth:t,isLoading:n}),e.jsx(z,{sx:{borderStyle:"dashed"}}),e.jsx(ws,{title:"Movimientos",data:i||[],columns:d,isLoading:n,options:{responsive:"simple",rowHover:!0,selectableRows:"none",selectableRowsOnClick:!1,selectToolbarPlacement:"replace",sortOrder:{name:"date",direction:"desc"},downloadOptions:{filename:`movimientos_terminal_${s==null?void 0:s.name}.csv`,filterOptions:{useDisplayedColumnsOnly:!1}}}})]})},Xs=()=>{const a=w(t=>t.terminal);return e.jsxs(y,{sx:t=>({pl:{xs:0,lg:2},overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[a&&e.jsxs(M,{children:[(a==null?void 0:a.isVirtual)&&e.jsx(Vs,{}),e.jsx(y,{pt:0,pb:4,px:2,children:e.jsx(Js,{})})]}),!a&&e.jsxs(y,{spacing:3,sx:{height:"100%",width:"100%"},children:[e.jsx(m,{variant:"filled",severity:"info",children:"Debe seleccionar una terminal para ver sus detalles!"}),e.jsx(y,{alignItems:"center",children:e.jsx(Es,{sx:{width:"30%"}})})]})]})},vs=ss(es)(({theme:a})=>({borderRadius:"8px!important",width:1,justifyContent:"center",display:"flex",alignItems:"center",mb:1})),U=({terminal:a})=>{const t=f(d=>d.isOpenList),s=f(d=>d.setOpenList),i=w(d=>d.setTerminal),n=w(d=>d.terminal);(a==null?void 0:a.id)===(n==null?void 0:n.id)&&n&&(n==null||n.cardON);const o=(a==null?void 0:a.id)===(n==null?void 0:n.id),u=d=>{var l;!((l=d.target)==null?void 0:l.type)&&!o&&(i(a),s(!1))};return e.jsx(ts,{title:a==null?void 0:a.name,arrow:!0,placement:"right",children:e.jsx(bs,{sx:{mb:1,padding:0,borderRadius:1,"& :hover":{color:"text.primary"}},disablePadding:!0,children:e.jsxs(vs,{onClick:u,sx:{...o&&{bgcolor:"secondary.light",color:"black","& :hover":{color:"text.primary"}},"& :hover":{color:"text.primary"},width:1,py:1,gap:1},children:[e.jsx(Os,{sx:{ml:2,m:0},children:e.jsx(g,{sx:{position:"relative"},children:e.jsx(V,{sx:d=>({width:32,height:32,m:0,backgroundColor:d.palette.primary.main,"& :hover":{color:"white"}}),children:a!=null&&a.isVirtual?e.jsx(W,{sx:{width:20,height:20,color:"white"}}):e.jsx(Ns,{sx:{width:16,height:16,color:"white"}})})})}),t&&e.jsx(e.Fragment,{children:e.jsx(y,{sx:{width:1},children:e.jsx(b,{noWrap:!0,variant:"subtitle2",children:a==null?void 0:a.name})})})]})})})};U.propTypes={terminal:x.shape({alias:x.any,id:x.any,isVirtual:x.any,name:x.any})};const Q=({terminalsQuery:a,sx:t,...s})=>{const{isLoading:i,data:n,error:o,isError:u,refetch:d}=a,c=f(r=>r.isOpenList),l=f(r=>r.terminals);return u&&c&&!n&&!i?e.jsx(as,{errorMessage:o,handleButton:d}):n&&c&&(n==null?void 0:n.length)===0&&!i?e.jsx(ys,{pt:2.5,message:"No hay terminales activas para este comercio"}):e.jsx(rs,{disablePadding:!0,sx:t,...s,children:(i?[...Array(12)]:l).map((r,p)=>r!=null&&r.id?e.jsx(U,{terminal:r},r==null?void 0:r.id):e.jsx(Ms,{isOpenSideBar:c},p))})};Q.propTypes={sx:x.any,terminalsQuery:x.shape({data:x.array,error:x.any,isError:x.any,isLoading:x.any,refetch:x.any})};const K=({commerceTerminals:a=[]})=>{const t=f(j=>j.isOpenList),s=f(j=>j.setOpenList),i=f(j=>j.setTerminals),n=f(j=>j.terminals),o=f(j=>j.isCollapse),[u,d]=h.useState(""),[c,l]=h.useState(!1),r=async j=>{try{const{value:T}=j.target;if(d(T),T){const G=(a==null?void 0:a.filter(S=>{var _;return(S==null?void 0:S.name)&&((_=S==null?void 0:S.name)==null?void 0:_.toLowerCase().indexOf(T.toLowerCase()))!==-1}))||[];i(G)}else i(a)}catch(T){console.error(T)}},p=()=>{t&&(d(""),i(a)),s(!t)},C=()=>{l(!0)},q=()=>{l(!1)};return h.useEffect(()=>{a&&i(a)},[a]),h.useEffect(()=>{if(!t)return l(!1)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(g,{sx:{p:2,px:0},children:e.jsxs(y,{direction:"row",justifyContent:t?"flex-end":"center",alignItems:"center",spacing:2,children:[!o&&e.jsx(Is,{onClickAway:q,children:e.jsx(As,{fullWidth:!0,size:"small",value:u,onFocus:C,onChange:r,placeholder:"Buscar Terminales...",InputProps:{startAdornment:e.jsx(Ps,{position:"start",children:e.jsx(Rs,{sx:{color:"text.disabled",width:20,height:20}})})}})}),e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",children:e.jsx(_s,{size:"small",sx:{...!t&&{transform:"rotate(180deg)"}},onClick:p,children:is})})]})}),(n==null?void 0:n.length)===0&&(a==null?void 0:a.length)>0&&e.jsx(ns,{sx:{p:1,display:"flex",flexDirection:"column",alignItems:"center"},searchQuery:u})]})};K.propTypes={commerceTerminals:x.array};const ms=()=>{const a=f(r=>r.setOpenList),t=f(r=>r.setCollapse),s=f(r=>r.isOpenList),i=Qs(),n=os(),o=cs("up","md"),u=o&&!s,d=()=>{a(!1)},c=()=>{a(!s)};h.useEffect(()=>{o&&a(!0)},[o]),h.useEffect(()=>{t(u)},[u]);const l=e.jsx(M,{sx:{height:.98},children:e.jsxs(y,{px:s?1:0,children:[e.jsx(K,{commerceTerminals:(i==null?void 0:i.data)||[]}),e.jsx(Q,{terminalsQuery:i})]})});return e.jsxs(e.Fragment,{children:[!o&&!s&&e.jsx(Ds,{onClick:c,children:e.jsx(W,{sx:{width:20,height:20}})}),o?e.jsx(A,{open:s,variant:"persistent",PaperProps:{sx:{height:1,borderRightStyle:"none",bgcolor:"background.default"}},sx:{height:1,width:O,transition:n.transitions.create("width"),"& .MuiDrawer-paper":{position:"static",backgroundColor:"transparent!important",width:O},...u&&{width:P,"& .MuiDrawer-paper":{width:P,backgroundColor:"transparent!important",position:"static",transform:"none !important",visibility:"visible !important"}}},children:l}):e.jsx(A,{ModalProps:{keepMounted:!0},open:s,onClose:d,sx:{height:1,"& .MuiDrawer-paper":{width:O,p:2}},children:l})]})},se=()=>e.jsx(ds,{title:"Lista de Terminales Punto de Venta",children:e.jsx(js,{children:e.jsxs(g,{display:"flex",overflow:"hidden",sx:{height:"100vH",maxHeight:"100%",flexDirection:"column"},children:[e.jsx(g,{px:1,children:e.jsx(gs,{name:"Terminales Punto de Venta",links:[{name:"Inicio",href:ls.root},{name:"Administracion",href:hs.terminals},{name:ps.terminals.name}]})}),e.jsxs(g,{display:"flex",overflow:"hidden",sx:{flex:"1 1 0%"},children:[e.jsx(g,{display:"block",width:1,position:"absolute"}),e.jsx(ms,{}),e.jsx(Xs,{})]})]})})}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{zs as L,ye as P,xe as c,fe as g,w as u};
