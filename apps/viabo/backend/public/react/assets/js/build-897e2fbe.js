import{aZ as Ce,a_ as Ve,a$ as $e,b0 as $,z as Ge,j as t,C as ae,r as g,_ as re,N as M,S as w,T as R,m as te,V as at,p as de,L as Ye,ah as rt,I as Z,H as it,B as z,E as Q,J as N,ay as G,ag as Me,d as be,g as Ee,Q as v,b as je,b1 as ke,b2 as Fe,W as ot,b3 as d,b4 as se,b5 as Y,b6 as lt,aT as ct,b7 as De,b8 as pe,b9 as ue,ba as he,bb as ce,az as xe,aA as fe,bc as _e,bd as Ae,be as dt,aC as qe,bf as J,aU as Be,bg as Se,bh as pt,a2 as ut,aB as ht,bi as xt,K as U,bj as ft,bk as gt,bl as yt,a5 as Ct,P as Mt,a9 as bt}from"./index-3809032b.js";import{a as Et}from"./build-02647ec5.js";import{f as F,L as jt}from"./build-566d20b3.js";import"./build-d59f6763.js";import{u as ge,C as Dt,M as St,L as wt,F as Tt}from"./build-38a50b1e.js";import{R as Rt}from"./build-30757a5f.js";import{C as It}from"./build-5f6917c9.js";import{g as Ot,B as Pt,a as kt}from"./build-9d77b025.js";import{S as Ft,g as _t}from"./build-7290ac90.js";import{C as we}from"./build-9f005fe0.js";import{C as Ke}from"./build-d7bdfd9c.js";import{C as me}from"./build-adedcfe4.js";import{D as Te}from"./build-643b05e8.js";import{a as Ue,b as At,c as Bt,d as Nt}from"./build-7637d2c3.js";import{c as Wt,r as Lt,i as Ht,g as zt,b as Vt,H as $t}from"./build-2b227f05.js";import{a as Gt}from"./build-8fbeaa5d.js";import{A as Yt}from"./build-1f7146f4.js";import{f as qt,g as Kt,h as mt,i as Ut,M as Xt}from"./build-1adb5778.js";import{G as A}from"./build-381d8d7c.js";import{a as Ne,S as We,T as Jt}from"./build-4389c83a.js";import{u as Qt}from"./build-961174a6.js";import{s as Zt}from"./build-fb129cc3.js";import"./build-ff91dbf2.js";import"./build-53b11780.js";import"./build-26daf111.js";import"./build-2969add5.js";import"./build-35d26722.js";import"./build-0d95e123.js";import"./build-ee266471.js";import"./build-f831d8b4.js";import"./build-46916aa3.js";import"./build-6fc59234.js";import"./build-6fc5dca7.js";import"./build-78fd7f79.js";import"./build-5af041c1.js";import"./build-e69012db.js";import"./build-7041d859.js";import"./build-4d4aa58d.js";import"./build-49cea08c.js";import"./build-f3f9b6e9.js";import"./build-e6290908.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-c6f78c0d.js";import"./build-627f2440.js";import"./build-bee6630b.js";import"./build-b0677c31.js";function Xe(e){Ce(1,arguments);var a;if(e&&typeof e.forEach=="function")a=e;else if(Ve(e)==="object"&&e!==null)a=Array.prototype.slice.call(e);else return new Date(NaN);var s;return a.forEach(function(o){var r=$e(o);(s===void 0||s<r||isNaN(Number(r)))&&(s=r)}),s||new Date(NaN)}function Je(e){Ce(1,arguments);var a;if(e&&typeof e.forEach=="function")a=e;else if(Ve(e)==="object"&&e!==null)a=Array.prototype.slice.call(e);else return new Date(NaN);var s;return a.forEach(function(o){var r=$e(o);(s===void 0||s>r||isNaN(r.getDate()))&&(s=r)}),s||new Date(NaN)}function vt(e){return Ce(1,arguments),$(e,Date.now())}const es=Ge(t.jsx("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z"}),"CalendarMonth"),Qe=Ge(t.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update"),ts=ae(g.lazy(()=>re(()=>import("./build-5f935abc.js"),["assets/js/build-5f935abc.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-ee266471.js","assets/js/build-35d26722.js","assets/js/build-38a50b1e.js","assets/js/build-26daf111.js","assets/js/build-9d77b025.js","assets/js/build-2b227f05.js","assets/js/build-53b11780.js","assets/js/build-c6f78c0d.js","assets/js/build-6fc59234.js","assets/js/build-f3f9b6e9.js","assets/js/build-e6290908.js","assets/js/build-2969add5.js","assets/js/build-1f7146f4.js","assets/js/build-bee6630b.js","assets/js/build-566d20b3.js","assets/js/build-0d95e123.js","assets/js/build-f831d8b4.js","assets/js/build-46916aa3.js","assets/js/build-4389c83a.js","assets/js/build-6fc5dca7.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-381d8d7c.js","assets/js/build-7637d2c3.js","assets/js/build-4d4aa58d.js","assets/js/build-78fd7f79.js","assets/js/build-8fbeaa5d.js","assets/js/build-627f2440.js","assets/js/build-5af041c1.js","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js","assets/js/build-e69012db.js","assets/js/build-7041d859.js","assets/js/build-adedcfe4.js","assets/js/build-49cea08c.js","assets/js/build-3e92a63a.js"]))),ss=ae(g.lazy(()=>re(()=>import("./build-1b71e6f5.js"),["assets/js/build-1b71e6f5.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-7637d2c3.js","assets/js/build-4389c83a.js","assets/js/build-53b11780.js","assets/js/build-4d4aa58d.js","assets/js/build-566d20b3.js","assets/js/build-c7ce8ef2.js","assets/js/build-78fd7f79.js","assets/js/build-8fbeaa5d.js","assets/js/build-2b227f05.js","assets/js/build-c6f78c0d.js","assets/js/build-6fc59234.js","assets/js/build-627f2440.js","assets/js/build-5af041c1.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-46916aa3.js","assets/js/build-381d8d7c.js","assets/js/build-f831d8b4.js","assets/js/build-8adb868c.js"]))),Ze=({open:e,setOpen:a,card:s,cardList:o=[]})=>{const[r,i]=g.useState(0),u=g.useMemo(()=>s==null?void 0:s.balance,[s==null?void 0:s.balance]),[n,h]=g.useState(!1),[x,c]=g.useState(null),[y,I]=g.useState(!1),p=g.useMemo(()=>(parseFloat(u)-r).toFixed(2)<0,[r,u]),D=()=>{a(!1),i(0),h(!1),c(null),I(!1)},T=_=>{const L=s==null?void 0:s.id;c({cardOriginId:L,isGlobal:!1,transactions:(_==null?void 0:_.transactions)||[],balance:u,currentBalance:r}),h(!0)},C=()=>{h(!1)},E=t.jsx(t.Fragment,{children:t.jsx(R,{variant:"h6",children:"Fondear Tarjetas"})}),P=t.jsxs(t.Fragment,{children:[t.jsxs(w,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,pt:2,children:[t.jsx(R,{variant:"subtitle1",children:"Saldo"}),t.jsxs(w,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(R,{variant:"h3",color:"success.main",children:F(u)}),t.jsx(R,{variant:"caption",color:"success.main",children:"MXN"})]}),t.jsxs(w,{direction:"row",spacing:1,alignItems:"center",children:[t.jsxs(R,{variant:"subtitle1",color:"error",children:["- ",F(r)]}),t.jsx(R,{variant:"caption",color:"error",children:"MXN"})]}),p&&t.jsx(R,{variant:"caption",color:"warning.main",textAlign:"center",children:"Saldo insuficiente para realizar la(s) operacion(es)"})]}),t.jsx(ts,{cards:o,setCurrentBalance:i,insufficient:p,isBinCard:!1,onSuccess:T})]});return t.jsx(Et,{open:e,handleClose:D,titleElement:E,children:e&&t.jsxs(t.Fragment,{children:[t.jsx(te.div,{initial:{opacity:1},animate:{opacity:n?0:1},transition:{duration:.5},style:{display:n?"none":"flex",flex:1,overflow:"hidden",flexDirection:"column"},children:P}),t.jsx(te.div,{initial:{opacity:0},animate:{opacity:n?1:0},transition:{duration:.5},style:{display:n?"flex":"none",flexDirection:"column",flex:1,overflow:"hidden"},children:t.jsx(ss,{data:x,onBack:C,setTransactionLoading:I,transactionLoading:y,onClose:D})})]})})};Ze.propTypes={card:M.shape({balance:M.any,id:M.any}),cardList:M.array,open:M.any,setOpen:M.func};function ve({isRefetchingCards:e,commerceCards:a,card:s}){const{isCollapse:o}=at(),r=ge(h=>h.setOpenFundingOrder),i=ge(h=>h.setFundingCard),[u,n]=g.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsxs(w,{px:2,py:1,gap:1,flexDirection:{lg:o?"row":"column",xl:"row"},justifyContent:"space-between",children:[t.jsx(de,{color:"primary",variant:"text",startIcon:t.jsx(Rt,{}),size:"small",onClick:()=>{r(!0),i(s)},children:"Orden Fondeo"}),t.jsx(Ye,{size:"small",variant:"text",color:"primary",startIcon:t.jsx(It,{}),loading:e,onClick:()=>{n(!0)},children:"Fondear Tarjetas"})]}),t.jsx(Ze,{setOpen:n,open:u,card:s,cardList:a})]})}ve.propTypes={card:M.any,commerceCards:M.any,isRefetchingCards:M.any};const ns={card:null,isMaster:!0,movements:[],balanceMovements:"$0.00",income:"$0.00",expenses:"$0.00",expensesWithInvoice:"$0.00",expensesWithoutInvoice:"$0.00",expensesWithoutChecked:"$0.00",totalExpensesOtherCharges:"$0.00",filterPaymentProcessor:null,filterDate:null},as=(e,a)=>({...ns,setGlobalCard:s=>{a(),e(o=>({card:s}),!1,"SET_GLOBAL_CARD")},resetGlobalCard:()=>{e(s=>({card:null}),!1,"RESET_GLOBAL_CARD")},setIsMaster:s=>{e(o=>({isMaster:s}),!1,"SET_IS_MASTER")},setMovements:s=>{e(o=>({movements:(s==null?void 0:s.movements)||[],balanceMovements:(s==null?void 0:s.balanceMovements)||"$0.00",expenses:(s==null?void 0:s.expenses)||"$0.00",income:(s==null?void 0:s.income)||"$0.00",expensesWithInvoice:(s==null?void 0:s.expensesWithInvoice)||"$0.00",expensesWithoutInvoice:(s==null?void 0:s.expensesWithoutInvoice)||"$0.00",expensesWithoutChecked:(s==null?void 0:s.expensesWithoutChecked)||"$0.00",totalExpensesOtherCharges:(s==null?void 0:s.totalExpensesOtherCharges)||"$0.00"}),!1,"SET_MASTER_MOVEMENTS")},getBalance:()=>{const{balanceMovements:s,income:o,expenses:r,expensesWithInvoice:i,expensesWithoutInvoice:u,expensesWithoutChecked:n,totalExpensesOtherCharges:h}=a();return{balanceMovements:s,income:o,expenses:r,expensesWithInvoice:i,expensesWithoutInvoice:u,expensesWithoutChecked:n,totalExpensesOtherCharges:h}},setFilterPaymentProcessor:s=>{e(o=>({filterPaymentProcessor:s}),!1,"SET_FILTER_PAYMENT_PROCESSOR")},setFilterDate:s=>{e(o=>({filterDate:s}),!1,"SET_FILTER_DATE")}}),W=rt(as),et=({card:e,cardSelected:a,isRefetchingCards:s,commerceCards:o,disableFilter:r=!1})=>{const[i,u]=g.useState(!1),n=Ot(e==null?void 0:e.paymentProcessor),h=n==null?void 0:n.component,x=(a==null?void 0:a.id)===(e==null?void 0:e.id),{setGlobalCard:c,setIsMaster:y,setFilterPaymentProcessor:I}=W(C=>C),p=g.useMemo(()=>o&&o[e==null?void 0:e.paymentProcessorId]||[],[o]),D=(p==null?void 0:p.length)||0,T=C=>E=>{r||(I(C==null?void 0:C.paymentProcessor),y(!1),c(C))};return t.jsx(w,{children:t.jsxs(we,{sx:{minWidth:{xs:300,md:"auto"},border:x?3:0,borderColor:C=>x?C.palette.mode==="dark"?C.palette.secondary.main:C.palette.primary.main:"inherit"},children:[t.jsx(Ke,{title:t.jsxs(w,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"space-between",children:[t.jsx(R,{variant:"caption",children:D===0?"":D+" Tarjetas"}),t.jsxs(w,{flexDirection:"row",alignItems:"center",sx:{flexWrap:"wrap"},gap:1,children:[n&&t.jsx(h,{sx:{width:30,height:30}}),t.jsx(Z,{variant:"outlined",title:`Copiar SPEI - ${e==null?void 0:e.spei}`,color:i?"success":"inherit",onClick:C=>{u(!0),it(e==null?void 0:e.SPEI),setTimeout(()=>{u(!1)},1e3)},children:i?t.jsx(me,{sx:{color:"success"}}):t.jsx(Ft,{sx:{width:25,height:25}})})]})]}),sx:{px:2,py:2}}),t.jsx(z,{component:r?"div":te.div,onClick:T(e),...r?{}:{whileTap:{scale:.8},style:{cursor:"pointer"}},children:t.jsxs(w,{alignItems:"center",pb:2,px:2,children:[t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(R,{variant:"h6",children:e==null?void 0:e.balanceFormatted}),t.jsx(R,{variant:"caption",children:"MXN"})]}),t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(Qe,{sx:{width:20,height:20,color:"text.secondary"}}),t.jsxs(w,{alignItems:"center",children:[t.jsx(R,{variant:"subtitle2",children:"En transito"}),t.jsxs(w,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(R,{variant:"body2",children:e==null?void 0:e.inTransitFormatted}),t.jsx(R,{variant:"caption",children:"MXN"})]})]})]})]})}),t.jsx(Q,{sx:{borderStyle:"dashed"}}),t.jsx(ve,{isRefetchingCards:s,commerceCards:p,card:e})]})},e==null?void 0:e.cardId)};et.propTypes={card:M.shape({SPEI:M.any,balanceFormatted:M.any,cardId:M.any,id:M.any,inTransitFormatted:M.any,paymentProcessor:M.any,paymentProcessorId:M.any,spei:M.any}),cardSelected:M.shape({id:M.any}),commerceCards:M.any,disableFilter:M.bool,isRefetchingCards:M.any};const rs={"MASTER CARD":"1",MASTERCARD:"1",CARNET:"2"},is=e=>{const a=Ue(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);let s=0,o=0;const r=a==null?void 0:a.map(i=>{var u;return s+=parseFloat(i==null?void 0:i.balance),o+=parseFloat(i==null?void 0:i.inTransit),{...i,paymentProcessorId:rs[(u=i==null?void 0:i.paymentProcessor)==null?void 0:u.toUpperCase()]??null,id:i==null?void 0:i.cardId,SPEI:i==null?void 0:i.spei,balanceFormatted:F(i==null?void 0:i.balance),inTransitFormatted:F(i==null?void 0:i.inTransit)}});return{master:{balance:s,inTransit:o,balanceFormatted:F(s),inTransitFormatted:F(o)},globals:r}},os=e=>{const a=Ue(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);let s=0,o=0,r=0,i=0,u=0;return{movements:(a==null?void 0:a.map(n=>{var T,C,E;const h=parseFloat((n==null?void 0:n.amount)||"0");(n==null?void 0:n.type.toLowerCase())==="gasto"&&(s+=h),(n==null?void 0:n.type.toLowerCase())==="ingreso"&&(o+=h);const x=n!=null&&n.receiptFiles?(T=n==null?void 0:n.receiptFiles)==null?void 0:T.split(","):[],c=x==null?void 0:x.reduce((P,_)=>(_.endsWith(".xml")?P.xml=_:_.endsWith(".pdf")&&(P.pdf=_),P),{xml:null,pdf:null}),y=(c==null?void 0:c.xml)!==null&&(c==null?void 0:c.pdf)!==null,I=n!=null&&n.date?N(new Date(n==null?void 0:n.date),"dd MMM yyyy",{locale:G}):"",p=n!=null&&n.date?N(new Date(n==null?void 0:n.date),"p"):"",D=((C=n==null?void 0:n.operationType)==null?void 0:C.toLowerCase())==="otros cargos";return D&&(n!=null&&n.checked)&&y&&(i+=h),D&&(n!=null&&n.checked)&&!y&&(r+=h),D&&!(n!=null&&n.checked)&&(u+=h),{id:n==null?void 0:n.transactionId,fullDate:Wt(n==null?void 0:n.date),date:I,time:p,serverDate:n==null?void 0:n.date,description:n==null?void 0:n.description,amount:h,amountFormat:F(h),paymentProcessor:n==null?void 0:n.cardPaymentProcessor,type:n==null?void 0:n.type.toLowerCase(),operationType:(E=n==null?void 0:n.operationType)==null?void 0:E.toUpperCase(),concept:(n==null?void 0:n.concept)??"",cardId:n==null?void 0:n.cardId,commerceId:n==null?void 0:n.cardCommerceId,verified:!!(n!=null&&n.checked),isMainCard:!!(n!=null&&n.cardMain),expensesControl:{id:n==null?void 0:n.receiptId,isInvoice:y,invoiceFiles:c,otherFiles:y?[]:x},original:n}}))??[],income:F(o),expenses:F(s),balanceMovements:F(o-s),expensesWithInvoice:F(i),expensesWithoutInvoice:F(r),expensesWithoutChecked:F(u),totalExpensesOtherCharges:F(i+r+u)}},ls=async()=>{const{data:e}=await Me.get("/api/main-cards/information");return is(e)},cs=async(e,a,s)=>{const o=new URL("/api/master-cards/movements",window.location.origin);o.searchParams.set("startDate",e),o.searchParams.set("endDate",a);const{data:r}=await Me.get(o.href);return os(r)},ds=async e=>{const a={},s=e.map(o=>Me.get(`/api/enabled-cards/commerce?paymentProcessorId=${o}`).then(r=>Gt(r.data)).then(r=>{a[o]=r}));return await Promise.all(s),a},ps=(e,a={})=>{const[s,o]=g.useState(null),r=be({queryKey:[Te.COMMERCE_CARDS],queryFn:({signal:i})=>ds(e),staleTime:6e4,...a});return g.useEffect(()=>{if(r!=null&&r.isError){const i=Ee(r.error,"No se puede obtener la lista de tarjetas del comercio. Intente nuevamente o reporte a sistemas");o(i),v.error(i,{type:je(r.error)})}},[r.isError,r.error]),{...r,error:s||null}},us=(e={})=>{const[a,s]=g.useState(null),o=ge(i=>i.setMainCard);return{...be([Te.GLOBAL_CARDS],ls,{staleTime:6e4,refetchOnWindowFocus:!1,onError:i=>{const u=Ee(i,"No se puede obtener la informacion de las tarjetas principales");s(u),o(null),v.error(u,{type:je(i)})},onSuccess:i=>{o(i)},...e}),error:a||null}},hs=(e,a,s={})=>{if(!e||!a)return null;const o=N(ke(e),"yyyy-MM-dd"),r=N(Fe(a),"yyyy-MM-dd"),[i,u]=g.useState(null),{setMovements:n,setFilterDate:h}=W(c=>c);return{...be([Te.MOVEMENTS],({signal:c})=>cs(o,r),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:c=>{const y=Ee(c,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");u(y),v.error(y,{type:je(c)}),n(null)},onSuccess:c=>{h({startDate:ke(e),endDate:Fe(a),text:`${N(e,"dd MMMM yyyy",{locale:G})} - ${N(a,"dd MMMM yyyy",{locale:G})}`})},...s}),error:i||null}};function tt({data:e,isLoading:a}){var I;const s=W(p=>p.card),o=W(p=>p.resetGlobalCard),r=W(p=>p.setIsMaster),i=W(p=>p.setFilterPaymentProcessor),u=W(p=>p.isMaster),n=g.useMemo(()=>{var p;return((p=e==null?void 0:e.globals)==null?void 0:p.reduce((D,T)=>(D.push(T.paymentProcessorId),D),[]))||null},[e==null?void 0:e.globals]),{data:h,isRefetching:x}=ps(n,{enabled:!!n}),c=e==null?void 0:e.master,y=e==null?void 0:e.globals;return t.jsx(Yt,{children:t.jsxs(w,{spacing:2,flex:1,children:[a&&t.jsx(ot,{}),!a&&t.jsxs(t.Fragment,{children:[((I=e==null?void 0:e.globals)==null?void 0:I.length)>1&&t.jsx(te.div,{onClick:()=>{r(!0),o(),i(null)},whileHover:{scale:1.03},whileTap:{scale:.8},children:t.jsxs(we,{sx:{p:0,cursor:"pointer",border:u?3:0,borderColor:p=>u?p.palette.mode==="dark"?p.palette.secondary.main:p.palette.primary.main:"inherit"},children:[t.jsx(Ke,{title:t.jsx(w,{flexDirection:"row",gap:1,alignItems:"center",children:t.jsx(R,{variant:"subtitle2",children:"Global [Master]"})}),sx:{px:2,py:2}}),t.jsxs(w,{alignItems:"center",pb:2,px:2,children:[t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(R,{variant:"h3",children:c==null?void 0:c.balanceFormatted}),t.jsx(R,{variant:"caption",children:"MXN"})]}),t.jsxs(w,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(Qe,{sx:{width:30,height:30,color:"text.secondary"}}),t.jsxs(w,{alignItems:"center",children:[t.jsx(R,{variant:"subtitle2",children:"En transito"}),t.jsxs(w,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(R,{variant:"body1",children:c==null?void 0:c.inTransitFormatted}),t.jsx(R,{variant:"caption",children:"MXN"})]})]})]})]})]})}),y==null?void 0:y.map(p=>{var D;return t.jsx(et,{card:p,cardSelected:s,isRefetchingCards:x,commerceCards:h,disableFilter:((D=e==null?void 0:e.globals)==null?void 0:D.length)<=1},p==null?void 0:p.id)})]})]})})}tt.propTypes={data:M.shape({globals:M.array,master:M.shape({balanceFormatted:M.any,inTransitFormatted:M.any})}),isLoading:M.any};var Re={},xs=Ht;Object.defineProperty(Re,"__esModule",{value:!0});var st=Re.default=void 0,fs=xs(Lt()),gs=t,ys=(0,fs.default)((0,gs.jsx)("path",{d:"M16.01 11H4v2h12.01v3L20 12l-3.99-4z"}),"ArrowRightAlt");st=Re.default=ys;const Cs=(e,a)=>Array.from({length:Math.ceil(e.length/a)},(s,o)=>e.slice(o*a,o*a+a)),Ms=(e,a)=>{const s=ue(xe(e),{locale:a}),o=he(fe(e),{locale:a}),r=[];for(let i=s;J(i,o);)r.push(i),i=pe(i,1);return r},bs=({startDate:e},a)=>e&&$(a,e),Es=({endDate:e},a)=>e&&$(a,e),js=({startDate:e,endDate:a},s)=>e&&a&&(Se(s,{start:e,end:a})||$(s,e)||$(s,a)),Ds=({startDate:e,endDate:a})=>e&&a?$(e,a):!1,Le=(e,a)=>{if(e){const s=e instanceof Date?e:lt(e);if(ct(s))return s}return a},Ss=(e,a,s)=>{const{startDate:o,endDate:r}=e;if(o&&r){const i=Xe([o,a]),u=Je([r,s]);return[i,De(i,u)?Y(i,1):u]}return[o,r]},ws=(e,a)=>[{label:"Today",startDate:e,endDate:e},{label:"Yesterday",startDate:pe(e,-1),endDate:pe(e,-1)},{label:"This Week",startDate:ue(e,{locale:a}),endDate:he(e,{locale:a})},{label:"Last Week",startDate:ue(ce(e,-1),{locale:a}),endDate:he(ce(e,-1),{locale:a})},{label:"Last 7 Days",startDate:ce(e,-1),endDate:e},{label:"This Month",startDate:xe(e),endDate:fe(e)},{label:"Last Month",startDate:xe(Y(e,-1)),endDate:fe(Y(e,-1))},{label:"This Year",startDate:_e(e),endDate:Ae(e)},{label:"Last Year",startDate:_e(se(e,-1)),endDate:Ae(se(e,-1))}],Ts=(e,a)=>{const s=Math.floor(a/2);return Array(a).fill(0).map((o,r)=>e.getFullYear()-s+r)},Rs=({date:e,setDate:a,nextDisabled:s,prevDisabled:o,onClickNext:r,onClickPrevious:i,locale:u})=>{const n=typeof u<"u"?[...Array(12).keys()].map(c=>{var y;return(y=u.localize)===null||y===void 0?void 0:y.month(c,{width:"abbreviated",context:"standalone"})}):["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],h=c=>{a(gt(e,parseInt(c.target.value,10)))},x=c=>{a(yt(e,parseInt(c.target.value,10)))};return d.createElement(A,{container:!0,justifyContent:"space-between",alignItems:"center"},d.createElement(A,{item:!0,sx:{padding:"5px"}},d.createElement(Z,{sx:{padding:"10px","&:hover":{background:"none"}},disabled:o,onClick:i},d.createElement(Kt,{color:o?"disabled":"action"}))),d.createElement(A,{item:!0},d.createElement(Ne,{variant:"standard"},d.createElement(We,{value:xt(e),onChange:h,MenuProps:{disablePortal:!0}},n.map((c,y)=>d.createElement(U,{key:c,value:y},c))))),d.createElement(A,{item:!0},d.createElement(Ne,{variant:"standard"},d.createElement(We,{value:ft(e),onChange:x,MenuProps:{disablePortal:!0}},Ts(e,30).map(c=>d.createElement(U,{key:c,value:c},c))))),d.createElement(A,{item:!0,sx:{padding:"5px"}},d.createElement(Z,{sx:{padding:"10px","&:hover":{background:"none"}},disabled:s,onClick:r},d.createElement(mt,{color:s?"disabled":"action"}))))},Is=({startOfRange:e,endOfRange:a,disabled:s,highlighted:o,outlined:r,filled:i,onClick:u,onHover:n,value:h})=>d.createElement(z,{sx:{display:"flex",borderRadius:e?"50% 0 0 50%":a?"0 50% 50% 0":void 0,backgroundColor:x=>!s&&o?x.palette.primary.light:void 0}},d.createElement(Z,{sx:Object.assign({height:"36px",width:"36px",padding:0,border:x=>!s&&r?`1px solid ${x.palette.primary.dark}`:void 0},!s&&i?{"&:hover":{backgroundColor:x=>x.palette.primary.dark},backgroundColor:x=>x.palette.primary.dark}:{}),disabled:s,onClick:u,onMouseOver:n},d.createElement(R,{sx:{lineHeight:1.6,color:x=>s?x.palette.text.secondary:i?x.palette.primary.contrastText:x.palette.text.primary},variant:"body2"},h)));var ne;(function(e){e[e.Previous=-1]="Previous",e[e.Next=1]="Next"})(ne||(ne={}));const He=e=>{var a;const{helpers:s,handlers:o,value:r,dateRange:i,marker:u,setValue:n,minDate:h,maxDate:x,locale:c}=e,y=((a=c==null?void 0:c.options)===null||a===void 0?void 0:a.weekStartsOn)||0,I=typeof c<"u"?[...Array(7).keys()].map(T=>{var C;return(C=c.localize)===null||C===void 0?void 0:C.day((T+y)%7,{width:"short",context:"standalone"})}):["Su","Mo","Tu","We","Th","Fr","Sa"],[p,D]=e.navState;return d.createElement(qe,{square:!0,elevation:0,sx:{width:290}},d.createElement(A,{container:!0},d.createElement(Rs,{date:r,setDate:n,nextDisabled:!D,prevDisabled:!p,onClickPrevious:()=>o.onMonthNavigate(u,ne.Previous),onClickNext:()=>o.onMonthNavigate(u,ne.Next),locale:c}),d.createElement(A,{item:!0,container:!0,direction:"row",justifyContent:"space-between",sx:{marginTop:"10px",paddingLeft:"30px",paddingRight:"30px"}},I.map((T,C)=>d.createElement(R,{color:"textSecondary",key:C,variant:"caption"},T))),d.createElement(A,{item:!0,container:!0,direction:"column",justifyContent:"space-between",sx:{paddingLeft:"15px",paddingRight:"15px",marginTop:"15px",marginBottom:"20px"}},Cs(Ms(r,c),7).map((T,C)=>d.createElement(A,{key:C,container:!0,direction:"row",justifyContent:"center"},T.map(E=>{const P=bs(i,E),_=Es(i,E),B=Ds(i),L=js(i,E)||s.inHoverRange(E);return d.createElement(Is,{key:N(E,"dd-MM-yyyy"),filled:P||_,outlined:vt(E),highlighted:L&&!B,disabled:!De(r,E)||!Se(E,{start:h,end:x}),startOfRange:P&&!B,endOfRange:_&&!B,onClick:()=>o.onDayClick(E),onHover:()=>o.onDayHover(E),value:pt(E)})}))))))},ze=(e,a)=>{const{startDate:s,endDate:o}=e,{startDate:r,endDate:i}=a;return s&&r&&o&&i?$(s,r)&&$(o,i):!1},Os=({ranges:e,setRange:a,selectedRange:s,verticalOrientation:o})=>d.createElement(ut,{sx:{flexDirection:o?"row":"column",display:"flex",overflowY:"scroll"}},e.map((r,i)=>d.createElement(jt,{button:!0,key:i,onClick:()=>a(r),sx:[ze(r,s)&&{backgroundColor:u=>u.palette.primary.dark,color:"primary.contrastText","&:hover":{color:"inherit"}}]},d.createElement(ht,{primaryTypographyProps:{variant:"body2",sx:{fontWeight:ze(r,s)?"bold":"normal"}}},r.label)))),ye={FIRST_MONTH:Symbol("firstMonth"),SECOND_MONTH:Symbol("secondMonth")},Ps={writingMode:"vertical-lr",transform:"rotate(180deg)"},ks=e=>{const{ranges:a,dateRange:s,minDate:o,maxDate:r,firstMonth:i,setFirstMonth:u,secondMonth:n,setSecondMonth:h,setDateRange:x,helpers:c,handlers:y,locale:I,verticalOrientation:p}=e,{startDate:D,endDate:T}=s,C=dt(n,i)>=2,E={dateRange:s,minDate:o,maxDate:r,helpers:c,handlers:y},P=Object.assign({flex:1,textAlign:"center"},p?Ps:{});return d.createElement(qe,{elevation:5,square:!0},d.createElement(A,{container:!0,direction:p?"column":"row",wrap:"nowrap"},d.createElement(A,null,d.createElement(Os,{selectedRange:s,ranges:a,setRange:x,verticalOrientation:p})),d.createElement(Q,{orientation:p?"horizontal":"vertical",flexItem:!0}),d.createElement(A,{display:"flex",flexDirection:p?"row":"column"},d.createElement(A,{container:!0,direction:p?"column":"row",sx:p?{}:{padding:"20px 70px"},alignItems:"center"},d.createElement(A,{item:!0,sx:P},d.createElement(R,{variant:"subtitle1"},D?N(D,"dd MMMM yyyy",{locale:I}):"Start Date")),d.createElement(A,{item:!0,sx:{flex:p?.5:1,display:"flex",justifyContent:"center",alignItems:"center"}},p?d.createElement(qt,{color:"action"}):d.createElement(st,{color:"action"})),d.createElement(A,{item:!0,sx:P},d.createElement(R,{variant:"subtitle1"},T?N(T,"dd MMMM yyyy",{locale:I}):"End Date"))),d.createElement(Q,null),d.createElement(A,{container:!0,direction:p?"column":"row",justifyContent:"center",wrap:"nowrap"},d.createElement(He,Object.assign({},E,{value:i,setValue:u,navState:[!0,C],marker:ye.FIRST_MONTH,locale:I})),d.createElement(Q,{orientation:p?"horizontal":"vertical",flexItem:!0}),d.createElement(He,Object.assign({},E,{value:n,setValue:h,navState:[C,!0],marker:ye.SECOND_MONTH,locale:I}))))))},Fs=e=>{const a=new Date,{open:s,onChange:o,initialDateRange:r,minDate:i,maxDate:u,definedRanges:n=ws(new Date,e.locale),locale:h,verticalOrientation:x}=e,c=Le(i,se(a,-10)),y=Le(u,se(a,10)),[I,p]=Ss(r||{},c,y),[D,T]=g.useState(Object.assign({},r)),[C,E]=g.useState(),[P,_]=g.useState(I||a),[B,L]=g.useState(p||Y(P,1)),{startDate:V,endDate:X}=D,ie=l=>{J(l,B)&&_(l)},oe=l=>{Be(l,P)&&L(l)},H=l=>{let{startDate:S,endDate:b}=l;if(S&&b)l.startDate=S=Xe([S,c]),l.endDate=b=Je([b,y]),T(l),o(l),_(S),L(De(S,b)?Y(S,1):b);else{const K={};T(K),o(K),_(a),L(Y(P,1))}},q=l=>{if(V&&!X&&!J(l,V)){const S={startDate:V,endDate:l};o(S),T(S)}else T({startDate:l,endDate:void 0});E(l)},le=(l,S)=>{if(l===ye.FIRST_MONTH){const b=Y(P,S);J(b,B)&&_(b)}else{const b=Y(B,S);J(P,b)&&L(b)}},ee=l=>{V&&!X&&(!C||!$(l,C))&&E(l)},k={inHoverRange:l=>V&&!X&&C&&Be(C,V)&&Se(l,{start:V,end:C})},O={onDayClick:q,onDayHover:ee,onMonthNavigate:le};return s?g.createElement(ks,{dateRange:D,minDate:c,maxDate:y,ranges:n,firstMonth:P,secondMonth:B,setFirstMonth:ie,setSecondMonth:oe,setDateRange:H,helpers:k,handlers:O,locale:h,verticalOrientation:!!x}):null},_s=e=>{const{closeOnClickOutside:a,wrapperClassName:s,toggle:o,open:r}=e,i=()=>{a!==!1&&o()},u=n=>(n==null?void 0:n.key)==="Escape"&&i();return d.createElement(z,{sx:{position:"relative"}},r&&d.createElement(z,{sx:{position:"fixed",height:"100vh",width:"100vw",bottom:0,zIndex:0,right:0,left:0,top:0},onKeyPress:u,onClick:i}),d.createElement(z,{sx:{position:"relative",zIndex:1},className:s},d.createElement(Fs,Object.assign({},e))))},As=e=>d.createElement(_s,Object.assign({},e)),nt=({startDate:e,endDate:a,onChangeDateRange:s,loading:o,onOpenBalance:r})=>{const i=g.useMemo(()=>zt(),[]),u=g.useRef(null),n=Ct("down","md"),[h,x]=g.useState(!1),[c,y]=g.useState(h),I=()=>{x(!h),h||y(!0)},p=g.useMemo(()=>e?N(e,"dd MMMM yyyy",{locale:G}):N(new Date,"dd MMMM yyyy",{locale:G}),[e]),D=g.useMemo(()=>a?N(a,"dd MMMM yyyy",{locale:G}):N(new Date,"dd MMMM yyyy",{locale:G}),[a]),T=`${p} - ${D}`;return t.jsxs(t.Fragment,{children:[t.jsxs(w,{py:2,px:1,flexDirection:{lg:"row"},justifyContent:"space-between",alignItems:"center",gap:1,children:[t.jsxs(w,{flex:1,direction:"row",spacing:.5,children:[t.jsx(Z,{disabled:!!o,onClick:I,size:"small",children:t.jsx(es,{})}),t.jsx(w,{minWidth:300,flex:1,children:t.jsx(Jt,{placeholder:"Fecha inicial - Fecha final",value:T,fullWidth:!0,type:"text",variant:"outlined",size:"small",disabled:!!o,onClick:I,InputProps:{readOnly:!0}})})]}),t.jsx(z,{display:"flex",flexGrow:1}),t.jsx(z,{display:"flex",flexGrow:1,justifyContent:"flex-end",children:t.jsx(de,{variant:"contained",color:"secondary",disabled:!!o,startIcon:t.jsx(Dt,{}),sx:{color:"text.primary",fontWeight:"bolder"},onClick:r,children:"Ver Balance del Periodo"})}),t.jsxs(At,{open:c,ref:u,scroll:"body","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",maxWidth:"md",children:[t.jsx(Ut,{variant:"subtitle1",fontWeight:"bolder",id:"scroll-dialog-title",children:"Confirma las fechas seleccionadas"}),t.jsx(Bt,{id:"scroll-dialog-description",dividers:!0,children:t.jsx(As,{open:h,onChange:s,verticalOrientation:n,toggle:I,locale:G,definedRanges:i,closeOnClickOutside:!1,wrapperClassName:"simple-date-range"})}),t.jsx(Nt,{children:t.jsx(de,{variant:"contained",color:"primary",onClick:()=>{y(!1),setTimeout(()=>{x(!1)},200)},children:"Hecho"})})]})]}),t.jsx(Q,{sx:{borderStyle:"dashed"}})]})};nt.propTypes={endDate:M.any.isRequired,loading:M.any,onChangeDateRange:M.func.isRequired,onOpenBalance:M.func,startDate:M.any.isRequired};const Bs=ae(g.lazy(()=>re(()=>import("./build-a9f8f40e.js"),["assets/js/build-a9f8f40e.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js"]))),Ns=ae(g.lazy(()=>re(()=>import("./build-9620adc6.js"),["assets/js/build-9620adc6.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js","assets/js/build-4389c83a.js","assets/js/build-53b11780.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-46916aa3.js","assets/js/build-2b227f05.js","assets/js/build-c6f78c0d.js","assets/js/build-6fc59234.js","assets/js/build-381d8d7c.js","assets/js/build-7637d2c3.js","assets/js/build-4d4aa58d.js","assets/js/build-566d20b3.js","assets/js/build-f831d8b4.js"])));function Ws(){var ee;const e=new Date,a=W(j=>j.filterPaymentProcessor),{setMovements:s,getBalance:o}=W(j=>j),r=W(j=>j.filterDate),i=W(j=>j.movements),u=g.useMemo(()=>r!=null&&r.startDate?new Date(r==null?void 0:r.startDate):Zt(e,{days:30}),[r==null?void 0:r.startDate]),n=g.useMemo(()=>r!=null&&r.endDate?new Date(r==null?void 0:r.endDate):e,[r==null?void 0:r.endDate]),h=g.useMemo(()=>o(),[i]),[x,c]=g.useState(u),[y,I]=g.useState(n),[p,D]=g.useState(!1),[T,C]=g.useState(!1),{data:E,isError:P,isLoading:_,isFetching:B,error:L,refetch:V}=hs(x,y);g.useEffect(()=>{x&&y&&V()},[x,y]),g.useEffect(()=>{var j;if(a){let k=0,O=0,l=0,S=0,b=0;const K=(j=E==null?void 0:E.movements)==null?void 0:j.filter(f=>{var m;return((m=f==null?void 0:f.paymentProcessor)==null?void 0:m.toLowerCase())===(a==null?void 0:a.toLowerCase())});K==null||K.forEach(f=>{var Ie,Oe,Pe;(f==null?void 0:f.type.toLowerCase())==="gasto"?k+=f==null?void 0:f.amount:O+=f==null?void 0:f.amount;const m=((Ie=f==null?void 0:f.operationType)==null?void 0:Ie.toLowerCase())==="otros cargos";m&&(f!=null&&f.verified)&&((Oe=f==null?void 0:f.expensesControl)!=null&&Oe.isInvoice)&&(S+=f==null?void 0:f.amount),m&&(f!=null&&f.verified)&&!((Pe=f==null?void 0:f.expensesControl)!=null&&Pe.isInvoice)&&(l+=f==null?void 0:f.amount),m&&!(f!=null&&f.verified)&&(b+=f==null?void 0:f.amount)}),s({movements:K,income:F(O),expenses:F(k),balanceMovements:F(O-k),expensesWithInvoice:F(S),expensesWithoutInvoice:F(l),expensesWithoutChecked:F(b),totalExpensesOtherCharges:F(S+l+b)})}else s(E)},[a,E]);const X=j=>{const{startDate:k,endDate:O}=j;O!==null&&k!==null&&(I(O),c(k))},ie=j=>()=>{var S;const k=((S=j==null?void 0:j.getSelectedRowModel().flatRows)==null?void 0:S.map(b=>b.original))??[],O=k==null?void 0:k.some(b=>b==null?void 0:b.verified),l=k==null?void 0:k.some(b=>(b==null?void 0:b.operationType)!=="OTROS CARGOS");return O?v.warn("Existen movimientos que ya se encuentran comprobados, verifique los movimientos seleccionados."):l?v.warn("Existen movimientos que no se pueden comprobar, verifique el tipo de movimiento."):D(!0)},oe=g.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({cell:j,column:k,row:O})=>{const{original:l}=O;return t.jsx(St,{row:l})}},{accessorKey:"serverDate",header:"Fecha",size:120,Cell:({cell:j,column:k,row:O})=>{const{original:l}=O;return t.jsx(w,{children:t.jsx(R,{variant:"subtitle2",children:l==null?void 0:l.fullDate})})}},{accessorKey:"operationType",header:"Tipo",filterVariant:"multi-select",size:100,Cell:({cell:j,column:k,row:O})=>{const{original:l}=O,S=_t(l==null?void 0:l.operationType),b=S==null?void 0:S.component;return t.jsx(z,{children:S?t.jsx(b,{sx:{width:25,height:25}}):t.jsx(wt,{size:22})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:j,column:k,row:O})=>{const{original:l}=O,S=(l==null?void 0:l.type)==="ingreso",b=(l==null?void 0:l.type)==="terminal";return t.jsx(R,{variant:"subtitle2",fontWeight:"bold",color:S||b?"success.main":"error",children:S||b?`+ ${l==null?void 0:l.amountFormat}`:`- ${l==null?void 0:l.amountFormat}`})}},{accessorKey:"verified",header:"Comprobación",size:100,Cell:({cell:j,column:k,row:O})=>{const{original:l}=O;return t.jsx(w,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,mr:2,color:"primary",children:l!=null&&l.verified?t.jsx(Pt,{color:"green",fontWeight:"bold",fontSize:"18px"}):t.jsx(kt,{fontSize:"18px",color:"red"})})}}],[]),H=Qt(P,L,{columns:oe,data:i||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:_,showAlertBanner:P,showProgressBars:B},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:j})=>t.jsx(z,{sx:{display:"flex",gap:"1rem"},children:t.jsx(Ye,{loading:B,onClick:ie(j),disabled:le(),startIcon:t.jsx(me,{width:24,height:24}),variant:"outlined",children:"Comprobar"})}),renderRowActionMenuItems:({row:j})=>[t.jsx(U,{onClick:()=>console.info("conciliation"),children:"Conciliación"},"conciliation"),t.jsx(U,{onClick:()=>console.info("incidence"),children:"Incidencia"},"incidence"),t.jsx(U,{onClick:()=>console.info("communication"),children:"Comunicación"},"communication"),t.jsx(U,{onClick:()=>console.info("tag"),children:"Tag"},"tag")]}),q=((ee=H==null?void 0:H.getSelectedRowModel().flatRows)==null?void 0:ee.map(j=>j.original))??[],le=g.useCallback(()=>{var O;const j=q.length>0?(O=q[0])==null?void 0:O.paymentProcessor:null;return!!!(q.every(l=>l.paymentProcessor===j)&&(H!=null&&H.getIsSomeRowsSelected()))},[q,H]);return t.jsxs(t.Fragment,{children:[t.jsxs(we,{children:[t.jsx(nt,{startDate:x,endDate:y,onChangeDateRange:X,onOpenBalance:()=>C(!0),loading:B}),t.jsx(Xt,{table:H})]}),t.jsx(Bs,{open:p,setOpen:D,movements:q??[]}),t.jsx(Ns,{open:T,balance:h,dateRange:r==null?void 0:r.text,onClose:()=>{C(!1)}})]})}function Fn(){const{data:e,isLoading:a}=us();return t.jsx(Mt,{title:"Dashboard Master",children:t.jsxs(Vt,{children:[t.jsx($t,{name:"Dashboard Master",links:[{name:"Inicio",href:bt.root},{name:"Dashboard Master"}]}),t.jsx(z,{pb:4,children:t.jsxs(w,{flexDirection:{md:"row"},gap:3,children:[t.jsx(w,{minWidth:300,children:t.jsx(tt,{data:e,isLoading:a})}),t.jsx(w,{flex:1,children:t.jsx(Ws,{})})]})}),t.jsx(Tt,{})]})})}export{Fn as default};
