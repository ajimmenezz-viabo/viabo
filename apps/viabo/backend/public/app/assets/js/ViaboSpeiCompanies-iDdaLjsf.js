import{r as L,C as F,q as f,g as w,a as N,y as V,L as R,_ as B,P as W}from"./index-s6HyWPbs.js";import{P as p,i as s,B as A,I as _,bN as U,c as H,f as K,a9 as j,r as b,e as Y,T as c,x as Q,bk as $,a3 as q,bw as G,S as m,bO as J,bP as X}from"./vendor-FSZoD0Ty.js";import{u as Z}from"./useViaboSpeiBreadCrumbs-vDfIDA2Q.js";import{a as D}from"./TextMaxLine-PpgibfDP.js";import{c as y,i as P}from"./matchTypes-_pBEYOAq.js";import{f as ee}from"./formatNumber-IeezKRXK.js";import{M as te,C as se,H as ae}from"./HeaderPage-iSujr2v1.js";import{u as re}from"./useMaterialTable-nTpJPdva.js";const ie={company:null,openNewCompany:!1},ne=(e,r)=>({...ie,setSpeiCompany:t=>{e(a=>({company:t}),!1,"SET_SPEI_COMPANY")},setOpenNewSpeiCompany:t=>{e(a=>({openNewCompany:t}),!1,"SET_OPEN_SPEI_NEW_COMPANY")}}),I=L(ne);function v({table:e,isChangingCauseStatus:r,causeIdToggleStatus:t,onChangeStatus:a}){const{row:n}=e,{original:o}=n,{status:u}=o,x=r&&t===(o==null?void 0:o.id),{setSpeiCompany:S,setOpenNewSpeiCompany:d}=I();return s.jsxs(A,{sx:{display:"flex",flex:1,justifyContent:"flex-start",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:[x?s.jsx(F,{size:15,containerProps:{display:"flex",ml:1}}):s.jsx(D,{size:"md",color:u?"success":"error",checked:u||!1,inputProps:{"aria-label":"controlled"},onClick:l=>{l.stopPropagation(),a(o)}}),u&&s.jsx(_,{size:"small",color:"primary",onClick:l=>{l.stopPropagation(),S(o),d(!0)},children:s.jsx(U,{size:"small",fontSize:"16px"})})]})}v.propTypes={causeIdToggleStatus:p.any,isChangingCauseStatus:p.any,onChangeStatus:p.func,table:p.shape({row:p.shape({original:p.shape({id:p.any,status:p.bool})})})};const oe=e=>{const r=e==null?void 0:e.map(t=>({id:t==null?void 0:t.id,name:t==null?void 0:t.name}));return y(r,"id","name")},M={COMPANIES_LIST:"spei-companies-list",USERS_ADMIN_COMPANY_LIST:"spei-admin-company-users-list",COMPANY_DETAILS:"spei-company-details"},we={ADMIN_USERS:"users",NEW_ADMIN_USER:"new-user"},le=e=>(e==null?void 0:e.map(t=>{var a;return{id:t==null?void 0:t.id,folio:t==null?void 0:t.folio,name:t==null?void 0:t.tradeName,balance:ee((t==null?void 0:t.balance)||"0"),status:(t==null?void 0:t.active)==="1",rfc:t==null?void 0:t.rfc,stpAccount:{complete:t==null?void 0:t.bankAccount,hidden:(a=t==null?void 0:t.bankAccount)==null?void 0:a.replace(/.(?=.{8})/g,"*")}}}))||[],ce=e=>{var t,a;return{id:e==null?void 0:e.id,commercialName:e==null?void 0:e.tradeName,fiscalName:e==null?void 0:e.fiscalName,rfc:e==null?void 0:e.rfc,adminUsers:((t=e==null?void 0:e.users)==null?void 0:t.map(n=>n==null?void 0:n.id))||[],costCenters:((a=e==null?void 0:e.costCenters)==null?void 0:a.map(n=>n==null?void 0:n.id))||[]}},ue=async()=>{const{data:e}=await f.get("/api/commerces");return le(e)},Ne=async e=>{const{data:r}=await f.post("/api/backoffice/company/new",e);return r},_e=async()=>{const{data:e}=await f.get("/api/security/users/administrators-of-companies");return oe(e)},de=async e=>{const r=new URL("/api/backoffice/company/toggle",window.location.origin);return r.searchParams.set("company",e==null?void 0:e.id),r.searchParams.set("active",e==null?void 0:e.changeStatus),await f.put(r),e},Ie=async e=>{const{data:r}=await f.get(`/api/backoffice/company/${e}`);return ce(r)},ve=async e=>(await f.put("/api/backoffice/company/update",e),e),pe=(e={})=>{const r=H(),t=K({mutationFn:de,...e});return{...t,mutate:async(n,o)=>{const{onSuccess:u,onError:x,...S}=o;try{await j.promise(t.mutateAsync(n,S),{pending:"Actualizando estado de la empresa...",success:{render({data:d}){return r.invalidateQueries([M.COMPANIES_LIST]),P(u)&&u(d),"Se actualizó el estado de la empresa con éxito"}}})}catch(d){const l=w(d,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");P(x)&&x(l),j.error(l,{type:N(d)})}}}},Se=(e={})=>{const[r,t]=b.useState(null),a=Y({queryKey:[M.COMPANIES_LIST],queryFn:ue,refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,...e});return b.useEffect(()=>{if(a!=null&&a.isError){const n=w(a.error,"No se puede obtener la lista de empresas. Intente nuevamente o reporte a sistemas");t(n),j.error(n,{type:N(a.error)})}},[a.isError,a.error]),{...a,error:r||null}},Ce=()=>b.useMemo(()=>[{id:"folio",accessorKey:"folio",header:"ID",enableHiding:!1,maxSize:50,Cell:({cell:e,column:r,row:t,renderedCellValue:a})=>s.jsx(c,{variant:"subtitle2",children:a})},{id:"rfc",accessorKey:"rfc",header:"RFC",Cell:({cell:e,column:r,row:t,renderedCellValue:a})=>s.jsx(c,{textTransform:"uppercase",variant:"subtitle2",children:a})},{id:"name",accessorKey:"name",header:"Nombre",enableHiding:!1,Cell:({cell:e,column:r,row:t,renderedCellValue:a})=>s.jsx(c,{textTransform:"capitalize",fontWeight:"bold",variant:"subtitle2",children:a})},{id:"stpAccount",header:"Cuenta STP",enableClickToCopy:!0,accessorFn:e=>{var r;return((r=e==null?void 0:e.stpAccount)==null?void 0:r.complete)||null},Cell:({cell:e,column:r,row:t,renderedCellValue:a})=>{var o;const{original:n}=t;return s.jsx(c,{variant:"subtitle2",children:(o=n==null?void 0:n.stpAccount)==null?void 0:o.hidden})}},{id:"balance",accessorKey:"balance",header:"Balance",minSize:100,Cell:({cell:e,column:r,row:t,renderedCellValue:a})=>s.jsx(c,{variant:"subtitle2",children:a})}],[]),ge=()=>{var T;const{data:e,isLoading:r,isError:t,error:a,isFetching:n}=Se(),{setOpenNewSpeiCompany:o}=I(),u=Ce(),[x,S]=b.useState(!1),[d,l]=b.useState(null),[i,h]=b.useState(null),{mutate:O,isLoading:k}=pe(),z=()=>{S(!1),O({...i,changeStatus:!(i!=null&&i.status)},{onSuccess:()=>{l(null),h(null)},onError:()=>{l(null),h(null)}})},E=re(t,a,{columns:u,data:e||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"folio",desc:!1}]},state:{isLoading:r,showAlertBanner:t,showProgressBars:n},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},muiTableBodyRowProps:({row:C})=>({sx:g=>({backgroundColor:"inherit","&.Mui-selected":{backgroundColor:g.palette.action.selected,"&:hover":{backgroundColor:g.palette.action.hover}}})}),enableColumnResizing:!0,layoutMode:"grid",renderTopToolbarCustomActions:()=>s.jsx(A,{}),renderRowActions:C=>s.jsx(v,{table:C,isChangingCauseStatus:k,onChangeStatus:g=>{h(g),l(g==null?void 0:g.id),S(!0)},causeIdToggleStatus:d})});return s.jsxs(s.Fragment,{children:[s.jsxs(Q,{variant:"outlined",sx:C=>E.getState().isFullScreen?{}:{boxShadow:C.customShadows.z24,backgroundColor:C.palette.mode==="light"?"inherit":C.palette.grey[50012],backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:[s.jsx($,{sx:C=>({pb:2}),title:"Lista de Empresas",subheader:`Tienes ${(e==null?void 0:e.length)||0} empresas dadas de alta`,action:s.jsx(q,{title:"Nueva Empresa",children:s.jsx(_,{color:"primary",size:"large",onClick:()=>o(!0),children:s.jsx(G,{})})})}),s.jsx(te,{table:E})]}),s.jsx(V,{title:s.jsxs(m,{alignItems:"center",justifyContent:"space-between",flexDirection:"row",children:[s.jsx(c,{variant:"h6",children:i!=null&&i.status?"Desactivar Empresa":"Activar Empresa"}),i!=null&&i.status?s.jsx(J,{color:"error"}):s.jsx(X,{color:"success"})]}),textButtonSuccess:"Si",textButtonCancel:"No",onClose:()=>{S(!1)},open:x,actionsProps:{sx:{justifyContent:"center"}},description:s.jsxs(m,{spacing:3,children:[s.jsxs(m,{spacing:.5,p:2,borderColor:"secondary.light",borderRadius:2,sx:{borderStyle:"dotted"},children:[s.jsx(c,{fontWeight:"bold",variant:"subtitle2",children:i==null?void 0:i.name}),s.jsx(c,{variant:"subtitle2",children:i==null?void 0:i.rfc}),s.jsx(c,{variant:"subtitle2",children:(T=i==null?void 0:i.stpAccount)==null?void 0:T.hidden})]}),s.jsxs(c,{textAlign:"center",children:["¿Está seguro de"," ",s.jsx(A,{component:"span",sx:{fontWeight:"bold"},children:`${i!=null&&i.status?"Desactivar":"Activar"}`})," ","la empresa?"]})]}),onSuccess:z,fullWidth:!0,maxWidth:"xs"})]})},be=R(b.lazy(()=>B(()=>import("./SpeiNewCompanyDrawer-f0mJBaa4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14])))),xe=()=>{const{companies:e}=Z();return s.jsx(W,{title:"Empresas - Viabo Spei",children:s.jsxs(se,{sx:{pb:3},children:[s.jsx(ae,{name:"Empresas",links:e}),s.jsx(ge,{}),s.jsx(be,{})]})})},Me=Object.freeze(Object.defineProperty({__proto__:null,ViaboSpeiCompanies:xe},Symbol.toStringTag,{value:"Module"}));export{we as M,M as S,Me as V,Ie as a,ve as b,_e as g,Ne as n,I as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/SpeiNewCompanyDrawer-f0mJBaa4.js","assets/js/index-s6HyWPbs.js","assets/js/vendor-FSZoD0Ty.js","assets/css/build-K0YT2apu.css","assets/js/useFindSpeiCostCenters-lZikHkQ4.js","assets/js/matchTypes-_pBEYOAq.js","assets/js/useViaboSpeiBreadCrumbs-vDfIDA2Q.js","assets/js/TextMaxLine-PpgibfDP.js","assets/js/formik.esm--ft-gNTR.js","assets/js/UploadSingleFile-RRpuU-ga.js","assets/js/fade-HpdRXKiE.js","assets/js/transition-Uc7vb3zK.js","assets/js/formatNumber-IeezKRXK.js","assets/js/HeaderPage-iSujr2v1.js","assets/js/useMaterialTable-nTpJPdva.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=ViaboSpeiCompanies-iDdaLjsf.js.map
