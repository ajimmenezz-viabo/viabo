import{c as R,f as W,a9 as C,aM as v,r as V,e as D,s as K,bB as j,i as e,B as S,S as Q,br as b,by as H,bz as _,bA as $,bC as l,bD as w,T,dW as G}from"./vendor-CEMfbhOc.js";import{c as Y,T as y,g as q,u as m}from"./POSTerminals-DUI33OP8.js";import{f as B}from"./formatNumber-Df8NwpjV.js";import{g as M,a as O,a8 as J,S as U}from"./index-1FUUY6N4.js";import{S as X,M as Z}from"./MaterialDataTable-_kvAzFsF.js";import{u as ee}from"./useMaterialTable-9wOa4uxn.js";import"./index-BdTlPQ76.js";import"./iconBase-D_ql85QS.js";import"./cardTypes-C4UgKCLi.js";import"./AmexLogo-DsyshqEq.js";import"./CarnetLogo-BssSE0Ex.js";import"./MasterCardLogo-Bcn9gvbj.js";import"./VisaLogo-ByWQmEg7.js";import"./csv-BGNpG_Xb.js";import"./formatTime-mlJJpQBT.js";import"./cardMovementsAdapter-i_XZHzp7.js";import"./crypto--V-xCCVf.js";import"./TextMaxLine-BooApTzI.js";import"./formik.esm-Dshy1xjd.js";import"./matchTypes-BFKCRNnN.js";import"./UploadSingleFile-DBlnS0ZI.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./SidebarStyles-JhyDWPNq.js";import"./HeaderPage-DF1oZxt5.js";const te=(s,c,o)=>{var n,u;const d=(c==null?void 0:c.map(i=>{var p,a;return{transactionId:(p=i==null?void 0:i.id)==null?void 0:p.toString(),amount:(a=i==null?void 0:i.amount)==null?void 0:a.toString()}}))??[];return{terminalId:s==null?void 0:s.terminalId,speiCardTransactionId:(n=o==null?void 0:o.id)==null?void 0:n.toString(),speiCardTransactionAmount:(u=o==null?void 0:o.amount)==null?void 0:u.toString(),transactions:d}},ie=(s={})=>{const c=R(),o=W(Y,s);return{...o,mutate:async(n,u)=>{const{onSuccess:i,onError:p,mutationOptions:a}=u;try{await C.promise(o.mutateAsync(n,a),{pending:"Conciliando movimientos de la terminal ...",success:{render({data:r}){return c.invalidateQueries([y.MOVEMENTS,n==null?void 0:n.terminalId]),i(r),"Se creó la conciliación con éxito"}}})}catch(r){const x=M(r,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");p(x),C.error(x,{type:O(r)})}}}},se=(s,c,o={})=>{const d=v(c,"yyyy-MM-dd"),[n,u]=V.useState(null),i=s?[y.CONCILIATE_MOVEMENTS,s]:[y.MOVEMENTS,"global"];return{...D(i,({signal:a})=>q(s,d),{staleTime:6e4,refetchOnWindowFocus:!1,onError:a=>{const r=M(a,"No se puede obtener la lista de movimientos para conciliar la terminal. Intente nuevamente o reporte a sistemas");u(r),C.error(r,{type:O(a)})},...o}),error:n||null}},oe=K(j)(({theme:s})=>({"& td":{paddingTop:s.spacing(.5),paddingBottom:s.spacing(.5),backgroundColor:s.palette.background.neutral}})),ke=()=>{var E;const s=m(t=>t.setOpenConciliate),c=m(t=>t.openConciliate),o=m(t=>t.setConciliateMovements),{movements:d,total:n,date:u}=m(t=>t.conciliateInfo),i=m(t=>t.terminal),{data:p,error:a,isError:r,isFetching:x,isLoading:k}=se(i==null?void 0:i.terminalId,u,{enabled:!!(i&&u)}),{mutate:z,isLoading:N}=ie(),P=R(),h=ee(r,a,{columns:[{id:"card",header:"Movimientos Tarjeta Asociada",columns:[{accessorKey:"description",header:"Movimiento",minSize:100},{accessorKey:"date",header:"Fecha",size:130},{accessorKey:"amountFormat",header:"Monto",minSize:100}]}],data:(p==null?void 0:p.movements)||[],enableColumnPinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,enableColumnResizing:!1,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:k,showAlertBanner:r,showProgressBars:x},muiTablePaperProps:{elevation:0,sx:t=>({borderRadius:0,backgroundColor:t.palette.background.neutral})},muiBottomToolbarProps:{sx:t=>({backgroundColor:t.palette.background.neutral})},muiTopToolbarProps:{sx:t=>({backgroundColor:t.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{maxSize:10,header:""}},renderToolbarInternalActions:({table:t})=>e.jsx(S,{children:e.jsx(X,{table:t})}),muiTableContainerProps:{sx:{maxHeight:"md"}}}),g=((E=h==null?void 0:h.getSelectedRowModel().flatRows)==null?void 0:E.map(t=>t.original))??[],f=()=>{s(!1),o(null),P.removeQueries([y.CONCILIATE_MOVEMENTS,i==null?void 0:i.terminalId])},F=()=>{if((g==null?void 0:g.length)>0){const t=te(i,d,g[0]);z(t,{onSuccess:()=>{f()},onError:()=>{}})}else C.warn("Debe seleccionar un movimiento de la tarjeta para conciliar los movimientos de la terminal")};return e.jsx(J,{onClose:f,onSuccess:F,isSubmitting:N,fullWidth:!0,scrollType:"body",title:`Conciliar Movimientos ${i==null?void 0:i.name}`,textButtonSuccess:"Conciliar",maxWidth:"md",open:c,children:e.jsx(Q,{pt:3,children:e.jsxs(b,{container:!0,spacing:{xs:2},children:[e.jsx(b,{item:!0,xs:12,md:5,children:e.jsx(U,{children:e.jsx(H,{sx:{minWidth:200},children:e.jsxs(_,{size:"small",children:[e.jsxs($,{sx:{borderBottom:t=>`solid 1px ${t.palette.divider}`},children:[e.jsx(j,{children:e.jsx(l,{align:"center",colSpan:3,children:"Movimientos Terminal"})}),e.jsxs(j,{children:[e.jsx(l,{width:40,children:"#"}),e.jsx(l,{align:"left",children:"Descripción"}),e.jsx(l,{align:"right",children:"Monto"})]})]}),e.jsxs(w,{children:[d==null?void 0:d.map((t,I)=>{var A;return e.jsxs(j,{sx:{borderBottom:L=>`solid 1px ${L.palette.divider}`},children:[e.jsx(l,{children:I+1}),e.jsx(l,{align:"left",children:e.jsxs(S,{sx:{maxWidth:180},children:[e.jsx(T,{variant:"subtitle2",children:t==null?void 0:t.description}),e.jsx(T,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:(A=t==null?void 0:t.transactionDate)==null?void 0:A.fullDate})]})}),e.jsx(l,{align:"right",children:B(t==null?void 0:t.amount)})]},I)}),e.jsxs(oe,{children:[e.jsx(l,{colSpan:1}),e.jsx(l,{align:"right",children:e.jsx(T,{variant:"h6",children:"Total"})}),e.jsx(l,{align:"right",width:140,children:e.jsx(T,{variant:"h6",children:B(n)})})]})]})]})})})}),e.jsx(b,{item:!0,xs:12,md:1,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(S,{display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(G,{fontSize:"large",color:"primary"})})}),e.jsx(b,{item:!0,xs:12,md:6,children:e.jsx(Z,{table:h})})]})})})};export{ke as default};
//# sourceMappingURL=ConciliateTerminalsMovements-PVjTNIog.js.map
