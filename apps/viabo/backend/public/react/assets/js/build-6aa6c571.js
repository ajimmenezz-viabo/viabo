import{t as V,j as e,F as S,a as E,n as R,E as z,Q as w,g as T,o as W,r as B,G as O,b as H,P as l,H as $,J as Q,S as a,T as t,i as C,K as N,N as I,L as Y,B as j,O as _,R as G,f as K,U}from"./index-23ec28e1.js";import{u as X}from"./build-5f2543fb.js";import{a as J}from"./build-7a57c9bd.js";import{c as Z,a as g}from"./build-23530379.js";import{g as y,a as D}from"./build-4e68fd35.js";import{f as L}from"./build-8ab16f05.js";import{F as k,M as A,L as ee}from"./build-c616c612.js";import{R as f}from"./build-ba4202b0.js";import{M as re}from"./build-60193303.js";import{V as oe}from"./build-88fbe48e.js";import{I as v}from"./build-79fb9ca8.js";import{C as ne}from"./build-12f241c7.js";import{V as ae}from"./build-21aac1f7.js";import{P as ie}from"./build-1db7ad67.js";import{E as se}from"./build-b6087623.js";import{L as te}from"./build-bd1eb26c.js";import{D as ce}from"./build-af35eb93.js";import{V as le}from"./build-899176f2.js";import{R as ue}from"./build-6d706cbe.js";import"./build-488f3cd2.js";import"./build-bee6630b.js";import"./build-f728c994.js";import"./build-ece7c255.js";const de=V(e.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),me=(r,o)=>{const n=r!=null&&r.expiration?S(new Date(r==null?void 0:r.expiration),"MM/yyyy"):null,c=n?n==null?void 0:n.slice(-2):"",s=n?n==null?void 0:n.slice(0,2):"",p=n?(n==null?void 0:n.slice(0,3))+c:"",x={payId:o==null?void 0:o.id,cardHolder:r==null?void 0:r.name,phone:r==null?void 0:r.phone,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expirationDate:p,expMonth:s,expYear:c,security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return y(x)},q={INFO:"payment-link-info"},xe=r=>{const o=D(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:L(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName},reference:o==null?void 0:o.reference,terminalId:o==null?void 0:o.terminalId,transaction:{reference:(o==null?void 0:o.apiReferenceNumber)!==""?o==null?void 0:o.apiReferenceNumber:"-",authCode:(o==null?void 0:o.apiAuthCode)!==""?o==null?void 0:o.apiAuthCode:"-"}};throw new Error("Algo fallo al obtenerla información de la liga de pago")},he=async r=>{const{data:o}=await E.get(`/api/commerces/pay/${r}`);return xe(o)},pe=async r=>{const{data:o}=await E.post("/api/commerce/pay/generate/transaction",r);return o},ge=(r,o={})=>{const n=R(pe,o),c=z();return{...n,mutate:async(p,x)=>{const{onSuccess:d,onError:m,mutationOptions:h}=x;try{await w.promise(n.mutateAsync(p,h),{pending:"Realizando cargo ...",success:{render({data:i}){return c.invalidateQueries([q.INFO]),d(i),"Se realizo el pago con éxito"}}})}catch(i){const u=T(i,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");m(u),w.error(u,{type:W(i)})}}}},je=(r,o={})=>{const[n,c]=B.useState(null),s=O();return{...H([q.INFO,r],()=>he(r),{staleTime:6e4,onError:x=>{const d=T(x,"No se puede obtener la informacion de la liga de pago");c(d),s("/404")},...o}),error:n||null}},M=({details:r})=>{const{mutate:o}=ge(r==null?void 0:r.id),n=Z().shape({cardNumber:g().transform((i,u)=>u.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),expiration:g().nullable().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(i){const u=new Date(i);return $(u)&&Q(u,new Date)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El teléfono es muy corto",i=>!(i&&i.replace(/[\s+]/g,"").length<10)).required("El teléfono es requerido")}),c=X({initialValues:{cardNumber:"",expiration:null,cvv:"",name:"",email:(r==null?void 0:r.email)||"",phone:(r==null?void 0:r.phone)||""},enableReinitialize:!0,validationSchema:n,onSubmit:(i,{setSubmitting:u,setFieldTouched:b})=>{const P=me(i,r);o(P,{onSuccess:()=>{u(!1)},onError:()=>{u(!1),d("cvv","").then(()=>{b("cvv",!1,!1)}),d("expiration",null).then(()=>{b("expiration",!1,!1)})}})}}),{errors:s,touched:p,isSubmitting:x,setFieldValue:d,values:m}=c,h=x;return e.jsx(k,{formik:c,children:e.jsxs(a,{spacing:3,children:[e.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(t,{variant:"h6",children:"Forma de Pago"}),e.jsx(C,{sx:{px:1},children:e.jsx(re,{sx:{width:30,height:30}})}),e.jsx(C,{sx:{px:1},children:e.jsx(oe,{sx:{width:30,height:30}})})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(f,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ne,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:m.cardNumber,onAccept:i=>{d("cardNumber",i)}}},disabled:h})]}),e.jsxs(a,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),e.jsx(ce,{disabled:h,views:["year","month"],name:"expiration",value:m!=null&&m.expiration?new Date(m.expiration):null,required:!0,onChange:i=>{d("expiration",i)},slotProps:{textField:{fullWidth:!0,error:!!s.expiration,required:!0,helperText:s.expiration?s.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(f,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ae,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:i=>{d("cvv",i)},value:m.cvv}},disabled:h})]})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(f,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:h,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ie,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(f,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:h,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(se,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),e.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:m.phone,disabled:h,required:!0,onChange:(i,u)=>{d("phone",i)},error:p.phone&&!!s.phone,helperText:p.phone&&s.phone})]}),e.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(N,{component:I,underline:"always",color:"info.main",children:"Terminos y condiciones"}),"  &  ",e.jsx(N,{component:I,underline:"always",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),e.jsx(a,{children:e.jsx(Y,{loading:x,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(te,{}),children:"Pagar"})})]})})};M.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const fe=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ve=r=>{var o;return((o=fe.find(n=>(n==null?void 0:n.id)===r))==null?void 0:o.color)??"info"},F=({details:r})=>{var o,n,c,s;return e.jsx(a,{children:e.jsxs(C,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[e.jsx(j,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:e.jsx("img",{src:le,alt:"viabo-logo"})}),e.jsxs(a,{alignItems:"center",justifyContent:"center",spacing:2,children:[e.jsx(ee,{variant:"ghost",color:ve((o=r==null?void 0:r.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(n=r==null?void 0:r.status)==null?void 0:n.name}),e.jsx(ue,{color:"primary",sx:{width:40,height:40}}),e.jsxs(a,{alignItems:"center",justifyContent:"center",children:[e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(t,{variant:"h2",children:[" ",r==null?void 0:r.amount]}),e.jsx(t,{variant:"caption",children:"MXN"})]}),e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(de,{}),e.jsx(t,{variant:"subtitle1",textTransform:"capitalize",children:r==null?void 0:r.name})]})]}),e.jsx(t,{textAlign:"center",variant:"body2",children:r==null?void 0:r.description})]}),((c=r==null?void 0:r.status)==null?void 0:c.id)==="7"&&e.jsx(e.Fragment,{children:e.jsxs(a,{divider:e.jsx(_,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:1,alignItems:"center",justifyContent:"center",p:2,children:[e.jsx(j,{}),e.jsx(t,{variant:"subtitle1",color:"text.secondary",children:"Detalles de la Transacción"}),e.jsxs(a,{flex:1,width:1,spacing:1,children:[e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Terminal:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.terminalId})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Referencia:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.reference})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Autorización:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:(s=r==null?void 0:r.transaction)==null?void 0:s.authCode})]})]})]})})]})})};F.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,reference:l.any,status:l.shape({id:l.any,name:l.any}),terminalId:l.any,transaction:l.shape({authCode:l.any})})};const _e=()=>{var c,s;const{paymentId:r}=G(),{data:o,isLoading:n}=je(r,{enabled:!!r});return e.jsx(K,{title:"Cobro",meta:e.jsxs(e.Fragment,{children:[e.jsx("meta",{name:"description",content:"Liga de Pago para el servicio Viabo Pay"}),e.jsx("meta",{name:"keywords",content:"viabo pay, liga de pago, pago en linea,servició de pago,paypal,viabo card"}),e.jsx("meta",{property:"og:title",content:`Liga de Pago Generada de Viabo Pay de un monto de : ${o==null?void 0:o.amount}`}),e.jsx("meta",{property:"og:description",content:"Esta es la página sobre  el cobro mediante una liga de pago generada para el servició viabo pay"}),e.jsx("meta",{property:"og:image",content:"/landingPage/img/instagram-3.jpg"})]}),children:e.jsx(j,{component:"main",height:1,m:0,p:0,children:e.jsxs(a,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[n&&e.jsx(U,{}),!n&&o&&e.jsxs(a,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,maxWidth:((c=o==null?void 0:o.status)==null?void 0:c.id)==="7"?400:"sm",children:[e.jsx(F,{details:o}),["6","8"].includes((s=o==null?void 0:o.status)==null?void 0:s.id)&&e.jsx(M,{details:o})]})]})})})};export{_e as default};
