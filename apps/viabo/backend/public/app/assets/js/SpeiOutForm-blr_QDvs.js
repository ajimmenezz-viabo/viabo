import{r as S,U as $,i as r,S as i,T as u,B as M,A as x,bB as W,aT as q,br as E,aR as D,aP as O,d_ as U,aQ as G,J as H,d$ as J,P as o}from"./vendor-5lkxkETF.js";import{S as Q,y as h,a5 as X}from"./index-D5oZe3QV.js";import{u as Z,d as _}from"./formik.esm-CTTSENmf.js";import{c as b,d as K,a as Y}from"./index.esm-gIIytEq8.js";import{d as f,B as F}from"./AdminDashboardViaboSpei-UZToPwGD.js";import{F as v,R as A,M as rr}from"./TextMaxLine-Cweu1ZMD.js";import{R as nr}from"./RFSelect-DSsw7uR8.js";import"./formatNumber-dGNhWwxT.js";import"./matchTypes-mENztEWg.js";import"./formatTime-jCgU2sMR.js";import"./viabo-spei-paths-CscWQyNa.js";import"./filterSearch-NGUmCbyG.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./usePagination-Xa7qo0UK.js";import"./HeaderPage-BXF44eOm.js";import"./UploadSingleFile-D4e1QNmZ.js";const er=({selectedAccount:m,accounts:R,setCurrentBalance:w,insufficient:I,onSuccess:P,initialValues:C})=>{var y;const g=S.useRef(null),B=window.crypto||window.msCrypto,T=new Uint32Array(1),k=B.getRandomValues(T)[0],N=b().shape({transactions:K().of(b().shape({amount:Y().test("maxAmount","Monto máximo de transferencia $50,000",function(a){return parseFloat(a==null?void 0:a.replace(/,/g,""))<=5e4}).required("La cantidad es requerida"),account:b().nullable().required("La cuenta es requerida")}))}),j=Z({initialValues:C||{transactions:[],beneficiary:null,amount:"",concept:""},validateOnChange:!1,validationSchema:N,onSubmit:(a,{setFieldValue:n,setSubmitting:t})=>{var s;return I?($.warning("Saldo insuficiente para realizar esta operación"),t(!1)):(t(!1),n("amount",""),n("beneficiary",null),P({...a,origin:(s=m==null?void 0:m.account)==null?void 0:s.number}))}}),{isSubmitting:z,setFieldValue:d,values:e}=j,p=z,V=!(e!=null&&e.beneficiary)||(e==null?void 0:e.amount)===""||Number(e==null?void 0:e.amount)<=0;S.useEffect(()=>{var t;const n=((t=e.transactions)==null?void 0:t.reduce((s,c)=>{const l=c.amount.trim()!==""?parseFloat(c.amount.replace(/,/g,"")):0;return isNaN(l)?s:s+l},0)).toFixed(2);w(n)},[e.transactions]);const L=()=>{d("amount",""),d("beneficiary",null)};return r.jsx(Q,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(v,{formik:j,children:r.jsxs(i,{sx:{p:3},children:[r.jsxs(i,{gap:2,children:[r.jsxs(i,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Beneficiario:"}),r.jsx(nr,{name:"beneficiary",disabled:p,textFieldParams:{placeholder:"Seleccionar ...",size:"large"},options:R||[],onChange:(a,n)=>{d("beneficiary",n)},renderOption:(a,n)=>{const t=h((n==null?void 0:n.label)||"");return r.jsx(M,{component:"li",...a,children:r.jsxs(i,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(x,{...t,sx:{...t==null?void 0:t.sx,width:25,height:25,fontSize:12}}),r.jsx("span",{children:n.label})]})})},renderInput:a=>{var t;const n=h(((t=a==null?void 0:a.inputProps)==null?void 0:t.value)||"");return r.jsx(W,{...a,size:"large",placeholder:"Seleccionar ...",inputProps:{...a.inputProps},InputProps:{...a.InputProps,startAdornment:r.jsx(q,{position:"start",children:r.jsx(x,{...n,sx:{...n==null?void 0:n.sx,width:25,height:25,fontSize:12}})}),sx:{borderRadius:s=>1,borderColor:f}}})}})]}),r.jsxs(i,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Monto:"}),r.jsx(A,{size:"large",name:"amount",placeholder:"0.00",disabled:p,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"MXN"}),inputComponent:rr,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,scale:2,value:e.amount,onAccept:a=>{d("amount",a)}},sx:{borderRadius:a=>1,borderColor:f}}})]}),r.jsx(i,{direction:"row",spacing:1,children:r.jsx(F,{type:"button",startIcon:r.jsx(E,{}),disabled:p||V,onClick:()=>{g.current.push({id:k,account:e==null?void 0:e.beneficiary,amount:e==null?void 0:e.amount}),L()},sx:{flexShrink:0,color:"text.primary"},children:"Agregar Transacción"})})]}),r.jsx(_,{name:"transactions",render:a=>(g.current=a,r.jsx(D,{sx:{width:"100%",bgcolor:"background.paper"},children:e==null?void 0:e.transactions.map((n,t)=>{var s,c,l;return r.jsx(i,{children:r.jsxs(O,{sx:{px:0},secondaryAction:r.jsx(X,{color:"error",edge:"end","aria-label":"delete",onClick:()=>a.remove(t),children:r.jsx(U,{})}),children:[r.jsx(G,{children:r.jsx(x,{title:((s=n==null?void 0:n.account)==null?void 0:s.label)||"",...h(((c=n==null?void 0:n.account)==null?void 0:c.label)||"")})}),r.jsx(H,{primary:r.jsx(u,{variant:"subtitle1",children:(l=n==null?void 0:n.account)==null?void 0:l.clabeHidden}),secondary:r.jsx(u,{variant:"subtitle1",fontWeight:"bold",children:n==null?void 0:n.amount})})]})},n.id)})}))}),r.jsx(A,{fullWidth:!0,name:"concept",multiline:!0,disabled:p,rows:2,label:"Concepto",placeholder:"Transferencia ..",InputProps:{sx:{borderRadius:a=>1,borderColor:f}}}),r.jsx(i,{sx:{pt:3},children:r.jsx(F,{variant:"contained",size:"large",color:"primary",disabled:!!((y=e==null?void 0:e.transactions)!=null&&y.length)<=0,fullWidth:!0,type:"submit",startIcon:r.jsx(J,{}),children:"Siguiente"})})]})})})};er.propTypes={accounts:o.array,initialValues:o.shape({amount:o.string,beneficiary:o.any,concept:o.string,transactions:o.array}),insufficient:o.any,onSuccess:o.func,selectedAccount:o.shape({account:o.shape({number:o.any}),concentrator:o.shape({number:o.any})}),setCurrentBalance:o.func};export{er as default};
//# sourceMappingURL=SpeiOutForm-blr_QDvs.js.map
