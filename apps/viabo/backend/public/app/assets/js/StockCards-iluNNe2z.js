import{K as A,w as ne,N as ie,j as oe,O as ce,l as q,E as le,q as R,g as M,a as de,Q as H,S as ue,T as xe,U as pe,W as me,X as W,P as he,o as ge,H as je,J as Ce,L as fe,_ as be}from"./index-8BLzEq8l.js";import{r as g,t as _,i as e,a3 as Z,I as P,bQ as Se,a4 as ye,bR as ve,V as u,T as j,B as I,bO as Ae,bS as Te,bk as we,x as J,bo as w,bv as Ee,aY as O,aZ as Ie,bT as ke,b1 as De,c as Re,f as _e,a9 as z,e as V,bU as Me,bV as K,bW as Pe,a_ as Fe,bX as Ne,bY as Le,aN as Oe,a0 as ee,bZ as Ve,a2 as Be,n as qe,aG as He,K as We,X as ze,A as Ke,O as Ge,b_ as Ye,bw as Qe,b$ as $e,c0 as G,c1 as Ue,bj as Xe}from"./vendor-StReGf79.js";import{u as Ze}from"./formik.esm-ayHIcoJR.js";import{c as Y,a as L}from"./index.esm-cYP9oANf.js";import{a as Je}from"./crypto-DOZFMzid.js";import{c as te}from"./matchTypes-VzXr5CmM.js";import{a as et}from"./cardsAdapter-jMj_YqiI.js";import{F as tt,R as Q,M as $}from"./TextMaxLine-9O-T-qdR.js";import{R as U}from"./RFSelect-VFpQl01y.js";import{v as X}from"./fade-HpdRXKiE.js";import{C as st}from"./CarnetLogo-9N730tjt.js";import{M as at}from"./MasterCardLogo-31QJgBVq.js";import{D as rt,C as nt,H as it}from"./HeaderPage-Oxll9yW3.js";import{C as ot,s as ct}from"./filterSearch-5mPANZVQ.js";function lt(t,a){const[s,r]=g.useState(1),c=Math.ceil(t.length/a);function i(){const o=(s-1)*a,n=o+a;return t.slice(o,n)}function l(){r(o=>Math.min(o+1,c))}function C(){r(o=>Math.max(o-1,1))}function x(o){const n=Math.max(1,o);r(p=>Math.min(n,c))}return{next:l,prev:C,jump:x,currentData:i,currentPage:s,maxPage:c}}function dt({card:t}){const a=A(p=>p.isReadyToAssign),s=A(p=>p.setOpen),r=A(p=>p.setCard),[c,i]=g.useState(null),l=!!c,{enqueueSnackbar:C}=_(),x=p=>{i(p.currentTarget)},o=()=>{i(null)},n=()=>{a?(s(!0),r(t)):(s(!1),C("Por el momento no se puede asignar la tarjeta. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Acciones",children:e.jsx(P,{onClick:x,sx:{ml:2},"aria-controls":l?"card-menu":void 0,"aria-haspopup":"true","aria-expanded":l?"true":void 0,children:e.jsx(Se,{width:20,height:20})})}),e.jsx(ne,{open:!!l,anchorEl:c,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},arrow:"right-start",sx:{mt:-1,mr:0,p:2,width:250,"& .MuiMenuItem-root":{px:1,typography:"body2",borderRadius:.75,"& svg":{mr:2,width:20,height:20}}},children:e.jsxs(ye,{onClick:()=>{n(),o()},sx:{color:"text.secondary"},children:[e.jsx(ve,{width:24,height:24}),"Asignar a Comercio"]})})]})}function ut({card:t,disableShow:a}){const[s,r]=g.useState(!0),c=i=>{i.stopPropagation(),r(l=>!l)};return e.jsxs(u,{position:"relative",children:[e.jsx(j,{sx:{mb:1,typography:"caption",opacity:.48},children:"CVV"}),e.jsx(u,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(j,{sx:{typography:"subtitle2"},children:s?"***":t==null?void 0:t.cvv})}),!a&&e.jsx(I,{position:"absolute",sx:{left:"32px",top:"20px"},children:e.jsx(P,{size:"small",color:"inherit",onClick:c,sx:{opacity:.2},children:s?e.jsx(Ae,{}):e.jsx(Te,{})})})]})}function xt({card:t}){return e.jsxs(ie,{children:[e.jsx(we,{action:e.jsx(dt,{card:t}),title:e.jsx(j,{sx:{typography:"subtitle2",opacity:.72},children:"Viabo Card"}),subheader:t==null?void 0:t.register,sx:{p:0}}),e.jsx("div",{children:e.jsx(ot,{card:t})}),e.jsxs(u,{direction:"row",spacing:5,children:[e.jsxs(u,{children:[e.jsx(j,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(j,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(ut,{card:t})]})]})}function pt(){return e.jsxs(J,{sx:t=>({color:t.palette.common.white,display:"flex",p:3,flexDirection:"column",justifyContent:"space-between"}),children:[e.jsxs(u,{children:[e.jsx(w,{variant:"text",sx:{width:.3}}),e.jsx(w,{variant:"text",sx:{width:.5}})]}),e.jsx(u,{sx:{py:1.5},children:e.jsx(w,{variant:"text",sx:{width:.9,height:40}})}),e.jsxs(u,{direction:"row",spacing:2,children:[e.jsxs(u,{spacing:.5,children:[e.jsx(w,{variant:"text",sx:{width:100}}),e.jsx(w,{variant:"text",sx:{width:40}})]}),e.jsxs(u,{spacing:.5,children:[e.jsx(w,{variant:"text",sx:{width:100}}),e.jsxs(u,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(w,{variant:"text",sx:{width:40}}),e.jsx(w,{variant:"circular",sx:{width:16,height:16}})]})]})]})]})}function mt({cards:t,emptyMessage:a="No hay tarjetas disponibles en stock",cardComponent:s=xt,...r}){const c=oe("up","xl"),{isCollapse:i}=ce(),[l,C]=g.useState(1),[x,o]=g.useState(""),[n,p]=g.useState([]),{data:d,isLoading:S,isError:y,error:v,isSuccess:k,refetch:b}=t,f=d||[],m=S,h=c?12:9,T=g.useMemo(()=>(x!==""?n:f)||[],[x,f,n]),N=T.length||0,ae=Math.ceil(N/h),B=lt(T||[],h),re=(E,D)=>{C(D),B.jump(D)};return g.useEffect(()=>{if(x){const E=ct(f,x);p(E)}else p([])},[x,f]),e.jsxs(e.Fragment,{children:[k&&(f==null?void 0:f.length)>0&&e.jsxs(I,{display:"flex",mb:3,flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center"},...r,children:[e.jsx(I,{children:e.jsx(Ee,{fullWidth:!0,size:"small",placeholder:"Buscar ...",value:x,onChange:E=>o(E.target.value),InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(I,{sx:{color:"text.disabled"},children:e.jsx(Ie,{sx:{marginTop:1}})})})}})}),e.jsx(I,{sx:{flex:"1 1 auto",mb:{xs:3}}}),e.jsx(ke,{count:ae,page:l,onChange:re})]}),!m&&k&&f.length===0&&e.jsx(q,{widthImage:"30%",message:a}),!m&&y&&e.jsx(le,{widthImage:"30%",errorMessage:v,handleButton:b}),!y&&e.jsx(I,{mb:3,sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:i?"repeat(3, 1fr)":"repeat(2, 1fr)",xl:"repeat(4, 1fr)"}},children:(m?[...Array(h)]:B.currentData()||[]).map((E,D)=>E?g.createElement(s,{card:E,key:D}):e.jsx(pt,{},D))}),f.length>0&&N===0&&e.jsx(q,{widthImage:"30%",message:"No hay tarjetas que coincidan con la búsqueda"})]})}function ht({handleAssign:t}){return e.jsx(I,{sx:{marginRight:3},children:e.jsx(Z,{title:"Asignar",children:e.jsx(P,{onClick:t,children:e.jsx(De,{sx:{color:a=>a.palette.info.main},width:24,height:24})})})})}const gt=t=>{const a=t.map(s=>{var r;return{id:s==null?void 0:s.id,name:(r=s==null?void 0:s.name)==null?void 0:r.toUpperCase(),statusId:s==null?void 0:s.active}})||[];return te(a,"id","name")},se={CARD_TYPES_LIST:"cardTypes"},jt=async()=>{const{data:t}=await R.get("/api/payment-processors");return gt(t)},F={STOCK_CARDS_LIST:"stockCards",AFFILIATED_COMMERCES_LIST:"affiliatedCommerces"},Ct=t=>{const{cardNumber:a,cardType:s,expiration:r,cvv:c,assigned:i}=t,l=r==null?void 0:r.slice(-2),C=(r==null?void 0:r.slice(0,3))+l,x={cardNumber:a.replace(/\s+/g,""),paymentProcessorId:s==null?void 0:s.value,expirationDate:C,cvv:c,commerceId:(i==null?void 0:i.value)||""};return Je(x)},ft=t=>{const a=(t==null?void 0:t.map(s=>({id:s==null?void 0:s.id,name:s==null?void 0:s.name})))||[];return te(a,"id","name")},bt=async t=>(await R.post("/api/card/new",t),t),St=async()=>{const{data:t}=await R.get("/api/commerces/affiliates");return ft(t)},yt=async()=>{const{data:t}=await R.get("/api/cards/stock");return et(t)},Gt=async t=>{const a=t!=null&&t.cardId?"/api/card/assign/commerce":"/api/cards/assign/commerce",{data:s}=await R.post(a,t);return s},vt=(t={})=>{const a=Re(),s=_e(bt,t);return{...s,registerCard:async(c,i)=>{const{onSuccess:l,onError:C,mutationOptions:x}=i;try{await z.promise(s.mutateAsync(c,x),{pending:"Registrando tarjeta ...",success:{render({data:o}){return a.invalidateQueries([F.STOCK_CARDS_LIST]),l(o),o!=null&&o.isAssigned?"Se agrego una nueva tarjeta al comercio":"Se agrego una nueva tarjeta al stock"}}})}catch(o){const n=M(o,"No se puede agregar la tarjeta al stock");C(n),z.error(n,{type:de(o)})}}}},At=(t={})=>{const{enqueueSnackbar:a}=_(),[s,r]=g.useState(null);return{...V([F.AFFILIATED_COMMERCES_LIST],St,{staleTime:60*5e3,onError:i=>{const l=M(i,"No se puede obtener la lista de comercios afiliados");r(l),a(l,{variant:"error",autoHideDuration:5e3})},...t}),error:s||null}},Tt=(t={})=>{const[a,s]=g.useState(null);return{...V([F.STOCK_CARDS_LIST],yt,{staleTime:6e4,onError:c=>{const i=M(c,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");s(i)},...t}),error:a||null}};function wt({setOpen:t}){const{registerCard:a,isLoading:s}=vt(),r=H([F.AFFILIATED_COMMERCES_LIST])||[],c=H([se.CARD_TYPES_LIST])||[],[i,l]=g.useState(!1),C=Y().shape({cardNumber:L().transform((m,h)=>h.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:L().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),cardType:Y().nullable().required("El tipo de tarjeta es requerido"),expiration:L().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(m){const h=Me(`01/${m}`,"dd/MM/yyyy",new Date),T=new Date;return K(h)&&Pe(h,T)})}),x=Ze({initialValues:{cardNumber:"",cardType:c&&c.length>0&&c[0]||null,expiration:"",cvv:"",assigned:null},validationSchema:C,onSubmit:(m,{setSubmitting:h})=>{h(!1),m.assigned?l(!0):f(m)}}),{isSubmitting:o,values:n,setFieldValue:p,errors:d,handleSubmit:S,touched:y,resetForm:v,setSubmitting:k}=x,b=o||s,f=(m,h=!1)=>{const T=Ct(m);a({...T,isAssigned:h},{onSuccess:()=>{t(!1),v(),l(!1)},onError:()=>{l(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(tt,{formik:x,children:e.jsx(u,{spacing:5,sx:{p:3},children:e.jsxs(u,{spacing:3,children:[e.jsxs(u,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta"}),e.jsx(U,{name:"cardType",disableClearable:!0,textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:c,disabled:b})]}),e.jsxs(u,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta"}),e.jsx(Q,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Fe,{})}),inputComponent:$,inputProps:{mask:"0000 0000 0000 0000",value:n.cardNumber,onAccept:m=>{p("cardNumber",m)}}},disabled:b})]}),e.jsxs(u,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(u,{sx:{width:{xs:"100%",lg:"40%"}},children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(Q,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Ne,{})}),inputComponent:$,inputProps:{mask:"000",onAccept:m=>{p("cvv",m)},value:n.cvv}},disabled:b})]}),e.jsxs(u,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),e.jsx(Le,{disabled:b,views:["year","month"],name:"expiration",value:new Date(n.expiration)??null,onChange:m=>K(m)?x.setFieldValue("expiration",Oe(m,"MM/yyyy")):x.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(y.expiration&&d.expiration),required:!0,helperText:y.expiration&&d.expiration?d.expiration:""}},disablePast:!0,format:"MM/yy"})]})]}),e.jsxs(u,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Asignar:"}),e.jsx(U,{name:"assigned",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:r,disabled:b})]})]})})})}),e.jsx(u,{sx:{px:3,pt:3},children:e.jsx(ee,{loading:b,variant:"contained",color:"primary",fullWidth:!0,type:"submit",onClick:S,disabled:b,startIcon:e.jsx(Ve,{}),children:"Crear"})}),i&&e.jsx(xe,{title:"Asignar Tarjeta",typeAlert:"warning",textButtonSuccess:"Asignar",onClose:()=>{l(!1),k(!1)},open:i,isSubmitting:s,description:e.jsxs(u,{spacing:2,children:[e.jsx(j,{children:"¿Está seguro de asignar esta tarjeta a este comercio?"}),e.jsxs(u,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(Be,{}),e.jsx(j,{variant:"caption",children:"Verifique que todos los datos esten correctos"})]})]}),onSuccess:()=>{f(n,!0)},fullWidth:!0,maxWidth:"xs"})]})}function Et({open:t,setOpen:a}){const{themeDirection:s}=pe(),r=s!=="rtl"?X({distance:W.BASE_WIDTH,durationIn:.32,durationOut:.32}).inRight:X({distance:W.BASE_WIDTH,durationIn:.32,durationOut:.32}).inLeft;g.useEffect(()=>{t?document.body.style.overflow="hidden":document.body.style.overflow="unset"},[t]);const c=()=>{a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(qe,{open:t,onClick:c,sx:{background:"transparent",zIndex:i=>i.zIndex.drawer+1}}),e.jsx(He,{children:t&&e.jsx(e.Fragment,{children:e.jsxs(me,{...r,children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{py:2,pr:1,pl:2.5},children:[e.jsx(j,{variant:"subtitle1",children:"Nueva Tarjeta"}),e.jsx("div",{children:e.jsx(P,{"aria-label":"close",size:"medium",onClick:c,children:e.jsx(We,{width:20,height:20,fontSize:"inherit",color:"primary"})})})]}),e.jsx(ze,{sx:{borderStyle:"dashed"}}),e.jsx(wt,{setOpen:a})]})})})]})}function It({isLoading:t,cards:a=[]}){const s=A(n=>n.isReadyToAssign),r=A(n=>n.setOpen),c=A(n=>n.setCard),[i,l]=g.useState(null),{enqueueSnackbar:C}=_(),x=[{name:"cardNumberHidden",label:"Tarjeta",options:{customBodyRenderLite:(n,p)=>{const d=a[n];return e.jsx(j,{variant:"subtitle2",fontWeight:"bold",children:d==null?void 0:d.cardNumberHidden})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(n,p)=>{const d=a[n];return e.jsxs(u,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(Ke,{sx:S=>({width:45,height:45,color:S.palette.primary.contrastText,backgroundColor:S.palette.primary.light}),children:(d==null?void 0:d.cardType)==="Carnet"?e.jsx(st,{sx:{width:30},color:"white"}):e.jsx(at,{sx:{width:30}})}),e.jsx(j,{variant:"subtitle2",children:d==null?void 0:d.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"register",label:"Fecha",options:{filterType:"textField",customBodyRenderLite:(n,p)=>{const d=a[n];return e.jsxs(u,{children:[e.jsx(j,{variant:"subtitle2",children:d==null?void 0:d.registerDate}),e.jsx(j,{variant:"body2",sx:{color:"text.secondary"},children:d==null?void 0:d.registerTime})]})}}}],o=()=>{s?(r(!0),c(i)):(r(!1),C("Por el momento no se puede asignar la tarjeta. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return e.jsx(J,{children:e.jsx(rt,{isLoading:t,data:a||[],columns:x,options:{responsive:"simple",rowHover:!0,selectableRows:"single",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_stock.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(n,p,d)=>{const S=a==null?void 0:a.find((y,v)=>d.includes(v));l(S)},customToolbarSelect:n=>e.jsx(ht,{handleAssign:o})}})})}const kt=(t={})=>{const{enqueueSnackbar:a}=_(),[s,r]=g.useState(null);return{...V([se.CARD_TYPES_LIST],jt,{staleTime:60*5e3,onError:i=>{const l=M(i,"No se puede obtener la lista de los tipos de tarjeta");r(l),a(l,{variant:"error",autoHideDuration:5e3})},...t}),error:s||null}},Dt=fe(g.lazy(()=>be(()=>import("./AssignCardModal-aKrSyYbY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]))));function Rt(){const[t,a]=g.useState(!1),{data:s,isSuccess:r,isLoading:c}=At(),{data:i,isSuccess:l,isLoading:C}=kt(),x=Tt(),{data:o,isLoading:n}=x,p=A(h=>h.setOpen),d=A(h=>h.setReadyToAssign),S=A(h=>h.open),{enqueueSnackbar:y}=_(),[v,k]=g.useState("1"),b=(h,T)=>{k(T)},f=()=>{s&&i&&l&&r?a(!0):y("Por el momento no se puede crear una tarjeta. Intente nuevamenta o reporte a sistemas",{variant:"warning",autoHideDuration:5e3})},m=()=>{s&&s.length>0&&i&&i.length>0?p(!0):(p(!1),y("Por el momento no se puede asignar tarjetas. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return g.useEffect(()=>{s&&s.length>0?d(!0):d(!1)},[s]),e.jsx(he,{title:"Stock de Tarjetas",children:e.jsxs(nt,{children:[e.jsx(it,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:ge.root},{name:"Administracion",href:je.stock_cards},{name:Ce.stock_cards.name}],buttons:e.jsxs(u,{direction:"column",spacing:2,mt:{xs:2,md:0},children:[e.jsxs(u,{spacing:2,direction:{xs:"column",md:"row"},children:[o&&(o==null?void 0:o.length)>0&&e.jsx(Ge,{sx:{color:"text.primary"},type:"button",color:"secondary",variant:"contained",onClick:m,startIcon:e.jsx(Ye,{}),children:"Asignar Tarjetas"}),e.jsx(ee,{loading:c||C,variant:"contained",onClick:f,startIcon:e.jsx(Qe,{}),children:"Nueva Tarjeta"})]}),e.jsx(u,{alignItems:{xs:"center",md:"flex-end"},children:e.jsxs($e,{size:"small",color:"primary",value:v,exclusive:!0,onChange:b,"aria-label":"Platform",children:[e.jsx(G,{value:"1",children:e.jsx(Ue,{})}),e.jsx(G,{value:"2",children:e.jsx(Xe,{})})]})})]})}),v==="2"&&e.jsx(mt,{cards:x}),v==="1"&&e.jsx(It,{cards:o,isLoading:n}),e.jsx(Et,{open:t,setOpen:a}),S&&e.jsx(Dt,{})]})})}const Yt=Object.freeze(Object.defineProperty({__proto__:null,default:Rt},Symbol.toStringTag,{value:"Module"}));export{F as M,se as S,Gt as a,Yt as b};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/AssignCardModal-aKrSyYbY.js","assets/js/vendor-StReGf79.js","assets/js/formik.esm-ayHIcoJR.js","assets/js/index.esm-cYP9oANf.js","assets/js/index-8BLzEq8l.js","assets/css/build-K0YT2apu.css","assets/js/filterSearch-5mPANZVQ.js","assets/js/CarnetLogo-9N730tjt.js","assets/js/MasterCardLogo-31QJgBVq.js","assets/js/formatNumber-D2wM-uoj.js","assets/js/TextMaxLine-9O-T-qdR.js","assets/js/UploadSingleFile-IuSqpHgf.js","assets/js/fade-HpdRXKiE.js","assets/js/transition-Uc7vb3zK.js","assets/js/RFSelect-VFpQl01y.js","assets/js/crypto-DOZFMzid.js","assets/js/matchTypes-VzXr5CmM.js","assets/js/cardsAdapter-jMj_YqiI.js","assets/js/formatTime-j4oUQxO9.js","assets/js/HeaderPage-Oxll9yW3.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=StockCards-iluNNe2z.js.map
