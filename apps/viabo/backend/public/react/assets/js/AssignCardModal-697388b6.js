import{s as R,T as y,r as m,an as L,ah as M,j as i,ae as _,ao as j,ap as k,p as u,G as F,aJ as O,c as g,d as N,L as P,u as q,k as B,o as K,g as w,t as Q,S as T}from"./index-68e3b10c.js";import{u as G}from"./formik.esm-62465d07.js";import{c as A,e as $}from"./index.esm-4f526a47.js";import{R as H}from"./RFTextField-1e53b8e9.js";import{D as U,g as W,a as J,b as V,c as Y,M as S,d as z,u as x,e as E,C as X,R as Z}from"./StockCards-8962880a.js";import{F as ee}from"./FormProvider-6183c809.js";import"./TextField-91aef46b.js";import"./EmptyList-bd544756.js";import"./transition-f2dd95fb.js";import"./middleware-5838e949.js";import"./formatNumber-86c26ae4.js";import"./VisibilityOff-1b3fb906.js";import"./Card-3cc84b77.js";import"./matchTypes-ecaf0d13.js";import"./InputAdornment-c2c7898a.js";import"./Grid-701ea119.js";const oe=["className","id"],te=e=>{const{classes:t}=e;return k({root:["root"]},W,t)},se=R(y,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),re=m.forwardRef(function(t,o){const a=L({props:t,name:"MuiDialogTitle"}),{className:r,id:n}=a,l=M(a,oe),c=a,C=te(c),{titleId:p=n}=m.useContext(U);return i(se,_({component:"h2",className:j(C.root,r),ownerState:c,ref:o,variant:"h6",id:n??p},l))}),ie=re;v.propTypes={onClose:u.func,onSuccess:u.func,children:u.node,open:u.bool,isSubmitting:u.bool,scrollType:u.string,title:u.string,textButtonSuccess:u.string,disableLoadingIndicator:u.bool};function v(e){const{title:t,textButtonSuccess:o,isSubmitting:a,open:r,scrollType:n="paper",onClose:l,onSuccess:c,disableLoadingIndicator:C=!1,children:p,...h}=e,b=F();O(b.breakpoints.between("xs","sm"));const D=m.useRef(null);return m.useEffect(()=>{if(r){const{current:s}=D;s!==null&&s.focus()}},[r]),g(J,{open:r,onClose:(s,d)=>{d&&d==="backdropClick"||d&&d==="escapeKeyDown"||l()},scroll:n,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",...h,children:[i(ie,{sx:{mb:n==="paper"?3:0},id:"scroll-dialog-title",children:t}),i(V,{id:"croll-dialog-description",dividers:n==="paper",children:p}),g(Y,{children:[!a&&i(N,{variant:"outlined",color:"inherit",onClick:l,children:"Cerrar"}),i(P,{onClick:c,loading:a,color:"primary",variant:"contained",children:o})]})]})}const ae=(e={})=>{const{enqueueSnackbar:t}=q(),[o,a]=m.useState(null),r=B();return{...K(z,{onSuccess:()=>{a(null),r.removeQueries([S.STOCK_CARDS_LIST]),t("Se asignaron las tarjetas al comercio",{variant:"success",autoHideDuration:5e3})},onError:l=>{r.removeQueries([S.STOCK_CARDS_LIST]);const c=w(l,"No se puede asignar las tarjetas al comercio");t(c,{variant:Q(l),autoHideDuration:5e3}),a(c)},...e}),error:o||null}},ne=e=>{var o;const t=(o=e==null?void 0:e.commerce)==null?void 0:o.value;return e!=null&&e.cardId?{cardId:e==null?void 0:e.cardId,commerceId:t}:{cardNumbers:e==null?void 0:e.numberOfCards,commerceId:t}};function Ae(){const e=x(s=>s.setOpen),t=x(s=>s.setCard),o=x(s=>s.card),a=E([S.AFFILIATED_COMMERCES_LIST])||[],r=E([S.STOCK_CARDS_LIST])||[],{mutate:n,isLoading:l}=ae(),c=m.useMemo(()=>{const s={commerce:A().nullable().required("El comercio es requerido")};return o?{...s}:{...s,numberOfCards:$().min(1,"Al menos debe existir una tarjeta").max(r.length,`La cantidad maxima de tarjetas son: ${r.length} `).required("El número de tarjetas es requerido")}},[o,r]),C=m.useMemo(()=>o?{cardId:o==null?void 0:o.id,commerce:null}:{numberOfCards:1,commerce:null},[o]),p=G({initialValues:C,validationSchema:A().shape(c),onSubmit:(s,{setSubmitting:d})=>{console.log(s);const I=ne(s);n(I,{onSuccess:()=>{e(!1),t(null),d(!1)},onError:()=>{d(!1)}})}}),{isSubmitting:h,handleSubmit:b,resetForm:D}=p,f=h||l;return i(v,{onClose:()=>{e(!1),t(null)},onSuccess:b,isSubmitting:f,fullWidth:!0,scrollType:"body",title:o?"Asignar Tarjeta":"Asignar Tarjetas",textButtonSuccess:"Guardar",open:!0,children:i(ee,{formik:p,children:g(T,{spacing:3,sx:{py:3},children:[o?i(X,{card:o}):g(T,{children:[i(y,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de tarjetas:"}),i(H,{name:"numberOfCards",placeholder:"1",type:"number",inputProps:{inputMode:"numeric",min:"1"},disabled:f})]}),g(T,{children:[i(y,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comercio:"}),i(Z,{name:"commerce",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:a,disabled:f})]})]})})})}export{Ae as default};
