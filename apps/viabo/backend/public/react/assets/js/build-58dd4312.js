import{r as E,k as M,X as ie,ar as re,j as e,U as _,as as ae,at as le,au as V,t as ce,a as k,a3 as de,n as me,av as b,g as N,o as pe,b as ue,P as y,aa as B,S as x,ab as xe,T as C,L as he,c as ge,aj as Ce,a4 as fe,d as je,B as F,f as ye,ao as ve,ap as Ee,aq as be}from"./build-a4286722.js";import{u as Ae}from"./build-c9fe264a.js";import{M as Te}from"./build-a420dad7.js";import{c as Se,a as I}from"./build-5f4b6afe.js";import{g as we,C as Ie}from"./build-7167ab3a.js";import{C as Re,R as Le,a as _e,D as De}from"./build-1fe8520e.js";import{C as Ve}from"./build-c7ce8ef2.js";import{F as Pe,R as D,M as Oe}from"./build-227a49f0.js";import{I as P}from"./build-4a55cb46.js";import{E as Me}from"./build-e646a66f.js";import{V as ke,A as Ne}from"./build-2ea05e3c.js";import{C as Be,M as Fe,a as Ue,H as qe}from"./build-e98b8eba.js";import{C as We}from"./build-04156900.js";import{C as ze}from"./build-1ac380b1.js";import{C as He,A as $e,a as Qe,b as Ge,F as Ke,c as Ze}from"./build-311cb954.js";import{C as U}from"./build-eaf5f815.js";import{s as Xe}from"./build-9563ddbe.js";import{C as Ye}from"./build-00e619ad.js";import{C as Je}from"./build-f5da9d22.js";import{T as es,a as O}from"./build-53f22b1a.js";import"./build-2cb47c61.js";import"./build-ecaf0d13.js";import"./build-6545b459.js";import"./build-bee6630b.js";import"./build-960b2b78.js";import"./build-1edc0bc7.js";import"./build-4794144f.js";import"./build-48ae2208.js";import"./build-bcc20dc7.js";const ss=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ns={entering:{transform:"none"},entered:{transform:"none"}},ts=E.forwardRef(function(t,r){const a=M(),o={enter:a.transitions.duration.enteringScreen,exit:a.transitions.duration.leavingScreen},{addEndListener:l,appear:p=!0,children:d,easing:m,in:n,onEnter:u,onEntered:i,onEntering:c,onExit:h,onExited:j,onExiting:A,style:R,timeout:L=o,TransitionComponent:K=ae}=t,Z=ie(t,ss),w=E.useRef(null),X=re(w,d.ref,r),T=g=>v=>{if(g){const S=w.current;v===void 0?g(S):g(S,v)}},Y=T(c),J=T((g,v)=>{le(g);const S=V({style:R,timeout:L,easing:m},{mode:"enter"});g.style.webkitTransition=a.transitions.create("transform",S),g.style.transition=a.transitions.create("transform",S),u&&u(g,v)}),ee=T(i),se=T(A),ne=T(g=>{const v=V({style:R,timeout:L,easing:m},{mode:"exit"});g.style.webkitTransition=a.transitions.create("transform",v),g.style.transition=a.transitions.create("transform",v),h&&h(g)}),te=T(j),oe=g=>{l&&l(w.current,g)};return e.jsx(K,_({appear:p,in:n,nodeRef:w,onEnter:J,onEntered:ee,onEntering:Y,onExit:ne,onExited:te,onExiting:se,addEndListener:oe,timeout:L},Z,{children:(g,v)=>E.cloneElement(d,_({style:_({transform:"scale(0)",visibility:g==="exited"&&!n?"hidden":void 0},ns[g],R,d.props.style),ref:X},v))}))}),os=ts,is=ce(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),q={LIST:"allCommerceCards"},rs=(s,t,r)=>{var d;const{phone:a,email:o,name:l}=s,p={name:l,phone:a,email:o,cards:r?[{id:(d=t[0])==null?void 0:d.id,cvv:s==null?void 0:s.cvv}]:(t==null?void 0:t.map(m=>({id:m==null?void 0:m.id,cvv:m==null?void 0:m.cvv})))||[]};return we(p)},as=async()=>{const{data:s}=await k.get("/api/cards/commerce");return Re(s)},ls=async s=>(await k.put("/api/assign/commerce-card/to/user",s),s),cs=(s={})=>{const t=de(),r=me(ls,s);return{...r,mutate:async(o,l)=>{const{onSuccess:p,onError:d,mutationOptions:m}=l;try{await b.promise(r.mutateAsync(o,m),{pending:"Asignando Tarjetas ...",success:{render({data:n}){return t.invalidateQueries([q.LIST]),t.invalidateQueries([Ve.CARDS_COMMERCE_LIST]),p(),"Se asignaron las tarjetas con éxito"}}})}catch(n){const u=N(n,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(u),b.error(u,{type:pe(n)})}}}},ds=(s={})=>{const[t,r]=E.useState(null);return{...ue([q.LIST],as,{staleTime:6e4,onError:o=>{const l=N(o,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");r(l)},...s}),error:t||null}};function W({cards:s,onSuccess:t}){const{mutate:r,isLoading:a}=cs(),o=E.useMemo(()=>(s==null?void 0:s.length)>0&&s[0].cvv==="",[s]),l=Se({name:I().required("El nombre es requerido"),email:I().email("Ingresa un correo valido").required("El correo es requerido"),phone:I().test("longitud","El telefono es muy corto",j=>!(j&&j.replace(/[\s+]/g,"").length<10)),...o&&{cvv:I().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),p=Ae({initialValues:{name:"",phone:"",email:"",...o&&{cvv:""}},validationSchema:l,onSubmit:j=>{const A=rs(j,s,o);r(A,{onSuccess:()=>{c(!1),t()},onError:()=>{c(!1)}})}}),{errors:d,touched:m,isSubmitting:n,setFieldValue:u,values:i,setSubmitting:c}=p,h=n||a;return e.jsx(B,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Pe,{formik:p,children:e.jsxs(x,{spacing:3,sx:{p:3},children:[o&&e.jsx(xe,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(C,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(x,{children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:h})]}),e.jsxs(x,{children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:h,InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(Me,{})})}})]}),e.jsxs(x,{children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Te,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:i.phone||"+52",disabled:h,onChange:(j,A)=>{u("phone",j)},error:m.phone&&!!d.phone,helperText:m.phone&&d.phone})]}),o&&e.jsxs(x,{children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(D,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(ke,{})}),inputComponent:Oe,inputProps:{mask:"000",onAccept:j=>{u("cvv",j)},value:i.cvv}},disabled:h})]}),e.jsx(x,{sx:{pt:3},children:e.jsx(he,{loading:n,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Ne,{}),children:"Asociar"})})]})})})}W.propTypes={cards:y.array,onSuccess:y.func};const ms={cards:[],rows:[],openAssign:!1},ps=(s,t)=>({...ms,setSelectedCard:r=>{const{cards:a}=t(),o=a.indexOf(r);let l=[];o===-1?l=l.concat(a,r):o===0?l=l.concat(a.slice(1)):o===a.length-1?l=l.concat(a.slice(0,-1)):o>0&&(l=l.concat(a.slice(0,o),a.slice(o+1))),s(p=>({cards:l}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:r=>{s(a=>({cards:r}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:r=>{s(a=>({rows:r}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:r=>{s(a=>({openAssign:r}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{s(r=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),f=ge(ps);function z({open:s,handleClose:t,handleSuccess:r}){const a=f(o=>o.cards);return e.jsxs(Le,{open:s,handleClose:t,title:(a==null?void 0:a.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(x,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:a==null?void 0:a.map(o=>e.jsx(Ie,{icon:e.jsx(We,{}),label:o==null?void 0:o.cardNumberHidden},o==null?void 0:o.id))}),e.jsx(W,{cards:a,onSuccess:r})]})}z.propTypes={handleClose:y.func,handleSuccess:y.func,open:y.bool};function H({card:s}){var l,p;const t=f(d=>d.setSelectedCard),r=f(d=>d.cards),a=r==null?void 0:r.some(d=>(d==null?void 0:d.id)===(s==null?void 0:s.id)),o=d=>{d.stopPropagation(),t(s)};return e.jsx(Ce.div,{onClick:o,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(_e,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(x,{flexDirection:"row",gap:1,children:[e.jsx(U,{onClick:o,edge:"start",checked:a,inputProps:{"aria-labelledby":s==null?void 0:s.id},color:"success"}),e.jsxs(x,{children:[e.jsx(C,{variant:"subtitle2",sx:{opacity:.72},children:((l=s==null?void 0:s.assignUser)==null?void 0:l.name)==="-"?"Viabo Card":(p=s==null?void 0:s.assignUser)==null?void 0:p.name}),e.jsx(C,{variant:"caption",color:"text.secondary",children:s==null?void 0:s.register})]})]}),e.jsx(ze,{card:s,disableShow:!0}),e.jsxs(x,{direction:"row",spacing:5,children:[e.jsxs(x,{children:[e.jsx(C,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(C,{sx:{typography:"subtitle1"},children:s==null?void 0:s.expiration})]}),e.jsx(He,{card:s,disableShow:!0})]})]})})}H.propTypes={card:y.shape({expiration:y.any,id:y.any,register:y.any})};function $({cards:s}){const t=f(n=>n.cards),r=f(n=>n.setAllCards),a=f(n=>n.resetCards),o=f(n=>n.setOpenAssign),l=(t==null?void 0:t.length)||0,p=(s==null?void 0:s.length)||0,d=n=>{if(n){r(s);return}a()},m=()=>{const n=t.some(c=>(c==null?void 0:c.cvv)==="")&&(t==null?void 0:t.length)>1,u=t.some(c=>{var h;return((h=c==null?void 0:c.assignUser)==null?void 0:h.id)!==""});t.every(c=>(c==null?void 0:c.cvv)==="")&&(t==null?void 0:t.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):n?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?b.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):o(!0)};return e.jsx(e.Fragment,{children:e.jsx(fe,{sx:n=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:n.customShadows.z8,backgroundColor:n.palette.info.lighter,color:"white"}),children:e.jsxs(x,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(x,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(U,{indeterminate:l>0&&l<p,checked:p>0&&l===p,onChange:n=>d(n.target.checked),color:"success"}),e.jsx(C,{color:"success.main",variant:"subtitle1",children:l===1?`${l} Tarjeta`:`${l} Tarjetas`})]}),e.jsx(x,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(je,{startIcon:e.jsx($e,{}),variant:"outlined",color:"info",onClick:m,children:"Asignar"})})]})})})}$.propTypes={cards:y.array};function Q({commerceCards:s}){const t=s==null?void 0:s.data,r=f(d=>d.cards),a=f(d=>d.setIndexCards,Xe),o=M(),l=E.useMemo(()=>(r==null?void 0:r.map(d=>t.findIndex(m=>m.id===d.id)))||[],[r,t]);E.useEffect(()=>{a(l)},[l]);const p={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen};return e.jsx(x,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(x,{sx:d=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(os,{in:(r==null?void 0:r.length)>0,timeout:p,style:{transitionDelay:`${(r==null?void 0:r.length)>0?p.exit:0}ms`},unmountOnExit:!0,children:e.jsx(F,{children:e.jsx($,{cards:s==null?void 0:s.data})})}),e.jsx(B,{children:e.jsx(Qe,{cards:s,emptyMessage:"No hay tarjetas sin asignar",cardComponent:H,my:3})})]})})}Q.propTypes={commerceCards:y.shape({data:y.array})};function G({isLoading:s,cards:t=[],rows:r=[]}){const a=f(n=>n.setAllCards),o=f(n=>n.cards),l=f(n=>n.setOpenAssign),p=f(n=>n.setIndexCards),d=()=>{const n=o.some(c=>(c==null?void 0:c.cvv)==="")&&(o==null?void 0:o.length)>1,u=o.some(c=>{var h;return((h=c==null?void 0:c.assignUser)==null?void 0:h.id)!==""});o.every(c=>(c==null?void 0:c.cvv)==="")&&(o==null?void 0:o.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):n?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?b.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):l(!0)},m=[{name:"cardNumberMoreDigits",label:"Tarjeta",options:{customBodyRenderLite:(n,u)=>{const i=t[n];return e.jsx(C,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:i==null?void 0:i.cardNumberMoreDigits})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(n,u)=>{const i=t[n];return e.jsx(x,{flexDirection:"row",alignItems:"center",gap:1,children:(i==null?void 0:i.cardType)==="Carnet"?e.jsx(Be,{sx:{width:25}}):e.jsx(Fe,{sx:{width:25}})})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"emptyCVV",label:"CVV",options:{filterType:"checkbox",customBodyRenderLite:(n,u)=>{const i=t[n];return(i==null?void 0:i.cvv)===""||!(i!=null&&i.cvv)?e.jsx(Je,{color:"error"}):e.jsx(is,{color:"success"})}}},{name:"assignUser.name",label:"Asignado",options:{customBodyRenderLite:(n,u)=>{var c;const i=t[n];return e.jsx(C,{variant:"body2",children:(c=i==null?void 0:i.assignUser)==null?void 0:c.name})}}},{name:"assignUser.date",label:"Fecha de Asignación",options:{customBodyRenderLite:(n,u)=>{var c,h,j,A;const i=t[n];return((c=i==null?void 0:i.assignUser)==null?void 0:c.date)==="-"?e.jsx(C,{variant:"subtitle2",children:(h=i==null?void 0:i.assignUser)==null?void 0:h.date}):e.jsxs(x,{children:[e.jsx(C,{variant:"subtitle2",children:(j=i==null?void 0:i.assignUser)==null?void 0:j.date}),e.jsx(C,{variant:"body2",fontSize:"12px",sx:{color:"text.secondary"},children:(A=i==null?void 0:i.assignUser)==null?void 0:A.time})]})}}},{name:"register",label:"Fecha de Registro",options:{filterType:"textField",customBodyRenderLite:(n,u)=>{const i=t[n];return e.jsxs(x,{children:[e.jsx(C,{variant:"subtitle2",children:i==null?void 0:i.registerDate}),e.jsx(C,{variant:"body2",fontSize:"12px",sx:{color:"text.secondary"},children:i==null?void 0:i.registerTime})]})}}}];return e.jsx(Ye,{children:e.jsx(De,{isLoading:s,data:t||[],columns:m,options:{responsive:"simple",rowsSelected:r,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",enableNestedDataAccess:".",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(n,u,i)=>{const c=t==null?void 0:t.filter((h,j)=>i.includes(j));a(c),p(i)},setTableProps:()=>({size:"small"}),customToolbarSelect:n=>e.jsx(Ge,{handleAssign:d})}})})}G.propTypes={cards:y.array,isLoading:y.bool,rows:y.array};function qs(){const s=ds(),[t,r]=E.useState("1"),a=(m,n)=>{n&&r(n)},o=f(m=>m.rows),l=f(m=>m.openAssign),p=f(m=>m.setOpenAssign),d=f(m=>m.resetCards);return e.jsx(e.Fragment,{children:e.jsx(ye,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(Ue,{sx:{height:"100%"},children:[e.jsx(qe,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:ve.root},{name:"Administracion",href:Ee.cards},{name:be.unassignedCards.name}],buttons:e.jsx(F,{display:"flex",justifyContent:"center",mt:{xs:2,md:0},children:e.jsxs(es,{size:"small",color:"primary",value:t,exclusive:!0,onChange:a,"aria-label":"Platform",children:[e.jsx(O,{value:"1",children:e.jsx(Ke,{})}),e.jsx(O,{value:"2",children:e.jsx(Ze,{})})]})})}),t==="2"&&e.jsx(Q,{commerceCards:s}),t==="1"&&e.jsx(G,{cards:s.data,isLoading:s.isLoading,rows:o}),e.jsx(z,{open:l,handleClose:()=>{p(!1)},handleSuccess:()=>{p(!1),d()}})]})})})}export{qs as default};
