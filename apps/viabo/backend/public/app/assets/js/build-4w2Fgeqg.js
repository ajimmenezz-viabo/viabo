import{z as M,j as e,k as R,a as E,Q as I,g as N,b as F,q as k,r as C,D as O,B as z,T as d,S as B,L as D,p as Q,O as c}from"./index-EHCGdQqa.js";import{a as W}from"./build-Wa6kpvgH.js";import{f as y}from"./build-G-VE9h_k.js";import{t as _}from"./build-wNs_MxwQ.js";import{C as f}from"./build-qjKQWaxY.js";import{g as L}from"./build-5t4D_lqw.js";import{n as T,T as P,l as G,m as $,o as s,p as q}from"./build-dAZ6w5rU.js";import"./build-lZ3TP0q8.js";import"./build-3xVnG2m1.js";import"./build-AT2uCFgk.js";import"./build-J6QiovFS.js";import"./build-jVKbR__F.js";import"./build-TfVjCNGi.js";import"./build-9olBfd-W.js";import"./build-Y0IIkvqn.js";import"./build-dgnPFhL8.js";import"./build-S4-6fRHa.js";import"./build--4aaS65y.js";import"./build-bVmbnDvY.js";import"./build-mZYsXZap.js";import"./build-tvLIepYE.js";import"./build-z2d0I-ip.js";import"./build-j61AaUI1.js";import"./build-n0pfqJRy.js";import"./build-evFGbqQZ.js";const H=M(e.jsx("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos"),K=(r,i,t,u)=>{var x,h;let p;return u?p={originCardId:r,destinationCards:[{cardId:(x=i==null?void 0:i.card)==null?void 0:x.value.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((i==null?void 0:i.amount.toString())===""?"0":(h=i==null?void 0:i.amount)==null?void 0:h.toString().replace(/,/g,"")).toString()}]}:p={originCardId:r,destinationCards:i==null?void 0:i.map(o=>{var a,n,m;return{cardId:(n=(a=o==null?void 0:o.card)==null?void 0:a.value)==null?void 0:n.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((o==null?void 0:o.amount.toString())===""?"0":(m=o==null?void 0:o.amount)==null?void 0:m.toString().replace(/,/g,"")).toString()}})},{cardId:p==null?void 0:p.originCardId,data:W(p)}},U=(r={})=>{const i=R(),t=E(_,r);return{...t,transaction:async(p,x)=>{const{onSuccess:h,onError:o,mutationOptions:a}=x;try{await I.promise(t.mutateAsync(p,a),{pending:"Procesando Transferencia ...",success:{render({data:n}){return i.fetchQuery([f.TRANSIT_BALANCE]),i.invalidateQueries([f.CARD_INFO,n==null?void 0:n.cardId]),i.fetchQuery([f.CARD_MOVEMENTS,n==null?void 0:n.cardId]),i.fetchQuery([f.MAIN_CARD]),h(n),"Se realizo la transferencia con éxito"}}})}catch(n){const m=N(n,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");o(m),I.error(m,{type:F(n)})}}}},b=k(T)(({theme:r})=>({"& td":{paddingTop:r.spacing(.5),paddingBottom:r.spacing(.5)}})),V=({data:r,onBack:i,setTransactionLoading:t,transactionLoading:u,onClose:p})=>{const{transaction:x,isLoading:h}=U(),o=C.useMemo(()=>(r!=null&&r.isGlobal?[r==null?void 0:r.transactions]:r==null?void 0:r.transactions)||[],[r]),a=C.useMemo(()=>(parseFloat(r==null?void 0:r.balance)-(r==null?void 0:r.currentBalance)).toFixed(2)||0,[r]),n=()=>{const{cardOriginId:l,transactions:g,isGlobal:j,concept:S}=r,A=K(l,g,S,j);t(!0),x(A,{onSuccess:()=>{p()},onError:()=>{t(!1)}})},m=C.useMemo(()=>L(r==null?void 0:r.paymentProcessor),[r]),v=m==null?void 0:m.component;return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsx(P,{sx:{minWidth:200},children:e.jsxs(G,{children:[e.jsx($,{sx:{borderBottom:l=>`solid 1px ${l.palette.divider}`},children:e.jsxs(T,{children:[e.jsx(s,{width:40,children:"#"}),e.jsx(s,{align:"left",children:"Movimiento"}),e.jsx(s,{align:"right",children:"Monto"})]})}),e.jsxs(q,{children:[o==null?void 0:o.map((l,g)=>{var j;return e.jsxs(T,{sx:{borderBottom:S=>`solid 1px ${S.palette.divider}`},children:[e.jsx(s,{children:g+1}),e.jsx(s,{align:"left",children:e.jsxs(z,{sx:{maxWidth:200},children:[e.jsx(d,{variant:"subtitle2",children:((j=l==null?void 0:l.card)==null?void 0:j.cardUserNumber)||"Cuenta Global"}),e.jsx(d,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:l==null?void 0:l.concept})]})}),e.jsx(s,{align:"right",children:y(l==null?void 0:l.amount)})]},g)}),e.jsxs(b,{children:[e.jsx(s,{colSpan:1}),e.jsx(s,{align:"right",children:e.jsxs(B,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsx(d,{children:"Saldo Disponible"}),m&&e.jsx(v,{sx:{width:30,height:30}})]})}),e.jsx(s,{align:"right",width:120,children:e.jsx(d,{children:y(r==null?void 0:r.balance)})})]}),e.jsxs(b,{children:[e.jsx(s,{colSpan:1}),e.jsx(s,{align:"right",children:e.jsx(d,{variant:"h6",children:"Total a dispersar"})}),e.jsx(s,{align:"right",width:120,children:e.jsx(d,{variant:"h6",sx:{color:"error.main"},children:y(-(r==null?void 0:r.currentBalance))})})]}),e.jsxs(b,{children:[e.jsx(s,{colSpan:1}),e.jsx(s,{align:"right",children:e.jsx(d,{children:"Total después de movimiento"})}),e.jsx(s,{align:"right",width:140,children:e.jsx(d,{children:y(a)})})]})]})]})})}),e.jsxs(B,{sx:{p:3},spacing:3,children:[e.jsx(D,{size:"large",onClick:n,loading:h||u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",sx:{fontWeight:"bold"},children:"Realizar"}),(!h||!u)&&e.jsx(Q,{onClick:i,variant:"outlined",color:"inherit",fullWidth:!0,startIcon:e.jsx(H,{}),children:"Regresar"})]})]})};V.propTypes={data:c.shape({balance:c.any,cardOriginId:c.any,paymentProcessor:c.any,currentBalance:c.any,isGlobal:c.any,transactions:c.any,concept:c.any}),onBack:c.any,onClose:c.func,setTransactionLoading:c.func,transactionLoading:c.any};export{V as default};
