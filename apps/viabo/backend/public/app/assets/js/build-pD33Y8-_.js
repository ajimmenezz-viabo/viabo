import{z as k,j as e,k as z,a as F,Q as b,g as w,b as L,O as v,S as s,T as i,aD as f,N as T,i as P,cQ as A,L as D,D as O}from"./index-C406R3ty.js";import{u as R}from"./build-KIH6eYLU.js";import{c as _,a as h}from"./build-GJTBy67J.js";import{m as B}from"./build-UypUDUag.js";import{a as $}from"./build-BzeQqsN5.js";import{b as Q,T as S,u as M}from"./build-WktRpPYB.js";import{F as W,M as j,b as I}from"./build-ldM02251.js";import{R as x}from"./build-OsaRfRsO.js";import{M as Y}from"./build-39p-QRwT.js";import{V as U}from"./build--uzdFUXB.js";import{I as g}from"./build-GHuRHZx5.js";import{C as K}from"./build-7XWeDX-u.js";import{V as X}from"./build-fho3Mtyv.js";import{P as G}from"./build-IkErBVYP.js";import{E as H}from"./build-IK_p1PN7.js";import{L as E}from"./build-5t1lJgEW.js";import{L as Z}from"./build-nC142HZT.js";import{a as J}from"./build-btaGkTMs.js";import"./build-4S4YMhHj.js";import"./build-uh7Bczik.js";import"./build-v6oTCMsm.js";import"./build-ykbm84ot.js";import"./build-ysCbZUYd.js";import"./build-UYjh2_VD.js";import"./build-_XBbYtHg.js";import"./build-38iB6sZP.js";import"./build-Pl9dCnZ0.js";import"./build-caySWpUG.js";import"./build-3wi0y6zP.js";import"./build-S6p02zpV.js";import"./build-9E9tHrZa.js";import"./build-Ccv5rkT2.js";import"./build-UlczVlm5.js";import"./build-79GBda30.js";import"./build-arySZ8p4.js";import"./build-_6vnnb0s.js";import"./build-tho4U_WW.js";import"./build-aKDSGjg5.js";import"./build-c97ZKUI0.js";import"./build-Uc7vb3zK.js";import"./build-qULkV8zv.js";import"./build-S-j7JQ0q.js";import"./build-4ztnasGs.js";import"./build-hf2Z-lwv.js";import"./build-08ImWFYS.js";import"./build-6A_Z079A.js";const y=k(e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"}),"Phone");function ee(t){return/^([1-9])$/.test(t)?"0"+t:t}const re=(t,r)=>{var m,d,p,l,u;const n={commerceId:t==null?void 0:t.commerceId,terminalId:t==null?void 0:t.terminalId,amount:parseFloat(((m=r==null?void 0:r.amount)==null?void 0:m.toString())===""?"0":(d=r==null?void 0:r.amount)==null?void 0:d.toString().replace(/,/g,"")).toString(),description:r==null?void 0:r.concept,clientName:r==null?void 0:r.name,phone:`+52 ${r==null?void 0:r.phone}`,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expMonth:((p=ee((r==null?void 0:r.month)+1))==null?void 0:p.toString())||"",expYear:((u=(l=r==null?void 0:r.year)==null?void 0:l.toString())==null?void 0:u.slice(-2))||"",security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return $(n)},oe=(t={})=>{const r=z(),n=F(Q,t);return{...n,mutate:async(d,p)=>{const{onSuccess:l,onError:u,mutationOptions:a}=p;try{await b.promise(n.mutateAsync(d,a),{pending:"Realizando Pago ...",success:{render({data:o}){return l(o),r.invalidateQueries([S.MOVEMENTS]),"Se completó la transacción y se envió el comprobante con éxito"}}})}catch(o){const c=w(o,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");u(c),b.error(c,{type:L(o)}),r.invalidateQueries([S.MOVEMENTS])}}}},te=1,se=1e5,N=new Date().getFullYear(),ie=new Date().getMonth(),ae=10,ne=Array.from({length:ae},(t,r)=>N+r),q=({onSuccessTransaction:t})=>{const r=M(o=>o.terminal),{mutate:n}=oe(),m=_().shape({amount:h().required("El monto es requerido"),concept:h().required("El concepto es requerido"),cardNumber:h().transform((o,c)=>c.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:h().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),name:h().required("El nombre es requerido"),email:h().email("Ingresa un correo valido").required("El correo es requerido"),phone:h().test("longitud","El teléfono es muy corto",o=>!(o&&o.replace(/\s/g,"").length<10)).required("El teléfono es requerido")}),d=R({initialValues:{amount:"",cardNumber:"",month:ie,year:N,cvv:"",name:"",email:"",phone:"",concept:""},enableReinitialize:!0,validationSchema:m,onSubmit:(o,{setSubmitting:c,setFieldTouched:C})=>{const V=re(r,o);n(V,{onSuccess:()=>{c(!1),t()},onError:()=>{c(!1),l("cvv","").then(()=>{C("cvv",!1,!1)})}})}}),{isSubmitting:p,setFieldValue:l,values:u}=d,a=p;return e.jsx(W,{formik:d,children:e.jsxs(s,{spacing:2,p:3,children:[e.jsxs(s,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(i,{variant:"subtitle1",children:"Forma de Pago"}),e.jsx(f,{sx:{px:1,backgroundColor:"background.neutral"},children:e.jsx(Y,{sx:{width:30,height:30}})}),e.jsx(f,{sx:{px:1,backgroundColor:"background.neutral"},children:e.jsx(U,{sx:{width:30,height:30}})})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Monto *"}),e.jsx(x,{autoFocus:!0,fullWidth:!0,name:"amount",required:!0,placeholder:"0.00",disabled:a,size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:e.jsx(g,{position:"end",children:"MXN"}),inputComponent:j,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:te,max:se,scale:2,value:u.amount,onAccept:o=>{l("amount",o)}}}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Concepto *"}),e.jsx(x,{size:"small",name:"concept",multiline:!0,disabled:a,rows:2,placeholder:"Pago por .."})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(x,{name:"cardNumber",required:!0,size:"small",placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(K,{})}),inputComponent:j,inputProps:{mask:"0000 0000 0000 0000",value:u.cardNumber,onAccept:o=>{l("cardNumber",o)}}},disabled:a})]}),e.jsxs(s,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",flexWrap:"wrap",children:[e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Mes *"}),e.jsx(I,{size:"small",name:"month",disabled:a,children:B.map((o,c)=>e.jsx(T,{value:c,children:o},c))})]}),e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Año *"}),e.jsx(I,{size:"small",name:"year",disabled:a,children:ne.map(o=>e.jsx(T,{value:o,children:o},o))})]}),e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(x,{name:"cvv",required:!0,placeholder:"123",size:"small",InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(X,{})}),inputComponent:j,inputProps:{mask:"000",onAccept:o=>{l("cvv",o)},value:u.cvv}},disabled:a})]})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(x,{name:"name",required:!0,size:"small",placeholder:"Nombre del Titular de la Tarjeta",disabled:a,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(G,{})})}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(x,{name:"email",required:!0,size:"small",placeholder:"usuario@dominio.com",disabled:a,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(H,{})})}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(i,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono *"}),e.jsx(x,{name:"phone",required:!0,type:"phone",size:"small",placeholder:"55 5555 5555",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(y,{})}),inputComponent:j,inputProps:{mask:"00 0000 0000",value:u.phone,onAccept:o=>{l("phone",o)}}},disabled:a})]}),e.jsxs(i,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(E,{component:P,underline:"always",color:"info.main",to:A.policies,target:"_blank",children:"Términos y condiciones"}),"  &  ",e.jsx(E,{component:P,underline:"always",color:"info.main",to:A.privacy,target:"_blank",children:"Acuerdos de privacidad"}),"."]}),e.jsx(s,{children:e.jsx(D,{loading:p,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Z,{}),children:"Pagar"})})]})})};q.propTypes={onSuccessTransaction:v.func};const le=({open:t,setOpen:r})=>{const n=M(d=>d.terminal),m=()=>{r(!1)};return e.jsx(J,{open:t,handleClose:m,titleElement:e.jsxs(s,{children:[e.jsx(i,{variant:"h6",children:"Terminal Virtual"}),e.jsx(i,{variant:"subtitle2",children:n==null?void 0:n.name})]}),children:e.jsx(O,{children:e.jsx(q,{onSuccessTransaction:m})})})};le.propTypes={open:v.bool,setOpen:v.func};export{le as default};
