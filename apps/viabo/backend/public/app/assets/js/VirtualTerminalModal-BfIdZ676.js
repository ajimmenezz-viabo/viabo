import{c as V,f as F,a9 as b,P as v,i as e,S as s,T as t,U as f,aX as g,aZ as z,a4 as T,bX as w,bp as D,dq as O,du as R,aH as P,a5 as A,a0 as L,dr as B}from"./vendor-CEMfbhOc.js";import{u as _}from"./formik.esm-Dshy1xjd.js";import{c as $,a as h}from"./index.esm-C2GVbld4.js";import{m as W}from"./formatTime-mlJJpQBT.js";import{g as U,a as X,a4 as S,D as Y,S as Q}from"./index-1FUUY6N4.js";import{a as H}from"./crypto--V-xCCVf.js";import{b as K,T as E,u as M}from"./POSTerminals-DUI33OP8.js";import{F as Z,R as x,M as j,c as I}from"./TextMaxLine-BooApTzI.js";import{M as G}from"./MasterCardLogo-Bcn9gvbj.js";import{V as J}from"./VisaLogo-ByWQmEg7.js";import"./index-BdTlPQ76.js";import"./iconBase-D_ql85QS.js";import"./cardTypes-C4UgKCLi.js";import"./AmexLogo-DsyshqEq.js";import"./CarnetLogo-BssSE0Ex.js";import"./csv-BGNpG_Xb.js";import"./formatNumber-Df8NwpjV.js";import"./cardMovementsAdapter-i_XZHzp7.js";import"./MaterialDataTable-_kvAzFsF.js";import"./transition-anLY3gj9.js";import"./SidebarStyles-JhyDWPNq.js";import"./HeaderPage-DF1oZxt5.js";import"./fade-CViozI82.js";import"./matchTypes-BFKCRNnN.js";import"./UploadSingleFile-DBlnS0ZI.js";function y(a){return/^([1-9])$/.test(a)?"0"+a:a}const ee=(a,r)=>{var p,d,m,l,u;const n={commerceId:a==null?void 0:a.commerceId,terminalId:a==null?void 0:a.terminalId,amount:parseFloat(((p=r==null?void 0:r.amount)==null?void 0:p.toString())===""?"0":(d=r==null?void 0:r.amount)==null?void 0:d.toString().replace(/,/g,"")).toString(),description:r==null?void 0:r.concept,clientName:r==null?void 0:r.name,phone:`+52 ${r==null?void 0:r.phone}`,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expMonth:((m=y((r==null?void 0:r.month)+1))==null?void 0:m.toString())||"",expYear:((u=(l=r==null?void 0:r.year)==null?void 0:l.toString())==null?void 0:u.slice(-2))||"",security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return H(n)},re=(a={})=>{const r=V(),n=F(K,a);return{...n,mutate:async(d,m)=>{const{onSuccess:l,onError:u,mutationOptions:i}=m;try{await b.promise(n.mutateAsync(d,i),{pending:"Realizando Pago ...",success:{render({data:o}){return l(o),r.invalidateQueries([E.MOVEMENTS]),"Se completó la transacción y se envió el comprobante con éxito"}}})}catch(o){const c=U(o,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");u(c),b.error(c,{type:X(o)}),r.invalidateQueries([E.MOVEMENTS])}}}},oe=1,ae=1e5,q=new Date().getFullYear(),se=new Date().getMonth(),te=10,ie=Array.from({length:te},(a,r)=>q+r),N=({onSuccessTransaction:a})=>{const r=M(o=>o.terminal),{mutate:n}=re(),p=$().shape({amount:h().required("El monto es requerido"),concept:h().required("El concepto es requerido"),cardNumber:h().transform((o,c)=>c.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:h().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),name:h().required("El nombre es requerido"),email:h().email("Ingresa un correo valido").required("El correo es requerido"),phone:h().test("longitud","El teléfono es muy corto",o=>!(o&&o.replace(/\s/g,"").length<10)).required("El teléfono es requerido")}),d=_({initialValues:{amount:"",cardNumber:"",month:se,year:q,cvv:"",name:"",email:"",phone:"",concept:""},enableReinitialize:!0,validationSchema:p,onSubmit:(o,{setSubmitting:c,setFieldTouched:C})=>{const k=ee(r,o);n(k,{onSuccess:()=>{c(!1),a()},onError:()=>{c(!1),l("cvv","").then(()=>{C("cvv",!1,!1)})}})}}),{isSubmitting:m,setFieldValue:l,values:u}=d,i=m;return e.jsx(Z,{formik:d,children:e.jsxs(s,{spacing:2,p:3,children:[e.jsxs(s,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(t,{variant:"subtitle1",children:"Forma de Pago"}),e.jsx(f,{sx:{px:1,backgroundColor:"background.neutral"},children:e.jsx(G,{sx:{width:30,height:30}})}),e.jsx(f,{sx:{px:1,backgroundColor:"background.neutral"},children:e.jsx(J,{sx:{width:30,height:30}})})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Monto *"}),e.jsx(x,{autoFocus:!0,fullWidth:!0,name:"amount",required:!0,placeholder:"0.00",disabled:i,size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:e.jsx(g,{position:"end",children:"MXN"}),inputComponent:j,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:oe,max:ae,scale:2,value:u.amount,onAccept:o=>{l("amount",o)}}}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Concepto *"}),e.jsx(x,{size:"small",name:"concept",multiline:!0,disabled:i,rows:2,placeholder:"Pago por .."})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(x,{name:"cardNumber",required:!0,size:"small",placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(z,{})}),inputComponent:j,inputProps:{mask:"0000 0000 0000 0000",value:u.cardNumber,onAccept:o=>{l("cardNumber",o)}}},disabled:i})]}),e.jsxs(s,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",flexWrap:"wrap",children:[e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Mes *"}),e.jsx(I,{size:"small",name:"month",disabled:i,children:W.map((o,c)=>e.jsx(T,{value:c,children:o},c))})]}),e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Año *"}),e.jsx(I,{size:"small",name:"year",disabled:i,children:ie.map(o=>e.jsx(T,{value:o,children:o},o))})]}),e.jsxs(s,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(x,{name:"cvv",required:!0,placeholder:"123",size:"small",InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(w,{})}),inputComponent:j,inputProps:{mask:"000",onAccept:o=>{l("cvv",o)},value:u.cvv}},disabled:i})]})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(x,{name:"name",required:!0,size:"small",placeholder:"Nombre del Titular de la Tarjeta",disabled:i,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(D,{})})}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(x,{name:"email",required:!0,size:"small",placeholder:"usuario@dominio.com",disabled:i,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(O,{})})}})]}),e.jsxs(s,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono *"}),e.jsx(x,{name:"phone",required:!0,type:"phone",size:"small",placeholder:"55 5555 5555",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(R,{})}),inputComponent:j,inputProps:{mask:"00 0000 0000",value:u.phone,onAccept:o=>{l("phone",o)}}},disabled:i})]}),e.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(P,{component:A,underline:"always",color:"info.main",to:S.policies,target:"_blank",children:"Términos y condiciones"}),"  &  ",e.jsx(P,{component:A,underline:"always",color:"info.main",to:S.privacy,target:"_blank",children:"Acuerdos de privacidad"}),"."]}),e.jsx(s,{children:e.jsx(L,{loading:m,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(B,{}),children:"Pagar"})})]})})};N.propTypes={onSuccessTransaction:v.func};const ne=({open:a,setOpen:r})=>{const n=M(d=>d.terminal),p=()=>{r(!1)};return e.jsx(Y,{open:a,handleClose:p,titleElement:e.jsxs(s,{children:[e.jsx(t,{variant:"h6",children:"Terminal Virtual"}),e.jsx(t,{variant:"subtitle2",children:n==null?void 0:n.name})]}),children:e.jsx(Q,{children:e.jsx(N,{onSuccessTransaction:p})})})};ne.propTypes={open:v.bool,setOpen:v.func};export{ne as default};
//# sourceMappingURL=VirtualTerminalModal-BfIdZ676.js.map
