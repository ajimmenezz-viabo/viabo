import{r as E,i as O,aq as X,aI as Y,j as e,ao as L,aJ as J,aK as ee,aL as D,q as te,a as N,b as ne,g as P,a8 as se,m as oe,a9 as b,n as re,a3 as ie,S as p,T as g,c as ae,V as le,X as M,a0 as ce,L as de,B as me,ak as pe,e as ue,a5 as xe,aG as he,aH as ge}from"./build-25e7e2eb.js";import{C as fe}from"./build-5eb37bad.js";import{H as Ce}from"./build-fd05424b.js";import{C as je,b as ve,R as Ee,D as ye,a as be,M as Ae}from"./build-b4439384.js";import{c as Se,d as Te}from"./build-42302140.js";import{C as B}from"./build-3a191c20.js";import{b as we,c as Ie,C as Re,A as Le,F as Ve,a as De}from"./build-71a50a13.js";import{C as _e}from"./build-deb91634.js";import{u as ke}from"./build-0c7fe524.js";import{F as Oe,M as Ne}from"./build-9151ecd6.js";import{c as Pe,a as w}from"./build-aef65eb7.js";import{s as Me}from"./build-9563ddbe.js";import{C as Be}from"./build-caa4c160.js";import{C as Fe}from"./build-f777b884.js";import{R as V}from"./build-84820902.js";import{M as Ue}from"./build-a1aa6e7e.js";import{g as qe,C as We}from"./build-b0cf8558.js";import{C as He}from"./build-c7ce8ef2.js";import{I as _}from"./build-ea1777fe.js";import{E as Ge}from"./build-203a8839.js";import{V as $e,A as ze}from"./build-6daf67c8.js";import{C as Qe}from"./build-4bcaabc0.js";import{T as Ke,a as k}from"./build-f81efbfe.js";import"./build-43a055c7.js";import"./build-ecaf0d13.js";import"./build-e8a6b0bf.js";import"./build-bee6630b.js";import"./build-3f6bbffc.js";import"./build-cdcb9c1c.js";import"./build-9dff9011.js";import"./build-3cc84a75.js";import"./build-396b2db3.js";const Ze=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Xe={entering:{transform:"none"},entered:{transform:"none"}},Ye=E.forwardRef(function(n,a){const l=O(),s={enter:l.transitions.duration.enteringScreen,exit:l.transitions.duration.leavingScreen},{addEndListener:i,appear:m=!0,children:d,easing:c,in:o,onEnter:h,onEntered:r,onEntering:C,onExit:v,onExited:f,onExiting:S,style:I,timeout:R=s,TransitionComponent:U=J}=n,q=X(n,Ze),T=E.useRef(null),W=Y(T,d.ref,a),y=u=>j=>{if(u){const A=T.current;j===void 0?u(A):u(A,j)}},H=y(C),G=y((u,j)=>{ee(u);const A=D({style:I,timeout:R,easing:c},{mode:"enter"});u.style.webkitTransition=l.transitions.create("transform",A),u.style.transition=l.transitions.create("transform",A),h&&h(u,j)}),$=y(r),z=y(S),Q=y(u=>{const j=D({style:I,timeout:R,easing:c},{mode:"exit"});u.style.webkitTransition=l.transitions.create("transform",j),u.style.transition=l.transitions.create("transform",j),v&&v(u)}),K=y(f),Z=u=>{i&&i(T.current,u)};return e.jsx(U,L({appear:m,in:o,nodeRef:T,onEnter:G,onEntered:$,onEntering:H,onExit:Q,onExited:K,onExiting:z,addEndListener:Z,timeout:R},q,{children:(u,j)=>E.cloneElement(d,L({style:L({transform:"scale(0)",visibility:u==="exited"&&!o?"hidden":void 0},Xe[u],I,d.props.style),ref:W},j))}))}),Je=Ye,et=te(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),F={LIST:"unassignedCardsCommerce"},tt=(t,n,a)=>{var d;const{phone:l,email:s,name:i}=t,m={name:i,phone:l,email:s,cards:a?[{id:(d=n[0])==null?void 0:d.id,cvv:t==null?void 0:t.cvv}]:(n==null?void 0:n.map(c=>({id:c==null?void 0:c.id,cvv:c==null?void 0:c.cvv})))||[]};return qe(m)},nt=async()=>{const{data:t}=await N.get("/api/disabled-cards/commerce");return je(t)},st=async t=>(await N.put("/api/assign/commerce-card/to/user",t),t),ot=(t={})=>{const[n,a]=E.useState(null);return{...ne([F.LIST],nt,{staleTime:6e4,onError:s=>{const i=P(s,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");a(i)},...t}),error:n||null}},rt=(t={})=>{const n=se(),a=oe(st,t);return{...a,mutate:async(s,i)=>{const{onSuccess:m,onError:d,mutationOptions:c}=i;try{await b.promise(a.mutateAsync(s,c),{pending:"Asignando Tarjetas ...",success:{render({data:o}){return n.invalidateQueries([F.LIST]),n.invalidateQueries([He.CARDS_COMMERCE_LIST]),m(),"Se asignaron las tarjetas con éxito"}}})}catch(o){const h=P(o,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(h),b.error(h,{type:re(o)})}}}},it=(t,n)=>({cards:[],rows:[],openAssign:!1,setSelectedCard:a=>{const{cards:l}=n(),s=l.indexOf(a);let i=[];s===-1?i=i.concat(l,a):s===0?i=i.concat(l.slice(1)):s===l.length-1?i=i.concat(l.slice(0,-1)):s>0&&(i=i.concat(l.slice(0,s),l.slice(s+1))),t(m=>({cards:i}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{t(l=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{t(l=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{t(l=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),x=Se(Te(it));function at({cards:t}){const n=x(o=>o.cards),a=x(o=>o.setAllCards),l=x(o=>o.resetCards),s=x(o=>o.setOpenAssign),i=(n==null?void 0:n.length)||0,m=(t==null?void 0:t.length)||0,d=o=>{if(o){a(t);return}l()},c=()=>{const o=n.some(r=>(r==null?void 0:r.cvv)==="")&&(n==null?void 0:n.length)>1;n.every(r=>(r==null?void 0:r.cvv)==="")&&(n==null?void 0:n.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):o?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):s(!0)};return e.jsx(e.Fragment,{children:e.jsx(ie,{sx:o=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:o.customShadows.z8,backgroundColor:o.palette.info.lighter,color:"white"}),children:e.jsxs(p,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(p,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(B,{indeterminate:i>0&&i<m,checked:m>0&&i===m,onChange:o=>d(o.target.checked),color:"success"}),e.jsx(g,{color:"success.main",variant:"subtitle1",children:i===1?`${i} Tarjeta`:`${i} Tarjetas`})]}),e.jsx(p,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(ae,{startIcon:e.jsx(we,{}),variant:"outlined",color:"info",onClick:c,children:"Asignar"})})]})})})}function lt({card:t}){const n=x(i=>i.setSelectedCard),a=x(i=>i.cards),l=a==null?void 0:a.some(i=>(i==null?void 0:i.id)===(t==null?void 0:t.id)),s=i=>{i.stopPropagation(),n(t)};return e.jsx(le.div,{onClick:s,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(ve,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(p,{flexDirection:"row",gap:1,children:[e.jsx(B,{onClick:s,edge:"start",checked:l,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(p,{children:[e.jsx(g,{variant:"subtitle2",sx:{opacity:.72},children:"Viabo Card"}),e.jsx(g,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(_e,{card:t,disableShow:!0}),e.jsxs(p,{direction:"row",spacing:5,children:[e.jsxs(p,{children:[e.jsx(g,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(g,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(Ie,{card:t,disableShow:!0})]})]})})}function ct({cards:t,onSuccess:n}){const{mutate:a,isLoading:l}=rt(),s=E.useMemo(()=>(t==null?void 0:t.length)>0&&t[0].cvv==="",[t]),i=Pe({name:w().required("El nombre es requerido"),email:w().email("Ingresa un correo valido").required("El correo es requerido"),phone:w().test("longitud","El telefono es muy corto",f=>!(f&&f.replace(/[\s+]/g,"").length<10)),...s&&{cvv:w().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),m=ke({initialValues:{name:"",phone:"",email:"",...s&&{cvv:""}},validationSchema:i,onSubmit:f=>{const S=tt(f,t,s);a(S,{onSuccess:()=>{C(!1),n()},onError:()=>{C(!1)}})}}),{errors:d,touched:c,isSubmitting:o,setFieldValue:h,values:r,setSubmitting:C}=m,v=o||l;return e.jsx(M,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Oe,{formik:m,children:e.jsxs(p,{spacing:3,sx:{p:3},children:[s&&e.jsx(ce,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(g,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(p,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(V,{name:"name",required:!0,placeholder:"Usuario",disabled:v})]}),e.jsxs(p,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(V,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:v,InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx(Ge,{})})}})]}),e.jsxs(p,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Ue,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:r.phone||"+52",disabled:v,onChange:(f,S)=>{h("phone",f)},error:c.phone&&!!d.phone,helperText:c.phone&&d.phone})]}),s&&e.jsxs(p,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(V,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx($e,{})}),inputComponent:Ne,inputProps:{mask:"000",onAccept:f=>{h("cvv",f)},value:r.cvv}},disabled:v})]}),e.jsx(p,{sx:{pt:3},children:e.jsx(de,{loading:o,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(ze,{}),children:"Asociar"})})]})})})}function dt({open:t,handleClose:n,handleSuccess:a}){const l=x(s=>s.cards);return e.jsxs(Ee,{open:t,handleClose:n,title:(l==null?void 0:l.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(p,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:l==null?void 0:l.map(s=>e.jsx(We,{icon:e.jsx(Qe,{}),label:s==null?void 0:s.cardNumberHidden},s==null?void 0:s.id))}),e.jsx(ct,{cards:l,onSuccess:a})]})}function mt({unassignedCards:t}){const n=t==null?void 0:t.data,a=x(d=>d.cards),l=x(d=>d.setIndexCards,Me),s=O(),i=E.useMemo(()=>(a==null?void 0:a.map(d=>n.findIndex(c=>c.id===d.id)))||[],[a,n]);E.useEffect(()=>{l(i)},[i]);const m={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen};return e.jsx(p,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(p,{sx:d=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(Je,{in:(a==null?void 0:a.length)>0,timeout:m,style:{transitionDelay:`${(a==null?void 0:a.length)>0?m.exit:0}ms`},unmountOnExit:!0,children:e.jsx(me,{children:e.jsx(at,{cards:t==null?void 0:t.data})})}),e.jsx(M,{children:e.jsx(Re,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:lt,my:3})})]})})}function pt({isLoading:t,cards:n=[],rows:a=[]}){const l=x(o=>o.setAllCards),s=x(o=>o.cards),i=x(o=>o.setOpenAssign),m=x(o=>o.setIndexCards),d=()=>{const o=s.some(r=>(r==null?void 0:r.cvv)==="")&&(s==null?void 0:s.length)>1;s.every(r=>(r==null?void 0:r.cvv)==="")&&(s==null?void 0:s.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):o?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):i(!0)};console.log(n);const c=[{name:"cardNumberMoreDigits",label:"Tarjeta",options:{customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsx(g,{variant:"subtitle2",fontWeight:"bold",children:r==null?void 0:r.cardNumberMoreDigits})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsxs(p,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(pe,{sx:C=>({width:45,height:45,color:C.palette.primary.contrastText,backgroundColor:C.palette.primary.light}),children:(r==null?void 0:r.cardType)==="Carnet"?e.jsx(be,{sx:{width:30},color:"white"}):e.jsx(Ae,{sx:{width:30}})}),e.jsx(g,{variant:"subtitle2",children:r==null?void 0:r.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"emptyCVV",label:"CVV",options:{filterType:"checkbox",customBodyRenderLite:(o,h)=>{const r=n[o];return(r==null?void 0:r.cvv)===""||!(r!=null&&r.cvv)?e.jsx(Fe,{color:"error"}):e.jsx(et,{color:"success"})}}},{name:"register",label:"Fecha de Registro",options:{filterType:"textField",customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsxs(p,{children:[e.jsx(g,{variant:"subtitle2",children:r==null?void 0:r.registerDate}),e.jsx(g,{variant:"body2",sx:{color:"text.secondary"},children:r==null?void 0:r.registerTime})]})}}}];return e.jsx(Be,{children:e.jsx(ye,{isLoading:t,data:n||[],columns:c,options:{responsive:"simple",rowsSelected:a,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(o,h,r)=>{const C=n==null?void 0:n.filter((v,f)=>r.includes(f));l(C),m(r)},customToolbarSelect:o=>e.jsx(Le,{handleAssign:d})}})})}function Gt(){const t=ot(),[n,a]=E.useState("1"),l=(c,o)=>{a(o)},s=x(c=>c.rows),i=x(c=>c.openAssign),m=x(c=>c.setOpenAssign),d=x(c=>c.resetCards);return e.jsx(e.Fragment,{children:e.jsx(ue,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(fe,{sx:{height:"100%"},children:[e.jsx(Ce,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:xe.root},{name:"Administracion",href:he.cards},{name:ge.unassignedCards.name}],buttons:e.jsxs(Ke,{size:"small",color:"primary",value:n,exclusive:!0,onChange:l,"aria-label":"Platform",children:[e.jsx(k,{value:"1",children:e.jsx(Ve,{})}),e.jsx(k,{value:"2",children:e.jsx(De,{})})]})}),n==="2"&&e.jsx(mt,{unassignedCards:t}),n==="1"&&e.jsx(pt,{cards:t.data,isLoading:t.isLoading,rows:s}),e.jsx(dt,{open:i,handleClose:()=>{m(!1)},handleSuccess:()=>{m(!1),d()}})]})})})}export{Gt as default};
