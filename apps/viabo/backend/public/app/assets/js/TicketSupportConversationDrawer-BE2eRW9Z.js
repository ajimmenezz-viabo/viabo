import{g,b as C,L as j,_ as k,S as I,E as L}from"./index-B__7hL3x.js";import{r as d,dX as P,U as T,c as F,f as N,i as o,S as m,T as R,Q as w,dY as A}from"./vendor-5lkxkETF.js";import"./TextMaxLine-C9qIEh1p.js";import{T as f}from"./tickets-support-list-keys-S53qn0fN.js";import{u as y,g as D,f as O}from"./SupportIncidences-B1dCNpHR.js";import{i as S}from"./matchTypes-mENztEWg.js";import{R as b}from"./RightPanel-BFDo2QbY.js";import"./formik.esm-CTTSENmf.js";import"./formatTime-jCgU2sMR.js";import"./UploadSingleFile-DTaIprdd.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./formatNumber-dGNhWwxT.js";import"./MaterialDataTable-D_xqlUa9.js";import"./useMaterialTable-8QQmzXWd.js";import"./HeaderPage-c7qqGcUI.js";const M=(s,i={})=>{const[e,l]=d.useState(null),a=y(r=>r.setCanCloseTicket),t=P({queryKey:[f.TICKET_CONVERSATION,s],queryFn:async({pageParam:r=1})=>{const n=await D(s,r);return a(!!(n!=null&&n.canCloseTicket)),n},getNextPageParam:r=>r.next,refetchOnMount:"always",staleTime:60*5e3,...i});return d.useEffect(()=>{if(t!=null&&t.isError){const r=g(t.error,"No se puede obtener la conversación del ticket. Intente nuevamente o reporte a sistemas");l(r),T.error(r,{type:C(t.error)}),a(!1)}},[t.isError,t.error]),{...t,error:e||null}},Q=(s={})=>{const i=F(),e=N({mutationFn:O,...s});return{...e,mutate:async(a,t)=>{const{onSuccess:r,onError:n,...p}=t;try{await T.promise(e.mutateAsync(a,p),{pending:"Finalizando Ticket...",success:{render({data:c}){return i.invalidateQueries([f.ASSIGNED_LIST]),i.invalidateQueries([f.GENERATED_LIST]),S(r)&&r(c),"Se finalizo el ticket con éxito"}}})}catch(c){const u=g(c,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");S(n)&&n(u),T.error(u,{type:C(c)})}}}},z=j(d.lazy(()=>k(()=>import("./TicketConversationLayout-zyN40Okd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17])))),se=()=>{var E;const{openTicketConversation:s,setOpenTicketConversation:i,ticket:e,setSupportTicketDetails:l,canCloseTicket:a}=y(),t=M(e==null?void 0:e.id,{enabled:!!(e!=null&&e.id)}),{mutate:r,isLoading:n}=Q(),{isLoading:p,error:c,isError:u,refetch:h,data:v,fetchNextPage:B}=t;d.useEffect(()=>{s&&(e!=null&&e.id)&&h()},[s,e==null?void 0:e.id]);const x=()=>{i(!1),l(null)},_=()=>{r({ticketId:e==null?void 0:e.id},{onSuccess:()=>{x()}})};return o.jsxs(b,{open:s,handleClose:x,titleElement:o.jsxs(m,{justifyContent:"space-between",flex:1,flexDirection:"column",gap:1,children:[o.jsx(m,{children:o.jsx(R,{variant:"h6",children:`Ticket #${e==null?void 0:e.id}`})}),e&&v&&a&&((E=e==null?void 0:e.status)==null?void 0:E.id)!=="3"&&o.jsx(m,{maxWidth:"30%",children:o.jsx(w,{endIcon:o.jsx(A,{}),variant:"contained",onClick:_,loading:p||n,color:"success",children:"Concluir"})})]}),width:{sm:"100%",lg:"50%",xl:"40%"},children:[u&&!p&&o.jsx(I,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:o.jsx(m,{spacing:3,p:3,children:o.jsx(L,{errorMessage:c,titleMessage:"Conversación del Ticket",handleButton:()=>h()})})}),!u&&s&&o.jsx(z,{queryTicketConversation:t,ticket:e})]})};export{se as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/TicketConversationLayout-zyN40Okd.js","assets/js/index-B__7hL3x.js","assets/js/vendor-5lkxkETF.js","assets/css/build-Bl0dWaDY.css","assets/js/formik.esm-CTTSENmf.js","assets/js/index.esm-gIIytEq8.js","assets/js/matchTypes-mENztEWg.js","assets/js/tickets-support-list-keys-S53qn0fN.js","assets/js/SupportIncidences-B1dCNpHR.js","assets/js/TextMaxLine-C9qIEh1p.js","assets/js/formatTime-jCgU2sMR.js","assets/js/UploadSingleFile-DTaIprdd.js","assets/js/fade-CViozI82.js","assets/js/transition-anLY3gj9.js","assets/js/formatNumber-dGNhWwxT.js","assets/js/MaterialDataTable-D_xqlUa9.js","assets/js/useMaterialTable-8QQmzXWd.js","assets/js/HeaderPage-c7qqGcUI.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=TicketSupportConversationDrawer-BE2eRW9Z.js.map
