import{s as M,T as b,r as m,an as F,ah as k,j as a,ae as O,ao as P,ap as q,p as u,G as N,aJ as B,c as p,d as K,L as w,u as Q,k as $,o as G,g as H,t as U,aO as E,S as T,$ as W}from"./index-d15e21ee.js";import{u as Y}from"./formik.esm-b477a432.js";import{c as v,e as J}from"./index.esm-4f526a47.js";import{R as V}from"./RFTextField-9694297f.js";import{D as z,g as X,a as Z,b as ee,c as te,M as C,d as re,u as A,R as j,C as oe}from"./StockCards-8eec9b55.js";import{F as se}from"./FormProvider-9065639e.js";import"./TextField-2a380314.js";import"./EmptyList-35e81976.js";import"./transition-bee6630b.js";import"./HeaderPage-0d86c0b4.js";import"./Container-6e256a94.js";import"./middleware-e2e52734.js";import"./formatNumber-7b2149a6.js";import"./VisibilityOff-7787c389.js";import"./Card-c80050a1.js";import"./InputAdornment-2dc08fa5.js";import"./matchTypes-ecaf0d13.js";import"./Grid-56ba1e63.js";const ae=["className","id"],ie=e=>{const{classes:r}=e;return q({root:["root"]},X,r)},ne=M(b,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,r)=>r.root})({padding:"16px 24px",flex:"0 0 auto"}),le=m.forwardRef(function(r,t){const s=F({props:r,name:"MuiDialogTitle"}),{className:n,id:i}=s,l=k(s,ae),c=s,h=ie(c),{titleId:g=i}=m.useContext(z);return a(ne,O({component:"h2",className:P(h.root,n),ownerState:c,ref:t,variant:"h6",id:i??g},l))}),ce=le;R.propTypes={onClose:u.func,onSuccess:u.func,children:u.node,open:u.bool,isSubmitting:u.bool,scrollType:u.string,title:u.string,textButtonSuccess:u.string,disableLoadingIndicator:u.bool};function R(e){const{title:r,textButtonSuccess:t,isSubmitting:s,open:n,scrollType:i="paper",onClose:l,onSuccess:c,disableLoadingIndicator:h=!1,children:g,...f}=e,x=N();B(x.breakpoints.between("xs","sm"));const y=m.useRef(null);return m.useEffect(()=>{if(n){const{current:d}=y;d!==null&&d.focus()}},[n]),p(Z,{open:n,onClose:(d,o)=>{o&&o==="backdropClick"||o&&o==="escapeKeyDown"||l()},scroll:i,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",...f,children:[a(ce,{sx:{mb:i==="paper"?3:0},id:"scroll-dialog-title",children:r}),a(ee,{id:"croll-dialog-description",dividers:i==="paper",children:g}),p(te,{children:[!s&&a(K,{variant:"outlined",color:"inherit",onClick:l,children:"Cerrar"}),a(w,{onClick:c,loading:s,color:"primary",variant:"contained",children:t})]})]})}const ue=(e={})=>{const{enqueueSnackbar:r}=Q(),[t,s]=m.useState(null),n=$();return{...G(re,{onSuccess:()=>{s(null),n.invalidateQueries([C.STOCK_CARDS_LIST]),r("Se asignaron las tarjetas al comercio",{variant:"success",autoHideDuration:5e3})},onError:l=>{n.invalidateQueries([C.STOCK_CARDS_LIST]);const c=H(l,"No se puede asignar las tarjetas al comercio");r(c,{variant:U(l),autoHideDuration:5e3}),s(c)},...e}),error:t||null}},de=e=>{var t,s;const r=((t=e==null?void 0:e.commerce)==null?void 0:t.value)||"";return e!=null&&e.cardId?{cardId:e==null?void 0:e.cardId,commerceId:r}:{amount:e==null?void 0:e.numberOfCards.toString(),paymentProcessorId:((s=e==null?void 0:e.cardType)==null?void 0:s.value)||"",commerceId:r}};function Le(){const e=A(o=>o.setOpen),r=A(o=>o.setCard),t=A(o=>o.card),s=E([C.AFFILIATED_COMMERCES_LIST])||[],n=E([C.STOCK_CARDS_LIST])||[],i=E([C.CARD_TYPES_LIST])||[],{mutate:l,isLoading:c}=ue(),h=m.useMemo(()=>{const o={commerce:v().nullable().required("El comercio es requerido")};return t?{...o}:{...o,cardType:v().nullable().required("El tipo de tarjeta es requerido"),numberOfCards:J().min(1,"Al menos debe existir una tarjeta").test("maxCards","El maximo de tarjetas",function(S){const{cardType:D}=this.parent,I=n.filter(L=>L.cardTypeId===D.id).length;return S>I?this.createError({message:`No se pueden agregar más tarjetas que las disponibles (${I} tarjetas)`}):!0}).required("El número de tarjetas es requerido")}},[t,n]),g=m.useMemo(()=>t?{cardId:t==null?void 0:t.id,commerce:null}:{numberOfCards:1,cardType:i&&i.length>0&&i[0]||null,commerce:null},[t]),f=Y({initialValues:g,validationSchema:v().shape(h),onSubmit:(o,{setSubmitting:S})=>{const D=de(o);l(D,{onSuccess:()=>{e(!1),r(null),S(!1)},onError:()=>{S(!1)}})}}),{isSubmitting:x,handleSubmit:y,resetForm:_}=f,d=x||c;return a(R,{onClose:()=>{e(!1),r(null)},onSuccess:y,isSubmitting:d,fullWidth:!0,scrollType:"body",title:t?"Asignar Tarjeta":"Asignar Tarjetas",textButtonSuccess:"Guardar",open:!0,children:a(se,{formik:f,children:p(T,{spacing:3,sx:{py:3},children:[t?a(oe,{card:t}):p(W,{children:[p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta:"}),a(j,{name:"cardType",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:i,disabled:d})]}),p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de tarjetas:"}),a(V,{name:"numberOfCards",placeholder:"1",type:"number",InputLabelProps:{shrink:!0},inputProps:{inputMode:"numeric",min:"1"},disabled:d})]})]}),p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comercio:"}),a(j,{name:"commerce",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:s,disabled:d})]})]})})})}export{Le as default};
