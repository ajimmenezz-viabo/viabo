import{k as O,a as B,Q as y,g as M,b as j,r as N,d as R,j as t,B as k,S as c,$ as A,T as S}from"./index-f4730562.js";import{c as P,F as w,g as v,u as h}from"./build-75f61f82.js";import{g as z}from"./build-c0513ca7.js";import{S as I,M as D}from"./build-a28a65d2.js";import{a as L}from"./build-ddaa79ac.js";import{u as G}from"./build-42fbf954.js";import{C as K}from"./build-f505b767.js";import"./build-9de4b8aa.js";import"./build-cc5a0f7f.js";import"./build-4c9e4bdc.js";import"./build-d6e8e8a6.js";import"./build-ab61dd8b.js";import"./build-3a978d3e.js";import"./build-f3326ad8.js";import"./build-b8356536.js";import"./build-a6ffd79e.js";import"./build-1c8d8107.js";import"./build-2b64884d.js";import"./build-4c648b6f.js";import"./build-25380d02.js";import"./build-bee6630b.js";import"./build-1099c20e.js";import"./build-1d4535c6.js";import"./build-3fecaa82.js";import"./build-7a20d980.js";import"./build-aef0dee4.js";import"./build-c573209c.js";import"./build-b04fd233.js";import"./build-835e1d30.js";import"./build-0fd5ede1.js";import"./build-d07194a5.js";import"./build-c035a370.js";import"./build-dc931114.js";const Q=(r,n)=>({fundingOrderId:r==null?void 0:r.id,conciliationNumber:n==null?void 0:n.id}),V=(r={})=>{const n=O(),o=B(P,r);return{...o,mutate:async(m,i)=>{const{onSuccess:s,onError:l,mutationOptions:u}=i;try{await y.promise(o.mutateAsync(m,u),{pending:"Conciliando orden de fondeo ...",success:{render({data:a}){return n.invalidateQueries([w.LIST]),s(a),"Se creó la conciliación con éxito"}}})}catch(a){const p=M(a,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");l(p),y.error(p,{type:j(a)})}}}},W=(r,n={})=>{const[o,d]=N.useState(null);return{...R([w.MOVEMENTS,r==null?void 0:r.id],()=>v(r),{staleTime:6e4,refetchOnWindowFocus:!1,onError:i=>{const s=M(i,"No se puede obtener los movimientos de la cuenta");d(s),y.error(s,{type:j(i)})},...n}),error:o||null}},we=()=>{var f;const r=h(e=>e.openConciliateModal),n=h(e=>e.setOpenConciliateModal),o=h(e=>e.fundingOrder),d=h(e=>e.setFundingOrder),{mutate:m,isLoading:i}=V(),s=[{accessorKey:"description",header:"Movimiento",size:100},{accessorKey:"date",header:"Fecha",size:100},{accessorKey:"amountFormat",header:"Monto",size:100}],{data:l,isError:u,error:a,isLoading:p,isFetching:T}=W(o,{enabled:!!o}),g=z(o==null?void 0:o.paymentProcessorName),F=g==null?void 0:g.component,b=G(u,a,{columns:s,data:(l==null?void 0:l.movements)||[],enableColumnPinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,enableColumnResizing:!1,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:p,showAlertBanner:u,showProgressBars:T},muiTablePaperProps:{elevation:0,sx:e=>({borderRadius:0,backgroundColor:e.palette.background.neutral})},muiBottomToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},muiTopToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{maxSize:10,header:""}},renderToolbarInternalActions:({table:e})=>t.jsx(k,{children:t.jsx(I,{table:e})}),muiTableContainerProps:{sx:{maxHeight:"md"}}}),x=((f=b==null?void 0:b.getSelectedRowModel().flatRows)==null?void 0:f.map(e=>e.original))??[],E=()=>{if((x==null?void 0:x.length)>0){const e=Q(o,x[0]);m(e,{onSuccess:()=>{C()},onError:()=>{}})}else y.warn("Debe seleccionar un movimiento para conciliar la orden de fondeo")},C=()=>{n(!1),d(null)};return t.jsx(L,{onClose:C,onSuccess:E,isSubmitting:i,fullWidth:!0,scrollType:"body",title:"Conciliar",textButtonSuccess:"Conciliar",open:r,children:t.jsxs(c,{spacing:3,sx:{py:3},children:[t.jsx(A,{severity:"info",sx:{display:"flex",flexGrow:1,"& .MuiAlert-message":{display:"flex",flexGrow:1}},children:t.jsxs(c,{flexGrow:1,spacing:2,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t.jsxs(c,{children:[t.jsxs(S,{variant:"subtitle2",children:["Orden #",o==null?void 0:o.referenceNumber]}),t.jsx(S,{variant:"subtitle2",fontWeight:"bold",children:o==null?void 0:o.amount})]}),t.jsx(c,{children:g&&t.jsx(F,{sx:{width:30,height:30}})})]})}),t.jsx(c,{children:t.jsx(K,{children:t.jsx(D,{table:b})})})]})})};export{we as default};
