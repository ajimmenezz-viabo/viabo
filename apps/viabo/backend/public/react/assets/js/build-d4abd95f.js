import{z as S,j as e,J as R,ag as E,a as z,k as W,Q as w,g as q,b as B,r as O,cO as _,d as H,N as l,aT as Q,aU as $,S as a,T as t,aC as C,i as I,cP as N,L as U,B as j,E as Y,cQ as X,P as G,W as K}from"./index-3809032b.js";import{u as J}from"./build-ee266471.js";import{a as Z}from"./build-6c138e5d.js";import{c as y,a as g}from"./build-35d26722.js";import{g as L,a as D,D as k}from"./build-7637d2c3.js";import{f as ee}from"./build-566d20b3.js";import{F as re,M as A,L as oe}from"./build-0d95e123.js";import{R as f}from"./build-7041d859.js";import{M as ne}from"./build-f3f9b6e9.js";import{V as ae}from"./build-e6290908.js";import{I as v}from"./build-4d4aa58d.js";import{C as ie}from"./build-5f6917c9.js";import{V as se}from"./build-469cd745.js";import{P as te}from"./build-7f1d570f.js";import{E as ce}from"./build-2268d903.js";import{L as T}from"./build-6fc59234.js";import{L as le}from"./build-d4fb5b72.js";import{V as de}from"./build-899176f2.js";import{R as ue}from"./build-30757a5f.js";import"./build-4389c83a.js";import"./build-53b11780.js";import"./build-f831d8b4.js";import"./build-46916aa3.js";import"./build-1f7146f4.js";import"./build-bee6630b.js";const me=S(e.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),xe=(r,o)=>{const n=r!=null&&r.expiration?R(new Date(r==null?void 0:r.expiration),"MM/yyyy"):null,c=n?n==null?void 0:n.slice(-2):"",s=n?n==null?void 0:n.slice(0,2):"",p=n?(n==null?void 0:n.slice(0,3))+c:"",x={payId:o==null?void 0:o.id,cardHolder:r==null?void 0:r.name,phone:r==null?void 0:r.phone,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expirationDate:p,expMonth:s,expYear:c,security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return L(x)},M={INFO:"payment-link-info"},he=r=>{const o=D(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:ee(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName},reference:o==null?void 0:o.reference,terminalId:o==null?void 0:o.terminalId,transaction:{reference:(o==null?void 0:o.apiReferenceNumber)!==""?o==null?void 0:o.apiReferenceNumber:"-",authCode:(o==null?void 0:o.apiAuthCode)!==""?o==null?void 0:o.apiAuthCode:"-"}};throw new Error("Algo fallo al obtenerla información de la liga de pago")},pe=async r=>{const{data:o}=await E.get(`/api/commerces/pay/${r}`);return he(o)},ge=async r=>{const{data:o}=await E.post("/api/commerce/pay/generate/transaction",r);return o},je=(r,o={})=>{const n=z(ge,o),c=W();return{...n,mutate:async(p,x)=>{const{onSuccess:u,onError:m,mutationOptions:h}=x;try{await w.promise(n.mutateAsync(p,h),{pending:"Realizando cargo ...",success:{render({data:i}){return c.invalidateQueries([M.INFO]),u(i),"Se realizo el pago con éxito"}}})}catch(i){const d=q(i,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");m(d),w.error(d,{type:B(i)})}}}},fe=(r,o={})=>{const[n,c]=O.useState(null),s=_();return{...H([M.INFO,r],()=>pe(r),{staleTime:6e4,onError:x=>{const u=q(x,"No se puede obtener la informacion de la liga de pago");c(u),s("/404")},...o}),error:n||null}},V=({details:r})=>{const{mutate:o}=je(r==null?void 0:r.id),n=y().shape({cardNumber:g().transform((i,d)=>d.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),expiration:g().nullable().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(i){const d=new Date(i);return Q(d)&&$(d,new Date)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El teléfono es muy corto",i=>!(i&&i.replace(/[\s+]/g,"").length<10)).required("El teléfono es requerido")}),c=J({initialValues:{cardNumber:"",expiration:null,cvv:"",name:"",email:(r==null?void 0:r.email)||"",phone:(r==null?void 0:r.phone)||""},enableReinitialize:!0,validationSchema:n,onSubmit:(i,{setSubmitting:d,setFieldTouched:b})=>{const P=xe(i,r);o(P,{onSuccess:()=>{d(!1)},onError:()=>{d(!1),u("cvv","").then(()=>{b("cvv",!1,!1)}),u("expiration",null).then(()=>{b("expiration",!1,!1)})}})}}),{errors:s,touched:p,isSubmitting:x,setFieldValue:u,values:m}=c,h=x;return e.jsx(re,{formik:c,children:e.jsxs(a,{spacing:3,children:[e.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(t,{variant:"h6",children:"Forma de Pago"}),e.jsx(C,{sx:{px:1},children:e.jsx(ne,{sx:{width:30,height:30}})}),e.jsx(C,{sx:{px:1},children:e.jsx(ae,{sx:{width:30,height:30}})})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(f,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ie,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:m.cardNumber,onAccept:i=>{u("cardNumber",i)}}},disabled:h})]}),e.jsxs(a,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),e.jsx(k,{disabled:h,views:["year","month"],name:"expiration",value:m!=null&&m.expiration?new Date(m.expiration):null,required:!0,onChange:i=>{u("expiration",i)},slotProps:{textField:{fullWidth:!0,error:!!s.expiration,required:!0,helperText:s.expiration?s.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(f,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(se,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:i=>{u("cvv",i)},value:m.cvv}},disabled:h})]})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(f,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:h,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(te,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(f,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:h,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ce,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),e.jsx(Z,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:m.phone,disabled:h,required:!0,onChange:(i,d)=>{u("phone",i)},error:p.phone&&!!s.phone,helperText:p.phone&&s.phone})]}),e.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(T,{component:I,underline:"always",color:"info.main",to:N.policies,target:"_blank",children:"Términos y condiciones"}),"  &  ",e.jsx(T,{component:I,underline:"always",color:"info.main",to:N.privacy,target:"_blank",children:"Acuerdos de privacidad"}),"."]}),e.jsx(a,{children:e.jsx(U,{loading:x,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(le,{}),children:"Pagar"})})]})})};V.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const ve=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],be=r=>{var o;return((o=ve.find(n=>(n==null?void 0:n.id)===r))==null?void 0:o.color)??"info"},F=({details:r})=>{var o,n,c,s;return e.jsx(a,{children:e.jsxs(C,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[e.jsx(j,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:e.jsx("img",{src:de,alt:"viabo-logo"})}),e.jsxs(a,{alignItems:"center",justifyContent:"center",spacing:2,children:[e.jsx(oe,{variant:"ghost",color:be((o=r==null?void 0:r.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(n=r==null?void 0:r.status)==null?void 0:n.name}),e.jsx(ue,{color:"primary",sx:{width:40,height:40}}),e.jsxs(a,{alignItems:"center",justifyContent:"center",children:[e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(t,{variant:"h2",children:[" ",r==null?void 0:r.amount]}),e.jsx(t,{variant:"caption",children:"MXN"})]}),e.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(me,{}),e.jsx(t,{variant:"subtitle1",textTransform:"capitalize",children:r==null?void 0:r.name})]})]}),e.jsx(t,{textAlign:"center",variant:"body2",children:r==null?void 0:r.description})]}),((c=r==null?void 0:r.status)==null?void 0:c.id)==="7"&&e.jsx(e.Fragment,{children:e.jsxs(a,{divider:e.jsx(Y,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:1,alignItems:"center",justifyContent:"center",p:2,children:[e.jsx(j,{}),e.jsx(t,{variant:"subtitle1",color:"text.secondary",children:"Detalles de la Transacción"}),e.jsxs(a,{flex:1,width:1,spacing:1,children:[e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Terminal:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.terminalId})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Referencia:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:r==null?void 0:r.reference})]}),e.jsxs(a,{justifyContent:"space-between",direction:"row",children:[e.jsx(t,{variant:"subtitle2",children:"No. Autorización:"}),e.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:(s=r==null?void 0:r.transaction)==null?void 0:s.authCode})]})]})]})})]})})};F.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,reference:l.any,status:l.shape({id:l.any,name:l.any}),terminalId:l.any,transaction:l.shape({authCode:l.any})})};const Ge=()=>{var c,s;const{paymentId:r}=X(),{data:o,isLoading:n}=fe(r,{enabled:!!r});return e.jsx(G,{title:"Cobro",meta:e.jsxs(e.Fragment,{children:[e.jsx("meta",{name:"description",content:"Liga de Pago para el servicio Viabo Pay"}),e.jsx("meta",{name:"keywords",content:"viabo pay, liga de pago, pago en linea,servició de pago,paypal,viabo card"}),e.jsx("meta",{property:"og:title",content:`Liga de Pago Generada de Viabo Pay de un monto de : ${o==null?void 0:o.amount}`}),e.jsx("meta",{property:"og:description",content:"Esta es la página sobre  el cobro mediante una liga de pago generada para el servició viabo pay"}),e.jsx("meta",{property:"og:image",content:"/landingPage/img/instagram-3.jpg"})]}),children:e.jsx(j,{component:"main",height:1,m:0,p:0,children:e.jsxs(a,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[n&&e.jsx(K,{}),!n&&o&&e.jsxs(a,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,maxWidth:((c=o==null?void 0:o.status)==null?void 0:c.id)==="7"?400:"sm",children:[e.jsx(F,{details:o}),["6","8"].includes((s=o==null?void 0:o.status)==null?void 0:s.id)&&e.jsx(V,{details:o})]})]})})})};export{Ge as default};
