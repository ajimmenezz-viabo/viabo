import{t as fe,j as e,E as he,n as je,Q as Z,g as ge,o as be,r as j,ah as se,B as te,S as d,T as S,d as K,O as J,ac as ye,d2 as Se,L as ne,P as c,a9 as ve,aY as Ie}from"./index-4b99f413.js";import{C as P}from"./build-c7ce8ef2.js";import{f as ee}from"./build-79240b72.js";import{u as oe,d as we}from"./build-3a8905b3.js";import{c as C,b as Ae,a as ae}from"./build-2009f55b.js";import{g as Te}from"./build-31b96a33.js";import"./build-bb0265ab.js";import{t as Re,u as q}from"./build-5c422c79.js";import{F as ie,M as le,L as Ee}from"./build-7a1aa18c.js";import{R as Me}from"./build-09eafbeb.js";import{R as k}from"./build-41005266.js";import{A as Ne}from"./build-92d12e9a.js";import{C as ce}from"./build-8ea1e281.js";import{S as ue}from"./build-8f67d086.js";import{C as Be}from"./build-0a41abf6.js";import{R as De}from"./build-fe021a1f.js";import{T as Pe,a as re}from"./build-00c4bcb0.js";import"./build-bee6630b.js";import"./build-9367c53e.js";import"./build-70e42481.js";import"./build-eac152ed.js";import"./build-4c42a69c.js";import"./build-c930eafb.js";import"./build-0364ace1.js";import"./build-b66547c6.js";import"./build-ececd30c.js";import"./build-e656a6c5.js";import"./build-42939910.js";import"./build-b8fe6533.js";import"./build-2c3cdb47.js";import"./build-ecaf0d13.js";import"./build-cae86eed.js";const Fe=fe(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete"),pe=(v,t,n)=>{var s,a,m;const{transactions:f}=t;let r;return n?r={originCardId:v,destinationCards:[{cardId:(s=t==null?void 0:t.card)==null?void 0:s.value.toString(),concept:(a=t==null?void 0:t.concept)==null?void 0:a.toString(),amount:parseFloat((t==null?void 0:t.amount.toString())===""?"0":(m=t==null?void 0:t.amount)==null?void 0:m.toString().replace(/,/g,"")).toString()}]}:r={originCardId:v,destinationCards:f==null?void 0:f.map(o=>{var l,x,I,g;return{cardId:(x=(l=o==null?void 0:o.card)==null?void 0:l.value)==null?void 0:x.toString(),concept:(I=o==null?void 0:o.concept)==null?void 0:I.toString(),amount:parseFloat((o==null?void 0:o.amount.toString())===""?"0":(g=o==null?void 0:o.amount)==null?void 0:g.toString().replace(/,/g,"")).toString()}})},{cardId:r==null?void 0:r.originCardId,data:Te(r)}},de=(v={})=>{const t=he(),n=je(Re,v);return{...n,transaction:async(r,s)=>{const{onSuccess:a,onError:m,mutationOptions:o}=s;try{await Z.promise(n.mutateAsync(r,o),{pending:"Procesando Transferencia ...",success:{render({data:l}){return t.fetchQuery([P.TRANSIT_BALANCE]),t.invalidateQueries([P.CARD_INFO,l==null?void 0:l.cardId]),t.fetchQuery([P.CARD_MOVEMENTS,l==null?void 0:l.cardId]),t.fetchQuery([P.MAIN_CARD]),a(l),"Se realizo la transferencia con Ã©xito"}}})}catch(l){const x=ge(l,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");m(x),Z.error(x,{type:be(l)})}}}};function O({cards:v,balance:t,setCurrentBalance:n,insufficient:f,cardOriginId:r,setOpen:s,isBinCard:a,setTransactionLoading:m}){const o=j.useRef(null),l=window.crypto||window.msCrypto,x=new Uint32Array(1),I=l.getRandomValues(x)[0],[g,w]=j.useState(v),{transaction:b,isLoading:y}=de(),u=q(p=>p==null?void 0:p.selectedCards),N=C().shape({transactions:Ae().of(C().shape({amount:ae().required("La cantidad es requerida"),card:C().nullable().required("La tarjeta es requerida")}))}),F=oe({initialValues:{transactions:(u==null?void 0:u.length)>0&&a&&(u==null?void 0:u.map(p=>({id:Math.random(),card:{value:p==null?void 0:p.value,label:p==null?void 0:p.label,...p},amount:"",concept:""})))||[{id:I,card:null,amount:"",concept:""}]},validationSchema:N,onSubmit:p=>{if(f)return V(!1);const i=pe(r,p);m(!0),b(i,{onSuccess:()=>{V(!1),s(!1),m(!1)},onError:()=>{V(!1),m(!1)}})}}),{isSubmitting:L,setFieldValue:h,values:T,setSubmitting:V}=F,M=L||y;return j.useEffect(()=>{if(u&&a){const p=u==null?void 0:u.map(i=>({...i,isDisabled:!0}));w(p)}},[u,a]),j.useEffect(()=>{var A;const i=((A=T.transactions)==null?void 0:A.reduce((B,D)=>{const z=D.amount.trim()!==""?parseFloat(D.amount.replace(/,/g,"")):0;return isNaN(z)?B:B+z},0)).toFixed(2);n(i)},[T.transactions]),e.jsx(e.Fragment,{children:e.jsx(se,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(ie,{formik:F,children:e.jsxs(te,{sx:{p:3},children:[e.jsxs(d,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[e.jsx(S,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),e.jsx(d,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!a&&e.jsx(K,{type:"button",size:"small",variant:"outlined",startIcon:e.jsx(Ne,{}),disabled:M,onClick:()=>o.current.push({id:I,card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Nueva"})]}),e.jsx(we,{name:"transactions",render:p=>(o.current=p,e.jsx(d,{divider:e.jsx(J,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:T==null?void 0:T.transactions.map((i,A)=>{var _,$,Q,G,U,H;const B=`transactions[${A}].card`,D=`transactions[${A}].amount`,z=`transactions[${A}].concept`;return e.jsxs(d,{alignItems:"flex-end",spacing:1.5,children:[(($=(_=i==null?void 0:i.card)==null?void 0:_.assignUser)==null?void 0:$.name)&&e.jsx(ce,{avatar:e.jsx(ye,{...Se(((G=(Q=i==null?void 0:i.card)==null?void 0:Q.assignUser)==null?void 0:G.name)??"")}),label:(H=(U=i==null?void 0:i.card)==null?void 0:U.assignUser)==null?void 0:H.name}),e.jsxs(d,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[e.jsx(S,{variant:"overline",color:"text.disabled",children:A+1}),e.jsx(Me,{name:B,disabled:M||a,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:g||[],onChange:(W,R)=>{const xe=g==null?void 0:g.map(E=>{var X,Y;return!(R!=null&&R.value)&&E.value===((X=i==null?void 0:i.card)==null?void 0:X.value)?{...E,isDisabled:!1}:E.value===(R==null?void 0:R.value)?{...E,isDisabled:!0}:E.value===((Y=i==null?void 0:i.card)==null?void 0:Y.value)?{...E,isDisabled:!1}:E});w(xe),h(B,R)},sx:{width:{xs:1,lg:.6}}}),e.jsx(k,{sx:{width:{xs:1,lg:.4}},size:"small",name:D,required:!0,label:"Cantidad",placeholder:"0.00",disabled:M,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:le,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:i.amount,onAccept:W=>{h(D,W)}}}})]}),e.jsx(d,{sx:{width:1},children:e.jsx(k,{name:z,multiline:!0,disabled:M,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),A!==0&&!a&&e.jsx(K,{size:"small",color:"error",disabled:M,startIcon:e.jsx(Fe,{}),onClick:()=>p.remove(A),children:"Borrar"})]},i.id)})}))}),e.jsx(J,{sx:{my:3,borderStyle:"dashed"}}),e.jsx(d,{sx:{px:3,pt:3},children:e.jsx(ne,{variant:"contained",color:"primary",loading:M,disabled:f,fullWidth:!0,type:"submit",startIcon:e.jsx(ue,{}),children:"Enviar"})})]})})})})}O.propTypes={balance:c.any,cardOriginId:c.any,cards:c.any,insufficient:c.any,isBinCard:c.any,setCurrentBalance:c.func,setOpen:c.func,setTransactionLoading:c.func};function me({balance:v,setCurrentBalance:t,insufficient:n,cardOriginId:f,setOpen:r,mainCard:s,setTransactionLoading:a}){const{transaction:m,isLoading:o}=de(),l=C().shape({amount:ae().required("La cantidad es requerida")}),x=oe({initialValues:{card:s?{label:s==null?void 0:s.label,value:s==null?void 0:s.id}:null,amount:"",concept:""},validationSchema:l,onSubmit:(y,{setSubmitting:u})=>{if(n)return u(!1);const N=pe(f,y,!0);a(!0),m(N,{onSuccess:()=>{u(!1),r(!1),a(!1)},onError:()=>{u(!1),a(!1)}})}}),{isSubmitting:I,setFieldValue:g,values:w}=x,b=I||o;return e.jsx(se,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(ie,{formik:x,children:e.jsxs(d,{sx:{p:3},spacing:1,children:[e.jsx(d,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",justifyContent:"center",children:e.jsx(ce,{icon:e.jsx(Be,{}),label:s==null?void 0:s.cardNumberHidden})}),e.jsx(d,{children:e.jsx(k,{sx:{width:1},size:"small",name:"amount",required:!0,label:"Cantidad",placeholder:"0.00",disabled:b,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:le,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:w.amount,onAccept:y=>{t(parseFloat(y===""?"0":y.replace(/,/g,"")).toFixed(2)),g("amount",y)}}}})}),e.jsx(d,{sx:{width:1},children:e.jsx(k,{name:"concept",multiline:!0,disabled:b,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),e.jsx(d,{sx:{px:3,pt:3},children:e.jsx(ne,{variant:"contained",color:"primary",loading:b,fullWidth:!0,type:"submit",startIcon:e.jsx(ue,{}),children:"Enviar"})})]})})})}me.propTypes={balance:c.any,cardOriginId:c.any,insufficient:c.any,mainCard:c.shape({cardNumberHidden:c.any,id:c.any,label:c.any}),setCurrentBalance:c.func,setOpen:c.func,setTransactionLoading:c.func};function Le({open:v,setOpen:t,isFundingCard:n}){var L;const f=ve(),r=q(h=>h.card),s=q(h=>h.mainCard),a=Ie([P.CARDS_COMMERCE_LIST])||[],[m,o]=j.useState(0),l=j.useMemo(()=>n?s==null?void 0:s.balance:r==null?void 0:r.balance,[s==null?void 0:s.balance,r==null?void 0:r.balance]),[x,I]=j.useState("1"),[g,w]=j.useState(!1),b=j.useMemo(()=>(parseFloat(l)-m).toFixed(2)<0,[m,l]),y=j.useMemo(()=>{var h;return((h=f==null?void 0:f.profile)==null?void 0:h.toLowerCase())==="representante legal"},[f]),u=j.useMemo(()=>a==null?void 0:a.filter(h=>h.id!==(r==null?void 0:r.id)),[a,r==null?void 0:r.id]),N=()=>{o(0),t(!1)},F=(h,T)=>{T&&I(T)};return j.useEffect(()=>{o(0)},[x]),e.jsxs(De,{open:v,handleClose:N,titleElement:n?e.jsx(S,{variant:"h6",children:"Fondear"}):e.jsxs(te,{children:[e.jsxs(d,{spacing:1,alignItems:"center",direction:"row",mb:.5,children:[e.jsx(S,{variant:"subtitle2",children:"Origen: "}),e.jsxs(S,{variant:"subtitle2",children:[r==null?void 0:r.cardNumberMoreDigits," "]})]}),e.jsx(Ee,{color:"info",children:(L=r==null?void 0:r.assignUser)==null?void 0:L.name})]}),children:[!n&&y&&e.jsx(d,{alignItems:"flex-end",sx:{py:1,px:3},children:e.jsxs(Pe,{size:"small",color:"primary",value:x,exclusive:!0,onChange:F,"aria-label":"Platform",disabled:g,children:[e.jsx(re,{value:"1",children:"Tarjetas"}),e.jsx(re,{value:"2",children:"Global"})]})}),e.jsxs(d,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,pt:n?2:1,children:[e.jsx(S,{variant:"subtitle1",children:"Saldo"}),e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(S,{variant:"h3",color:"success.main",children:ee(l)}),e.jsx(S,{variant:"caption",color:"success.main",children:"MXN"})]}),e.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs(S,{variant:"subtitle1",color:"error",children:["- ",ee(m)]}),e.jsx(S,{variant:"caption",color:"error",children:"MXN"})]}),b&&e.jsx(S,{variant:"caption",color:"warning.main",textAlign:"center",children:"Saldo insuficiente para realizar la(s) operacion(es)"})]}),n&&e.jsx(O,{cards:n?a:u,balance:n?s==null?void 0:s.balance:r==null?void 0:r.balance,setCurrentBalance:o,insufficient:b,cardOriginId:n?s==null?void 0:s.id:r==null?void 0:r.id,setOpen:t,isBinCard:n,setTransactionLoading:w}),!n&&y&&e.jsxs(e.Fragment,{children:[x==="1"&&e.jsx(O,{cards:n?a:u,balance:m,setCurrentBalance:o,insufficient:b,cardOriginId:n?s==null?void 0:s.id:r==null?void 0:r.id,setOpen:t,isBinCard:n,setTransactionLoading:w}),x==="2"&&e.jsx(me,{mainCard:s,balance:r==null?void 0:r.balance,setCurrentBalance:o,insufficient:b,cardOriginId:r==null?void 0:r.id,setOpen:t,setTransactionLoading:w})]}),!n&&!y&&e.jsx(O,{cards:n?a:u,balance:m,setCurrentBalance:o,insufficient:b,cardOriginId:n?s==null?void 0:s.id:r==null?void 0:r.id,setOpen:t,isBinCard:n,setTransactionLoading:w})]})}Le.propTypes={isFundingCard:c.bool,open:c.bool,setOpen:c.func};export{Le as default};
