import{C as y,q as _,g as w,a as P,r as k,y as z,L as R,_ as F,P as L}from"./index-IncEwUKO.js";import{P as c,i as a,B as A,c as B,f as V,a9 as E,r as g,e as W,T as i,x as H,bk as K,a3 as U,I as Y,bw as $,V as f,bN as Q,bO as q}from"./vendor-X9cKXa3I.js";import{u as G}from"./useViaboSpeiBreadCrumbs-_KtiQNgU.js";import{a as J}from"./TextMaxLine-SKcMsBiK.js";import{c as X,i as T}from"./matchTypes-ev-w7Wi9.js";import{_ as Z,f as u}from"./index-bT7c8_vF.js";import{g as D,a as ee}from"./crypto-DLV5sXJi.js";import{f as te}from"./formatNumber-lcHsHzSd.js";import{M as se,C as ae,H as re}from"./HeaderPage-V_w2vjBb.js";import{u as ne}from"./useMaterialTable-N56kn-M3.js";function I({table:e,isChangingCauseStatus:r,causeIdToggleStatus:t,onChangeStatus:s}){const{row:l}=e,{original:o}=l,{status:d}=o,C=r&&t===(o==null?void 0:o.id);return a.jsx(A,{sx:{display:"flex",flex:1,justifyContent:"flex-start",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:C?a.jsx(y,{size:15,containerProps:{display:"flex",ml:1}}):a.jsx(J,{size:"md",color:d?"success":"error",checked:d||!1,inputProps:{"aria-label":"controlled"},onClick:p=>{p.stopPropagation(),s(o)}})})}I.propTypes={causeIdToggleStatus:c.any,isChangingCauseStatus:c.any,onChangeStatus:c.func,table:c.shape({row:c.shape({original:c.shape({id:c.any,status:c.bool})})})};const ie=e=>{const r=D(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(!r)throw new Error("No se pueden obtener los usuarios administradores de empresas");const t=r==null?void 0:r.map(s=>({id:s==null?void 0:s.id,name:s==null?void 0:s.name,status:!!(s!=null&&s.status)}));return X(t,"id","name","status")},N={COMPANIES_LIST:"spei-companies-list",USERS_ADMIN_COMPANY_LIST:"spei-admin-company-users-list"},Me={ADMIN_USERS:"users",NEW_ADMIN_USER:"new-user"},oe=e=>(e==null?void 0:e.map(t=>({id:t==null?void 0:t.id,name:t==null?void 0:t.name,balance:te((t==null?void 0:t.balance)||"0"),status:!!(t!=null&&t.active),rfc:t==null?void 0:t.rfc,stpAccount:t==null?void 0:t.stpAccount})))||[],le=ee([...Array(5)].map((e,r)=>({id:Z.id(r),name:u.person.fullName(),status:u.datatype.boolean({probability:.8})}))),ce=[...Array(5)].map((e,r)=>({id:u.string.numeric(6),name:u.company.name(),active:u.datatype.boolean({probability:.8}),rfc:u.string.alphanumeric(13),balance:u.string.numeric(5),stpAccount:u.string.numeric(18)})),ue=async()=>oe(ce),Oe=async e=>{const{data:r}=await _.post("/api/spei/external-account/new",e);return r},ye=async()=>ie(le),de=async e=>(await _.put(`/api/spei/company/${e==null?void 0:e.id}/${e!=null&&e.changeStatus?"disable":"enable"}`),e),pe=(e={})=>{const r=B(),t=V({mutationFn:de,...e});return{...t,mutate:async(l,o)=>{const{onSuccess:d,onError:C,...p}=o;try{await E.promise(t.mutateAsync(l,p),{pending:"Actualizando estado de la empresa...",success:{render({data:b}){return r.invalidateQueries([N.COMPANIES_LIST]),T(d)&&d(b),"Se actualizó el estado de la empresa con éxito"}}})}catch(b){const x=w(b,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");T(C)&&C(x),E.error(x,{type:P(b)})}}}},me=(e={})=>{const[r,t]=g.useState(null),s=W({queryKey:[N.COMPANIES_LIST],queryFn:ue,refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,...e});return g.useEffect(()=>{if(s!=null&&s.isError){const l=w(s.error,"No se puede obtener la lista de empresas. Intente nuevamente o reporte a sistemas");t(l),E.error(l,{type:P(s.error)})}},[s.isError,s.error]),{...s,error:r||null}},Se=()=>g.useMemo(()=>[{id:"id",accessorKey:"id",header:"ID",enableHiding:!1,maxSize:40,Cell:({cell:e,column:r,row:t,renderedCellValue:s})=>a.jsx(i,{variant:"subtitle2",children:s})},{id:"rfc",accessorKey:"rfc",header:"RFC",Cell:({cell:e,column:r,row:t,renderedCellValue:s})=>a.jsx(i,{textTransform:"uppercase",variant:"subtitle2",children:s})},{id:"name",accessorKey:"name",header:"Nombre",enableHiding:!1,Cell:({cell:e,column:r,row:t,renderedCellValue:s})=>a.jsx(i,{textTransform:"capitalize",fontWeight:"bold",variant:"subtitle2",children:s})},{id:"stpAccount",header:"Cuenta STP",accessorKey:"stpAccount",Cell:({cell:e,column:r,row:t,renderedCellValue:s})=>a.jsx(i,{variant:"subtitle2",children:s})},{id:"balance",accessorKey:"balance",header:"Balance",minSize:100,Cell:({cell:e,column:r,row:t,renderedCellValue:s})=>a.jsx(i,{variant:"subtitle2",children:s})}],[]),ge={company:null,openNewCompany:!1},Ce=(e,r)=>({...ge,setSpeiCompany:t=>{e(s=>({company:t}),!1,"SET_SPEI_NEW_COMPANY")},setOpenNewSpeiCompany:t=>{e(s=>({openNewCompany:t}),!1,"SET_OPEN_SPEI_NEW_COMPANY")}}),be=k(Ce),xe=()=>{const{data:e,isLoading:r,isError:t,error:s,isFetching:l}=me(),{setOpenNewSpeiCompany:o}=be(),d=Se(),[C,p]=g.useState(!1),[b,x]=g.useState(null),[n,h]=g.useState(null),{mutate:v,isLoading:M}=pe(),O=()=>{p(!1),v({...n,changeStatus:!(n!=null&&n.status)},{onSuccess:()=>{x(null),h(null)},onError:()=>{x(null),h(null)}})},j=ne(t,s,{columns:d,data:e||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"id",desc:!1}]},state:{isLoading:r,showAlertBanner:t,showProgressBars:l},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},muiTableBodyRowProps:({row:m})=>({sx:S=>({backgroundColor:"inherit","&.Mui-selected":{backgroundColor:S.palette.action.selected,"&:hover":{backgroundColor:S.palette.action.hover}}})}),enableColumnResizing:!0,layoutMode:"grid",renderTopToolbarCustomActions:()=>a.jsx(A,{}),renderRowActions:m=>a.jsx(I,{table:m,isChangingCauseStatus:M,onChangeStatus:S=>{h(S),x(S==null?void 0:S.id),p(!0)},causeIdToggleStatus:b})});return a.jsxs(a.Fragment,{children:[a.jsxs(H,{variant:"outlined",sx:m=>j.getState().isFullScreen?{}:{boxShadow:m.customShadows.z24,backgroundColor:m.palette.mode==="light"?"inherit":m.palette.grey[50012],backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:[a.jsx(K,{sx:m=>({pb:2}),title:"Lista de Empresas",subheader:`Tienes ${(e==null?void 0:e.length)||0} empresas dadas de alta`,action:a.jsx(U,{title:"Nueva Empresa",children:a.jsx(Y,{color:"primary",size:"large",onClick:()=>o(!0),children:a.jsx($,{})})})}),a.jsx(se,{table:j})]}),a.jsx(z,{title:a.jsxs(f,{alignItems:"center",justifyContent:"space-between",flexDirection:"row",children:[a.jsx(i,{variant:"h6",children:n!=null&&n.status?"Desactivar Empresa":"Activar Empresa"}),n!=null&&n.status?a.jsx(Q,{color:"error"}):a.jsx(q,{color:"success"})]}),textButtonSuccess:"Si",textButtonCancel:"No",onClose:()=>{p(!1)},open:C,actionsProps:{sx:{justifyContent:"center"}},description:a.jsxs(f,{spacing:3,children:[a.jsxs(f,{spacing:.5,p:2,borderColor:"secondary.light",borderRadius:2,sx:{borderStyle:"dotted"},children:[a.jsx(i,{fontWeight:"bold",variant:"subtitle2",children:n==null?void 0:n.name}),a.jsx(i,{variant:"subtitle2",children:n==null?void 0:n.rfc}),a.jsx(i,{variant:"subtitle2",children:n==null?void 0:n.stpAccount})]}),a.jsxs(i,{textAlign:"center",children:["¿Está seguro de"," ",a.jsx(A,{component:"span",sx:{fontWeight:"bold"},children:`${n!=null&&n.status?"Desactivar":"Activar"}`})," ","la empresa?"]})]}),onSuccess:O,fullWidth:!0,maxWidth:"xs"})]})},he=R(g.lazy(()=>F(()=>import("./SpeiNewCompanyDrawer-8xkyOUZz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15])))),fe=()=>{const{companies:e}=G();return a.jsx(L,{title:"Empresas - Viabo Spei",children:a.jsxs(ae,{sx:{pb:3},children:[a.jsx(re,{name:"Empresas",links:e}),a.jsx(xe,{}),a.jsx(he,{})]})})},ke=Object.freeze(Object.defineProperty({__proto__:null,ViaboSpeiCompanies:fe},Symbol.toStringTag,{value:"Module"}));export{Me as M,N as S,ke as V,ye as g,Oe as n,be as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/SpeiNewCompanyDrawer-8xkyOUZz.js","assets/js/index-IncEwUKO.js","assets/js/vendor-X9cKXa3I.js","assets/css/build-K0YT2apu.css","assets/js/useViaboSpeiBreadCrumbs-_KtiQNgU.js","assets/js/TextMaxLine-SKcMsBiK.js","assets/js/formik.esm-drA_7EEr.js","assets/js/UploadSingleFile-v78kQPok.js","assets/js/fade-HpdRXKiE.js","assets/js/transition-Uc7vb3zK.js","assets/js/formatNumber-lcHsHzSd.js","assets/js/matchTypes-ev-w7Wi9.js","assets/js/index-bT7c8_vF.js","assets/js/crypto-DLV5sXJi.js","assets/js/HeaderPage-V_w2vjBb.js","assets/js/useMaterialTable-N56kn-M3.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=ViaboSpeiCompanies-XZYl-B87.js.map
