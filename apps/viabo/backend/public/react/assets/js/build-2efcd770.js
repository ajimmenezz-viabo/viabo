import{r as E,k,X as ie,ar as re,j as e,U as _,as as ae,at as le,au as V,t as ce,a as M,a3 as de,n as me,av as b,g as N,o as pe,b as ue,P as y,aa as B,S as x,ab as xe,T as h,L as he,c as ge,aj as Ce,a4 as fe,d as je,B as F,ag as ye,f as ve,ao as Ee,ap as be,aq as Ae}from"./build-a914105e.js";import{u as Te}from"./build-d98979f8.js";import{M as Se}from"./build-2b5d2635.js";import{c as we,a as I}from"./build-625f2e5a.js";import{g as Ie,C as Re}from"./build-127804b6.js";import{C as Le}from"./build-c7ce8ef2.js";import{C as _e,R as De,a as Ve,D as Oe}from"./build-80a184b8.js";import{R as D}from"./build-40e822bb.js";import{F as Pe,M as ke}from"./build-54774474.js";import{I as O}from"./build-f2b95e6c.js";import{E as Me}from"./build-e587217a.js";import{V as Ne,A as Be}from"./build-9cb74a5e.js";import{C as Fe,M as Ue,a as qe,H as We}from"./build-43d9dd38.js";import{C as He}from"./build-1233ea6e.js";import{C as $e}from"./build-b35cd6a9.js";import{C as ze,A as Qe,a as Ge,b as Ke,F as Ze,c as Xe}from"./build-16595612.js";import{C as U}from"./build-dd58f4fe.js";import{s as Ye}from"./build-9563ddbe.js";import{C as Je}from"./build-0f1bf6ed.js";import{C as es}from"./build-51e15f17.js";import{T as ss,a as P}from"./build-8c780b84.js";import"./build-b1f1edf3.js";import"./build-ecaf0d13.js";import"./build-71d71eb2.js";import"./build-bee6630b.js";import"./build-eeb9eef1.js";import"./build-56505f06.js";import"./build-6b2f2a1f.js";import"./build-e27f7ba6.js";import"./build-0a21e8ff.js";const ns=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ts={entering:{transform:"none"},entered:{transform:"none"}},os=E.forwardRef(function(t,r){const a=k(),i={enter:a.transitions.duration.enteringScreen,exit:a.transitions.duration.leavingScreen},{addEndListener:c,appear:p=!0,children:d,easing:m,in:n,onEnter:u,onEntered:o,onEntering:l,onExit:g,onExited:j,onExiting:A,style:R,timeout:L=i,TransitionComponent:K=ae}=t,Z=ie(t,ns),w=E.useRef(null),X=re(w,d.ref,r),T=C=>v=>{if(C){const S=w.current;v===void 0?C(S):C(S,v)}},Y=T(l),J=T((C,v)=>{le(C);const S=V({style:R,timeout:L,easing:m},{mode:"enter"});C.style.webkitTransition=a.transitions.create("transform",S),C.style.transition=a.transitions.create("transform",S),u&&u(C,v)}),ee=T(o),se=T(A),ne=T(C=>{const v=V({style:R,timeout:L,easing:m},{mode:"exit"});C.style.webkitTransition=a.transitions.create("transform",v),C.style.transition=a.transitions.create("transform",v),g&&g(C)}),te=T(j),oe=C=>{c&&c(w.current,C)};return e.jsx(K,_({appear:p,in:n,nodeRef:w,onEnter:J,onEntered:ee,onEntering:Y,onExit:ne,onExited:te,onExiting:se,addEndListener:oe,timeout:L},Z,{children:(C,v)=>E.cloneElement(d,_({style:_({transform:"scale(0)",visibility:C==="exited"&&!n?"hidden":void 0},ts[C],R,d.props.style),ref:X},v))}))}),is=os,rs=ce(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),q={LIST:"allCommerceCards"},as=(s,t,r)=>{var d;const{phone:a,email:i,name:c}=s,p={name:c,phone:a,email:i,cards:r?[{id:(d=t[0])==null?void 0:d.id,cvv:s==null?void 0:s.cvv}]:(t==null?void 0:t.map(m=>({id:m==null?void 0:m.id,cvv:m==null?void 0:m.cvv})))||[]};return Ie(p)},ls=async()=>{const{data:s}=await M.get("/api/cards/commerce");return _e(s)},cs=async s=>(await M.put("/api/assign/commerce-card/to/user",s),s),ds=(s={})=>{const t=de(),r=me(cs,s);return{...r,mutate:async(i,c)=>{const{onSuccess:p,onError:d,mutationOptions:m}=c;try{await b.promise(r.mutateAsync(i,m),{pending:"Asignando Tarjetas ...",success:{render({data:n}){return t.invalidateQueries([q.LIST]),t.invalidateQueries([Le.CARDS_COMMERCE_LIST]),p(),"Se asignaron las tarjetas con éxito"}}})}catch(n){const u=N(n,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(u),b.error(u,{type:pe(n)})}}}},ms=(s={})=>{const[t,r]=E.useState(null);return{...ue([q.LIST],ls,{staleTime:6e4,onError:i=>{const c=N(i,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");r(c)},...s}),error:t||null}};function W({cards:s,onSuccess:t}){const{mutate:r,isLoading:a}=ds(),i=E.useMemo(()=>(s==null?void 0:s.length)>0&&s[0].cvv==="",[s]),c=we({name:I().required("El nombre es requerido"),email:I().email("Ingresa un correo valido").required("El correo es requerido"),phone:I().test("longitud","El telefono es muy corto",j=>!(j&&j.replace(/[\s+]/g,"").length<10)),...i&&{cvv:I().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),p=Te({initialValues:{name:"",phone:"",email:"",...i&&{cvv:""}},validationSchema:c,onSubmit:j=>{const A=as(j,s,i);r(A,{onSuccess:()=>{l(!1),t()},onError:()=>{l(!1)}})}}),{errors:d,touched:m,isSubmitting:n,setFieldValue:u,values:o,setSubmitting:l}=p,g=n||a;return e.jsx(B,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Pe,{formik:p,children:e.jsxs(x,{spacing:3,sx:{p:3},children:[i&&e.jsx(xe,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(h,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(x,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:g})]}),e.jsxs(x,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:g,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Me,{})})}})]}),e.jsxs(x,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Se,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:o.phone||"+52",disabled:g,onChange:(j,A)=>{u("phone",j)},error:m.phone&&!!d.phone,helperText:m.phone&&d.phone})]}),i&&e.jsxs(x,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(D,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Ne,{})}),inputComponent:ke,inputProps:{mask:"000",onAccept:j=>{u("cvv",j)},value:o.cvv}},disabled:g})]}),e.jsx(x,{sx:{pt:3},children:e.jsx(he,{loading:n,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Be,{}),children:"Asociar"})})]})})})}W.propTypes={cards:y.array,onSuccess:y.func};const ps={cards:[],rows:[],openAssign:!1},us=(s,t)=>({...ps,setSelectedCard:r=>{const{cards:a}=t(),i=a.indexOf(r);let c=[];i===-1?c=c.concat(a,r):i===0?c=c.concat(a.slice(1)):i===a.length-1?c=c.concat(a.slice(0,-1)):i>0&&(c=c.concat(a.slice(0,i),a.slice(i+1))),s(p=>({cards:c}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:r=>{s(a=>({cards:r}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:r=>{s(a=>({rows:r}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:r=>{s(a=>({openAssign:r}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{s(r=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),f=ge(us);function H({open:s,handleClose:t,handleSuccess:r}){const a=f(i=>i.cards);return e.jsxs(De,{open:s,handleClose:t,title:(a==null?void 0:a.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(x,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:a==null?void 0:a.map(i=>e.jsx(Re,{icon:e.jsx(He,{}),label:i==null?void 0:i.cardNumberHidden},i==null?void 0:i.id))}),e.jsx(W,{cards:a,onSuccess:r})]})}H.propTypes={handleClose:y.func,handleSuccess:y.func,open:y.bool};function $({card:s}){var c,p;const t=f(d=>d.setSelectedCard),r=f(d=>d.cards),a=r==null?void 0:r.some(d=>(d==null?void 0:d.id)===(s==null?void 0:s.id)),i=d=>{d.stopPropagation(),t(s)};return e.jsx(Ce.div,{onClick:i,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(Ve,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(x,{flexDirection:"row",gap:1,children:[e.jsx(U,{onClick:i,edge:"start",checked:a,inputProps:{"aria-labelledby":s==null?void 0:s.id},color:"success"}),e.jsxs(x,{children:[e.jsx(h,{variant:"subtitle2",sx:{opacity:.72},children:((c=s==null?void 0:s.assignUser)==null?void 0:c.name)==="-"?"Viabo Card":(p=s==null?void 0:s.assignUser)==null?void 0:p.name}),e.jsx(h,{variant:"caption",color:"text.secondary",children:s==null?void 0:s.register})]})]}),e.jsx($e,{card:s,disableShow:!0}),e.jsxs(x,{direction:"row",spacing:5,children:[e.jsxs(x,{children:[e.jsx(h,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(h,{sx:{typography:"subtitle1"},children:s==null?void 0:s.expiration})]}),e.jsx(ze,{card:s,disableShow:!0})]})]})})}$.propTypes={card:y.shape({expiration:y.any,id:y.any,register:y.any})};function z({cards:s}){const t=f(n=>n.cards),r=f(n=>n.setAllCards),a=f(n=>n.resetCards),i=f(n=>n.setOpenAssign),c=(t==null?void 0:t.length)||0,p=(s==null?void 0:s.length)||0,d=n=>{if(n){r(s);return}a()},m=()=>{const n=t.some(l=>(l==null?void 0:l.cvv)==="")&&(t==null?void 0:t.length)>1,u=t.some(l=>{var g;return((g=l==null?void 0:l.assignUser)==null?void 0:g.id)!==""});t.every(l=>(l==null?void 0:l.cvv)==="")&&(t==null?void 0:t.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):n?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?b.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):i(!0)};return e.jsx(e.Fragment,{children:e.jsx(fe,{sx:n=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:n.customShadows.z8,backgroundColor:n.palette.info.lighter,color:"white"}),children:e.jsxs(x,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(x,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(U,{indeterminate:c>0&&c<p,checked:p>0&&c===p,onChange:n=>d(n.target.checked),color:"success"}),e.jsx(h,{color:"success.main",variant:"subtitle1",children:c===1?`${c} Tarjeta`:`${c} Tarjetas`})]}),e.jsx(x,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(je,{startIcon:e.jsx(Qe,{}),variant:"outlined",color:"info",onClick:m,children:"Asignar"})})]})})})}z.propTypes={cards:y.array};function Q({commerceCards:s}){const t=s==null?void 0:s.data,r=f(d=>d.cards),a=f(d=>d.setIndexCards,Ye),i=k(),c=E.useMemo(()=>(r==null?void 0:r.map(d=>t.findIndex(m=>m.id===d.id)))||[],[r,t]);E.useEffect(()=>{a(c)},[c]);const p={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen};return e.jsx(x,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(x,{sx:d=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(is,{in:(r==null?void 0:r.length)>0,timeout:p,style:{transitionDelay:`${(r==null?void 0:r.length)>0?p.exit:0}ms`},unmountOnExit:!0,children:e.jsx(F,{children:e.jsx(z,{cards:s==null?void 0:s.data})})}),e.jsx(B,{children:e.jsx(Ge,{cards:s,emptyMessage:"No hay tarjetas sin asignar",cardComponent:$,my:3})})]})})}Q.propTypes={commerceCards:y.shape({data:y.array})};function G({isLoading:s,cards:t=[],rows:r=[]}){const a=f(n=>n.setAllCards),i=f(n=>n.cards),c=f(n=>n.setOpenAssign),p=f(n=>n.setIndexCards),d=()=>{const n=i.some(l=>(l==null?void 0:l.cvv)==="")&&(i==null?void 0:i.length)>1,u=i.some(l=>{var g;return((g=l==null?void 0:l.assignUser)==null?void 0:g.id)!==""});i.every(l=>(l==null?void 0:l.cvv)==="")&&(i==null?void 0:i.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):n?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?b.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):c(!0)},m=[{name:"cardNumberMoreDigits",label:"Tarjeta",options:{customBodyRenderLite:(n,u)=>{const o=t[n];return e.jsx(h,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:o==null?void 0:o.cardNumberMoreDigits})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(n,u)=>{const o=t[n];return e.jsxs(x,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(ye,{sx:l=>({width:45,height:45,color:l.palette.primary.contrastText,backgroundColor:l.palette.primary.light}),children:(o==null?void 0:o.cardType)==="Carnet"?e.jsx(Fe,{sx:{width:30},color:"white"}):e.jsx(Ue,{sx:{width:30}})}),e.jsx(h,{variant:"subtitle2",children:o==null?void 0:o.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"emptyCVV",label:"CVV",options:{filterType:"checkbox",customBodyRenderLite:(n,u)=>{const o=t[n];return(o==null?void 0:o.cvv)===""||!(o!=null&&o.cvv)?e.jsx(es,{color:"error"}):e.jsx(rs,{color:"success"})}}},{name:"assignUser.name",label:"Asignado",options:{customBodyRenderLite:(n,u)=>{var l;const o=t[n];return e.jsx(h,{variant:"body2",children:(l=o==null?void 0:o.assignUser)==null?void 0:l.name})}}},{name:"assignUser.date",label:"Fecha de Asignación",options:{customBodyRenderLite:(n,u)=>{var l,g,j,A;const o=t[n];return((l=o==null?void 0:o.assignUser)==null?void 0:l.date)==="-"?e.jsx(h,{variant:"subtitle2",children:(g=o==null?void 0:o.assignUser)==null?void 0:g.date}):e.jsxs(x,{children:[e.jsx(h,{variant:"subtitle2",children:(j=o==null?void 0:o.assignUser)==null?void 0:j.date}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:(A=o==null?void 0:o.assignUser)==null?void 0:A.time})]})}}},{name:"register",label:"Fecha de Registro",options:{filterType:"textField",customBodyRenderLite:(n,u)=>{const o=t[n];return e.jsxs(x,{children:[e.jsx(h,{variant:"subtitle2",children:o==null?void 0:o.registerDate}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:o==null?void 0:o.registerTime})]})}}}];return e.jsx(Je,{children:e.jsx(Oe,{isLoading:s,data:t||[],columns:m,options:{responsive:"simple",rowsSelected:r,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",enableNestedDataAccess:".",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(n,u,o)=>{const l=t==null?void 0:t.filter((g,j)=>o.includes(j));a(l),p(o)},customToolbarSelect:n=>e.jsx(Ke,{handleAssign:d})}})})}G.propTypes={cards:y.array,isLoading:y.bool,rows:y.array};function Hs(){const s=ms(),[t,r]=E.useState("1"),a=(m,n)=>{r(n)},i=f(m=>m.rows),c=f(m=>m.openAssign),p=f(m=>m.setOpenAssign),d=f(m=>m.resetCards);return e.jsx(e.Fragment,{children:e.jsx(ve,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(qe,{sx:{height:"100%"},children:[e.jsx(We,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Ee.root},{name:"Administracion",href:be.cards},{name:Ae.unassignedCards.name}],buttons:e.jsx(F,{display:"flex",justifyContent:"center",mt:{xs:2,md:0},children:e.jsxs(ss,{size:"small",color:"primary",value:t,exclusive:!0,onChange:a,"aria-label":"Platform",children:[e.jsx(P,{value:"1",children:e.jsx(Ze,{})}),e.jsx(P,{value:"2",children:e.jsx(Xe,{})})]})})}),t==="2"&&e.jsx(Q,{commerceCards:s}),t==="1"&&e.jsx(G,{cards:s.data,isLoading:s.isLoading,rows:i}),e.jsx(H,{open:c,handleClose:()=>{p(!1)},handleSuccess:()=>{p(!1),d()}})]})})})}export{Hs as default};
