import{r as C,q as s,g as d,a as l}from"./index-W5_PJt9d.js";import{t as u,r as S,c as E,f}from"./vendor-VdGvLetj.js";import{g as c}from"./crypto-X2gsqmc7.js";import{a as A,b as g}from"./cardsAdapter-EpXnb-aF.js";import{f as _}from"./formatNumber-v_3o-PH6.js";import{C as D}from"./cardMovementsAdapter-aZlT15s7.js";const R={GLOBAL_CARDS:"global-cards",MOVEMENTS:"master-movements",COMMERCE_CARDS:"commerce-cards"},I={CARDS_COMMERCE_LIST:"cardsCommerce",CARD_INFO:"cardInfo",CARD_MOVEMENTS:"cardMovements",MAIN_CARD:"mainCard",TRANSIT_BALANCE:"transitBalance",PAYMENT_PROCESSORS:"paymentProcessors"},G=(e,t)=>{var r,i;const a=(r=e==null?void 0:e.processorTypes)==null?void 0:r.find(o=>o==="1"),n=(i=e==null?void 0:e.processorTypes)==null?void 0:i.find(o=>o==="2");return{cardId:t==null?void 0:t.id,amount:e==null?void 0:e.amount.toString(),spei:a?t==null?void 0:t.SPEI:"",payCash:n?"1":""}},O=e=>{const t=c(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(t)return{id:t==null?void 0:t.id,reference:t==null?void 0:t.referenceNumber};throw new Error("Algo fallo al obtener la información")},p=e=>{const t=c(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);return(t==null?void 0:t.map(n=>{var r;return{id:n==null?void 0:n.id,name:(r=n==null?void 0:n.name)==null?void 0:r.toUpperCase()}}))||[]},M={card:null,isMainCardSelected:!1,cardTypeSelected:null,mainCard:null,selectedCards:[],openFundingOrder:!1,fundingCard:null},N=(e,t)=>({...M,setCard:a=>{const{card:n}=t();e(r=>({card:{...n,...a}}),!1,"SET_CARD")},resetCard:()=>{e(a=>({card:null}),!1,"RESET_CARD")},setSelectedCards:a=>{t(),e(n=>({selectedCards:a}),!1,"SET_SELECTED_CARDS")},addInfoCard:a=>{const{card:n}=t();e(r=>({card:{...n,...a}}),!1,"SET_INFO_CARD")},setMainCard:a=>{e(n=>({mainCard:a}),!1,"SET_MAIN_CARD")},setSelectedMainCard:a=>{e(n=>({isMainCardSelected:a}),!1,"SET_IS_MAIN_CARD_SELECTED")},setOpenFundingOrder:a=>{e(n=>({openFundingOrder:a}),!1,"SET_OPEN_FUNDING_ORDER")},setFundingCard:a=>{e(n=>({fundingCard:a}),!1,"SET_FUNDING_CARD")},resetFundingOrder:()=>{e(a=>({fundingCard:null,openFundingOrder:!1}),!1,"RESET_FUNDING_ORDER")},setCardTypeSelected:a=>{e(n=>({cardTypeSelected:a}),!1,"SET_CARD_TYPE_SELECTED")}}),U=C(N),F=e=>{const t=c(e==null?void 0:e.ciphertext,e==null?void 0:e.iv),a=parseFloat((t==null?void 0:t.balance)===""?"0":t==null?void 0:t.balance.replace(/,/g,""));if(t)return{id:t==null?void 0:t.cardId,SPEI:t==null?void 0:t.spei,balance:a,balanceFormatted:_(a),cardNumberHidden:"GLOBAL"};throw new Error("Algo fallo al obtenerla informacion")},k=async()=>{const{data:e}=await s.get("/api/payment-processors/of/commerce");return p(e)},Y=async e=>{const{data:t}=await s.get(`/api/enabled-cards/commerce?paymentProcessorId=${e}`);return A(t)},$=async(e,t)=>{const{data:a}=await s.get(`/api/card/information/${e}`,{signal:t});return g(a)},b=async e=>(await s.put(`/api/card/${e==null?void 0:e.id}/block/${e!=null&&e.cardON?"unblocked":"blocked"}`),e),H=async e=>(await s.post("/api/card/transactions",e==null?void 0:e.data),e),Q=async(e,t,a,n)=>{const r=new URL("/api/card/movements",window.location.origin);r.searchParams.set("cardId",e),r.searchParams.set("startDate",t),r.searchParams.set("endDate",a);const{data:i}=await s.get(r.href,{timeout:3e4,signal:n});return D(i)},K=async(e,t)=>{const{data:a}=await s.get(`/api/main-card/information?paymentProcessorId=${e}`,{signal:t});return F(a)},j=async e=>{const{data:t}=await s.post("/api/funding-order/new",e);return O(t)},q=async e=>{const{data:t}=await s.post("/api/funding-order/send",e);return t},w={LIST:"commerce-all-cards"},V=(e={})=>{const{enqueueSnackbar:t}=u(),[a,n]=S.useState(null),r=E();return{...f(b,{onSuccess:o=>{n(null),r.refetchQueries([I.CARD_INFO,o==null?void 0:o.id]),r.invalidateQueries([w.LIST]),r.invalidateQueries([R.GLOBAL_CARDS]),t(o!=null&&o.cardON?"Se encendió la tarjeta con éxito":"Se apagó la tarjeta con éxito",{variant:"success",autoHideDuration:5e3})},onError:o=>{const m=d(o,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");t(m,{variant:l(o),autoHideDuration:5e3}),n(m)},...e}),error:a||null}};export{w as A,I as C,R as D,Q as a,k as b,Y as c,K as d,V as e,j as f,$ as g,G as h,q as s,H as t,U as u};
//# sourceMappingURL=useToggleStatusCard-uymsHwFM.js.map
