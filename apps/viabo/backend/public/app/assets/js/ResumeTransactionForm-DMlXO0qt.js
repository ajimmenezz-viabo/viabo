import{c as R,f as E,a9 as B,s as M,bB as T,r as C,i as e,by as N,bz as F,bA as D,bC as o,bD as O,B as P,T as p,S as I,a0 as Q,Q as W,e0 as _,P as c}from"./vendor-CEMfbhOc.js";import{a as k}from"./crypto--V-xCCVf.js";import{g as z,a as G,S as L}from"./index-B-U8M-8N.js";import{f as y}from"./formatNumber-Df8NwpjV.js";import{t as $,C as b}from"./useToggleStatusCard-CU00NBE9.js";import{g as H}from"./cardTypes-NmdqE8Eh.js";import"./cardsAdapter-BbJ4Fs0Z.js";import"./formatTime-mlJJpQBT.js";import"./matchTypes-BFKCRNnN.js";import"./cardMovementsAdapter-ocC5swCp.js";import"./AmexLogo-DsyshqEq.js";import"./CarnetLogo-BssSE0Ex.js";import"./MasterCardLogo-Bcn9gvbj.js";import"./VisaLogo-ByWQmEg7.js";const K=(r,i,t,u)=>{var x,m;let d;return u?d={originCardId:r,destinationCards:[{cardId:(x=i==null?void 0:i.card)==null?void 0:x.value.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((i==null?void 0:i.amount.toString())===""?"0":(m=i==null?void 0:i.amount)==null?void 0:m.toString().replace(/,/g,"")).toString()}]}:d={originCardId:r,destinationCards:i==null?void 0:i.map(n=>{var a,s,h;return{cardId:(s=(a=n==null?void 0:n.card)==null?void 0:a.value)==null?void 0:s.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((n==null?void 0:n.amount.toString())===""?"0":(h=n==null?void 0:n.amount)==null?void 0:h.toString().replace(/,/g,"")).toString()}})},{cardId:d==null?void 0:d.originCardId,data:k(d)}},U=(r={})=>{const i=R(),t=E($,r);return{...t,transaction:async(d,x)=>{const{onSuccess:m,onError:n,mutationOptions:a}=x;try{await B.promise(t.mutateAsync(d,a),{pending:"Procesando Transferencia ...",success:{render({data:s}){return i.fetchQuery([b.TRANSIT_BALANCE]),i.invalidateQueries([b.CARD_INFO,s==null?void 0:s.cardId]),i.fetchQuery([b.CARD_MOVEMENTS,s==null?void 0:s.cardId]),i.fetchQuery([b.MAIN_CARD]),m(s),"Se realizo la transferencia con éxito"}}})}catch(s){const h=z(s,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");n(h),B.error(h,{type:G(s)})}}}},S=M(T)(({theme:r})=>({"& td":{paddingTop:r.spacing(.5),paddingBottom:r.spacing(.5)}})),V=({data:r,onBack:i,setTransactionLoading:t,transactionLoading:u,onClose:d})=>{const{transaction:x,isLoading:m}=U(),n=C.useMemo(()=>(r!=null&&r.isGlobal?[r==null?void 0:r.transactions]:r==null?void 0:r.transactions)||[],[r]),a=C.useMemo(()=>(parseFloat(r==null?void 0:r.balance)-(r==null?void 0:r.currentBalance)).toFixed(2)||0,[r]),s=()=>{const{cardOriginId:l,transactions:g,isGlobal:j,concept:f}=r,A=K(l,g,f,j);t(!0),x(A,{onSuccess:()=>{d()},onError:()=>{t(!1)}})},h=C.useMemo(()=>H(r==null?void 0:r.paymentProcessor),[r]),v=h==null?void 0:h.component;return e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsx(N,{sx:{minWidth:200},children:e.jsxs(F,{children:[e.jsx(D,{sx:{borderBottom:l=>`solid 1px ${l.palette.divider}`},children:e.jsxs(T,{children:[e.jsx(o,{width:40,children:"#"}),e.jsx(o,{align:"left",children:"Movimiento"}),e.jsx(o,{align:"right",children:"Monto"})]})}),e.jsxs(O,{children:[n==null?void 0:n.map((l,g)=>{var j;return e.jsxs(T,{sx:{borderBottom:f=>`solid 1px ${f.palette.divider}`},children:[e.jsx(o,{children:g+1}),e.jsx(o,{align:"left",children:e.jsxs(P,{sx:{maxWidth:200},children:[e.jsx(p,{variant:"subtitle2",children:((j=l==null?void 0:l.card)==null?void 0:j.cardUserNumber)||"Cuenta Global"}),e.jsx(p,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:l==null?void 0:l.concept})]})}),e.jsx(o,{align:"right",children:y(l==null?void 0:l.amount)})]},g)}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsxs(I,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsx(p,{children:"Saldo Disponible"}),h&&e.jsx(v,{sx:{width:30,height:30}})]})}),e.jsx(o,{align:"right",width:120,children:e.jsx(p,{children:y(r==null?void 0:r.balance)})})]}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsx(p,{variant:"h6",children:"Total a dispersar"})}),e.jsx(o,{align:"right",width:120,children:e.jsx(p,{variant:"h6",sx:{color:"error.main"},children:y(-(r==null?void 0:r.currentBalance))})})]}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsx(p,{children:"Total después de movimiento"})}),e.jsx(o,{align:"right",width:140,children:e.jsx(p,{children:y(a)})})]})]})]})})}),e.jsxs(I,{sx:{p:3},spacing:3,children:[e.jsx(Q,{size:"large",onClick:s,loading:m||u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",sx:{fontWeight:"bold"},children:"Realizar"}),(!m||!u)&&e.jsx(W,{onClick:i,variant:"outlined",color:"inherit",fullWidth:!0,startIcon:e.jsx(_,{}),children:"Regresar"})]})]})};V.propTypes={data:c.shape({balance:c.any,cardOriginId:c.any,paymentProcessor:c.any,currentBalance:c.any,isGlobal:c.any,transactions:c.any,concept:c.any}),onBack:c.any,onClose:c.func,setTransactionLoading:c.func,transactionLoading:c.any};export{V as default};
//# sourceMappingURL=ResumeTransactionForm-DMlXO0qt.js.map
