import{t as S,j as r,F as V,a as E,n as R,E as z,Q as w,g as T,o as W,r as B,G as O,b as H,P as l,H as Q,J as Y,S as s,T as t,i as C,K as N,N as I,L as _,B as j,O as $,R as K,f as U,U as X}from"./index-6ad460b4.js";import{u as G}from"./build-154de2c9.js";import{a as J}from"./build-ebcfb744.js";import{c as Z,a as g}from"./build-74deba51.js";import{g as D,a as L}from"./build-5e714fdb.js";import{f as y}from"./build-0a64cac0.js";import{F as k,M as A,L as ee}from"./build-437622c8.js";import{R as f}from"./build-e822f479.js";import{M as re}from"./build-59732c7e.js";import{V as oe}from"./build-3780f7f9.js";import{I as v}from"./build-062e0ba8.js";import{C as ne}from"./build-01244a73.js";import{V as se}from"./build-50a5e040.js";import{P as ae}from"./build-7845a4db.js";import{E as ie}from"./build-93e23aed.js";import{L as te}from"./build-2b83ebac.js";import{D as ce}from"./build-78813490.js";import{V as le}from"./build-899176f2.js";import{R as ue}from"./build-0b0fca12.js";import"./build-636787f0.js";import"./build-bee6630b.js";import"./build-4d96ee10.js";import"./build-af45772f.js";const de=S(r.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),he=(e,o)=>{const n=e!=null&&e.expiration?V(new Date(e==null?void 0:e.expiration),"MM/yyyy"):null,c=n?n==null?void 0:n.slice(-2):"",i=n?n==null?void 0:n.slice(0,2):"",p=n?(n==null?void 0:n.slice(0,3))+c:"",x={payId:o==null?void 0:o.id,cardHolder:e==null?void 0:e.name,phone:e==null?void 0:e.phone,cardNumber:e==null?void 0:e.cardNumber.replace(/\s+/g,""),expirationDate:p,expMonth:i,expYear:c,security:e==null?void 0:e.cvv,email:e==null?void 0:e.email};return D(x)},q={INFO:"payment-link-info"},xe=e=>{const o=L(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:y(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName},reference:o==null?void 0:o.reference,terminalId:o==null?void 0:o.terminalId,transaction:{reference:(o==null?void 0:o.apiReferenceNumber)!==""?o==null?void 0:o.apiReferenceNumber:"-",authCode:(o==null?void 0:o.apiAuthCode)!==""?o==null?void 0:o.apiAuthCode:"-"}};throw new Error("Algo fallo al obtenerla información de la liga de pago")},me=async e=>{const{data:o}=await E.get(`/api/commerces/pay/${e}`);return xe(o)},pe=async e=>{const{data:o}=await E.post("/api/commerce/pay/generate/transaction",e);return o},ge=(e,o={})=>{const n=R(pe,o),c=z();return{...n,mutate:async(p,x)=>{const{onSuccess:d,onError:h,mutationOptions:m}=x;try{await w.promise(n.mutateAsync(p,m),{pending:"Realizando cargo ...",success:{render({data:a}){return c.invalidateQueries([q.INFO]),d(a),"Se realizo el pago con éxito"}}})}catch(a){const u=T(a,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");h(u),w.error(u,{type:W(a)})}}}},je=(e,o={})=>{const[n,c]=B.useState(null),i=O();return{...H([q.INFO,e],()=>me(e),{staleTime:6e4,onError:x=>{const d=T(x,"No se puede obtener la informacion de la liga de pago");c(d),i("/404")},...o}),error:n||null}},M=({details:e})=>{const{mutate:o}=ge(e==null?void 0:e.id),n=Z().shape({cardNumber:g().transform((a,u)=>u.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),expiration:g().nullable().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(a){const u=new Date(a);return Q(u)&&Y(u,new Date)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El teléfono es muy corto",a=>!(a&&a.replace(/[\s+]/g,"").length<10)).required("El teléfono es requerido")}),c=G({initialValues:{cardNumber:"",expiration:null,cvv:"",name:"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""},enableReinitialize:!0,validationSchema:n,onSubmit:(a,{setSubmitting:u,setFieldTouched:b})=>{const P=he(a,e);o(P,{onSuccess:()=>{u(!1)},onError:()=>{u(!1),d("cvv","").then(()=>{b("cvv",!1,!1)}),d("expiration",null).then(()=>{b("expiration",!1,!1)})}})}}),{errors:i,touched:p,isSubmitting:x,setFieldValue:d,values:h}=c,m=x;return r.jsx(k,{formik:c,children:r.jsxs(s,{spacing:3,children:[r.jsxs(s,{direction:"row",alignItems:"center",spacing:1,children:[r.jsx(t,{variant:"h6",children:"Forma de Pago"}),r.jsx(C,{sx:{px:1},children:r.jsx(re,{sx:{width:30,height:30}})}),r.jsx(C,{sx:{px:1},children:r.jsx(oe,{sx:{width:30,height:30}})})]}),r.jsxs(s,{spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),r.jsx(f,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(ne,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:h.cardNumber,onAccept:a=>{d("cardNumber",a)}}},disabled:m})]}),r.jsxs(s,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[r.jsxs(s,{flex:1,spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),r.jsx(ce,{disabled:m,views:["year","month"],name:"expiration",value:h!=null&&h.expiration?new Date(h.expiration):null,required:!0,onChange:a=>{d("expiration",a)},slotProps:{textField:{fullWidth:!0,error:!!i.expiration,required:!0,helperText:i.expiration?i.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),r.jsxs(s,{spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),r.jsx(f,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(se,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:a=>{d("cvv",a)},value:h.cvv}},disabled:m})]})]}),r.jsxs(s,{spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),r.jsx(f,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:m,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(ae,{})})}})]}),r.jsxs(s,{spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),r.jsx(f,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:m,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(ie,{})})}})]}),r.jsxs(s,{spacing:1,children:[r.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),r.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:h.phone,disabled:m,required:!0,onChange:(a,u)=>{d("phone",a)},error:p.phone&&!!i.phone,helperText:p.phone&&i.phone})]}),r.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",r.jsx(N,{component:I,underline:"always",color:"info.main",children:"Terminos y condiciones"}),"  &  ",r.jsx(N,{component:I,underline:"always",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),r.jsx(s,{children:r.jsx(_,{loading:x,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:r.jsx(te,{}),children:"Pagar"})})]})})};M.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const fe=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ve=e=>{var o;return((o=fe.find(n=>(n==null?void 0:n.id)===e))==null?void 0:o.color)??"info"},F=({details:e})=>{var o,n,c,i;return r.jsx(s,{children:r.jsxs(C,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[r.jsx(j,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:r.jsx("img",{src:le,alt:"viabo-logo"})}),r.jsxs(s,{alignItems:"center",justifyContent:"center",spacing:2,children:[r.jsx(ee,{variant:"ghost",color:ve((o=e==null?void 0:e.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(n=e==null?void 0:e.status)==null?void 0:n.name}),r.jsx(ue,{color:"primary",sx:{width:40,height:40}}),r.jsxs(s,{alignItems:"center",justifyContent:"center",children:[r.jsxs(s,{direction:"row",spacing:1,alignItems:"center",children:[r.jsxs(t,{variant:"h2",children:[" ",e==null?void 0:e.amount]}),r.jsx(t,{variant:"caption",children:"MXN"})]}),r.jsxs(s,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(de,{}),r.jsx(t,{variant:"subtitle1",textTransform:"capitalize",children:e==null?void 0:e.name})]})]}),r.jsx(t,{textAlign:"center",variant:"body2",children:e==null?void 0:e.description})]}),((c=e==null?void 0:e.status)==null?void 0:c.id)==="7"&&r.jsx(r.Fragment,{children:r.jsxs(s,{divider:r.jsx($,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:1,alignItems:"center",justifyContent:"center",p:2,children:[r.jsx(j,{}),r.jsx(t,{variant:"subtitle1",color:"text.secondary",children:"Detalles de la Transacción"}),r.jsxs(s,{flex:1,width:1,spacing:1,children:[r.jsxs(s,{justifyContent:"space-between",direction:"row",children:[r.jsx(t,{variant:"subtitle2",children:"No. Terminal:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:e==null?void 0:e.terminalId})]}),r.jsxs(s,{justifyContent:"space-between",direction:"row",children:[r.jsx(t,{variant:"subtitle2",children:"No. Referencia:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:e==null?void 0:e.reference})]}),r.jsxs(s,{justifyContent:"space-between",direction:"row",children:[r.jsx(t,{variant:"subtitle2",children:"No. Autorización:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:(i=e==null?void 0:e.transaction)==null?void 0:i.authCode})]})]})]})})]})})};F.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,reference:l.any,status:l.shape({id:l.any,name:l.any}),terminalId:l.any,transaction:l.shape({authCode:l.any})})};const $e=()=>{var c,i;const{paymentId:e}=K(),{data:o,isLoading:n}=je(e,{enabled:!!e});return r.jsx(U,{title:"Cobro",children:r.jsx(j,{component:"main",height:1,m:0,p:0,children:r.jsxs(s,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[n&&r.jsx(X,{}),!n&&o&&r.jsxs(s,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,maxWidth:((c=o==null?void 0:o.status)==null?void 0:c.id)==="7"?400:"sm",children:[r.jsx(F,{details:o}),["6","8"].includes((i=o==null?void 0:o.status)==null?void 0:i.id)&&r.jsx(M,{details:o})]})]})})})};export{$e as default};
