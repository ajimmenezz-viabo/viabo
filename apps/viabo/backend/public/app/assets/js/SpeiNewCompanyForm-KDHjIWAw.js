import{c as U,f as V,a9 as v,u as O,i as e,S as t,T as m,B as S,b8 as W,dH as B,e0 as k,dZ as _,e1 as R,aY as M,dr as Q,dv as Y,a0 as $,P as x}from"./vendor-FSZoD0Ty.js";import{u as H}from"./formik.esm--ft-gNTR.js";import{c as G,a as p,d as I,f as K}from"./index.esm-ZMwb309P.js";import{g as D,a as L,a2 as Z}from"./index-c1QoFEuN.js";import{M as j,n as J,S as w,b as X}from"./ViaboSpeiCompanies-rdNb1LfD.js";import{i as C}from"./matchTypes-_pBEYOAq.js";import{V as y}from"./viabo-card-zH8OCAbq.js";import{F as ee,R as E,a as re}from"./TextMaxLine-cfAOJylX.js";import{R as z}from"./RFSelect-r0md_kbC.js";import"./useViaboSpeiBreadCrumbs-Gc1NxzaE.js";import"./formatNumber-IeezKRXK.js";import"./HeaderPage-K86N9ZPe.js";import"./fade-HpdRXKiE.js";import"./transition-Uc7vb3zK.js";import"./useMaterialTable-nTpJPdva.js";import"./UploadSingleFile-tjLGAlpU.js";const se=r=>{var l,o,s,N,b,c,u,f,i;return{fiscalName:(l=r==null?void 0:r.fiscalName)==null?void 0:l.trim(),rfc:(o=r==null?void 0:r.rfc)==null?void 0:o.trim(),commercialName:(s=r==null?void 0:r.commercialName)==null?void 0:s.trim(),isNewUser:(r==null?void 0:r.method)===j.NEW_ADMIN_USER,assignedUsers:((N=r==null?void 0:r.adminUsers)==null?void 0:N.map(d=>d.value))||[],userName:(b=r==null?void 0:r.adminName)==null?void 0:b.trim(),userLastName:(c=r==null?void 0:r.adminLastName)==null?void 0:c.trim(),userEmail:(u=r==null?void 0:r.adminEmail)==null?void 0:u.trim(),userPhone:(f=r==null?void 0:r.adminPhone)==null?void 0:f.trim(),costCenters:((i=r==null?void 0:r.costCenters)==null?void 0:i.map(d=>d.value))||[],hasViaboCard:r==null?void 0:r.hasViaboCard}},ae=(r={})=>{const l=U(),o=V(J,r);return{...o,mutate:async(N,b)=>{const{onSuccess:c,onError:u,mutationOptions:f}=b;try{await v.promise(o.mutateAsync(N,f),{pending:"Creando empresa...",success:{render({data:i}){return l.invalidateQueries([w.COMPANIES_LIST]),C(c)&&c(i),"Se creó la empresa con éxito"}}})}catch(i){const d=D(i,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");C(u)&&u(d),v.error(d,{type:L(i)})}}}},ie=(r={})=>{const l=U(),o=V(X,r);return{...o,mutate:async(N,b)=>{const{onSuccess:c,onError:u,mutationOptions:f}=b;try{await v.promise(o.mutateAsync(N,f),{pending:"Actualizando empresa...",success:{render({data:i}){return l.invalidateQueries([w.COMPANIES_LIST]),l.invalidateQueries([w.COMPANY_DETAILS,i==null?void 0:i.id]),C(c)&&c(i),"Se actualizó la empresa con éxito"}}})}catch(i){const d=D(i,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");C(u)&&u(d),v.error(d,{type:L(i)})}}}},te=({adminCompanyUsers:r,costCenters:l,onSuccess:o,company:s})=>{const{mutate:N,isLoading:b}=ae(),{mutate:c,isLoading:u}=ie(),f=G().shape({fiscalName:p().trim().required("Es necesario el nombre fiscal"),rfc:p().trim().required("Es necesario el rfc"),commercialName:p().trim().max(100,"Máximo 100 caracteres"),adminUsers:I().when("method",{is:j.ADMIN_USERS,then:a=>a.min(1,"Es necesario al menos un usuario administrador asignado a la empresa"),otherwise:a=>I()}),adminName:p().trim().when("method",{is:j.NEW_ADMIN_USER,then:a=>a.required("Es necesario el nombre del administrador"),otherwise:a=>p().trim()}),adminLastName:p().trim().when("method",{is:j.NEW_ADMIN_USER,then:a=>a.required("Es necesario los apellidos del administrador"),otherwise:a=>p().trim()}),adminEmail:p().trim().email("Ingrese un correo valido").when("method",{is:j.NEW_ADMIN_USER,then:a=>a.required("Es necesario el correo del administrador"),otherwise:a=>p().trim().email("Ingrese un correo valido")}),adminPhone:p().trim(),hasViaboCard:K(),costCenters:I()}),i=H({initialValues:{fiscalName:(s==null?void 0:s.fiscalName)||"",commercialName:(s==null?void 0:s.commercialName)||"",rfc:(s==null?void 0:s.rfc)||"",method:j.ADMIN_USERS,adminUsers:(r==null?void 0:r.filter(a=>{var h;return(h=s==null?void 0:s.adminUsers)==null?void 0:h.includes(a==null?void 0:a.value)}))||[],costCenters:(l==null?void 0:l.filter(a=>{var h;return(h=s==null?void 0:s.costCenters)==null?void 0:h.includes(a==null?void 0:a.value)}))||[],adminName:"",adminLastName:"",adminEmail:"",adminPhone:"",hasViaboCard:!1},enableReinitialize:!0,validationSchema:f,onSubmit:(a,{setSubmitting:h,setFieldValue:le})=>{const P=se(a);return s?c({...P,id:s==null?void 0:s.id},{onSuccess:()=>{o(),h(!1)},onError:()=>{h(!1)}}):N(P,{onSuccess:()=>{o(),h(!1)},onError:()=>{h(!1)}})}}),{isSubmitting:d,setFieldValue:F,values:g,setTouched:T,resetForm:q}=i,n=d||b||u,A=O();return e.jsx(ee,{formik:i,children:e.jsxs(t,{spacing:2,children:[e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre Fiscal",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(E,{inputProps:{maxLength:"18"},required:!0,name:"fiscalName",size:"small",disabled:n,placeholder:"Nombre Fiscal de la Empresa..."})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["RFC",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),s?e.jsx(m,{variant:"subtitle1",children:g==null?void 0:g.rfc}):e.jsx(E,{required:!0,name:"rfc",size:"small",placeholder:"RFC de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre Comercial"}),e.jsx(E,{name:"commercialName",size:"small",placeholder:"Nombre Comercial de la Empresa...",disabled:n})]}),e.jsx(t,{children:e.jsxs(W,{disabled:n,children:[e.jsx(B,{id:"demo-row-radio-buttons-group-label",children:"Seleccione al administrador de la empresa:"}),e.jsxs(k,{value:g.method,onChange:a=>{q(),F("method",a.target.value),T({},!1)},row:!0,"aria-labelledby":"demo-row-radio-buttons-group-label",name:"row-radio-buttons-group",children:[e.jsx(_,{value:j.ADMIN_USERS,control:e.jsx(R,{}),label:"Administrador de Empresa Existente"}),e.jsx(_,{value:j.NEW_ADMIN_USER,control:e.jsx(R,{}),label:"Nuevo Administrador de Empresa"})]})]})}),g.method===j.ADMIN_USERS?e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Usuarios Administradores",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(z,{multiple:!0,name:"adminUsers",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:r||[],disabled:n})]}):e.jsxs(e.Fragment,{children:[e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Nombre (s)",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(E,{name:"adminName",size:"small",required:!0,placeholder:"Nombre Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsxs(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Apellido (s)",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(E,{name:"adminLastName",size:"small",required:!0,placeholder:"Apellidos del Administrador de la Empresa...",disabled:n})]}),e.jsxs(t,{flexDirection:{md:"row"},gap:2,children:[e.jsxs(t,{spacing:1,flex:1,children:[e.jsxs(m,{type:"email",paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Correo",e.jsx(S,{component:"span",color:"error.main",ml:.5,children:"*"})]}),e.jsx(E,{name:"adminEmail",size:"small",required:!0,placeholder:"admin.company@domino.com...",InputProps:{startAdornment:e.jsx(M,{position:"start",children:e.jsx(Q,{})})},disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),e.jsx(E,{name:"adminPhone",type:"tel",size:"small",placeholder:"55 5555 5555",InputProps:{startAdornment:e.jsx(M,{position:"start",children:e.jsx(Y,{})})},disabled:n})]})]})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Centros de Costos"}),e.jsx(z,{multiple:!0,name:"costCenters",textFieldParams:{placeholder:"Seleccionar ...",size:"small"},options:l||[],disabled:n})]}),e.jsxs(t,{spacing:1,children:[e.jsx(m,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Servicios"}),e.jsxs(t,{justifyContent:"space-between",flexDirection:"row",alignItems:"center",children:[e.jsx(Z,{disabledEffect:!0,visibleByDefault:!0,alt:"logo",src:y,sx:{maxWidth:150,width:100,filter:(A==null?void 0:A.palette.mode)==="dark"?"brightness(0) invert(1) grayscale(100%)":"none"}}),e.jsx(re,{disabled:b,size:"md",color:g.hasViaboCard?"success":"error",checked:!!g.hasViaboCard||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{F("hasViaboCard",!g.hasViaboCard)}})]})]}),e.jsx(t,{sx:{pt:1},children:e.jsx($,{size:"large",loading:n,variant:"contained",color:"primary",fullWidth:!0,type:"submit",children:s?"Actualizar":"Crear"})})]})})};te.propTypes={adminCompanyUsers:x.array,company:x.shape({adminUsers:x.array,commercialName:x.string,costCenters:x.array,fiscalName:x.string,id:x.any,rfc:x.string}),costCenters:x.array,onSuccess:x.func};export{te as default};
//# sourceMappingURL=SpeiNewCompanyForm-KDHjIWAw.js.map
