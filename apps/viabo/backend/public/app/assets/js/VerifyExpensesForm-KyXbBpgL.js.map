{"version":3,"file":"VerifyExpensesForm-KyXbBpgL.js","sources":["../../../../../frontend/src/app/business/shared/services/SharedCardRepository.js","../../../../../frontend/src/app/business/shared/hooks/useVerifyExpensesMovements.js","../../../../../frontend/src/app/business/shared/adapters/verify-expenses-adapter.js"],"sourcesContent":["import { axios } from '@/shared/interceptors'\r\n\r\nexport const verifyExpenses = async expenses => {\r\n  const { data } = await axios.post('/api/card/add/receipt', expenses)\r\n  return data\r\n}\r\n","import { useMutation, useQueryClient } from '@tanstack/react-query'\r\nimport { toast } from 'react-toastify'\r\n\r\nimport { DASHBOARD_MASTER_KEYS } from '../../dashboard-master/adapters/dashboardMasterKeys'\r\nimport { CARDS_COMMERCES_KEYS } from '../../viabo-card/cards/adapters'\r\nimport { verifyExpenses } from '../services'\r\n\r\nimport { getErrorAPI, getNotificationTypeByErrorCode } from '@/shared/interceptors'\r\nimport { isFunction } from '@/shared/utils'\r\n\r\nexport const useVerifyExpensesMovements = (options = {}) => {\r\n  const client = useQueryClient()\r\n  const verify = useMutation({\r\n    mutationFn: verifyExpenses,\r\n    ...options\r\n  })\r\n  const mutate = async (formData, options) => {\r\n    const { onSuccess, onError, ...mutationOptions } = options\r\n\r\n    try {\r\n      await toast.promise(verify.mutateAsync(formData, mutationOptions), {\r\n        pending: 'Comprobando movimientos ...',\r\n        success: {\r\n          render({ data }) {\r\n            client.invalidateQueries([DASHBOARD_MASTER_KEYS.MOVEMENTS])\r\n            client.invalidateQueries([CARDS_COMMERCES_KEYS.CARD_MOVEMENTS])\r\n            isFunction(onSuccess) && onSuccess(data)\r\n            return 'Se creó la comprobación con éxito'\r\n          }\r\n        }\r\n      })\r\n    } catch (error) {\r\n      const errorFormatted = getErrorAPI(\r\n        error,\r\n        `No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas`\r\n      )\r\n      isFunction(onError) && onError(errorFormatted)\r\n      toast.error(errorFormatted, {\r\n        type: getNotificationTypeByErrorCode(error)\r\n      })\r\n    }\r\n  }\r\n\r\n  return {\r\n    ...verify,\r\n    mutate\r\n  }\r\n}\r\n","export const VerifyExpensesAdapter = (data, movements) => {\r\n  const { files, note, method, singleFile } = data\r\n\r\n  const isInvoice = method === 'invoice'\r\n  const formData = new FormData()\r\n\r\n  if (isInvoice) {\r\n    files?.forEach(file => {\r\n      formData.append('files[]', file)\r\n    })\r\n  }\r\n\r\n  if (!isInvoice && singleFile) {\r\n    formData.append('files[]', singleFile)\r\n  }\r\n\r\n  const movementsAdapted =\r\n    movements?.map(movement => ({\r\n      ...movement?.original\r\n    })) || []\r\n\r\n  formData.append('movements', JSON.stringify(movementsAdapted))\r\n  formData.append('note', note)\r\n  formData.append('isInvoice', isInvoice)\r\n\r\n  return formData\r\n}\r\n"],"names":["verifyExpenses","expenses","data","axios","useVerifyExpensesMovements","options","client","useQueryClient","verify","useMutation","formData","onSuccess","onError","mutationOptions","toast","DASHBOARD_MASTER_KEYS","CARDS_COMMERCES_KEYS","isFunction","error","errorFormatted","getErrorAPI","getNotificationTypeByErrorCode","VerifyExpensesAdapter","movements","files","note","method","singleFile","isInvoice","file","movementsAdapted","movement"],"mappings":"i0BAEO,MAAMA,GAAiB,MAAMC,GAAY,CAC9C,KAAM,CAAE,KAAAC,CAAI,EAAK,MAAMC,EAAM,KAAK,wBAAyBF,CAAQ,EACnE,OAAOC,CACT,ECKaE,GAA6B,CAACC,EAAU,KAAO,CAC1D,MAAMC,EAASC,EAAgB,EACzBC,EAASC,EAAY,CACzB,WAAYT,GACZ,GAAGK,CACP,CAAG,EA4BD,MAAO,CACL,GAAGG,EACH,OA7Ba,MAAOE,EAAUL,IAAY,CAC1C,KAAM,CAAE,UAAAM,EAAW,QAAAC,EAAS,GAAGC,CAAiB,EAAGR,EAEnD,GAAI,CACF,MAAMS,EAAM,QAAQN,EAAO,YAAYE,EAAUG,CAAe,EAAG,CACjE,QAAS,8BACT,QAAS,CACP,OAAO,CAAE,KAAAX,GAAQ,CACf,OAAAI,EAAO,kBAAkB,CAACS,EAAsB,SAAS,CAAC,EAC1DT,EAAO,kBAAkB,CAACU,EAAqB,cAAc,CAAC,EAC9DC,EAAWN,CAAS,GAAKA,EAAUT,CAAI,EAChC,mCACR,CACF,CACT,CAAO,CACF,OAAQgB,EAAO,CACd,MAAMC,EAAiBC,EACrBF,EACA,8FACD,EACDD,EAAWL,CAAO,GAAKA,EAAQO,CAAc,EAC7CL,EAAM,MAAMK,EAAgB,CAC1B,KAAME,EAA+BH,CAAK,CAClD,CAAO,CACF,CACF,CAKA,CACH,ozCC/CO,MAAMI,GAAwB,CAACpB,EAAMqB,IAAc,CACxD,KAAM,CAAE,MAAAC,EAAO,KAAAC,EAAM,OAAAC,EAAQ,WAAAC,CAAY,EAAGzB,EAEtC0B,EAAYF,IAAW,UACvBhB,EAAW,IAAI,SAEjBkB,IACFJ,GAAA,MAAAA,EAAO,QAAQK,GAAQ,CACrBnB,EAAS,OAAO,UAAWmB,CAAI,CACrC,IAGM,CAACD,GAAaD,GAChBjB,EAAS,OAAO,UAAWiB,CAAU,EAGvC,MAAMG,GACJP,GAAA,YAAAA,EAAW,IAAIQ,IAAa,CAC1B,GAAGA,GAAA,YAAAA,EAAU,QACd,MAAM,CAAE,EAEX,OAAArB,EAAS,OAAO,YAAa,KAAK,UAAUoB,CAAgB,CAAC,EAC7DpB,EAAS,OAAO,OAAQe,CAAI,EAC5Bf,EAAS,OAAO,YAAakB,CAAS,EAE/BlB,CACT"}