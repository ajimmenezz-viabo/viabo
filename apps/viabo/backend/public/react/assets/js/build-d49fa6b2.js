import{j as r,B as C,t as I,P as l,S as a,i as b,T as c,a as M,n as S,E as z,Q as P,g as T,o as R,r as B,F as H,b as L,G as O,H as w,J as _,K as $,N,O as A,L as Q,R as W,f as D,U as K}from"./build-de786878.js";import{V as U}from"./build-899176f2.js";import{u as X}from"./build-32dc6f9b.js";import{L as Y,F as G,M as E}from"./build-76de0576.js";import{a as J}from"./build-7fe00976.js";import{c as Z,a as g}from"./build-aaf0c156.js";import{g as k,a as y}from"./build-d8214ca6.js";import{f as ee}from"./build-035a2ea4.js";import{R as j}from"./build-164dffeb.js";import{M as re}from"./build-9bb40bad.js";import{I as f}from"./build-0d6223af.js";import{C as oe}from"./build-18a0257d.js";import{V as te}from"./build-37e047f9.js";import{P as ne}from"./build-ad762a34.js";import{E as ae}from"./build-d0939168.js";import{D as se}from"./build-c965bfa6.js";import"./build-8e48d587.js";import"./build-bee6630b.js";import"./build-dd25d9e2.js";import"./build-c4f9fdf5.js";const ie=({sx:e,color:o})=>r.jsx(C,{sx:{display:"flex",width:50,height:50,alignItems:"center",...e},children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 999 323.68",children:r.jsx("path",{d:"M651.185.5c-70.933 0-134.322 36.766-134.322 104.694 0 77.9 112.423 83.28 112.423 122.415 0 16.478-18.884 31.229-51.137 31.229-45.773 0-79.984-20.611-79.984-20.611l-14.638 68.547s39.41 17.41 91.734 17.41c77.552 0 138.576-38.572 138.576-107.66 0-82.316-112.89-87.537-112.89-123.86 0-12.91 15.501-27.053 47.662-27.053 36.286 0 65.892 14.99 65.892 14.99l14.326-66.204S696.614.5 651.185.5zM2.218 5.497.5 15.49s29.842 5.461 56.719 16.356c34.606 12.492 37.072 19.765 42.9 42.353l63.51 244.832h85.138L379.927 5.497h-84.942L210.707 218.67l-34.39-180.696c-3.154-20.68-19.13-32.477-38.685-32.477H2.218zm411.865 0L347.449 319.03h80.999l66.4-313.534h-80.765zm451.759 0c-19.532 0-29.88 10.457-37.474 28.73L709.699 319.03h84.942l16.434-47.468h103.483l9.994 47.468H999.5L934.115 5.497h-68.273zm11.047 84.707 25.178 117.653h-67.454L876.89 90.204z",style:{fill:"#1434cb",fillOpacity:1,stroke:"none"}})})}),ce=I(r.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"}),"Lock"),le=I(r.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),de=[{id:"6",color:"warning"},{id:"7",color:"success"}],ue=e=>{var o;return((o=de.find(n=>(n==null?void 0:n.id)===e))==null?void 0:o.color)??"info"},V=({details:e})=>{var o,n;return r.jsx(a,{children:r.jsxs(b,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[r.jsx(C,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:r.jsx("img",{src:U,alt:"viabo-logo"})}),r.jsxs(a,{alignItems:"center",justifyContent:"center",spacing:3,children:[r.jsx(Y,{variant:"ghost",color:ue((o=e==null?void 0:e.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(n=e==null?void 0:e.status)==null?void 0:n.name}),r.jsxs(a,{alignItems:"center",justifyContent:"center",children:[r.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[r.jsxs(c,{variant:"h2",children:[" ",e==null?void 0:e.amount]}),r.jsx(c,{variant:"caption",children:"MXN"})]}),r.jsxs(a,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(le,{}),r.jsx(c,{variant:"subtitle1",textTransform:"capitalize",children:e==null?void 0:e.name})]})]}),r.jsx(c,{textAlign:"center",variant:"body2",children:e==null?void 0:e.description})]})]})})};V.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,status:l.shape({id:l.any,name:l.any})})};const he=(e,o)=>{var u,h;const n=(u=e==null?void 0:e.expiration)==null?void 0:u.slice(-2),s=((h=e==null?void 0:e.expiration)==null?void 0:h.slice(0,3))+n,d={paymentId:o==null?void 0:o.id,name:e==null?void 0:e.name,phone:e==null?void 0:e.phone,cardNumber:e==null?void 0:e.cardNumber.replace(/\s+/g,""),expirationDate:s,cvv:e==null?void 0:e.cvv};return k(d)},q={INFO:"payment-link-info"},me=e=>{const o=y(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:ee(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName}};throw new Error("Algo fallo al obtenerla informacion de la liga de pago")},xe=async e=>{const{data:o}=await M.get(`/api/commerces/pay/${e}`);return me(o)},pe=async e=>{const{data:o}=await M.post("/api/commerce/pay/transaction",e);return o},ge=(e,o={})=>{const n=S(pe,o),s=z();return{...n,mutate:async(u,h)=>{const{onSuccess:p,onError:m,mutationOptions:x}=h;try{await P.promise(n.mutateAsync(u,x),{pending:"Realizando cargo ...",success:{render({data:t}){return s.invalidateQueries([q.INFO,e]),p(t),"Se realizo el pago con éxito"}}})}catch(t){const i=T(t,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");m(i),P.error(i,{type:R(t)})}}}},je=(e,o={})=>{const[n,s]=B.useState(null),d=H();return{...L([q.INFO,e],()=>xe(e),{staleTime:6e4,onError:h=>{const p=T(h,"No se puede obtener la informacion de la liga de pago");s(p),d("/404")},...o}),error:n||null}},F=({details:e})=>{const{mutate:o}=ge(e==null?void 0:e.id),n=Z().shape({cardNumber:g().transform((t,i)=>i.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:g().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(t){const i=O(`01/${t}`,"dd/MM/yyyy",new Date),v=new Date;return w(i)&&_(i,v)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El telefono es muy corto",t=>!(t&&t.replace(/[\s+]/g,"").length<10)).required("El telefono es requerido")}),s=X({initialValues:{cardNumber:"",expiration:"",cvv:"",name:"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""},enableReinitialize:!0,validationSchema:n,onSubmit:(t,{setSubmitting:i})=>{const v=he(t,e);o(v,{onSuccess:()=>{i(!1)},onError:()=>{i(!1)}})}}),{errors:d,touched:u,isSubmitting:h,setFieldValue:p,values:m}=s,x=h;return r.jsx(G,{formik:s,children:r.jsxs(a,{spacing:3,children:[r.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[r.jsx(c,{variant:"h6",children:"Forma de Pago"}),r.jsx(b,{sx:{px:1},children:r.jsx(re,{sx:{width:30,height:30}})}),r.jsx(b,{sx:{px:1},children:r.jsx(ie,{sx:{width:30,height:30}})})]}),r.jsxs(a,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),r.jsx(j,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(oe,{})}),inputComponent:E,inputProps:{mask:"0000 0000 0000 0000",value:m.cardNumber,onAccept:t=>{p("cardNumber",t)}}},disabled:x})]}),r.jsxs(a,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[r.jsxs(a,{flex:1,spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),r.jsx(se,{disabled:x,views:["year","month"],name:"expiration",value:m!=null&&m.expiration?new Date(m.expiration):null,required:!0,onChange:t=>w(t)?s.setFieldValue("expiration",$(t,"MM/yyyy")):s.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(u.expiration&&d.expiration),required:!0,helperText:u.expiration&&d.expiration?d.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),r.jsxs(a,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),r.jsx(j,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(te,{})}),inputComponent:E,inputProps:{mask:"000",onAccept:t=>{p("cvv",t)},value:m.cvv}},disabled:x})]})]}),r.jsxs(a,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),r.jsx(j,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:x,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(ne,{})})}})]}),r.jsxs(a,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),r.jsx(j,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:x,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(ae,{})})}})]}),r.jsxs(a,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),r.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:m.phone,disabled:x,required:!0,onChange:(t,i)=>{p("phone",t)},error:u.phone&&!!d.phone,helperText:u.phone&&d.phone})]}),r.jsxs(c,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",r.jsx(N,{component:A,underline:"always",target:"_blank",color:"info.main",children:"Terminos y condiciones"}),"  &  ",r.jsx(N,{component:A,underline:"always",target:"_blank",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),r.jsx(a,{children:r.jsx(Q,{loading:h,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:r.jsx(ce,{}),children:"Pagar"})})]})})};F.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const Oe=()=>{var s;const{paymentId:e}=W(),{data:o,isLoading:n}=je(e,{enabled:!!e});return r.jsx(D,{title:"Cobro",children:r.jsx(C,{component:"main",height:1,m:0,p:0,children:r.jsxs(a,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[n&&r.jsx(K,{}),!n&&o&&r.jsxs(a,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,children:[r.jsx(V,{details:o}),((s=o==null?void 0:o.status)==null?void 0:s.id)==="6"&&r.jsx(F,{details:o})]})]})})})};export{Oe as default};
