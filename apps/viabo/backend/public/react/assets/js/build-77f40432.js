import{t as E,j as e,av as k,r as h,_ as N,B as j,a7 as _,S as y,R as F,L as A,K as C,ax as P,a as w,b as B,g as H,aB as J,aC as X,aD as v,Q as m,o as ss,c as V,ad as W,T as S,a8 as es,Z as ts,a9 as as,P as x,ab as rs,a6 as is,af as ns,ai as os,aj as cs,aO as ds,l as ls,ak as R,f as hs,al as ps,am as us,an as xs}from"./index-50a35d25.js";import{A as fs}from"./build-d82fba51.js";import{n as M,m as ys,E as gs,C as js,H as Ss}from"./build-d6ad7469.js";import{f as $,L as bs}from"./build-88f4df1c.js";import{b as Ts,A as Cs,a as Is,C as Ls}from"./build-74e9df7c.js";import{D as Es}from"./build-aa9601fe.js";import{C as ws}from"./build-564ea1ee.js";import{S as Ms}from"./build-9237d033.js";import{L as Os,S as _s,a as Ds,b as As,c as O,d as z}from"./build-ffa8ef83.js";import"./build-63cd1a66.js";import{I as Ps}from"./build-773241b5.js";import{I as Rs}from"./build-8fc2a6fe.js";import{S as zs}from"./build-646e3364.js";const ks=E(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),U=E(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8.46 14.45l-1.36-.62c.28-.61.41-1.24.4-1.86-.01-.63-.14-1.24-.4-1.8l1.36-.63c.35.75.53 1.56.54 2.4.01.86-.17 1.7-.54 2.51zm3.07 1.56-1.3-.74c.52-.92.78-1.98.78-3.15 0-1.19-.27-2.33-.8-3.4l1.34-.67c.64 1.28.96 2.65.96 4.07 0 1.43-.33 2.74-.98 3.89zm3.14 1.32-1.35-.66c.78-1.6 1.18-3.18 1.18-4.69 0-1.51-.4-3.07-1.18-4.64l1.34-.67c.9 1.78 1.34 3.56 1.34 5.31 0 1.74-.44 3.54-1.33 5.35z"}),"ContactlessSharp"),Ns=E(e.jsx("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"}),"Link"),Fs=E(e.jsx("path",{d:"M17 2H7c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 4H7V4h10v2zm3 16H4c-1.1 0-2-.9-2-2v-1h20v1c0 1.1-.9 2-2 2zm-1.47-11.81C18.21 9.47 17.49 9 16.7 9H7.3c-.79 0-1.51.47-1.83 1.19L2 18h20l-3.47-7.81zM9.5 16h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm3 4h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5zm0-2h-1c-.28 0-.5-.22-.5-.5s.22-.5.5-.5h1c.28 0 .5.22.5.5s-.22.5-.5.5z"}),"PointOfSale"),Bs=k(h.lazy(()=>N(()=>import("./build-0e315181.js"),["assets/js/build-0e315181.js","assets/js/index-50a35d25.js","assets/css/build-f63bc8fe.css","assets/js/build-be6de154.js","assets/js/build-63cd1a66.js","assets/js/build-d6377163.js","assets/js/build-5c8192a4.js","assets/js/build-8fc2a6fe.js","assets/js/build-fd3d2130.js","assets/js/build-f93cbd2b.js","assets/js/build-ff52c786.js","assets/js/build-773241b5.js","assets/js/build-88f4df1c.js","assets/js/build-bee6630b.js","assets/js/build-1bdddf61.js","assets/js/build-f3dc9301.js","assets/js/build-cadb01fa.js","assets/js/build-564ea1ee.js","assets/js/build-d6ad7469.js","assets/js/build-cf29b9e5.js","assets/js/build-74e9df7c.js","assets/js/build-d82fba51.js","assets/js/build-aa9601fe.js","assets/js/build-47360967.js","assets/js/build-a339460d.js","assets/js/build-1ac975b6.js","assets/js/build-9237d033.js","assets/js/build-ffa8ef83.js","assets/js/build-646e3364.js"]))),Hs=k(h.lazy(()=>N(()=>import("./build-bdb55591.js"),["assets/js/build-bdb55591.js","assets/js/index-50a35d25.js","assets/css/build-f63bc8fe.css","assets/js/build-63cd1a66.js","assets/js/build-d6377163.js","assets/js/build-5c8192a4.js","assets/js/build-8fc2a6fe.js","assets/js/build-fd3d2130.js","assets/js/build-f93cbd2b.js","assets/js/build-ff52c786.js","assets/js/build-773241b5.js","assets/js/build-88f4df1c.js","assets/js/build-bee6630b.js","assets/js/build-74daf15f.js","assets/js/build-57c276cc.js","assets/js/build-4508dc39.js","assets/js/build-80e7e62a.js","assets/js/build-1bdddf61.js","assets/js/build-f3dc9301.js","assets/js/build-e1fe4ff8.js","assets/js/build-a339460d.js","assets/js/build-1ac975b6.js","assets/js/build-cadb01fa.js","assets/js/build-564ea1ee.js","assets/js/build-d6ad7469.js","assets/js/build-cf29b9e5.js","assets/js/build-d82fba51.js","assets/js/build-74e9df7c.js","assets/js/build-aa9601fe.js","assets/js/build-47360967.js","assets/js/build-9237d033.js","assets/js/build-ffa8ef83.js","assets/js/build-646e3364.js"]))),Vs=()=>{const[a,t]=h.useState(!1),[s,i]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(j,{sx:{mb:2},children:e.jsx(_,{children:e.jsxs(y,{direction:"row",divider:e.jsx(F,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:3},spacing:1,children:[e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(A,{startIcon:e.jsx(Ns,{}),variant:"contained",color:"info",onClick:()=>t(!0),children:"Liga de Pago"})}),e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(A,{startIcon:e.jsx(fs,{}),color:"info",variant:"contained",onClick:()=>i(!0),children:"Terminal Virtual"})})]})})}),a&&e.jsx(Bs,{open:a,setOpen:t}),s&&e.jsx(Hs,{open:s,setOpen:i})]})},Q={LIST:"commerce-terminals",MOVEMENTS:"terminal-movements"},Ws=a=>(a==null?void 0:a.map(t=>{var s,i,n,o;return{id:t==null?void 0:t.id,commerceId:t==null?void 0:t.commerceId,terminalId:t==null?void 0:t.terminalId,terminalON:((s=t==null?void 0:t.apiData)==null?void 0:s.status)===1,country:(i=t==null?void 0:t.apiData)==null?void 0:i.country,date:{created:(n=t==null?void 0:t.apiData)==null?void 0:n.created_at,updated:(o=t==null?void 0:t.apiData)==null?void 0:o.updated_at,register:t==null?void 0:t.registerDate},isVirtual:(t==null?void 0:t.typeId)==="1",name:(t==null?void 0:t.name)!==""?t==null?void 0:t.name.toString().toUpperCase():`TERMINAL-${t==null?void 0:t.terminalId}`,active:(t==null?void 0:t.active)==="1",balanceFormatted:$("0")}}))||[],$s=a=>{var t;return((t=a==null?void 0:a.movements)==null?void 0:t.map(s=>{const i=parseFloat((s==null?void 0:s.amount)||"0"),n=s!=null&&s.transaction_date?C(M(s==null?void 0:s.transaction_date),"dd MMM yyyy",{locale:P}):"",o=s!=null&&s.transaction_date?C(M(s==null?void 0:s.transaction_date),"p"):"";return{id:s==null?void 0:s.id,amount:i,amountFormat:$(i),approved:s==null?void 0:s.approved,authNumber:(s==null?void 0:s.authorization_number)===""?"-":s==null?void 0:s.authorization_number,cardType:s==null?void 0:s.card_brand,cardNumber:s==null?void 0:s.card_number,cardBank:s==null?void 0:s.issuer,referenceNumber:s==null?void 0:s.reference,transactionDate:{fullDate:C(M(s==null?void 0:s.transaction_date),"dd MMM yyyy HH:mm",{locale:P}),date:n,time:o},description:`${(s==null?void 0:s.issuer)===""?s==null?void 0:s.card_brand:s==null?void 0:s.issuer}-${s==null?void 0:s.card_number}`.toUpperCase(),transactionMessage:s==null?void 0:s.result_message}}))??[]},Us=async()=>{const{data:a}=await w.get("/api/commerces/terminals");return Ws(a)},fe=async a=>{const{data:t}=await w.post("/api/commerce/pay/new",a);return t},ye=async a=>{const{data:t}=await w.post("/api/commerce/virtual/pay",a);return t},Qs=async(a,t,s)=>{const{data:i}=await w.get(`/api/commerces-pay/transactions?fromDate=${t}&toDate=${s}&terminalId=${a}`);return $s(i)},Ks=(a={})=>{const[t,s]=h.useState(null);return{...B([Q.LIST],Us,{staleTime:6e4,refetchOnMount:"always",onError:n=>{const o=H(n,"No se puede obtener la lista de terminales del comercio. Intente nuevamente o reporte a sistemas");s(o)},...a}),error:t||null}},qs=(a,t,s={})=>{ys[J(t)];const i=X(t),n=v(t),o=C(i,"yyyy-MM-dd"),p=C(n,"yyyy-MM-dd"),[d,c]=h.useState(null);return{...B([Q.MOVEMENTS,a],({signal:r})=>Qs(a,o,p),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:r=>{const u=H(r,"No se puede obtener la lista de movimientos de la terminal. Intente nuevamente o reporte a sistemas");c(u),m.error(u,{type:ss(r)})},...s}),error:d||null}},Gs={terminal:null},Ys=(a,t)=>({...Gs,setTerminal:s=>{const{terminal:i}=t();a(n=>({terminal:{...i,...s}}),!1,"SET_TERMINAL_SELECTED")},resetTerminal:()=>{a(s=>({pos:null}),!1,"RESET_TERMINAL_SELECTED")},addTerminalInfo:s=>{const{terminal:i}=t();a(n=>({terminal:{...i,...s}}),!1,"SET_TERMINAL_INFO")}}),L=V(Ys),Zs={terminals:[],isOpenList:!1,isCollapse:!1},Js=(a,t)=>({...Zs,setTerminals:s=>{a(i=>({terminals:s}),!1,"SET_TERMINAL")},setOpenList:s=>{a(i=>({isOpenList:s}),!1,"SET_OPEN_LIST")},setCollapse:s=>{a(i=>({isCollapse:s}),!1,"SET_COLLAPSE")}}),f=V(Js),Xs=()=>{const[a,t]=h.useState(new Date),s=L(c=>c.terminal),{data:i,isFetching:n,refetch:o,isError:p}=qs(s==null?void 0:s.terminalId,a,{enabled:!!(s!=null&&s.terminalId)});h.useEffect(()=>{o()},[a]),h.useEffect(()=>{t(new Date)},[s==null?void 0:s.id]);const d=[{name:"description",label:"Descripción",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c],u=r==null?void 0:r.approved;return e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(j,{sx:{position:"relative"},children:[e.jsx(W,{sx:{width:40,height:40,color:"text.secondary",bgcolor:"background.neutral"},children:e.jsx(Cs,{width:25,height:25})}),e.jsx(j,{sx:{right:0,bottom:0,width:15,height:15,display:"flex",borderRadius:"50%",position:"absolute",alignItems:"center",color:"common.white",bgcolor:"error.main",justifyContent:"center",...u&&{bgcolor:"success.main"}},children:u?e.jsx(Is,{sx:{width:12,height:12}}):e.jsx(ks,{sx:{width:12,height:12}})})]}),e.jsxs(j,{sx:{ml:2},children:[e.jsxs(S,{variant:"subtitle2",children:[" ",r==null?void 0:r.description]}),e.jsx(S,{variant:"body2",textTransform:"capitalize",sx:{color:u?"success.main":"error.main"},children:r==null?void 0:r.transactionMessage})]})]})}}},{name:"cardType",label:"Tarjeta",options:{filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(S,{variant:"body2",children:r==null?void 0:r.cardType})}}},{name:"authNumber",label:"Autorización",options:{filterType:"textField",customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(S,{variant:"subtitle2",children:r==null?void 0:r.authNumber})}}},{name:"referenceNumber",label:"Referencia",options:{filterType:"textField",customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(S,{variant:"subtitle2",children:r==null?void 0:r.referenceNumber})}}},{name:"transactionDate.fullDate",label:"Fecha",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{var u,I;const r=i[c];return e.jsxs(y,{children:[e.jsx(S,{variant:"subtitle2",children:(u=r==null?void 0:r.transactionDate)==null?void 0:u.date}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary"},children:(I=r==null?void 0:r.transactionDate)==null?void 0:I.time})]})}}},{name:"amountFormat",label:"Cantidad",options:{filterType:"textField",filterOptions:{fullWidth:!0},customBodyRenderLite:(c,l)=>{const r=i[c];return e.jsx(S,{variant:"subtitle2",fontWeight:"bold",children:r==null?void 0:r.amountFormat})}}}];return e.jsxs(ws,{children:[e.jsx(Ts,{currentMonth:a,setCurrentMonth:t,isLoading:n}),e.jsx(F,{sx:{borderStyle:"dashed"}}),e.jsx(Es,{title:"Movimientos",data:i||[],columns:d,isLoading:n,options:{responsive:"simple",rowHover:!0,selectableRows:"none",selectableRowsOnClick:!1,selectToolbarPlacement:"replace",sortOrder:{name:"date",direction:"desc"},downloadOptions:{filename:`movimientos_terminal_${s==null?void 0:s.name}.csv`,filterOptions:{useDisplayedColumnsOnly:!1}}}})]})},vs=()=>{const a=L(t=>t.terminal);return e.jsxs(y,{sx:t=>({pl:{xs:0,lg:2},overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[a&&e.jsxs(_,{children:[(a==null?void 0:a.isVirtual)&&e.jsx(Vs,{}),e.jsx(y,{pt:0,pb:4,px:2,children:e.jsx(Xs,{})})]}),!a&&e.jsxs(y,{spacing:3,sx:{height:"100%",width:"100%"},children:[e.jsx(es,{variant:"filled",severity:"info",children:"Debe seleccionar una terminal para ver sus detalles!"}),e.jsx(y,{alignItems:"center",children:e.jsx(Ms,{sx:{width:"30%"}})})]})]})},ms=ts(as)(({theme:a})=>({borderRadius:"8px!important",width:1,justifyContent:"center",display:"flex",alignItems:"center",mb:1})),K=({terminal:a})=>{const t=f(d=>d.isOpenList),s=f(d=>d.setOpenList),i=L(d=>d.setTerminal),n=L(d=>d.terminal);(a==null?void 0:a.id)===(n==null?void 0:n.id)&&n&&(n==null||n.cardON);const o=(a==null?void 0:a.id)===(n==null?void 0:n.id),p=d=>{var l;!((l=d.target)==null?void 0:l.type)&&!o&&(i(a),s(!1))};return e.jsx(rs,{title:a==null?void 0:a.name,arrow:!0,placement:"right",children:e.jsx(bs,{sx:{mb:1,padding:0,borderRadius:1,"& :hover":{color:"text.primary"}},disablePadding:!0,children:e.jsxs(ms,{onClick:p,sx:{...o&&{bgcolor:"secondary.light",color:"black","& :hover":{color:"text.primary"}},"& :hover":{color:"text.primary"},width:1,py:1,gap:1},children:[e.jsx(Os,{sx:{ml:2,m:0},children:e.jsx(j,{sx:{position:"relative"},children:e.jsx(W,{sx:d=>({width:32,height:32,m:0,backgroundColor:d.palette.primary.main,"& :hover":{color:"white"}}),children:a!=null&&a.isVirtual?e.jsx(U,{sx:{width:20,height:20,color:"white"}}):e.jsx(Fs,{sx:{width:16,height:16,color:"white"}})})})}),t&&e.jsx(e.Fragment,{children:e.jsx(y,{sx:{width:1},children:e.jsx(S,{noWrap:!0,variant:"subtitle2",children:a==null?void 0:a.name})})})]})})})};K.propTypes={terminal:x.shape({alias:x.any,id:x.any,isVirtual:x.any,name:x.any})};const q=({terminalsQuery:a,sx:t,...s})=>{const{isLoading:i,data:n,error:o,isError:p,refetch:d}=a,c=f(r=>r.isOpenList),l=f(r=>r.terminals);return p&&c&&!n&&!i?e.jsx(is,{errorMessage:o,handleButton:d}):n&&c&&(n==null?void 0:n.length)===0&&!i?e.jsx(gs,{pt:2.5,message:"No hay terminales activas para este comercio"}):e.jsx(ns,{disablePadding:!0,sx:t,...s,children:(i?[...Array(12)]:l).map((r,u)=>r!=null&&r.id?e.jsx(K,{terminal:r},r==null?void 0:r.id):e.jsx(_s,{isOpenSideBar:c},u))})};q.propTypes={sx:x.any,terminalsQuery:x.shape({data:x.array,error:x.any,isError:x.any,isLoading:x.any,refetch:x.any})};const G=({commerceTerminals:a=[]})=>{const t=f(g=>g.isOpenList),s=f(g=>g.setOpenList),i=f(g=>g.setTerminals),n=f(g=>g.terminals),o=f(g=>g.isCollapse),[p,d]=h.useState(""),[c,l]=h.useState(!1),r=async g=>{try{const{value:T}=g.target;if(d(T),T){const Z=(a==null?void 0:a.filter(b=>{var D;return(b==null?void 0:b.name)&&((D=b==null?void 0:b.name)==null?void 0:D.toLowerCase().indexOf(T.toLowerCase()))!==-1}))||[];i(Z)}else i(a)}catch(T){console.error(T)}},u=()=>{t&&(d(""),i(a)),s(!t)},I=()=>{l(!0)},Y=()=>{l(!1)};return h.useEffect(()=>{a&&i(a)},[a]),h.useEffect(()=>{if(!t)return l(!1)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(j,{sx:{p:2,px:0},children:e.jsxs(y,{direction:"row",justifyContent:t?"flex-end":"center",alignItems:"center",spacing:2,children:[!o&&e.jsx(Ls,{onClickAway:Y,children:e.jsx(Ps,{fullWidth:!0,size:"small",value:p,onFocus:I,onChange:r,placeholder:"Buscar Terminales...",InputProps:{startAdornment:e.jsx(Rs,{position:"start",children:e.jsx(zs,{sx:{color:"text.disabled",width:20,height:20}})})}})}),e.jsx(y,{direction:"row",alignItems:"center",justifyContent:"center",children:e.jsx(Ds,{size:"small",sx:{...!t&&{transform:"rotate(180deg)"}},onClick:u,children:os})})]})}),(n==null?void 0:n.length)===0&&(a==null?void 0:a.length)>0&&e.jsx(cs,{sx:{p:1,display:"flex",flexDirection:"column",alignItems:"center"},searchQuery:p})]})};G.propTypes={commerceTerminals:x.array};const se=()=>{const a=f(r=>r.setOpenList),t=f(r=>r.setCollapse),s=f(r=>r.isOpenList),i=Ks(),n=ds(),o=ls("up","md"),p=o&&!s,d=()=>{a(!1)},c=()=>{a(!s)};h.useEffect(()=>{o&&a(!0)},[o]),h.useEffect(()=>{t(p)},[p]);const l=e.jsx(_,{sx:{height:.98},children:e.jsxs(y,{px:s?1:0,children:[e.jsx(G,{commerceTerminals:(i==null?void 0:i.data)||[]}),e.jsx(q,{terminalsQuery:i})]})});return e.jsxs(e.Fragment,{children:[!o&&!s&&e.jsx(As,{onClick:c,children:e.jsx(U,{sx:{width:20,height:20}})}),o?e.jsx(R,{open:s,variant:"persistent",PaperProps:{sx:{height:1,borderRightStyle:"none",bgcolor:"background.default"}},sx:{height:1,width:O,transition:n.transitions.create("width"),"& .MuiDrawer-paper":{position:"static",backgroundColor:"transparent!important",width:O},...p&&{width:z,"& .MuiDrawer-paper":{width:z,backgroundColor:"transparent!important",position:"static",transform:"none !important",visibility:"visible !important"}}},children:l}):e.jsx(R,{ModalProps:{keepMounted:!0},open:s,onClose:d,sx:{height:1,"& .MuiDrawer-paper":{width:O,p:2}},children:l})]})},ee=()=>e.jsx(hs,{title:"Lista de Terminales Punto de Venta",children:e.jsx(js,{children:e.jsxs(j,{display:"flex",overflow:"hidden",sx:{height:"100vH",maxHeight:"100%",flexDirection:"column"},children:[e.jsx(j,{px:1,children:e.jsx(Ss,{name:"Terminales Punto de Venta",links:[{name:"Inicio",href:ps.root},{name:"Administracion",href:us.terminals},{name:xs.terminals.name}]})}),e.jsxs(j,{display:"flex",overflow:"hidden",sx:{flex:"1 1 0%"},children:[e.jsx(j,{display:"block",width:1,position:"absolute"}),e.jsx(se,{}),e.jsx(vs,{})]})]})})}),ge=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"}));export{Ns as L,ge as P,fe as c,ye as g,L as u};
