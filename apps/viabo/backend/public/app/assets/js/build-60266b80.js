import{z as N,j as r,aj as z,N as H,aL as F,G as u,K as g,ai as A,H as E,J as S,r as n,d as B,g as R,Q as K,b as U,O as p,B as M,a1 as k,a2 as W,T as h,S as _,C as $,_ as Q,P as Y,ab as G,aH as J,aI as X}from"./index-f4730562.js";import{f as L}from"./build-1099c20e.js";import{n as x,a as Z,H as v}from"./build-aef0dee4.js";import{g as m}from"./build-c0513ca7.js";import{A as aa}from"./build-d4068e4b.js";import{C as sa}from"./build-606e80d3.js";import{C as ra}from"./build-ed0f56d6.js";import{s as ia,a as ta}from"./build-45cdb2cd.js";import{M as ea}from"./build-a28a65d2.js";import{u as ca}from"./build-42fbf954.js";import{C as la}from"./build-f505b767.js";const da=N(r.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"}),"Payment"),na={openDrawerLiquidateMovement:!1,movement:null,filterDate:null},oa=(t,s)=>({...na,setMovementToLiquidate:a=>{t(e=>({movement:a}),!1,"SET_DETAILS_MOVEMENT_TO_LIQUIDATE")},setOpenDrawerLiquidateMovement:a=>{t(e=>({openDrawerLiquidateMovement:a}),!1,"SET_OPEN_LIQUIDATE_MOVEMENT_VIABO_PAY")},setFilterDate:a=>{t(e=>({filterDate:a}),!1,"SET_FILTER_DATE_LIQUIDATE_MOVEMENTS")}}),T=z(oa);function ua(t){const{row:s,closeMenu:a}=t,{original:e}=s,{setMovementToLiquidate:i,setOpenDrawerLiquidateMovement:c}=T(y=>y);return[r.jsxs(H,{onClick:()=>{i(e),c(!0),a()},sx:{m:0},children:[r.jsx(F,{children:r.jsx(da,{color:"success"})}),"Liquidar"]},0)]}const pa={MOVEMENTS:"liquidated-viabo-pay-movements"},ha=t=>(t==null?void 0:t.map(a=>{const e=parseFloat((a==null?void 0:a.amount)||"0"),i=a!=null&&a.transaction_date?u(x(a==null?void 0:a.transaction_date),"dd MMM yyyy",{locale:g}):"",c=a!=null&&a.transaction_date?u(x(a==null?void 0:a.transaction_date),"p"):"";return{id:a==null?void 0:a.id,terminalName:a==null?void 0:a.terminal_name,terminalId:a==null?void 0:a.terminal_id,amount:e,amountFormat:L(e),amountToLiquidate:a==null?void 0:a.amountToSettled,amountToLiquidateFormat:L(a==null?void 0:a.amountToSettled),commerceName:a==null?void 0:a.commerceName,commerceId:a==null?void 0:a.commerceId,approved:a==null?void 0:a.approved,cardType:a==null?void 0:a.card_brand,authNumber:a==null?void 0:a.authorization_number,commission:(a==null?void 0:a.commission)>=0?`${a==null?void 0:a.commission}%`:"0%",cardNumber:a==null?void 0:a.card_number,cardBank:a==null?void 0:a.issuer,transactionDate:{fullDate:u(x(a==null?void 0:a.transaction_date),"dd MMM yyyy HH:mm",{locale:g}),date:i,time:c},serverDate:x(a==null?void 0:a.transaction_date),description:`${(a==null?void 0:a.issuer)===""?a==null?void 0:a.card_brand:a==null?void 0:a.issuer}-${a==null?void 0:a.card_number}`.toUpperCase(),transactionMessage:a==null?void 0:a.result_message,conciliated:!!(a!=null&&a.conciliated),conciliatedName:a!=null&&a.conciliated?"Conciliada":"Sin Conciliar",dataToLiquidate:{id:a==null?void 0:a.id,commerceId:a==null?void 0:a.commerceId,authorization_number:a==null?void 0:a.authorization_number,terminal_id:a==null?void 0:a.terminal_id,terminal_spei_card:(a==null?void 0:a.terminal_spei_card)||"",amountToSettled:a==null?void 0:a.amountToSettled}}}))??[],ya=async(t,s,a)=>{const e=new URL("/api/terminals/shared/transactions",window.location.origin);e.searchParams.set("startDate",t),e.searchParams.set("endDate",s);const{data:i}=await A.get(e.href,{signal:a});return ha(i)},qa=async t=>{const{data:s}=await A.post("/api/card/transactions/shared-terminals",t);return s},Ma=(t,s,a={})=>{if(!t||!s)return null;const{setFilterDate:e}=T(d=>d),i=u(E(t),"yyyy-MM-dd HH:mm:ss"),c=u(S(s),"yyyy-MM-dd HH:mm:ss"),[o,y]=n.useState(null),l=B({queryKey:[pa.MOVEMENTS],queryFn:({signal:d})=>ya(i,c,d),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,onSuccess:d=>{e({startDate:E(t),endDate:S(s),text:`${u(t,"dd MMMM yyyy",{locale:g})} - ${u(s,"dd MMMM yyyy",{locale:g})}`})},...a});return n.useEffect(()=>{if(l!=null&&l.isError){const d=R(l.error,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");y(d),K.error(d,{type:U(l.error)})}},[l.isError,l.error]),{...l,error:o||null}},P=({row:t})=>{const{original:s}=t,a=s==null?void 0:s.approved,e=m(s==null?void 0:s.cardType),i=e==null?void 0:e.component;return r.jsxs(M,{sx:{display:"flex",alignItems:"center"},children:[r.jsxs(M,{sx:{position:"relative"},children:[r.jsx(k,{title:s==null?void 0:s.cardType,children:r.jsx(W,{sx:{width:40,height:40,color:"text.secondary",bgcolor:"background.neutral"},children:e?r.jsx(i,{sx:{width:25,height:25}}):r.jsx(aa,{width:25,height:25})})}),r.jsx(M,{sx:{right:0,bottom:0,width:15,height:15,display:"flex",borderRadius:"50%",position:"absolute",alignItems:"center",color:"common.white",bgcolor:"error.main",justifyContent:"center",...a&&{bgcolor:"success.main"}},children:a?r.jsx(sa,{sx:{width:12,height:12}}):r.jsx(ra,{sx:{width:12,height:12}})})]}),r.jsxs(M,{sx:{ml:2},children:[r.jsx(h,{variant:"subtitle2",sx:{textWrap:"wrap"},children:s==null?void 0:s.description}),r.jsx(h,{variant:"body2",textTransform:"capitalize",sx:{color:a?"success.main":"error.main",textWrap:"wrap"},children:s==null?void 0:s.transactionMessage})]})]})};P.propTypes={row:p.shape({original:p.shape({approved:p.bool,cardType:p.any,description:p.any,transactionMessage:p.any})})};const xa=()=>n.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({row:t})=>r.jsx(P,{row:t})},{accessorKey:"terminalName",header:"Terminal",size:120,Cell:({cell:t,column:s,row:a,renderedCellValue:e})=>{const{original:i}=a;return r.jsx(h,{fontWeight:"bold",variant:"subtitle2",children:i==null?void 0:i.terminalName})}},{accessorKey:"commerceName",header:"Comercio",size:120},{accessorKey:"serverDate",header:"Fecha",size:100,Cell:({cell:t,column:s,row:a,renderedCellValue:e})=>{var c;const{original:i}=a;return r.jsx(_,{children:r.jsx(h,{variant:"subtitle2",children:(c=i==null?void 0:i.transactionDate)==null?void 0:c.fullDate})})}},{accessorKey:"amount",header:"Monto Cobrado",size:120,Cell:({cell:t,column:s,row:a,renderedCellValue:e})=>{const{original:i}=a;return r.jsx(_,{children:r.jsx(h,{fontWeight:"bold",variant:"subtitle2",children:i==null?void 0:i.amountFormat})})}},{accessorKey:"amountToLiquidate",header:"Monto por liquidar",size:120,Cell:({cell:t,column:s,row:a,renderedCellValue:e})=>{const{original:i}=a;return r.jsx(_,{children:r.jsx(h,{fontWeight:"bold",color:"success.main",variant:"subtitle2",children:i==null?void 0:i.amountToLiquidateFormat})})}}],[]),ga=()=>{const t=new Date,s=T(b=>b.filterDate),a=n.useMemo(()=>s!=null&&s.startDate?new Date(s==null?void 0:s.startDate):ia(t,{days:30}),[s==null?void 0:s.startDate]),e=n.useMemo(()=>s!=null&&s.endDate?new Date(s==null?void 0:s.endDate):t,[s==null?void 0:s.endDate]),[i,c]=n.useState(a),[o,y]=n.useState(e),{data:l,isError:d,error:D,isLoading:I,isFetching:f,refetch:q}=Ma(i,o);n.useEffect(()=>{i&&o&&q()},[i,o]);const O=xa(),V=ca(d,D,{columns:O,data:l||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:I,showAlertBanner:d,showProgressBars:f},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderRowActionMenuItems:ua,renderTopToolbarCustomActions:()=>r.jsx(M,{})}),w=b=>{const{startDate:C,endDate:j}=b;j!==null&&C!==null&&(y(j),c(C))};return r.jsxs(la,{children:[r.jsx(ta,{startDate:i,endDate:o,onChangeDateRange:w,hideBalance:!0,loading:f}),r.jsx(ea,{table:V})]})},ba=$(n.lazy(()=>Q(()=>import("./build-9857b607.js"),["assets/js/build-9857b607.js","assets/js/index-f4730562.js","assets/css/build-a4b698a0.css","assets/js/build-de29ea3a.js","assets/js/build-f505b767.js","assets/js/build-aad0e5f9.js","assets/js/build-e75f6e8d.js","assets/js/build-1099c20e.js","assets/js/build-4c648b6f.js","assets/js/build-aef0dee4.js","assets/js/build-c573209c.js","assets/js/build-1d4535c6.js","assets/js/build-c0513ca7.js","assets/js/build-b04fd233.js","assets/js/build-835e1d30.js","assets/js/build-d4068e4b.js","assets/js/build-606e80d3.js","assets/js/build-ed0f56d6.js","assets/js/build-45cdb2cd.js","assets/js/build-a28a65d2.js","assets/js/build-0fd5ede1.js","assets/js/build-1c8d8107.js","assets/js/build-2b64884d.js","assets/js/build-d07194a5.js","assets/js/build-c035a370.js","assets/js/build-dc931114.js","assets/js/build-a6ffd79e.js","assets/js/build-42fbf954.js"]))),_a=()=>r.jsx(Y,{title:"Movimientos a Liquidar Viabo Pay",children:r.jsxs(Z,{children:[r.jsx(v,{name:"Nube",links:[{name:"Inicio",href:G.root},{name:"Viabo Pay",href:J.cloud},{name:X.cloud.name}]}),r.jsx(ga,{}),r.jsx(ba,{})]})}),Oa=Object.freeze(Object.defineProperty({__proto__:null,default:_a},Symbol.toStringTag,{value:"Module"}));export{pa as C,Oa as a,qa as l,T as u};
