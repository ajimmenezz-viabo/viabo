import{t as ue,j as e,a7 as pe,n as xe,a8 as H,g as me,o as he,r as S,ad as Y,B as de,S as x,T as v,d as W,ai as Z,ak as J,a_ as C,L as ee,a9 as fe}from"./build-9dc23fd9.js";import{t as je,u as z}from"./build-f03635ad.js";import{R as k}from"./build-1517a09b.js";import{R as be}from"./build-3fc32b88.js";import{u as se,d as ge}from"./build-d9d6fc9b.js";import{F as te,M as re}from"./build-c86a048d.js";import{c as P,b as Se,a as oe}from"./build-8545d663.js";import{g as ve,C as B}from"./build-ba3c1f3e.js";import{C as D}from"./build-c7ce8ef2.js";import{A as ye}from"./build-64074d19.js";import{S as ne}from"./build-56520632.js";import{g as Ie}from"./build-f50814e2.js";import{c as we}from"./build-3a6bce7a.js";import{C as Ae}from"./build-91f0622b.js";import{T as Ee,a as K}from"./build-4d835f96.js";import"./build-25455e46.js";import"./build-dea445ee.js";import"./build-36a6d1aa.js";import"./build-b4c8111a.js";import"./build-6306e52f.js";import"./build-b1913ba4.js";import"./build-b8eff164.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";import"./build-7ce00c67.js";import"./build-041f94ad.js";const Re=ue(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete"),ae=(f,o,r)=>{var n,c,p;const{transactions:s}=o;let t;return r?t={originCardId:f,destinationCards:[{cardId:(n=o==null?void 0:o.card)==null?void 0:n.value.toString(),concept:(c=o==null?void 0:o.concept)==null?void 0:c.toString(),amount:parseFloat((o==null?void 0:o.amount.toString())===""?"0":(p=o==null?void 0:o.amount)==null?void 0:p.toString().replace(/,/g,"")).toString()}]}:t={originCardId:f,destinationCards:s==null?void 0:s.map(a=>{var l,h,j,d;return{cardId:(h=(l=a==null?void 0:a.card)==null?void 0:l.value)==null?void 0:h.toString(),concept:(j=a==null?void 0:a.concept)==null?void 0:j.toString(),amount:parseFloat((a==null?void 0:a.amount.toString())===""?"0":(d=a==null?void 0:a.amount)==null?void 0:d.toString().replace(/,/g,"")).toString()}})},{cardId:t==null?void 0:t.originCardId,data:ve(t)}},le=(f={})=>{const o=pe(),r=xe(je,f);return{...r,transaction:async(t,n)=>{const{onSuccess:c,onError:p,mutationOptions:a}=n;try{await H.promise(r.mutateAsync(t,a),{pending:"Procesando Transferencia ...",success:{render({data:l}){return o.fetchQuery([D.TRANSIT_BALANCE]),o.invalidateQueries([D.CARD_INFO,l==null?void 0:l.cardId]),o.fetchQuery([D.CARD_MOVEMENTS,l==null?void 0:l.cardId]),o.fetchQuery([D.MAIN_CARD]),c(l),"Se realizo la transferencia con Ã©xito"}}})}catch(l){const h=me(l,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");p(h),H.error(h,{type:he(l)})}}}};function X({cards:f,balance:o,setCurrentBalance:r,insufficient:s,cardOriginId:t,setOpen:n,isBinCard:c,setTransactionLoading:p}){const a=S.useRef(null),[l,h]=S.useState(f),{transaction:j,isLoading:d}=le(),m=z(u=>u==null?void 0:u.selectedCards);S.useEffect(()=>{if(m&&c){const u=m==null?void 0:m.map(i=>({...i,isDisabled:!0}));h(u)}},[m,c]);const I=P().shape({transactions:Se().of(P().shape({amount:oe().required("La cantidad es requerida"),card:P().nullable().required("La tarjeta es requerida")}))}),b=se({initialValues:{transactions:(m==null?void 0:m.length)>0&&c&&(m==null?void 0:m.map(u=>({id:Math.random(),card:{value:u==null?void 0:u.value,label:u==null?void 0:u.label,...u},amount:"",concept:""})))||[{id:1,card:null,amount:"",concept:""}]},validationSchema:I,onSubmit:u=>{if(s)return M(!1);const i=ae(t,u);console.log(i),p(!0),j(i,{onSuccess:()=>{M(!1),n(!1),p(!1)},onError:()=>{M(!1),p(!1)}})}}),{isSubmitting:y,setFieldValue:w,values:g,setSubmitting:M}=b,R=y||d;return e.jsx(e.Fragment,{children:e.jsx(Y,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(te,{formik:b,children:e.jsxs(de,{sx:{p:3},children:[e.jsxs(x,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[e.jsx(v,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),e.jsx(x,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!c&&e.jsx(W,{type:"button",size:"small",variant:"outlined",startIcon:e.jsx(ye,{}),disabled:R,onClick:()=>a.current.push({id:Math.random(),card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Nueva"})]}),e.jsx(ge,{name:"transactions",render:u=>(a.current=u,e.jsx(x,{divider:e.jsx(Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:g==null?void 0:g.transactions.map((i,T)=>{var V,_,$,Q,G,L;const q=`transactions[${T}].card`,F=`transactions[${T}].amount`,ie=`transactions[${T}].concept`;return e.jsxs(x,{alignItems:"flex-end",spacing:1.5,children:[((_=(V=i==null?void 0:i.card)==null?void 0:V.assignUser)==null?void 0:_.name)&&e.jsx(B,{avatar:e.jsx(J,{...C(((Q=($=i==null?void 0:i.card)==null?void 0:$.assignUser)==null?void 0:Q.name)??"")}),label:(L=(G=i==null?void 0:i.card)==null?void 0:G.assignUser)==null?void 0:L.name}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[e.jsx(v,{variant:"overline",color:"text.disabled",children:T+1}),e.jsx(be,{name:q,disabled:R||c,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:l||[],onChange:(N,A)=>{const ce=l==null?void 0:l.map(E=>{var O,U;return!(A!=null&&A.value)&&E.value===((O=i==null?void 0:i.card)==null?void 0:O.value)?{...E,isDisabled:!1}:E.value===(A==null?void 0:A.value)?{...E,isDisabled:!0}:E.value===((U=i==null?void 0:i.card)==null?void 0:U.value)?{...E,isDisabled:!1}:E});h(ce),w(q,A)},sx:{width:{xs:1,lg:.6}}}),e.jsx(k,{sx:{width:{xs:1,lg:.4}},size:"small",name:F,required:!0,label:"Cantidad",placeholder:"0.00",disabled:R,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:re,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:i.amount,onAccept:N=>{r((parseFloat(o)-parseFloat(N===""?"0":N.replace(/,/g,""))).toFixed(2)),w(F,N)}}}})]}),e.jsx(x,{sx:{width:1},children:e.jsx(k,{name:ie,multiline:!0,disabled:R,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),T!==0&&!c&&e.jsx(W,{size:"small",color:"error",disabled:R,startIcon:e.jsx(Re,{}),onClick:()=>u.remove(T),children:"Borrar"})]},i.id)})}))}),e.jsx(Z,{sx:{my:3,borderStyle:"dashed"}}),e.jsx(x,{sx:{px:3,pt:3},children:e.jsx(ee,{variant:"contained",color:"primary",loading:R,fullWidth:!0,type:"submit",startIcon:e.jsx(ne,{}),children:"Enviar"})})]})})})})}function Te({balance:f,setCurrentBalance:o,insufficient:r,cardOriginId:s,setOpen:t,mainCard:n,setTransactionLoading:c}){const{transaction:p,isLoading:a}=le(),l=P().shape({amount:oe().required("La cantidad es requerida")}),h=se({initialValues:{card:n?{label:n==null?void 0:n.label,value:n==null?void 0:n.id}:null,amount:"",concept:""},validationSchema:l,onSubmit:(b,{setSubmitting:y})=>{if(r)return y(!1);const w=ae(s,b,!0);c(!0),p(w,{onSuccess:()=>{y(!1),t(!1),c(!1)},onError:()=>{y(!1),c(!1)}})}}),{isSubmitting:j,setFieldValue:d,values:m}=h,I=j||a;return e.jsx(Y,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(te,{formik:h,children:e.jsxs(x,{sx:{p:3},spacing:1,children:[e.jsx(x,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",justifyContent:"center",children:e.jsx(B,{icon:e.jsx(Ae,{}),label:n==null?void 0:n.cardNumberHidden})}),e.jsx(x,{children:e.jsx(k,{sx:{width:1},size:"small",name:"amount",required:!0,label:"Cantidad",placeholder:"0.00",disabled:I,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:re,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:m.amount,onAccept:b=>{o((parseFloat(f)-parseFloat(b===""?"0":b.replace(/,/g,""))).toFixed(2)),d("amount",b)}}}})}),e.jsx(x,{sx:{width:1},children:e.jsx(k,{name:"concept",multiline:!0,disabled:I,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),e.jsx(x,{sx:{px:3,pt:3},children:e.jsx(ee,{variant:"contained",color:"primary",loading:I,fullWidth:!0,type:"submit",startIcon:e.jsx(ne,{}),children:"Enviar"})})]})})})}function ss({open:f,setOpen:o,isFundingCard:r}){var y,w;const s=z(g=>g.card),t=z(g=>g.mainCard),n=fe([D.CARDS_COMMERCE_LIST])||[],[c,p]=S.useState(r?t==null?void 0:t.balance:s==null?void 0:s.balance),[a,l]=S.useState("1"),[h,j]=S.useState(!1),d=S.useMemo(()=>c<0,[c]);S.useEffect(()=>{r||p(s==null?void 0:s.balance)},[s==null?void 0:s.balance,r]),S.useEffect(()=>{r&&p(t==null?void 0:t.balance)},[t==null?void 0:t.balance,r]);const m=S.useMemo(()=>n==null?void 0:n.filter(g=>g.id!==(s==null?void 0:s.id)),[n,s==null?void 0:s.id]),I=()=>{p(r?t==null?void 0:t.balance:s==null?void 0:s.balance),o(!1)},b=(g,M)=>{l(M)};return e.jsxs(we,{open:f,handleClose:I,titleElement:r?e.jsx(v,{variant:"h6",children:"Fondear"}):e.jsxs(x,{children:[e.jsxs(x,{spacing:1,alignItems:"center",direction:"row",children:[e.jsx(v,{variant:"subtitle2",children:"Origen: "}),e.jsxs(v,{variant:"subtitle2",children:[s==null?void 0:s.cardNumberMoreDigits," "]})]}),e.jsx(B,{avatar:e.jsx(J,{...C(((y=s==null?void 0:s.assignUser)==null?void 0:y.name)??"")}),label:(w=s==null?void 0:s.assignUser)==null?void 0:w.name})]}),children:[!r&&e.jsx(x,{alignItems:"flex-end",sx:{py:1,px:3},children:e.jsxs(Ee,{size:"small",color:"primary",value:a,exclusive:!0,onChange:b,"aria-label":"Platform",disabled:h,children:[e.jsx(K,{value:"1",children:"Tarjetas"}),e.jsx(K,{value:"2",children:"Global"})]})}),e.jsxs(x,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,py:r?3:1,children:[e.jsx(v,{variant:"subtitle1",children:"Saldo"}),e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(v,{variant:"h3",color:d?"error":"success.main",children:Ie(c)}),e.jsx(v,{variant:"caption",color:d?"error":"success.main",children:"MXN"})]}),d&&e.jsx(v,{variant:"caption",color:"warning.main",textAlign:"center",children:"No cuenta con suficiente saldo para realizar la(s) operacion(es)"})]}),r&&e.jsx(X,{cards:r?n:m,balance:r?t==null?void 0:t.balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:r?t==null?void 0:t.id:s==null?void 0:s.id,setOpen:o,isBinCard:r,setTransactionLoading:j}),!r&&e.jsxs(e.Fragment,{children:[a==="1"&&e.jsx(X,{cards:r?n:m,balance:r?t==null?void 0:t.balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:r?t==null?void 0:t.id:s==null?void 0:s.id,setOpen:o,isBinCard:r,setTransactionLoading:j}),a==="2"&&e.jsx(Te,{mainCard:t,balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:s==null?void 0:s.id,setOpen:o,setTransactionLoading:j})]})]})}export{ss as default};
