import{r as c,t as le,j as e,b as _,g as N,u as ce,E as K,n as de,o as ue,T as b,S as x,Z,P as m,a2 as he,a3 as xe,O as me,d as W,B as v,C as fe,a4 as pe,U as J,a5 as z,a6 as L,a7 as ge,a8 as je,a9 as Ce,aa as Se,ab as be,ac as ye,ad as we,ae as ve,af as Ie,k as Ee,l as Me,ag as De,ah as Pe,ai as Re,aj as $,f as Ae,ak as ke,al as Oe,am as Le}from"./index-4b99f413.js";import{C as A}from"./build-c7ce8ef2.js";import{g as Ne,a as Fe,c as Be,u as p,C as Te,b as He,d as _e,e as ze,f as Ve,G as Ge,h as Qe,F as We}from"./build-5c422c79.js";import{C as $e}from"./build-c930eafb.js";import{S as qe}from"./build-bb0265ab.js";import{C as Ye}from"./build-72c8723e.js";import"./build-fe021a1f.js";import{u as Xe}from"./build-0364ace1.js";import{S as Ke}from"./build-61129e69.js";import{A as Ze,L as Je}from"./build-79240b72.js";import{G as B}from"./build-eac152ed.js";import{C as Ue,E as q,a as et,H as tt}from"./build-92d12e9a.js";import{M as st}from"./build-b8fe6533.js";import{C as nt}from"./build-9367c53e.js";import{L as rt,S as it,a as ot,b as at,c as T,d as Y}from"./build-50dfc6ea.js";import{s as lt}from"./build-9563ddbe.js";import{L as ct,I as dt}from"./build-7a1aa18c.js";import"./build-3a8905b3.js";import{s as ut}from"./build-f8fc243b.js";import{C as ht}from"./build-ececd30c.js";import{I as xt}from"./build-4c42a69c.js";import{S as mt}from"./build-1b6c7885.js";import{C as ft}from"./build-0a41abf6.js";import"./build-2009f55b.js";import"./build-31b96a33.js";import"./build-09eafbeb.js";import"./build-70e42481.js";import"./build-8ea1e281.js";import"./build-b66547c6.js";import"./build-e656a6c5.js";import"./build-42939910.js";import"./build-2c3cdb47.js";import"./build-ecaf0d13.js";import"./build-41005266.js";import"./build-bee6630b.js";import"./build-cae86eed.js";function pt(t){const[n,o]=c.useState((t==null?void 0:t.defaultDense)||!1),[a,d]=c.useState((t==null?void 0:t.defaultOrderBy)||"name"),[i,s]=c.useState((t==null?void 0:t.defaultOrder)||"asc"),[r,u]=c.useState((t==null?void 0:t.defaultCurrentPage)||0),[h,M]=c.useState((t==null?void 0:t.defaultRowsPerPage)||5),[l,w]=c.useState((t==null?void 0:t.defaultSelected)||[]);return{dense:n,order:i,page:r,setPage:u,orderBy:a,rowsPerPage:h,selected:l,setSelected:w,resetSelected:()=>{w((t==null?void 0:t.defaultSelected)||[])},onSelectRow:f=>{const C=l.indexOf(f);let S=[];C===-1?S=S.concat(l,f):C===0?S=S.concat(l.slice(1)):C===l.length-1?S=S.concat(l.slice(0,-1)):C>0&&(S=S.concat(l.slice(0,C),l.slice(C+1))),w(S)},onSelectAllRows:(f,C)=>{if(f){w(C);return}w([])},onSort:f=>{f!==""&&(s(a===f&&i==="asc"?"desc":"asc"),d(f))},onChangePage:(f,C)=>{u(C)},onChangeDense:f=>{o(f.target.checked)},onChangeRowsPerPage:f=>{M(parseInt(f.target.value,10)),u(0)}}}const X=le(e.jsx("path",{d:"M2 17h20v2H2v-2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48 1.3.75zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7l-.85 1.48zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23v-1.5z"}),"PasswordTwoTone"),gt=(t,n={})=>{const[o,a]=c.useState(null);return{..._([A.CARDS_COMMERCE_LIST],()=>Ne(t),{staleTime:6e4,refetchOnMount:"always",onError:i=>{const s=N(i,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");a(s)},...n}),error:o||null}},jt=(t,n={})=>{const[o,a]=c.useState(null);return{..._([A.CARD_INFO,t],({signal:i})=>Fe(t,i),{staleTime:6e4,onError:i=>{const s=N(i,"No se puede obtener la informacion de la tarjeta. Intente nuevamente o reporte a sistemas");a(s)},refetchOnWindowFocus:!1,...n}),error:o||null}},Ct=(t={})=>{const{enqueueSnackbar:n}=ce(),[o,a]=c.useState(null),d=K();return{...de(Be,{onSuccess:s=>{a(null),d.refetchQueries([A.CARD_INFO,s==null?void 0:s.id]),n(s!=null&&s.cardON?"Se encendió la tarjeta con éxito":"Se apagó la tarjeta con éxito",{variant:"success",autoHideDuration:5e3})},onError:s=>{const r=N(s,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");n(r,{variant:ue(s),autoHideDuration:5e3}),a(r)},...t}),error:o||null}};function St(){const t=p(o=>o.card),{assignUser:n}=t;return e.jsxs($e,{sx:{p:3},children:[e.jsx(b,{variant:"h6",gutterBottom:!0,children:"Asignado a:"}),e.jsxs(x,{spacing:3,children:[e.jsxs(x,{justifyContent:"space-between",gap:1,children:[e.jsx(b,{variant:"subtitle2",sx:{color:"text.secondary"},textTransform:"capitalize",children:"Nombre"}),e.jsx(b,{variant:"body2",children:n==null?void 0:n.name})]}),(n==null?void 0:n.phone)&&e.jsxs(x,{justifyContent:"space-between",gap:1,children:[e.jsx(b,{variant:"subtitle2",sx:{color:"text.secondary"},children:"Telefono"}),e.jsx(b,{variant:"body2",children:(n==null?void 0:n.phone)||"-"})]}),e.jsxs(x,{justifyContent:"space-between",gap:1,children:[e.jsx(b,{variant:"subtitle2",sx:{color:"text.secondary"},children:"Correo"}),e.jsx(b,{variant:"body2",children:n==null?void 0:n.email})]})]})]})}const bt=Z(t=>e.jsx(qe,{focusVisibleClassName:".Mui-focusVisible",disableRipple:!0,...t}))(({theme:t})=>({width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:t.palette.mode==="dark"?"#2ECA45":"#65C466",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:t.palette.mode==="light"?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:26/2,backgroundColor:t.palette.error.main,opacity:1,transition:t.transitions.create(["background-color"],{duration:500})}}));function U({card:t}){const[n,o]=c.useState(!1),[a,d]=c.useState(!1),{mutate:i,isLoading:s}=Ct(),r=Xe([A.CARD_INFO,t==null?void 0:t.id])===1;c.useEffect(()=>{o(!1),d(!1)},[t==null?void 0:t.id]);const u=h=>{i({...t,cardON:!(t!=null&&t.cardON)})};return e.jsx(he,{sx:h=>({borderRadius:1,position:"relative",zIndex:1,backgroundColor:h.palette.primary.light,color:"white",minHeight:"auto!important",height:{xs:1,sm:"auto"},py:{xs:0,sm:2}}),children:e.jsxs(x,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(x,{flexDirection:"column",spacing:0,alignItems:{xs:"center",md:"start"},children:[e.jsxs(x,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(b,{variant:"subtitle2",children:"Disponible"}),s||r?e.jsx(xe,{size:30,containerProps:{display:"flex",ml:1}}):e.jsx(bt,{disabled:s,color:t!=null&&t.cardON?"success":"error",checked:(t==null?void 0:t.cardON)||!1,onChange:u,sx:{m:1},inputProps:{"aria-label":"controlled"}})]}),e.jsxs(x,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(b,{variant:"h3",children:t==null?void 0:t.balanceFormatted}),e.jsx(b,{variant:"caption",children:"MXN"})]})]}),e.jsxs(x,{justifyContent:"flex-end",spacing:1,alignItems:{xs:"center",md:"end"},children:[e.jsx(Ye,{card:t,color:"#fff"}),e.jsxs(x,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",gap:1,divider:e.jsx(me,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),children:[e.jsx(b,{color:"#fff",variant:"subtitle2",children:t==null?void 0:t.expiration}),e.jsx(W,{startIcon:n?e.jsx(H,{handleFinish:()=>o(!1)}):e.jsx(X,{}),color:"inherit",onClick:()=>o(h=>!h),sx:{px:0,mx:0},children:n?e.jsx(x,{px:1,children:t==null?void 0:t.cvv}):"CVV"}),e.jsx(W,{startIcon:a?e.jsx(H,{handleFinish:()=>d(!1)}):e.jsx(X,{}),color:"inherit",onClick:()=>d(h=>!h),children:a?e.jsx(x,{px:1,children:t==null?void 0:t.nip}):"NIP"})]})]})]})})}U.propTypes={card:m.shape({balanceFormatted:m.any,cardON:m.bool,cvv:m.any,expiration:m.any,id:m.any,nip:m.any})};function H({handleFinish:t,duration:n=10}){const[o,a]=c.useState(100);return c.useEffect(()=>{let d;return o>0?d=setInterval(()=>{a(i=>i-100/n)},1e3):t(),()=>clearInterval(d)},[o,n]),e.jsxs(v,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(fe,{variant:"determinate",value:o}),e.jsx(v,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(b,{variant:"caption",component:"div",color:"text.primary",children:`${Math.ceil(n*o/100)} `})})]})}H.propTypes={duration:m.number,handleFinish:m.func};function yt(){const t=p(u=>u.card),n=p(u=>u.addInfoCard),{data:o,isLoading:a,isError:d,error:i,refetch:s}=jt(t==null?void 0:t.id,{enabled:!!(t!=null&&t.id)}),{isCollapse:r}=pe();return c.useEffect(()=>{o&&n(o)},[o]),e.jsx(x,{sx:u=>({pl:{xs:0,sm:2,lg:2},overflow:"hidden",flexDirection:"column",flexGrow:1}),children:e.jsxs(Ze,{children:[a&&t&&e.jsx(J,{}),d&&!o&&!a&&e.jsx(z,{sx:{justifyContent:"flex-start"},errorMessage:i,handleButton:s}),t&&!a&&!d&&o&&e.jsxs(e.Fragment,{children:[e.jsx(L.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsxs(x,{sx:u=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(U,{card:t}),e.jsx(Te,{})]})}),e.jsx(v,{sx:{overflowY:"auto"},children:e.jsx(L.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsx(x,{pt:2,pb:4,px:2,children:e.jsxs(B,{container:!0,spacing:3,sx:{p:0,pb:3},children:[e.jsx(B,{item:!0,xs:12,sm:12,md:12,lg:r?4:12,xl:4,children:e.jsxs(x,{spacing:3,children:[e.jsx(He,{}),e.jsx(_e,{}),e.jsx(St,{})]})}),e.jsx(B,{item:!0,xs:12,sm:12,md:12,lg:r?8:12,xl:8,children:e.jsx(ze,{})})]})})})})]}),!t&&e.jsx(L.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsxs(x,{spacing:3,sx:{height:"100%",width:"100%"},children:[e.jsx(ge,{variant:"filled",severity:"info",children:"Debe seleccionar una tarjeta para ver sus detalles!"}),e.jsx(x,{alignItems:"center",children:e.jsx(Ke,{sx:{width:"30%"}})})]})})]})})}const wt=Z(je)(({theme:t})=>({borderRadius:"8px!important",width:1,justifyContent:"center",display:"flex",alignItems:"center",mb:1}));ee.propTypes={isOpenSidebar:m.bool,selected:m.bool,card:m.object,onSelectRow:m.func,onOpenDetails:m.func};function ee({isOpenSidebar:t,card:n,selected:o,onSelectRow:a,onOpenDetails:d}){const{id:i,cardUserNumber:s,cardType:r}=n,u=p(g=>g.setCard),h=p(g=>g.card),M=p(g=>g.addInfoCard),l=p(g=>g.setSelectedMainCard),w=p(g=>g.isMainCardSelected),y=Ce(),O=(y==null?void 0:y.permissions)??[],j=i===(h==null?void 0:h.id)&&h?(h==null?void 0:h.cardON)===!0?"online":"offline":"invisible",D=i===(h==null?void 0:h.id),P=g=>{var f;!((f=g.target)==null?void 0:f.type)&&!D&&(u(n),w&&l(!1),M({movements:[],expenses:"$0.00",income:"$0.00",balanceMovements:"$0.00"}),d())};return e.jsx(Se,{title:t?"":s,arrow:!0,placement:"right",children:e.jsx(Je,{sx:{mb:1,padding:0,borderRadius:1,"& :hover":{color:"text.primary"}},secondaryAction:t&&O.includes(be.COMMERCE_CARDS)&&e.jsx(nt,{edge:"start",checked:o,onClick:a,inputProps:{"aria-labelledby":i}}),disablePadding:!0,children:e.jsxs(wt,{onClick:P,sx:{...D&&{bgcolor:"secondary.light",color:"black","& :hover":{color:"text.primary"}},"& :hover":{color:"text.primary"},width:1,py:1,gap:1},children:[e.jsx(rt,{sx:{ml:2,m:0},children:e.jsxs(v,{sx:{position:"relative"},children:[e.jsx(ye,{sx:g=>({width:30,height:30,m:0,color:g.palette.primary.contrastText,backgroundColor:g.palette.primary.main}),children:r==="Carnet"?e.jsx(Ue,{sx:{width:20},color:"white"}):e.jsx(st,{sx:{width:20}})}),e.jsx(we,{status:j,sx:{right:0,bottom:0,position:"absolute"}})]})}),t&&e.jsx(e.Fragment,{children:e.jsx(x,{sx:{width:1},children:e.jsx(b,{noWrap:!0,variant:"subtitle2",children:s})})})]})})})}const vt=c.memo(ee);te.propTypes={cards:m.array,isOpenSidebar:m.bool,onOpenDetails:m.func,isLoading:m.bool,sx:m.object};function te({cards:t,isOpenSidebar:n,isLoading:o,sx:a,onOpenDetails:d,...i}){const s=p(l=>l.setSelectedCards),r=p(l=>l.selectedCards,lt),{selected:u,onSelectRow:h,resetSelected:M}=pt();return c.useEffect(()=>{s(u)},[u]),c.useEffect(()=>{(r==null?void 0:r.length)===0&&M()},[r]),e.jsx(ve,{disablePadding:!0,sx:a,...i,children:(o?[...Array(12)]:t).map((l,w)=>l!=null&&l.id?e.jsx(vt,{isOpenSidebar:n,card:l,selected:r==null?void 0:r.some(y=>(y==null?void 0:y.id)===(l==null?void 0:l.id)),onSelectRow:()=>h(l),onOpenDetails:d},l==null?void 0:l.id):e.jsx(it,{isOpenSideBar:n},w))})}function se({cardTypes:t,isLoading:n,isError:o,refetch:a}){const d=p(r=>r.setCardTypeSelected),i=p(r=>r.cardTypeSelected),s=r=>{d(r==null?void 0:r.id)};return e.jsxs(v,{display:"flex",children:[n&&e.jsx(J,{}),o&&!n&&e.jsx(z,{errorMessage:"No existen tipos de tarjetas para este comercio",handleButton:a}),!n&&!o&&(t==null?void 0:t.map(r=>{const u=i===(r==null?void 0:r.id);return e.jsx(L.div,{onClick:()=>s(r),whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsx(ct,{variant:u?"ghost":"filled",color:Ie((r==null?void 0:r.name)||"inherit"),sx:{textTransform:"uppercase",marginRight:1,marginBottom:2,cursor:"pointer",border:u?3:0,borderColor:u?h=>h.palette.primary.main:"inherit"},children:r==null?void 0:r.name})},r==null?void 0:r.id)}))]})}se.propTypes={cardTypes:m.array,isError:m.any,isLoading:m.any,refetch:m.any};const It=(t={})=>{const[n,o]=c.useState(null),a=p(s=>s.setCardTypeSelected),d=p(s=>s.cardTypeSelected);return{..._([A.PAYMENT_PROCESSORS],Ve,{staleTime:6e4,refetchOnMount:"always",onError:s=>{const r=N(s,"No se puede obtener la lista de los tipos de tarjetas. Intente nuevamente o reporte a sistemas");o(r)},onSuccess:s=>{const r=(s==null?void 0:s.find(u=>(u==null?void 0:u.id)==="2"))||Array.isArray(s)&&(s==null?void 0:s.length)>0&&s[0]||null;r&&!d&&a(r==null?void 0:r.id)},...t}),error:n||null}};function Et(){const t=p(I=>{var E;return(E=I.card)==null?void 0:E.id}),n=p(I=>I.cardTypeSelected),{data:o,isLoading:a,isError:d,refetch:i}=It(),{data:s,isLoading:r,isRefetching:u,isError:h,error:M,refetch:l,isSuccess:w}=gt(n,{enabled:!1}),y=r||u,O=Ee(),[j,D]=c.useState(!0),[P,g]=c.useState(""),[R,f]=c.useState(s||[]),[C,S]=c.useState(!1),k=Me("up","md"),ne=P&&C,V=k&&!j;c.useEffect(()=>{n&&l()},[n]),c.useEffect(()=>{if(!k)return F()},[k,t]),c.useEffect(()=>{if(!j)return S(!1)},[j]),c.useEffect(()=>{s&&f(s)},[s]);const F=()=>{D(!1)},G=()=>{D(I=>(I&&(g(""),f(s)),!I))},re=()=>{S(!1)},ie=async I=>{try{const{value:E}=I.target;if(g(E),E){const ae=ut(s,E)||[];f(ae)}else f(s)}catch(E){console.error(E)}},oe=()=>{S(!0)},Q=e.jsxs(e.Fragment,{children:[e.jsxs(x,{children:[j&&e.jsx(se,{cardTypes:o,isLoading:a,isError:d,refetch:i}),!n&&j&&!a&&e.jsx(q,{pt:2.5,message:"Seleccione un tipo de tarjeta para obtener la lista de tarjetas"})]}),n&&!a&&!d&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{openSidebar:j}),e.jsx(v,{sx:{p:2,px:0},children:e.jsxs(x,{direction:"row",justifyContent:j?"flex-end":"center",alignItems:"center",spacing:2,children:[!V&&e.jsx(ht,{onClickAway:re,children:e.jsx(dt,{fullWidth:!0,size:"small",value:P,onFocus:oe,onChange:ie,placeholder:"Buscar Tarjetas...",InputProps:{startAdornment:e.jsx(xt,{position:"start",children:e.jsx(mt,{sx:{color:"text.disabled",width:20,height:20}})})}})}),e.jsx(x,{direction:"row",alignItems:"center",justifyContent:"center",children:e.jsx(ot,{size:"small",sx:{...!j&&{transform:"rotate(180deg)"}},onClick:G,children:De})})]})}),h&&j&&!s&&!y&&e.jsx(z,{errorMessage:M,handleButton:l}),s&&j&&(s==null?void 0:s.length)===0&&!y&&e.jsx(q,{pt:2.5,message:"No hay tarjetas activas en este tipo de tarjeta"}),e.jsx(Pe,{sx:{height:.98},children:e.jsxs(e.Fragment,{children:[e.jsx(te,{isOpenSidebar:j,cards:R||[],isLoading:y,onOpenDetails:F}),ne&&(R==null?void 0:R.length)===0&&(s==null?void 0:s.length)>0&&e.jsx(Re,{sx:{p:1,display:"flex",flexDirection:"column",alignItems:"center"},searchQuery:P})]})})]})]});return e.jsxs(e.Fragment,{children:[!k&&!j&&e.jsx(at,{onClick:G,children:e.jsx(ft,{sx:{width:16,height:16}})}),k?e.jsx($,{open:j,variant:"persistent",PaperProps:{sx:{height:1,borderRightStyle:"none",bgcolor:"background.default"}},sx:{height:1,width:T,transition:O.transitions.create("width"),"& .MuiDrawer-paper":{position:"static",backgroundColor:"transparent!important",width:T},...V&&{width:Y,"& .MuiDrawer-paper":{width:Y,backgroundColor:"transparent!important",position:"static",transform:"none !important",visibility:"visible !important"}}},children:Q}):e.jsx($,{ModalProps:{keepMounted:!0},open:j,onClose:F,sx:{height:1,"& .MuiDrawer-paper":{width:T,p:2}},children:Q})]})}function cs(){const t=p(i=>i==null?void 0:i.selectedCards),n=p(i=>i.isMainCardSelected),o=p(i=>i.setSelectedMainCard),a=p(i=>i.resetCard),d=K();return c.useEffect(()=>()=>{const i=Object.values(A);d.cancelQueries(i)},[]),c.useEffect(()=>{n&&(a(),o(!1))},[n]),e.jsx(Ae,{title:"Lista de Tarjetas",children:e.jsxs(et,{children:[e.jsxs(v,{display:"flex",overflow:"hidden",sx:{height:"100vH",maxHeight:"100%",flexDirection:"column"},children:[e.jsx(v,{px:1,children:e.jsx(tt,{name:"Lista de Tarjetas",links:[{name:"Inicio",href:ke.root},{name:"Administracion",href:Oe.cards},{name:Le.cards.name}]})}),e.jsx(x,{flexDirection:"row",sx:{display:"flex"},children:e.jsx(x,{sx:i=>({overflow:"hidden",flexDirection:"column",flexGrow:1,pb:2}),children:(t==null?void 0:t.length)>0&&e.jsx(Qe,{})})}),e.jsxs(v,{display:"flex",overflow:"hidden",sx:{flex:"1 1 0%"},children:[e.jsx(v,{display:"block",width:1,position:"absolute"}),e.jsx(Et,{}),e.jsx(yt,{})]})]}),e.jsx(We,{})]})})}export{cs as default};
