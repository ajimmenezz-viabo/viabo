import{z as N,j as r,aj as w,N as H,aL as z,G as u,K as g,ai as F,H as E,J as S,r as o,d as B,g as R,Q as K,b as U,O as p,B as M,a1 as k,a2 as W,T as h,S as T,C as $,_ as Q,P as Y,ab as G,aH as J,aI as X}from"./index-4598388a.js";import{f as L}from"./build-2e665ca4.js";import{n as x,a as Z,H as v}from"./build-6273f162.js";import{g as m}from"./build-a9e726a7.js";import{A as aa}from"./build-b0443748.js";import{C as sa}from"./build-c358b8a5.js";import{C as ra}from"./build-5087738b.js";import{s as ia,a as ea}from"./build-c95f6ef9.js";import{M as ta}from"./build-a3ff9182.js";import{u as ca}from"./build-a10aad03.js";import{C as la}from"./build-30afe32b.js";const na=N(r.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"}),"Payment"),oa={openDrawerLiquidateMovement:!1,movement:null,filterDate:null},da=(e,s)=>({...oa,setMovementToLiquidate:a=>{e(t=>({movement:a}),!1,"SET_DETAILS_MOVEMENT_TO_LIQUIDATE")},setOpenDrawerLiquidateMovement:a=>{e(t=>({openDrawerLiquidateMovement:a}),!1,"SET_OPEN_LIQUIDATE_MOVEMENT_VIABO_PAY")},setFilterDate:a=>{e(t=>({filterDate:a}),!1,"SET_FILTER_DATE_LIQUIDATE_MOVEMENTS")}}),_=w(da);function ua(e){const{row:s,closeMenu:a}=e,{original:t}=s,{setMovementToLiquidate:i,setOpenDrawerLiquidateMovement:c}=_(y=>y);return[r.jsxs(H,{onClick:()=>{i(t),c(!0),a()},sx:{m:0},children:[r.jsx(z,{children:r.jsx(na,{color:"success"})}),"Liquidar"]},0)]}const pa={MOVEMENTS:"liquidated-viabo-pay-movements"},ha=e=>(e==null?void 0:e.map(a=>{const t=parseFloat((a==null?void 0:a.amount)||"0"),i=a!=null&&a.transaction_date?u(x(a==null?void 0:a.transaction_date),"dd MMM yyyy",{locale:g}):"",c=a!=null&&a.transaction_date?u(x(a==null?void 0:a.transaction_date),"p"):"";return{id:a==null?void 0:a.id,terminalName:a==null?void 0:a.terminal_name,terminalId:a==null?void 0:a.terminal_id,amount:t,amountFormat:L(t),amountToLiquidate:a==null?void 0:a.amountToSettled,amountToLiquidateFormat:L(a==null?void 0:a.amountToSettled),commerceName:a==null?void 0:a.commerceName,commerceId:a==null?void 0:a.commerceId,approved:a==null?void 0:a.approved,cardType:a==null?void 0:a.card_brand,authNumber:a==null?void 0:a.authorization_number,commission:(a==null?void 0:a.commission)>=0?`${a==null?void 0:a.commission}%`:"0%",cardNumber:a==null?void 0:a.card_number,cardBank:a==null?void 0:a.issuer,transactionDate:{fullDate:u(x(a==null?void 0:a.transaction_date),"dd MMM yyyy HH:mm",{locale:g}),date:i,time:c},serverDate:x(a==null?void 0:a.transaction_date),description:`${(a==null?void 0:a.issuer)===""?a==null?void 0:a.card_brand:a==null?void 0:a.issuer}-${a==null?void 0:a.card_number}`.toUpperCase(),transactionMessage:a==null?void 0:a.result_message,conciliated:!!(a!=null&&a.conciliated),conciliatedName:a!=null&&a.conciliated?"Conciliada":"Sin Conciliar"}}))??[],ya=async(e,s,a)=>{const t=new URL("/api/terminals/shared/transactions",window.location.origin);t.searchParams.set("startDate",e),t.searchParams.set("endDate",s);const{data:i}=await F.get(t.href,{signal:a});return ha(i)},Ma=(e,s,a={})=>{if(!e||!s)return null;const{setFilterDate:t}=_(n=>n),i=u(E(e),"yyyy-MM-dd HH:mm:ss"),c=u(S(s),"yyyy-MM-dd HH:mm:ss"),[d,y]=o.useState(null),l=B({queryKey:[pa.MOVEMENTS],queryFn:({signal:n})=>ya(i,c,n),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,onSuccess:n=>{t({startDate:E(e),endDate:S(s),text:`${u(e,"dd MMMM yyyy",{locale:g})} - ${u(s,"dd MMMM yyyy",{locale:g})}`})},...a});return o.useEffect(()=>{if(l!=null&&l.isError){const n=R(l.error,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");y(n),K.error(n,{type:U(l.error)})}},[l.isError,l.error]),{...l,error:d||null}},A=({row:e})=>{const{original:s}=e,a=s==null?void 0:s.approved,t=m(s==null?void 0:s.cardType),i=t==null?void 0:t.component;return r.jsxs(M,{sx:{display:"flex",alignItems:"center"},children:[r.jsxs(M,{sx:{position:"relative"},children:[r.jsx(k,{title:s==null?void 0:s.cardType,children:r.jsx(W,{sx:{width:40,height:40,color:"text.secondary",bgcolor:"background.neutral"},children:t?r.jsx(i,{sx:{width:25,height:25}}):r.jsx(aa,{width:25,height:25})})}),r.jsx(M,{sx:{right:0,bottom:0,width:15,height:15,display:"flex",borderRadius:"50%",position:"absolute",alignItems:"center",color:"common.white",bgcolor:"error.main",justifyContent:"center",...a&&{bgcolor:"success.main"}},children:a?r.jsx(sa,{sx:{width:12,height:12}}):r.jsx(ra,{sx:{width:12,height:12}})})]}),r.jsxs(M,{sx:{ml:2},children:[r.jsx(h,{variant:"subtitle2",sx:{textWrap:"wrap"},children:s==null?void 0:s.description}),r.jsx(h,{variant:"body2",textTransform:"capitalize",sx:{color:a?"success.main":"error.main",textWrap:"wrap"},children:s==null?void 0:s.transactionMessage})]})]})};A.propTypes={row:p.shape({original:p.shape({approved:p.bool,cardType:p.any,description:p.any,transactionMessage:p.any})})};const xa=()=>o.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({row:e})=>r.jsx(A,{row:e})},{accessorKey:"terminalName",header:"Terminal",size:120,Cell:({cell:e,column:s,row:a,renderedCellValue:t})=>{const{original:i}=a;return r.jsx(h,{fontWeight:"bold",variant:"subtitle2",children:i==null?void 0:i.terminalName})}},{accessorKey:"commerceName",header:"Comercio",size:120},{accessorKey:"serverDate",header:"Fecha",size:100,Cell:({cell:e,column:s,row:a,renderedCellValue:t})=>{var c;const{original:i}=a;return r.jsx(T,{children:r.jsx(h,{variant:"subtitle2",children:(c=i==null?void 0:i.transactionDate)==null?void 0:c.fullDate})})}},{accessorKey:"amount",header:"Monto Cobrado",size:120,Cell:({cell:e,column:s,row:a,renderedCellValue:t})=>{const{original:i}=a;return r.jsx(T,{children:r.jsx(h,{fontWeight:"bold",variant:"subtitle2",children:i==null?void 0:i.amountFormat})})}},{accessorKey:"amountToLiquidate",header:"Monto por liquidar",size:120,Cell:({cell:e,column:s,row:a,renderedCellValue:t})=>{const{original:i}=a;return r.jsx(T,{children:r.jsx(h,{fontWeight:"bold",color:"success.main",variant:"subtitle2",children:i==null?void 0:i.amountToLiquidateFormat})})}}],[]),ga=()=>{const e=new Date,s=_(b=>b.filterDate),a=o.useMemo(()=>s!=null&&s.startDate?new Date(s==null?void 0:s.startDate):ia(e,{days:30}),[s==null?void 0:s.startDate]),t=o.useMemo(()=>s!=null&&s.endDate?new Date(s==null?void 0:s.endDate):e,[s==null?void 0:s.endDate]),[i,c]=o.useState(a),[d,y]=o.useState(t),{data:l,isError:n,error:P,isLoading:D,isFetching:f,refetch:I}=Ma(i,d);o.useEffect(()=>{i&&d&&I()},[i,d]);const q=xa(),O=ca(n,P,{columns:q,data:l||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:D,showAlertBanner:n,showProgressBars:f},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderRowActionMenuItems:ua}),V=b=>{const{startDate:C,endDate:j}=b;j!==null&&C!==null&&(y(j),c(C))};return r.jsxs(la,{children:[r.jsx(ea,{startDate:i,endDate:d,onChangeDateRange:V,hideBalance:!0,loading:f}),r.jsx(ta,{table:O})]})},ba=$(o.lazy(()=>Q(()=>import("./build-95b9d35d.js"),["assets/js/build-95b9d35d.js","assets/js/index-4598388a.js","assets/css/build-a4b698a0.css","assets/js/build-bfb80ca8.js","assets/js/build-30afe32b.js","assets/js/build-05419962.js","assets/js/build-d8ac8382.js","assets/js/build-2e665ca4.js","assets/js/build-0672d956.js","assets/js/build-6273f162.js","assets/js/build-65a59fe1.js","assets/js/build-ff9321b7.js","assets/js/build-a9e726a7.js","assets/js/build-c449aeae.js","assets/js/build-441a9fbc.js","assets/js/build-b0443748.js","assets/js/build-c358b8a5.js","assets/js/build-5087738b.js","assets/js/build-c95f6ef9.js","assets/js/build-a3ff9182.js","assets/js/build-5a5c5f07.js","assets/js/build-c52d07ca.js","assets/js/build-002795c1.js","assets/js/build-a6ca5fb2.js","assets/js/build-633032d6.js","assets/js/build-e872d097.js","assets/js/build-f32805fc.js","assets/js/build-a10aad03.js"]))),Ta=()=>r.jsx(Y,{title:"Movimientos a Liquidar Viabo Pay",children:r.jsxs(Z,{children:[r.jsx(v,{name:"Nube",links:[{name:"Inicio",href:G.root},{name:"Viabo Pay",href:J.cloud},{name:X.cloud.name}]}),r.jsx(ga,{}),r.jsx(ba,{})]})}),qa=Object.freeze(Object.defineProperty({__proto__:null,default:Ta},Symbol.toStringTag,{value:"Module"}));export{qa as C,_ as u};
