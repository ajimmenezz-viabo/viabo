import{j as e,C as x,r as m,a7 as de,S as E,T as C,a8 as _,d as ue,g as pe,a9 as H,n as me,B as I,p as ge,U as k,I as T,E as he,$ as w,k as fe,P as xe,a4 as Ce,a5 as Se,a6 as Ae,aa as B,ab as q}from"./index-9d194a96.js";import{A as $,u as Ee}from"./build-e5a86e6d.js";import{r as ve,i as je,a as Ie,b as _e,H as be}from"./build-ea6e9f7e.js";import{B as ye}from"./build-92053857.js";import{F as Te,g as we}from"./build-ca3a031e.js";import{C as Oe}from"./build-28b281f8.js";import{g as Pe}from"./build-ab116a41.js";import{c as De}from"./build-bd52b92f.js";import{M as Fe,S as Le,F as Re,a as Ne,b as ze}from"./build-8c1c9568.js";import{L as Ue,a as Me}from"./build-7e9eb185.js";import{M as Ve}from"./build-bd3e28b8.js";import{L as ke}from"./build-b8d642fe.js";import{C as He}from"./build-c22c2af0.js";import{C as Be}from"./build-de4e2211.js";import{A as qe}from"./build-188e5a9e.js";const $e=t=>{const l=Pe(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);if(l&&Array.isArray(l)){const a=l==null?void 0:l.map(u=>Oe(u)),s=De(a,"id","cardUserNumber")||[];return{data:s,meta:{total:(s==null?void 0:s.length)??0}}}throw new Error("No se pueden obtener las tarjetas")};var P={},We=je;Object.defineProperty(P,"__esModule",{value:!0});var W=P.default=void 0,Ke=We(ve()),Qe=e,Ge=(0,Ke.default)((0,Qe.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");W=P.default=Ge;const K=({open:t,anchorEl:l,handlePopoverClose:a,data:s})=>{var u,n,p;return s?e.jsx(de,{id:"mouse-over-popover",sx:{pointerEvents:"none"},open:t,anchorEl:l,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},onClose:a,disableRestoreFocus:!0,slotProps:{paper:{sx:{mt:1.5,ml:.5,overflow:"inherit",boxShadow:d=>d.customShadows.z20,border:d=>`solid 1px ${d.palette.grey[5008]}`,width:200}}},children:e.jsxs(E,{spacing:2,p:2,children:[e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s):"}),e.jsx(C,{variant:"body2",children:((u=s==null?void 0:s.assignUser)==null?void 0:u.name)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos:"}),e.jsx(C,{variant:"body2",children:((n=s==null?void 0:s.assignUser)==null?void 0:n.lastName)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"TelÃ©fono:"}),e.jsx(C,{variant:"body2",children:((p=s==null?void 0:s.assignUser)==null?void 0:p.phone)??"-"})]})]})}):null};K.propTypes={anchorEl:x.any,data:x.shape({assignUser:x.shape({lastName:x.string,name:x.string,phone:x.string})}),handlePopoverClose:x.any,open:x.any};const Je=m.memo(K),Ye=async(t,l)=>{const{columnFilters:a,globalFilter:s,pageIndex:u,pageSize:n,sorting:p}=t,d=new URL("/api/cards/commerce",window.location.origin);d.searchParams.set("start",`${u*n}`),d.searchParams.set("size",`${n}`),d.searchParams.set("filters",JSON.stringify(a??[])),d.searchParams.set("globalFilter",s??""),d.searchParams.set("sorting",JSON.stringify(p??[]));const{data:j}=await _.get(d.href,{signal:l});return $e(j)},vs=async t=>(await _.put("/api/assign/commerce-card/to/user",t),t),js=async t=>{const{data:l}=await _.put("/api/card-owner/data/update",t);return l},Is=async t=>{const{data:l}=await _.put(`/api/card-owner/password/reset/${t.id}`);return l},Xe=(t={},l={})=>{const{columnFilters:a,globalFilter:s,pageIndex:u,pageSize:n,sorting:p}=t,[d,j]=m.useState(null);return{...ue({queryKey:[$.LIST,a,s,u,n,p],queryFn:async({signal:v})=>Ye(t,v),keepPreviousData:!0,onError:v=>{const b=pe(v,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");j(b)},staleTime:6e4,refetchOnWindowFocus:!1,...l}),error:d||null}},Ze={cardInfo:null,openUserInfo:!1,hoverInfo:null,hoverElement:null},es=(t,l)=>({...Ze,setOpenUserInfo:a=>{t(s=>({openUserInfo:a}),!1,"SET_OPEN_USER_INFO_MODAL")},setCardInfo:a=>{t(s=>({cardInfo:a}),!1,"SET_CARD_INFO")},setHoverInfo:a=>{t(s=>({hoverInfo:a}),!1,"SET_HOVER_INFO")},setHoverElement:a=>{t(s=>({hoverElement:a}),!1,"SET_HOVER_ElEMENT")}}),Q=H(es),ss={cards:[],rows:[],openAssign:!1},rs=(t,l)=>({...ss,setSelectedCard:a=>{const{cards:s}=l(),u=s.indexOf(a);let n=[];u===-1?n=n.concat(s,a):u===0?n=n.concat(s.slice(1)):u===s.length-1?n=n.concat(s.slice(0,-1)):u>0&&(n=n.concat(s.slice(0,u),s.slice(u+1))),t(p=>({cards:n}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{t(s=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{t(s=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{t(s=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),O=H(rs),ts=({refCommerceCardsTable:t})=>{var M;const[l,a]=m.useState([]),[s,u]=m.useState(""),[n,p]=m.useState([]),[d,j]=m.useState({pageIndex:0,pageSize:10}),[D,v]=m.useState({}),{setOpenUserInfo:b,setCardInfo:G}=Q(r=>r),J=O(r=>r.setOpenAssign),Y=O(r=>r.setAllCards),X=me(),{data:A,isLoading:Z,isFetching:ee,isError:F,error:se,refetch:re}=Xe({columnFilters:l??[],globalFilter:s??"",pageIndex:(d==null?void 0:d.pageIndex)??0,pageSize:(d==null?void 0:d.pageSize)??10,sorting:n??[]}),{mutate:te,isLoading:ae}=Ee(),[L,R]=m.useState(null),[ne,N]=m.useState(null),[oe,y]=m.useState(null),le=r=>{R(r.currentTarget)},z=()=>{R(null),N(null)},U=!!L,S=m.useMemo(()=>[{id:"cardNumber",accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,Cell:({cell:r,column:o,row:i})=>{const{original:c}=i;return e.jsxs(E,{direction:"row",spacing:2,alignItems:"center",children:[(c==null?void 0:c.cardType)==="Carnet"?e.jsx(Ie,{sx:{width:25,height:25}}):e.jsx(Ve,{sx:{width:25,height:25}}),e.jsx(C,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:c==null?void 0:c.cardNumberHidden})]})}},{id:"assigned",accessorFn:r=>{var o;return((o=r==null?void 0:r.assignUser)==null?void 0:o.fullName)||null},Cell:({cell:r,column:o,row:i,renderedCellValue:c})=>{const{original:h}=i;return c!=="-"?e.jsx(E,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(ke,{color:"info.main",underline:"always",sx:{cursor:"pointer"},variant:"subtitle2",component:C,"aria-owns":U?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:f=>{le(f),N(h)},onMouseLeave:z,onClick:()=>{G(h),b(!0)},children:c})}):c},header:"Asignado",size:150},{id:"status",accessorFn:r=>{var o;return((o=r==null?void 0:r.cardStatus)==null?void 0:o.name)||null},header:"Estado",filterVariant:"select",size:150,Cell:({cell:r,column:o,row:i,renderedCellValue:c})=>{var f;const{original:h}=i;return c?e.jsx(I,{sx:{display:"flex",pt:1},children:e.jsx(Ue,{variant:X.palette.mode==="light"?"ghost":"filled",color:(f=h==null?void 0:h.cardStatus)!=null&&f.isActive?"success":"error",sx:{textTransform:"capitalize"},children:c})}):null}}],[]),ie=r=>()=>{var f;const o=((f=r.getSelectedRowModel().flatRows)==null?void 0:f.map(g=>g.original))??[],i=o.some(g=>(g==null?void 0:g.cvv)==="")&&(o==null?void 0:o.length)>1,c=o.some(g=>{var V;return((V=g==null?void 0:g.assignUser)==null?void 0:V.id)!==""});o.every(g=>(g==null?void 0:g.cvv)==="")&&(o==null?void 0:o.length)>1?w.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):i?w.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):c?w.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):(Y(o),J(!0))},ce=r=>()=>{try{const o=r.getSortedRowModel().rows.map(i=>(S==null?void 0:S.map(c=>i.getValue(c.accessorKey)))||[])??[];we((S==null?void 0:S.map(i=>i.header))||[],o,"Stock del comercio")}catch{}};return e.jsx(He,{maxWidth:"lg",children:e.jsxs(Be,{children:[e.jsx(Je,{anchorEl:L,open:U,handlePopoverClose:z,data:ne}),e.jsx(Fe,{tableInstanceRef:t,enablePinning:!0,enableColumnOrdering:!1,enableColumnFilterModes:!1,enableStickyHeader:!0,enableRowVirtualization:!0,enableRowActions:!0,positionActionsColumn:"last",enableDensityToggle:!1,enableFacetedValues:!0,columns:S,data:(A==null?void 0:A.data)||[],isError:F,textError:se,selectAllMode:"all",onRowSelectionChange:v,rowCount:((M=A==null?void 0:A.meta)==null?void 0:M.total)??0,initialState:{density:"compact",sorting:[{id:"assigned",desc:!0}]},state:{isLoading:Z,showAlertBanner:F,showProgressBars:ee,rowSelection:D??{}},enableRowSelection:!0,displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:15,muiTableHeadCellProps:({column:r})=>({align:"center"})},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:r})=>e.jsx(I,{sx:{display:"flex",gap:"1rem"},children:e.jsx(ge,{onClick:ie(r),disabled:!r.getIsSomeRowsSelected(),startIcon:e.jsx(qe,{width:24,height:24}),children:"Asociar"})}),muiTableBodyRowProps:({row:r})=>({sx:o=>({backgroundColor:o.palette.background.paper})}),renderToolbarInternalActions:({table:r})=>e.jsxs(I,{children:[e.jsx(k,{arrow:!0,title:"Actualizar",children:e.jsx(T,{onClick:()=>re(),children:e.jsx(W,{})})}),e.jsx(Le,{table:r}),e.jsx(k,{title:"Descargar",children:e.jsx(T,{disabled:r.getPrePaginationRowModel().rows.length===0,onClick:ce(r),children:e.jsx(Te,{})})}),e.jsx(Re,{table:r}),e.jsx(Ne,{table:r}),e.jsx(ze,{table:r})]}),renderRowActions:({row:r,table:o})=>{var f;const{original:i}=r,c=(f=i==null?void 0:i.cardStatus)==null?void 0:f.isActive,h=ae&&oe===(i==null?void 0:i.id);return e.jsxs(I,{sx:{display:"flex",flex:1,justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:[e.jsx(T,{size:"small",color:"primary",disabled:h,children:e.jsx(ye,{})}),h?e.jsx(he,{size:15,containerProps:{display:"flex",ml:1}}):e.jsx(Me,{size:"sm",color:c?"success":"error",checked:c||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{y(i==null?void 0:i.id),te({...i,cardON:!c},{onSuccess:()=>{y(null)},onError:()=>{y(null)}})}})]})}})]})})},as=B(m.lazy(()=>q(()=>import("./build-5dded889.js"),["assets/js/build-5dded889.js","assets/js/index-9d194a96.js","assets/css/build-f63bc8fe.css","assets/js/build-2f2f88f9.js","assets/js/build-de4e2211.js","assets/js/build-63748b81.js","assets/js/build-ad6a3786.js","assets/js/build-ab116a41.js","assets/js/build-e17be464.js","assets/js/build-e5a86e6d.js","assets/js/build-617d00e2.js","assets/js/build-28b281f8.js","assets/js/build-3a2d77cf.js","assets/js/build-bee6630b.js","assets/js/build-bd33a91e.js","assets/js/build-ea6e9f7e.js","assets/js/build-c22c2af0.js","assets/js/build-b8d642fe.js","assets/js/build-bd52b92f.js","assets/js/build-97b81deb.js","assets/js/build-92053857.js","assets/js/build-715faeb3.js","assets/js/build-ca3a031e.js","assets/js/build-8c1c9568.js","assets/js/build-9eaf01f4.js","assets/js/build-eb058c1a.js","assets/js/build-e256d942.js","assets/js/build-1580500f.js","assets/js/build-c44cedc6.js","assets/js/build-7e9eb185.js","assets/js/build-f1f37501.js","assets/js/build-bd3e28b8.js","assets/js/build-188e5a9e.js"]))),ns=B(m.lazy(()=>q(()=>import("./build-03b3d9ad.js"),["assets/js/build-03b3d9ad.js","assets/js/index-9d194a96.js","assets/css/build-f63bc8fe.css","assets/js/build-2f2f88f9.js","assets/js/build-de4e2211.js","assets/js/build-63748b81.js","assets/js/build-ad6a3786.js"])));function os(){const{openAssign:t,setOpenAssign:l}=O(p=>p),{openUserInfo:a,setOpenUserInfo:s}=Q(p=>p),u=fe(),n=m.useRef(null);return m.useEffect(()=>()=>{const p=Object.values($);u.cancelQueries(p)},[]),e.jsx(e.Fragment,{children:e.jsx(xe,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(_e,{sx:{height:"100%"},children:[e.jsx(be,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Ce.root},{name:"Viabo Card",href:Se.allCards},{name:Ae.allCards.name}]}),e.jsx(ts,{refCommerceCardsTable:n}),e.jsx(as,{open:t,handleClose:()=>{l(!1)},handleSuccess:()=>{var p;l(!1),(p=n==null?void 0:n.current)==null||p.resetRowSelection()}}),e.jsx(ns,{open:a,handleClose:()=>{s(!1)},handleSuccess:()=>{s(!1)}})]})})})}const _s=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{_s as A,vs as a,js as b,Q as c,Is as r,O as u};
