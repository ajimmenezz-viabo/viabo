import{j as e,D as h,r as p,a8 as oe,S as E,T as f,a9 as _,d as le,g as ie,aa as k,n as ce,B as I,p as de,V as M,I as b,a0 as w,k as ue,P as pe,a5 as me,a6 as ge,a7 as he,ab as H,ac as B}from"./index-be176464.js";import{r as fe,i as xe,a as Ce,b as Se,H as Ae}from"./build-199169fb.js";import{B as Ee}from"./build-a5ba83d8.js";import{F as ve,g as je}from"./build-d9ab66fd.js";import{C as Ie}from"./build-03bd94ba.js";import{g as _e}from"./build-f0aa92ba.js";import{c as ye}from"./build-f3d6ad6d.js";import{M as be,a as we,F as Te,b as Oe,c as Pe}from"./build-6bd3f839.js";import{L as Re}from"./build-3fdf003c.js";import{M as De}from"./build-59cb91f6.js";import{L as Fe}from"./build-112d79ca.js";import{C as Le}from"./build-aeaad37b.js";import{C as Ne}from"./build-a3d9f42b.js";import{A as Ue}from"./build-82cbb840.js";const Ve=t=>{const l=_e(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);if(l&&Array.isArray(l)){const a=l==null?void 0:l.map(c=>Ie(c)),s=ye(a,"id","cardUserNumber")||[];return{data:s,meta:{total:(s==null?void 0:s.length)??0}}}throw new Error("No se pueden obtener las tarjetas")},q={LIST:"commerce-all-cards"};var O={},ze=xe;Object.defineProperty(O,"__esModule",{value:!0});var W=O.default=void 0,Me=ze(fe()),ke=e,He=(0,Me.default)((0,ke.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");W=O.default=He;const $=({open:t,anchorEl:l,handlePopoverClose:a,data:s})=>{var c,n,d;return s?e.jsx(oe,{id:"mouse-over-popover",sx:{pointerEvents:"none"},open:t,anchorEl:l,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},onClose:a,disableRestoreFocus:!0,slotProps:{paper:{sx:{mt:1.5,ml:.5,overflow:"inherit",boxShadow:i=>i.customShadows.z20,border:i=>`solid 1px ${i.palette.grey[5008]}`,width:200}}},children:e.jsxs(E,{spacing:2,p:2,children:[e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(f,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s):"}),e.jsx(f,{variant:"body2",children:((c=s==null?void 0:s.assignUser)==null?void 0:c.name)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(f,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos:"}),e.jsx(f,{variant:"body2",children:((n=s==null?void 0:s.assignUser)==null?void 0:n.lastName)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(f,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"TelÃ©fono:"}),e.jsx(f,{variant:"body2",children:((d=s==null?void 0:s.assignUser)==null?void 0:d.phone)??"-"})]})]})}):null};$.propTypes={anchorEl:h.any,data:h.shape({assignUser:h.shape({lastName:h.string,name:h.string,phone:h.string})}),handlePopoverClose:h.any,open:h.any};const Be=p.memo($),qe=async(t,l)=>{const{columnFilters:a,globalFilter:s,pageIndex:c,pageSize:n,sorting:d}=t,i=new URL("/api/cards/commerce",window.location.origin);i.searchParams.set("start",`${c*n}`),i.searchParams.set("size",`${n}`),i.searchParams.set("filters",JSON.stringify(a??[])),i.searchParams.set("globalFilter",s??""),i.searchParams.set("sorting",JSON.stringify(d??[]));const{data:j}=await _.get(i.href,{timeout:3e4,signal:l});return Ve(j)},gs=async t=>(await _.put("/api/assign/commerce-card/to/user",t),t),hs=async t=>{const{data:l}=await _.put("/api/card-owner/data/update",t);return l},fs=async t=>{const{data:l}=await _.put(`/api/card-owner/password/reset/${t.id}`);return l},We=(t={},l={})=>{const{columnFilters:a,globalFilter:s,pageIndex:c,pageSize:n,sorting:d}=t,[i,j]=p.useState(null);return{...le({queryKey:[q.LIST,a,s,c,n,d],queryFn:async({signal:v})=>qe(t,v),keepPreviousData:!0,onError:v=>{const y=ie(v,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");j(y)},staleTime:6e4,refetchOnWindowFocus:!1,...l}),error:i||null}},$e={cardInfo:null,openUserInfo:!1,hoverInfo:null,hoverElement:null},Ke=(t,l)=>({...$e,setOpenUserInfo:a=>{t(s=>({openUserInfo:a}),!1,"SET_OPEN_USER_INFO_MODAL")},setCardInfo:a=>{t(s=>({cardInfo:a}),!1,"SET_CARD_INFO")},setHoverInfo:a=>{t(s=>({hoverInfo:a}),!1,"SET_HOVER_INFO")},setHoverElement:a=>{t(s=>({hoverElement:a}),!1,"SET_HOVER_ElEMENT")}}),K=k(Ke),Qe={cards:[],rows:[],openAssign:!1},Ge=(t,l)=>({...Qe,setSelectedCard:a=>{const{cards:s}=l(),c=s.indexOf(a);let n=[];c===-1?n=n.concat(s,a):c===0?n=n.concat(s.slice(1)):c===s.length-1?n=n.concat(s.slice(0,-1)):c>0&&(n=n.concat(s.slice(0,c),s.slice(c+1))),t(d=>({cards:n}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{t(s=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{t(s=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{t(s=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),T=k(Ge),Je=({refCommerceCardsTable:t})=>{var V;const[l,a]=p.useState([]),[s,c]=p.useState(""),[n,d]=p.useState([]),[i,j]=p.useState({pageIndex:0,pageSize:10}),[P,v]=p.useState({}),{setOpenUserInfo:y,setCardInfo:Q}=K(r=>r),G=T(r=>r.setOpenAssign),J=T(r=>r.setAllCards),Y=ce(),{data:A,isLoading:X,isFetching:Z,isError:R,error:ee,refetch:se}=We({columnFilters:l??[],globalFilter:s??"",pageIndex:(i==null?void 0:i.pageIndex)??0,pageSize:(i==null?void 0:i.pageSize)??10,sorting:n??[]}),[D,F]=p.useState(null),[te,L]=p.useState(null),re=r=>{F(r.currentTarget)},N=()=>{F(null),L(null)},U=!!D,x=p.useMemo(()=>[{id:"cardNumber",accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,Cell:({cell:r,column:o,row:g})=>{const{original:u}=g;return e.jsxs(E,{direction:"row",spacing:2,alignItems:"center",children:[(u==null?void 0:u.cardType)==="Carnet"?e.jsx(Ce,{sx:{width:25,height:25}}):e.jsx(De,{sx:{width:25,height:25}}),e.jsx(f,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:u==null?void 0:u.cardNumberHidden})]})}},{id:"assigned",accessorFn:r=>{var o;return((o=r==null?void 0:r.assignUser)==null?void 0:o.fullName)||null},Cell:({cell:r,column:o,row:g,renderedCellValue:u})=>{const{original:C}=g;return u!=="-"?e.jsx(E,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(Fe,{color:"info.main",underline:"always",sx:{cursor:"pointer"},variant:"subtitle2",component:f,"aria-owns":U?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:S=>{re(S),L(C)},onMouseLeave:N,onClick:()=>{Q(C),y(!0)},children:u})}):u},header:"Asignado",size:150},{id:"status",accessorFn:r=>{var o;return((o=r==null?void 0:r.cardStatus)==null?void 0:o.name)||null},header:"Estado",filterVariant:"select",size:150,Cell:({cell:r,column:o,row:g,renderedCellValue:u})=>{var S;const{original:C}=g;return u?e.jsx(I,{sx:{display:"flex",pt:1},children:e.jsx(Re,{variant:Y.palette.mode==="light"?"ghost":"filled",color:(S=C==null?void 0:C.cardStatus)!=null&&S.isActive?"success":"error",sx:{textTransform:"capitalize"},children:u})}):null}}],[]),ae=r=>()=>{var S;const o=((S=r.getSelectedRowModel().flatRows)==null?void 0:S.map(m=>m.original))??[],g=o.some(m=>(m==null?void 0:m.cvv)==="")&&(o==null?void 0:o.length)>1,u=o.some(m=>{var z;return((z=m==null?void 0:m.assignUser)==null?void 0:z.id)!==""});o.every(m=>(m==null?void 0:m.cvv)==="")&&(o==null?void 0:o.length)>1?w.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):g?w.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?w.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):(J(o),G(!0))},ne=r=>()=>{try{const o=r.getSortedRowModel().rows.map(g=>(x==null?void 0:x.map(u=>g.getValue(u.accessorKey)))||[])??[];je((x==null?void 0:x.map(g=>g.header))||[],o,"Stock del comercio")}catch{}};return e.jsx(Le,{maxWidth:"lg",children:e.jsxs(Ne,{children:[e.jsx(Be,{anchorEl:D,open:U,handlePopoverClose:N,data:te}),e.jsx(be,{tableInstanceRef:t,enablePinning:!0,enableColumnOrdering:!1,enableColumnFilterModes:!1,enableStickyHeader:!0,enableRowVirtualization:!0,enableRowActions:!0,positionActionsColumn:"last",enableDensityToggle:!1,enableFacetedValues:!0,columns:x,data:(A==null?void 0:A.data)||[],isError:R,textError:ee,selectAllMode:"all",onRowSelectionChange:v,rowCount:((V=A==null?void 0:A.meta)==null?void 0:V.total)??0,initialState:{density:"compact",sorting:[{id:"assigned",desc:!0}]},state:{isLoading:X,showAlertBanner:R,showProgressBars:Z,rowSelection:P??{}},enableRowSelection:!0,displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:15,muiTableHeadCellProps:({column:r})=>({align:"center"})},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:r})=>e.jsx(I,{sx:{display:"flex",gap:"1rem"},children:e.jsx(de,{onClick:ae(r),disabled:!r.getIsSomeRowsSelected(),startIcon:e.jsx(Ue,{width:24,height:24}),children:"Asociar"})}),muiTableBodyRowProps:({row:r})=>({sx:o=>({backgroundColor:o.palette.background.paper})}),renderToolbarInternalActions:({table:r})=>e.jsxs(I,{children:[e.jsx(M,{arrow:!0,title:"Actualizar",children:e.jsx(b,{onClick:()=>se(),children:e.jsx(W,{})})}),e.jsx(we,{table:r}),e.jsx(M,{title:"Descargar",children:e.jsx(b,{disabled:r.getPrePaginationRowModel().rows.length===0,onClick:ne(r),children:e.jsx(ve,{})})}),e.jsx(Te,{table:r}),e.jsx(Oe,{table:r}),e.jsx(Pe,{table:r})]}),renderRowActions:({row:r,table:o})=>e.jsx(I,{sx:{display:"flex",flex:1,justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:e.jsx(b,{size:"small",color:"primary",children:e.jsx(Ee,{})})})})]})})},Ye=H(p.lazy(()=>B(()=>import("./build-c76a256a.js"),["assets/js/build-c76a256a.js","assets/js/index-be176464.js","assets/css/build-f63bc8fe.css","assets/js/build-3e2825f2.js","assets/js/build-a3d9f42b.js","assets/js/build-8a3d443f.js","assets/js/build-0d6b0eaf.js","assets/js/build-f0aa92ba.js","assets/js/build-26f5fcb0.js","assets/js/build-199169fb.js","assets/js/build-bc852905.js","assets/js/build-aeaad37b.js","assets/js/build-112d79ca.js","assets/js/build-a5ba83d8.js","assets/js/build-d6c61d92.js","assets/js/build-d9ab66fd.js","assets/js/build-03bd94ba.js","assets/js/build-8047ff64.js","assets/js/build-bee6630b.js","assets/js/build-f3d6ad6d.js","assets/js/build-6bd3f839.js","assets/js/build-b46d1600.js","assets/js/build-865f3cc7.js","assets/js/build-7cb492e3.js","assets/js/build-3edaa701.js","assets/js/build-3fdf003c.js","assets/js/build-f1e2ed79.js","assets/js/build-59cb91f6.js","assets/js/build-82cbb840.js"]))),Xe=H(p.lazy(()=>B(()=>import("./build-f1cd5a94.js"),["assets/js/build-f1cd5a94.js","assets/js/index-be176464.js","assets/css/build-f63bc8fe.css","assets/js/build-3e2825f2.js","assets/js/build-a3d9f42b.js","assets/js/build-8a3d443f.js","assets/js/build-0d6b0eaf.js"])));function Ze(){const{openAssign:t,setOpenAssign:l}=T(d=>d),{openUserInfo:a,setOpenUserInfo:s}=K(d=>d),c=ue(),n=p.useRef(null);return p.useEffect(()=>()=>{const d=Object.values(q);c.cancelQueries(d)},[]),e.jsx(e.Fragment,{children:e.jsx(pe,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(Se,{sx:{height:"100%"},children:[e.jsx(Ae,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:me.root},{name:"Viabo Card",href:ge.allCards},{name:he.allCards.name}]}),e.jsx(Je,{refCommerceCardsTable:n}),e.jsx(Ye,{open:t,handleClose:()=>{l(!1)},handleSuccess:()=>{var d;l(!1),(d=n==null?void 0:n.current)==null||d.resetRowSelection()}}),e.jsx(Xe,{open:a,handleClose:()=>{s(!1)},handleSuccess:()=>{s(!1)}})]})})})}const xs=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{q as A,gs as a,hs as b,K as c,xs as d,fs as r,T as u};
