import{t as k,j as e,E as F,n as z,Q as T,g as w,o as O,P as f,S as a,T as t,i as P,aX as A,N as E,O as S,L as R,a7 as L}from"./index-6863da86.js";import{u as D}from"./build-e9e14512.js";import{c as _,a as p}from"./build-e86cc6dd.js";import{m as $}from"./build-1adf09ae.js";import{g as B}from"./build-6b8b3360.js";import{g as W,T as I,u as N}from"./build-189c0068.js";import{F as Q,M as b,a as M}from"./build-1f7770a6.js";import{R as h}from"./build-d31bc419.js";import{M as Y}from"./build-a0f4f8d6.js";import{V as X,L as K}from"./build-1b90faef.js";import{I as g}from"./build-9b410350.js";import{C as U}from"./build-320827f8.js";import{V as G}from"./build-be748c98.js";import{P as Z}from"./build-4b36d412.js";import{E as H}from"./build-344620eb.js";import{R as J}from"./build-15a7749e.js";import"./build-3106248c.js";import"./build-ef771cbf.js";import"./build-a416485b.js";import"./build-bee6630b.js";import"./build-6c440e0a.js";import"./build-2ea1affa.js";import"./build-ac6e46ca.js";import"./build-01f8aab2.js";import"./build-a30d033e.js";import"./build-79dc0c41.js";import"./build-2b8469e6.js";import"./build-3d4bb984.js";import"./build-0602b355.js";import"./build-8766947c.js";const y=k(e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"}),"Phone");function ee(s){return/^([1-9])$/.test(s)?"0"+s:s}const re=(s,r)=>{var d,l,j,v,u;const n={commerceId:s==null?void 0:s.commerceId,terminalId:s==null?void 0:s.terminalId,amount:parseFloat(((d=r==null?void 0:r.amount)==null?void 0:d.toString())===""?"0":(l=r==null?void 0:r.amount)==null?void 0:l.toString().replace(/,/g,"")).toString(),description:r==null?void 0:r.concept,clientName:r==null?void 0:r.name,phone:`+52 ${r==null?void 0:r.phone}`,cardNumber:r==null?void 0:r.cardNumber.replace(/\s+/g,""),expMonth:((j=ee((r==null?void 0:r.month)+1))==null?void 0:j.toString())||"",expYear:((u=(v=r==null?void 0:r.year)==null?void 0:v.toString())==null?void 0:u.slice(-2))||"",security:r==null?void 0:r.cvv,email:r==null?void 0:r.email};return B(n)},oe=(s={})=>{const r=F(),n=z(W,s);return{...n,mutate:async(l,j)=>{const{onSuccess:v,onError:u,mutationOptions:x}=j;try{await T.promise(n.mutateAsync(l,x),{pending:"Realizando Pago ...",success:{render({data:c}){return v(c),r.invalidateQueries([I.MOVEMENTS]),"Se completó la transacción y se envió el comprobante con éxito"}}})}catch(c){const i=w(c,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");u(i),T.error(i,{type:O(c)}),r.invalidateQueries([I.MOVEMENTS])}}}},se=1,ae=1e5,q=new Date().getFullYear(),te=new Date().getMonth(),ie=10,ne=Array.from({length:ie},(s,r)=>q+r),C=({onSuccessTransaction:s})=>{const r=N(o=>o.terminal),{mutate:n}=oe(),d=_().shape({amount:p().required("El monto es requerido"),concept:p().required("El concepto es requerido"),cardNumber:p().transform((o,m)=>m.replace(/\s/g,"")).min(16,"Debe contener 16 dígitos").required("El número de la tarjeta es requerido"),cvv:p().min(3,"Debe contener 3 dígitos").required("El CVV es requerido"),name:p().required("El nombre es requerido"),email:p().email("Ingresa un correo valido").required("El correo es requerido"),phone:p().test("longitud","El teléfono es muy corto",o=>!(o&&o.replace(/\s/g,"").length<10)).required("El teléfono es requerido")}),l=D({initialValues:{amount:"",cardNumber:"",month:te,year:q,cvv:"",name:"",email:"",phone:"",concept:""},enableReinitialize:!0,validationSchema:d,onSubmit:(o,{setSubmitting:m})=>{const V=re(r,o);n(V,{onSuccess:()=>{m(!1),s()},onError:()=>{m(!1)}})}}),{errors:j,touched:v,isSubmitting:u,setFieldValue:x,values:c}=l,i=u;return e.jsx(Q,{formik:l,children:e.jsxs(a,{spacing:2,p:3,children:[e.jsxs(a,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(t,{variant:"subtitle1",children:"Forma de Pago"}),e.jsx(P,{sx:{px:1,backgroundColor:"background.default"},children:e.jsx(Y,{sx:{width:30,height:30}})}),e.jsx(P,{sx:{px:1,backgroundColor:"background.default"},children:e.jsx(X,{sx:{width:30,height:30}})})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Monto *"}),e.jsx(h,{autoFocus:!0,fullWidth:!0,name:"amount",required:!0,placeholder:"0.00",disabled:i,size:"small",autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:e.jsx(g,{position:"end",children:"MXN"}),inputComponent:b,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:se,max:ae,scale:2,value:c.amount,onAccept:o=>{x("amount",o)}}}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Concepto *"}),e.jsx(h,{size:"small",name:"concept",multiline:!0,disabled:i,rows:2,placeholder:"Pago por .."})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),e.jsx(h,{name:"cardNumber",required:!0,size:"small",placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(U,{})}),inputComponent:b,inputProps:{mask:"0000 0000 0000 0000",value:c.cardNumber,onAccept:o=>{x("cardNumber",o)}}},disabled:i})]}),e.jsxs(a,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",flexWrap:"wrap",children:[e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Mes *"}),e.jsx(M,{size:"small",name:"month",disabled:i,children:$.map((o,m)=>e.jsx(A,{value:m,children:o},m))})]}),e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Año *"}),e.jsx(M,{size:"small",name:"year",disabled:i,children:ne.map(o=>e.jsx(A,{value:o,children:o},o))})]}),e.jsxs(a,{flex:1,spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),e.jsx(h,{name:"cvv",required:!0,placeholder:"123",size:"small",InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(G,{})}),inputComponent:b,inputProps:{mask:"000",onAccept:o=>{x("cvv",o)},value:c.cvv}},disabled:i})]})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),e.jsx(h,{name:"name",required:!0,size:"small",placeholder:"Nombre del Titular de la Tarjeta",disabled:i,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(Z,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),e.jsx(h,{name:"email",required:!0,size:"small",placeholder:"usuario@dominio.com",disabled:i,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(H,{})})}})]}),e.jsxs(a,{spacing:1,children:[e.jsx(t,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono *"}),e.jsx(h,{name:"phone",required:!0,type:"phone",size:"small",placeholder:"55 5555 5555",fullWidth:!0,InputProps:{startAdornment:e.jsx(g,{position:"start",children:e.jsx(y,{})}),inputComponent:b,inputProps:{mask:"00 0000 0000",value:c.phone,onAccept:o=>{x("phone",o)}}},disabled:i})]}),e.jsxs(t,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",e.jsx(E,{component:S,underline:"always",target:"_blank",color:"info.main",children:"Términos y condiciones"}),"  &  ",e.jsx(E,{component:S,underline:"always",target:"_blank",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),e.jsx(a,{children:e.jsx(R,{loading:u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(K,{}),children:"Pagar"})})]})})};C.propTypes={onSuccessTransaction:f.func};const le=({open:s,setOpen:r})=>{const n=N(l=>l.terminal),d=()=>{r(!1)};return e.jsx(J,{open:s,handleClose:d,titleElement:e.jsxs(a,{children:[e.jsx(t,{variant:"h6",children:"Terminal Virtual"}),e.jsx(t,{variant:"subtitle2",children:n==null?void 0:n.name})]}),children:e.jsx(L,{children:e.jsx(C,{onSuccessTransaction:d})})})};le.propTypes={open:f.bool,setOpen:f.func};export{le as default};
