import{c as R,f as E,a9 as B,s as M,bA as T,r as C,i as e,bx as N,by as F,bz as O,bB as o,bC as W,B as P,T as p,V as I,a0 as Q,O as _,dW as k,P as c}from"./vendor-StReGf79.js";import{a as z}from"./crypto-DOZFMzid.js";import{g as D,a as G,S as L}from"./index-8BLzEq8l.js";import{f as y}from"./formatNumber-D2wM-uoj.js";import{t as V,C as b}from"./useToggleStatusCard-wQ5uDSUR.js";import{g as $}from"./cardTypes-lFAiUg3F.js";import"./cardsAdapter-jMj_YqiI.js";import"./formatTime-j4oUQxO9.js";import"./matchTypes-VzXr5CmM.js";import"./cardMovementsAdapter-FSP8D4dM.js";import"./AmexLogo-HKO7b419.js";import"./CarnetLogo-9N730tjt.js";import"./MasterCardLogo-31QJgBVq.js";import"./VisaLogo-WgMS-TBE.js";const H=(r,i,t,u)=>{var m,x;let d;return u?d={originCardId:r,destinationCards:[{cardId:(m=i==null?void 0:i.card)==null?void 0:m.value.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((i==null?void 0:i.amount.toString())===""?"0":(x=i==null?void 0:i.amount)==null?void 0:x.toString().replace(/,/g,"")).toString()}]}:d={originCardId:r,destinationCards:i==null?void 0:i.map(n=>{var a,s,h;return{cardId:(s=(a=n==null?void 0:n.card)==null?void 0:a.value)==null?void 0:s.toString(),concept:(t==null?void 0:t.toString())||"",amount:parseFloat((n==null?void 0:n.amount.toString())===""?"0":(h=n==null?void 0:n.amount)==null?void 0:h.toString().replace(/,/g,"")).toString()}})},{cardId:d==null?void 0:d.originCardId,data:z(d)}},K=(r={})=>{const i=R(),t=E(V,r);return{...t,transaction:async(d,m)=>{const{onSuccess:x,onError:n,mutationOptions:a}=m;try{await B.promise(t.mutateAsync(d,a),{pending:"Procesando Transferencia ...",success:{render({data:s}){return i.fetchQuery([b.TRANSIT_BALANCE]),i.invalidateQueries([b.CARD_INFO,s==null?void 0:s.cardId]),i.fetchQuery([b.CARD_MOVEMENTS,s==null?void 0:s.cardId]),i.fetchQuery([b.MAIN_CARD]),x(s),"Se realizo la transferencia con éxito"}}})}catch(s){const h=D(s,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");n(h),B.error(h,{type:G(s)})}}}},S=M(T)(({theme:r})=>({"& td":{paddingTop:r.spacing(.5),paddingBottom:r.spacing(.5)}})),U=({data:r,onBack:i,setTransactionLoading:t,transactionLoading:u,onClose:d})=>{const{transaction:m,isLoading:x}=K(),n=C.useMemo(()=>(r!=null&&r.isGlobal?[r==null?void 0:r.transactions]:r==null?void 0:r.transactions)||[],[r]),a=C.useMemo(()=>(parseFloat(r==null?void 0:r.balance)-(r==null?void 0:r.currentBalance)).toFixed(2)||0,[r]),s=()=>{const{cardOriginId:l,transactions:g,isGlobal:j,concept:f}=r,A=H(l,g,f,j);t(!0),m(A,{onSuccess:()=>{d()},onError:()=>{t(!1)}})},h=C.useMemo(()=>$(r==null?void 0:r.paymentProcessor),[r]),v=h==null?void 0:h.component;return e.jsxs(e.Fragment,{children:[e.jsx(L,{children:e.jsx(N,{sx:{minWidth:200},children:e.jsxs(F,{children:[e.jsx(O,{sx:{borderBottom:l=>`solid 1px ${l.palette.divider}`},children:e.jsxs(T,{children:[e.jsx(o,{width:40,children:"#"}),e.jsx(o,{align:"left",children:"Movimiento"}),e.jsx(o,{align:"right",children:"Monto"})]})}),e.jsxs(W,{children:[n==null?void 0:n.map((l,g)=>{var j;return e.jsxs(T,{sx:{borderBottom:f=>`solid 1px ${f.palette.divider}`},children:[e.jsx(o,{children:g+1}),e.jsx(o,{align:"left",children:e.jsxs(P,{sx:{maxWidth:200},children:[e.jsx(p,{variant:"subtitle2",children:((j=l==null?void 0:l.card)==null?void 0:j.cardUserNumber)||"Cuenta Global"}),e.jsx(p,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:l==null?void 0:l.concept})]})}),e.jsx(o,{align:"right",children:y(l==null?void 0:l.amount)})]},g)}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsxs(I,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"flex-end",children:[e.jsx(p,{children:"Saldo Disponible"}),h&&e.jsx(v,{sx:{width:30,height:30}})]})}),e.jsx(o,{align:"right",width:120,children:e.jsx(p,{children:y(r==null?void 0:r.balance)})})]}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsx(p,{variant:"h6",children:"Total a dispersar"})}),e.jsx(o,{align:"right",width:120,children:e.jsx(p,{variant:"h6",sx:{color:"error.main"},children:y(-(r==null?void 0:r.currentBalance))})})]}),e.jsxs(S,{children:[e.jsx(o,{colSpan:1}),e.jsx(o,{align:"right",children:e.jsx(p,{children:"Total después de movimiento"})}),e.jsx(o,{align:"right",width:140,children:e.jsx(p,{children:y(a)})})]})]})]})})}),e.jsxs(I,{sx:{p:3},spacing:3,children:[e.jsx(Q,{size:"large",onClick:s,loading:x||u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",sx:{fontWeight:"bold"},children:"Realizar"}),(!x||!u)&&e.jsx(_,{onClick:i,variant:"outlined",color:"inherit",fullWidth:!0,startIcon:e.jsx(k,{}),children:"Regresar"})]})]})};U.propTypes={data:c.shape({balance:c.any,cardOriginId:c.any,paymentProcessor:c.any,currentBalance:c.any,isGlobal:c.any,transactions:c.any,concept:c.any}),onBack:c.any,onClose:c.func,setTransactionLoading:c.func,transactionLoading:c.any};export{U as default};
//# sourceMappingURL=ResumeTransactionForm--k1JZi8h.js.map
