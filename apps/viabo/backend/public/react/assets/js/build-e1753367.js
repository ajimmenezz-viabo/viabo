import{z as Z,j as r,r as h,a2 as J,B as K,S as i,T as q,p as j,H as M,V as Q,cC as X,D as u}from"./index-23408dd2.js";import{u as Y,b as _}from"./build-0d19139b.js";import{c as b,d as O,a as rr}from"./build-84a54290.js";import{u as tr}from"./build-eb506f09.js";import{F as sr,M as or}from"./build-99db375a.js";import{R as ar}from"./build-36c692ea.js";import{R as P}from"./build-53b28d89.js";import{A as er}from"./build-74a1b13a.js";import{C as nr}from"./build-26fbb83b.js";import{A as ir}from"./build-ef517207.js";import"./build-5f0084a1.js";import"./build-dedb6d40.js";import"./build-a1ec3a2c.js";import"./build-c875c593.js";import"./build-bfb17aff.js";import"./build-4ba3cb14.js";import"./build-9b1f8f5b.js";import"./build-a63161e6.js";import"./build-d00cf9da.js";import"./build-0354e1de.js";import"./build-cb395694.js";import"./build-9cdd5450.js";import"./build-70633a7e.js";import"./build-980fd41b.js";import"./build-54e0e54c.js";import"./build-2876f46a.js";import"./build-67a8e4e9.js";import"./build-e79ac7d8.js";import"./build-12c2fd0e.js";import"./build-79b895ac.js";import"./build-72154ec5.js";import"./build-c2dda577.js";import"./build-84b07bd3.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-1d5bebd4.js";import"./build-bb977102.js";import"./build-68d1d76d.js";import"./build-bee6630b.js";import"./build-6966c02a.js";import"./build-c8d964db.js";import"./build-7ab93eab.js";import"./build-86cd2417.js";import"./build-f2ae8137.js";import"./build-1fe99d79.js";import"./build-2f111781.js";const lr=Z(r.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");function cr({cards:E,setCurrentBalance:N,insufficient:g,isBinCard:l,onSuccess:U}){const y=h.useRef(null),H=window.crypto||window.msCrypto,B=new Uint32Array(1),S=H.getRandomValues(B)[0],[x,w]=h.useState(E),o=tr(t=>t==null?void 0:t.selectedCards),L=b().shape({transactions:O().of(b().shape({amount:rr().test("maxAmount","Monto m√°ximo de transferencia $50,000",function(t){return parseFloat(t==null?void 0:t.replace(/,/g,""))<=5e4}).required("La cantidad es requerida"),card:b().nullable().required("La tarjeta es requerida")}))}),F=Y({initialValues:{transactions:(o==null?void 0:o.length)>0&&l&&(o==null?void 0:o.map(t=>({id:Math.random(),card:{value:t==null?void 0:t.value,label:t==null?void 0:t.label,...t},amount:"",concept:""})))||[{id:S,card:null,amount:"",concept:""}]},validationSchema:L,onSubmit:t=>g?A(!1):(A(!1),U(t))}),{isSubmitting:G,setFieldValue:v,values:c,setSubmitting:A}=F,p=G;return h.useEffect(()=>{if(o&&l){const t=o==null?void 0:o.map(s=>({...s,isDisabled:!0}));w(t)}},[o,l]),h.useEffect(()=>{var a;const s=((a=c.transactions)==null?void 0:a.reduce((m,d)=>{const f=d.amount.trim()!==""?parseFloat(d.amount.replace(/,/g,"")):0;return isNaN(f)?m:m+f},0)).toFixed(2);N(s)},[c.transactions]),r.jsx(r.Fragment,{children:r.jsx(J,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(sr,{formik:F,children:r.jsxs(K,{sx:{p:3},children:[r.jsxs(i,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[r.jsx(q,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),r.jsx(i,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!l&&r.jsx(j,{type:"button",size:"small",variant:"outlined",startIcon:r.jsx(er,{}),disabled:p,onClick:()=>y.current.push({id:S,card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Nueva"})]}),r.jsx(_,{name:"transactions",render:t=>(y.current=t,r.jsx(i,{divider:r.jsx(M,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:c==null?void 0:c.transactions.map((s,a)=>{var I,C,R,D,T,k;const m=`transactions[${a}].card`,d=`transactions[${a}].amount`,f=`transactions[${a}].concept`;return r.jsxs(i,{alignItems:"flex-end",spacing:1.5,children:[((C=(I=s==null?void 0:s.card)==null?void 0:I.assignUser)==null?void 0:C.name)&&r.jsx(nr,{avatar:r.jsx(Q,{...X(((D=(R=s==null?void 0:s.card)==null?void 0:R.assignUser)==null?void 0:D.name)??"")}),label:(k=(T=s==null?void 0:s.card)==null?void 0:T.assignUser)==null?void 0:k.name}),r.jsxs(i,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[r.jsx(q,{variant:"overline",color:"text.disabled",children:a+1}),r.jsx(ar,{name:m,disabled:p||l,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:x||[],onChange:($,e)=>{const W=x==null?void 0:x.map(n=>{var z,V;return!(e!=null&&e.value)&&n.value===((z=s==null?void 0:s.card)==null?void 0:z.value)?{...n,isDisabled:!1}:n.value===(e==null?void 0:e.value)?{...n,isDisabled:!0}:n.value===((V=s==null?void 0:s.card)==null?void 0:V.value)?{...n,isDisabled:!1}:n});w(W),v(m,e)},sx:{width:{xs:1,lg:.6}}}),r.jsx(P,{sx:{width:{xs:1,lg:.4}},size:"small",name:d,required:!0,label:"Cantidad",placeholder:"0.00",disabled:p,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:or,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,scale:2,value:s.amount,onAccept:$=>{v(d,$)}}}})]}),r.jsx(i,{sx:{width:1},children:r.jsx(P,{name:f,multiline:!0,disabled:p,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),a!==0&&!l&&r.jsx(j,{size:"small",color:"error",disabled:p,startIcon:r.jsx(lr,{}),onClick:()=>t.remove(a),children:"Borrar"})]},s.id)})}))}),r.jsx(M,{sx:{my:3,borderStyle:"dashed"}}),r.jsx(i,{sx:{pt:3},children:r.jsx(j,{variant:"outlined",color:"primary",disabled:g,fullWidth:!0,type:"submit",startIcon:r.jsx(ir,{}),children:"Siguiente"})})]})})})})}cr.propTypes={cards:u.any,insufficient:u.any,isBinCard:u.any,onSuccess:u.func,setCurrentBalance:u.func};export{cr as default};
