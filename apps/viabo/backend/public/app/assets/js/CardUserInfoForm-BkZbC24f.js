import{f as M,a9 as j,c as K,r as A,i as t,S as i,A as X,T as c,aH as w,a0 as W,a2 as J,P as Z}from"./vendor-CEMfbhOc.js";import{u as I}from"./formik.esm-Dshy1xjd.js";import{C as ee}from"./mui-tel-input.es-DuWRtnpZ.js";import{c as te,a as R}from"./index.esm-C2GVbld4.js";import{g as k,a as V,a9 as se,S as ae,y as re}from"./index-B-U8M-8N.js";import{a as ie}from"./crypto--V-xCCVf.js";import{r as oe,b as ne,c as le}from"./AllCommerceCards-UfKmxhyg.js";import{i as b}from"./matchTypes-BFKCRNnN.js";import{A as ce}from"./useToggleStatusCard-CU00NBE9.js";import{F as de,R as L}from"./TextMaxLine-D6XZvUuW.js";import"./csv-BGNpG_Xb.js";import"./cardsAdapter-BbJ4Fs0Z.js";import"./formatNumber-Df8NwpjV.js";import"./formatTime-mlJJpQBT.js";import"./CarnetLogo-BssSE0Ex.js";import"./MasterCardLogo-Bcn9gvbj.js";import"./operationTypes-BbkqNKhX.js";import"./viabo-card-CcTpX9JZ.js";import"./viabo-pay-Tb0TUikx.js";import"./MaterialDataTable-CDmLz-NL.js";import"./useMaterialTable-9wOa4uxn.js";import"./HeaderPage-DRv2GeZX.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./cardMovementsAdapter-ocC5swCp.js";import"./UploadSingleFile-B0jkdwVt.js";const me=(s,e)=>{var d;const p={ownerId:(d=e==null?void 0:e.assignUser)==null?void 0:d.id,name:s==null?void 0:s.name,lastName:s==null?void 0:s.lastName,phone:s==null?void 0:s.phone};return ie(p)},pe=(s={})=>{const e=M(oe,s);return{...e,mutate:async(d,g={})=>{const{onSuccess:u,onError:o,...h}=g;try{await j.promise(e.mutateAsync(d,h),{pending:"Restableciendo Contraseña ...",success:{render({data:n}){return b(u)&&u(n),"Se restableció la contraseña con éxito"}}})}catch(n){const r=k(n,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");b(o)&&o(r),j.error(r,{type:V(n)})}}}},ue=(s={})=>{const e=K(),p=M(ne,s);return{...p,mutate:async(g,u={})=>{const{onSuccess:o,onError:h,...n}=u;try{await j.promise(p.mutateAsync(g,n),{pending:"Actualizando información ...",success:{render({data:r}){return e.invalidateQueries([ce.LIST]),b(o)&&o(r),"Se actualizo con éxito"}}})}catch(r){const l=k(r,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");b(h)&&h(l),j.error(l,{type:V(r)})}}}},m={UPDATE_USER_INFO:"1",RECOVERY_PASSWORD:"2"},he=({handleSuccess:s})=>{var N,P,_,T,F,f,D,z;const e=le(a=>a.cardInfo),{mutate:p,isLoading:d}=ue(),{mutate:g,isLoading:u}=pe(),[o,h]=A.useState(((N=e==null?void 0:e.assignUser)==null?void 0:N.name)||""),[n,r]=A.useState(!1),[l,y]=A.useState(null),Y=te({name:R().required("El nombre es requerido"),lastName:R(),phone:R().test("longitud","El teléfono es muy corto",a=>!(a&&a.replace(/[\s+]/g,"").length<10))}),v=I({initialValues:{name:((P=e==null?void 0:e.assignUser)==null?void 0:P.name)||"",phone:((_=e==null?void 0:e.assignUser)==null?void 0:_.phone)||"",lastName:((T=e==null?void 0:e.assignUser)==null?void 0:T.lastName)||""},enableReinitialize:!0,validationSchema:Y,onSubmit:(a,{setSubmitting:S})=>{if(l===m.UPDATE_USER_INFO){const H=me(a,e);p(H,{onSuccess:()=>{s(),y(null)}})}S(!1)}}),{values:E,setFieldValue:B,touched:C,errors:O,isSubmitting:q,handleSubmit:$}=v,x=d||q||u;A.useEffect(()=>{var a;E.name?h(E.name):h((a=e==null?void 0:e.assignUser)==null?void 0:a.name)},[E.name]);const U=A.useMemo(()=>se(o),[o]),Q=()=>{g(e==null?void 0:e.assignUser,{onSuccess:()=>{s(),y(null)}})},G=()=>{r(!1),l===m.UPDATE_USER_INFO&&$(),l===m.RECOVERY_PASSWORD&&Q()};return t.jsxs(t.Fragment,{children:[t.jsx(ae,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:t.jsx(de,{formik:v,children:t.jsxs(i,{spacing:2,sx:{p:3},children:[t.jsx(i,{spacing:.5,children:t.jsxs(i,{justifyContent:"center",alignItems:"center",spacing:1,children:[t.jsx(X,{variant:"rounded",src:"",color:"warning",alt:o,sx:{backgroundColor:a=>{var S;return(S=a.palette[U.color])==null?void 0:S.main},width:80,height:80,color:"white"},children:U.name}),t.jsx(c,{component:w,href:`mailto:${(F=e==null?void 0:e.assignUser)==null?void 0:F.email}`,variant:"body2",children:((f=e==null?void 0:e.assignUser)==null?void 0:f.email)??"-"}),t.jsx(i,{spacing:.5,alignItems:"center",children:(D=e==null?void 0:e.assignUser)!=null&&D.lastLogged?t.jsxs(t.Fragment,{children:[t.jsx(c,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"Último Inicio de Sesión:"}),t.jsx(c,{paragraph:!0,variant:"body2",sx:{color:"text.disabled"},children:((z=e==null?void 0:e.assignUser)==null?void 0:z.lastLogged)??"🚀"})]}):t.jsx(c,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"No ha iniciado sesión 🚀"})}),t.jsx(i,{children:t.jsx(W,{variant:"contained",color:"secondary",loading:u,disabled:x,sx:{color:"text.primary",fontWeight:"bolder"},onClick:()=>{y(m.RECOVERY_PASSWORD),r(!0)},children:"Restablecer Contraseña"})})]})}),t.jsxs(i,{spacing:.5,children:[t.jsx(c,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s)"}),t.jsx(L,{name:"name",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(c,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos"}),t.jsx(L,{name:"lastName",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(c,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),t.jsx(ee,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:E.phone||"+52",disabled:x,onChange:(a,S)=>{B("phone",a)},error:C.phone&&!!O.phone,helperText:C.phone&&O.phone})]}),t.jsx(i,{pt:2,children:t.jsx(W,{size:"large",variant:"contained",color:"primary",fullWidth:!0,loading:d,disabled:x,onClick:()=>{y(m.UPDATE_USER_INFO),r(!0)},children:"Actualizar"})})]})})}),n&&t.jsx(re,{title:l===m.UPDATE_USER_INFO?"Actualizar Usuario":"Restablecer Contraseña",typeAlert:"warning",textButtonSuccess:"Si, estoy de acuerdo",onClose:()=>{r(!1)},open:n,isSubmitting:!1,description:t.jsxs(i,{spacing:2,children:[t.jsx(c,{children:l===m.UPDATE_USER_INFO?"¿Está seguro de actualizar la información de este usuario?":"¿Está seguro de restablecer la contraseña de este usuario?"}),l===m.RECOVERY_PASSWORD&&t.jsxs(i,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(J,{}),t.jsx(i,{children:t.jsx(c,{variant:"caption",children:"Se enviara una notificación via correo electrónico con los cambios realizados"})})]})]}),onSuccess:G,fullWidth:!0,maxWidth:"xs"})]})};he.propTypes={handleSuccess:Z.func};export{he as default};
//# sourceMappingURL=CardUserInfoForm-BkZbC24f.js.map
