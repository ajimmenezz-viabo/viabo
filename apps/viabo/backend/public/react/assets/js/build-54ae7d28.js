import{a as W,a0 as A,g as M,b as q,k as X,r as j,aH as G,j as t,a3 as H,S as i,X as K,T as l,L as D,D as J}from"./index-be176464.js";import{u as Z}from"./build-f1e2ed79.js";import{$ as w}from"./build-260f3019.js";import{c as I,a as v}from"./build-4b51401b.js";import{a as ee}from"./build-f0aa92ba.js";import{r as te,b as se,A as ae,c as re}from"./build-78e6e7e7.js";import{i as E}from"./build-f3d6ad6d.js";import{F as ie}from"./build-3fdf003c.js";import{R as k}from"./build-4f7135b9.js";import{a as oe}from"./build-726930e2.js";import{L as ne}from"./build-112d79ca.js";import{W as le}from"./build-07913b04.js";import"./build-865f3cc7.js";import"./build-bc852905.js";import"./build-3edaa701.js";import"./build-199169fb.js";import"./build-aeaad37b.js";import"./build-a5ba83d8.js";import"./build-d6c61d92.js";import"./build-d9ab66fd.js";import"./build-03bd94ba.js";import"./build-8047ff64.js";import"./build-bee6630b.js";import"./build-6bd3f839.js";import"./build-b46d1600.js";import"./build-7cb492e3.js";import"./build-59cb91f6.js";import"./build-a3d9f42b.js";import"./build-82cbb840.js";const ce=(s,e)=>{var c;const m={ownerId:(c=e==null?void 0:e.assignUser)==null?void 0:c.id,name:s==null?void 0:s.name,lastName:s==null?void 0:s.lastName,phone:s==null?void 0:s.phone};return ee(m)},me=(s={})=>{const e=W(te,s);return{...e,mutate:async(c,h={})=>{const{onSuccess:d,onError:o,...p}=h;try{await A.promise(e.mutateAsync(c,p),{pending:"Restableciendo Contraseña ...",success:{render({data:n}){return E(d)&&d(n),"Se restableció la contraseña con éxito"}}})}catch(n){const r=M(n,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(o)&&o(r),A.error(r,{type:q(n)})}}}},de=(s={})=>{const e=X(),m=W(se,s);return{...m,mutate:async(h,d={})=>{const{onSuccess:o,onError:p,...n}=d;try{await A.promise(m.mutateAsync(h,n),{pending:"Actualizando información ...",success:{render({data:r}){return e.invalidateQueries([ae.LIST]),E(o)&&o(r),"Se actualizo con éxito"}}})}catch(r){const u=M(r,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(p)&&p(u),A.error(u,{type:q(r)})}}}},g={UPDATE_USER_INFO:"1",RECOVERY_PASSWORD:"2"},pe=({handleSuccess:s})=>{var O,P,T,F,_,f,L,z;const e=re(a=>a.cardInfo),{mutate:m,isLoading:c}=de(),{mutate:h,isLoading:d}=me(),[o,p]=j.useState(((O=e==null?void 0:e.assignUser)==null?void 0:O.name)||""),[n,r]=j.useState(!1),[u,b]=j.useState(null),V=I({name:v().required("El nombre es requerido"),lastName:v().required("El apellido es requerido"),phone:v().test("longitud","El teléfono es muy corto",a=>!(a&&a.replace(/[\s+]/g,"").length<10))}),R=Z({initialValues:{name:((P=e==null?void 0:e.assignUser)==null?void 0:P.name)||"",phone:((T=e==null?void 0:e.assignUser)==null?void 0:T.phone)||"",lastName:((F=e==null?void 0:e.assignUser)==null?void 0:F.lastName)||""},enableReinitialize:!0,validationSchema:V,onSubmit:(a,{setSubmitting:S})=>{if(u===g.UPDATE_USER_INFO){const Q=ce(a,e);m(Q,{onSuccess:()=>{s(),b(null)}})}u===g.RECOVERY_PASSWORD&&h(e==null?void 0:e.assignUser,{onSuccess:()=>{s(),b(null)}}),S(!1)}}),{values:y,setFieldValue:Y,touched:C,errors:N,isSubmitting:$,handleSubmit:B}=R,x=c||$||d;j.useEffect(()=>{var a;y.name?p(y.name):p((a=e==null?void 0:e.assignUser)==null?void 0:a.name)},[y.name]);const U=j.useMemo(()=>G(o),[o]);return t.jsxs(t.Fragment,{children:[t.jsx(H,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:t.jsx(ie,{formik:R,children:t.jsxs(i,{spacing:2,sx:{p:3},children:[t.jsx(i,{spacing:.5,children:t.jsxs(i,{justifyContent:"center",alignItems:"center",spacing:1,children:[t.jsx(K,{variant:"rounded",src:"",color:"warning",alt:o,sx:{backgroundColor:a=>{var S;return(S=a.palette[U.color])==null?void 0:S.main},width:80,height:80,color:"white"},children:U.name}),t.jsx(l,{component:ne,href:`mailto:${(_=e==null?void 0:e.assignUser)==null?void 0:_.email}`,variant:"body2",children:((f=e==null?void 0:e.assignUser)==null?void 0:f.email)??"-"}),t.jsx(i,{spacing:.5,alignItems:"center",children:(L=e==null?void 0:e.assignUser)!=null&&L.lastLogged?t.jsxs(t.Fragment,{children:[t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"Último Inicio de Sesión:"}),t.jsx(l,{paragraph:!0,variant:"body2",sx:{color:"text.disabled"},children:((z=e==null?void 0:e.assignUser)==null?void 0:z.lastLogged)??"🚀"})]}):t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"No ha iniciado sesión 🚀"})}),t.jsx(i,{children:t.jsx(D,{variant:"contained",color:"secondary",loading:d,disabled:x,sx:{color:"black"},onClick:()=>{b(g.RECOVERY_PASSWORD),r(!0)},children:"Restablecer Contraseña"})})]})}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s)"}),t.jsx(k,{name:"name",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos"}),t.jsx(k,{name:"lastName",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),t.jsx(w,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:y.phone||"+52",disabled:x,onChange:(a,S)=>{Y("phone",a)},error:C.phone&&!!N.phone,helperText:C.phone&&N.phone})]}),t.jsx(i,{pt:2,children:t.jsx(D,{size:"large",variant:"contained",color:"primary",fullWidth:!0,loading:c,disabled:x,onClick:()=>{b(g.UPDATE_USER_INFO),r(!0)},children:"Actualizar"})})]})})}),n&&t.jsx(oe,{title:u===g.UPDATE_USER_INFO?"Actualizar Usuario":"Restablecer Contraseña",typeAlert:"warning",textButtonSuccess:"Si, estoy de acuerdo",onClose:()=>{r(!1)},open:n,isSubmitting:!1,description:t.jsxs(i,{spacing:2,children:[t.jsx(l,{children:u===g.UPDATE_USER_INFO?"¿Está seguro de actualizar la información de este usuario":"¿Está seguro de restablecer la contraseña de este usuario"}),t.jsxs(i,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(le,{}),t.jsx(i,{children:t.jsx(l,{variant:"caption",children:"Se enviara una notificación via correo electrónico con los cambios realizados"})})]})]}),onSuccess:()=>{r(!1),B()},fullWidth:!0,maxWidth:"xs"})]})};pe.propTypes={handleSuccess:J.func};export{pe as default};
