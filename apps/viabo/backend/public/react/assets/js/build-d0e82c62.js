import{y as ue,j as e,C as x,r as f,a7 as pe,S as A,T as S,a8 as T,d as me,g as ge,a9 as B,n as he,B as v,p as fe,U as H,I as _,E as xe,$ as O,k as Se,P as Ce,a4 as Ae,a5 as Ee,a6 as je,aa as q,ab as $}from"./index-ceb2a577.js";import{A as W,u as ve}from"./build-38cc5667.js";import{r as Ie,i as ye,a as be,b as _e,H as Te}from"./build-72da39ef.js";import{B as we}from"./build-315820ab.js";import{F as Pe,g as Oe}from"./build-ec731fa0.js";import{C as De}from"./build-4a33b954.js";import{g as Fe}from"./build-252ef4a4.js";import{c as Le}from"./build-34807897.js";import{M as ze}from"./build-67c91909.js";import{g as Ne}from"./build-b598a037.js";import{M as Me,S as Re,F as Ue,a as Ve,b as ke}from"./build-b5ba967f.js";import{L as He,a as Be}from"./build-917d21e8.js";import{L as qe}from"./build-0370a01b.js";import{C as $e}from"./build-90e07471.js";import{A as We}from"./build-911a84ff.js";const Ke=ue([e.jsx("circle",{cx:"10",cy:"8",r:"4"},"0"),e.jsx("path",{d:"M10.67 13.02c-.22-.01-.44-.02-.67-.02-2.42 0-4.68.67-6.61 1.82-.88.52-1.39 1.5-1.39 2.53V20h9.26c-.79-1.13-1.26-2.51-1.26-4 0-1.07.25-2.07.67-2.98zM20.75 16c0-.22-.03-.42-.06-.63l1.14-1.01-1-1.73-1.45.49c-.32-.27-.68-.48-1.08-.63L18 11h-2l-.3 1.49c-.4.15-.76.36-1.08.63l-1.45-.49-1 1.73 1.14 1.01c-.03.21-.06.41-.06.63s.03.42.06.63l-1.14 1.01 1 1.73 1.45-.49c.32.27.68.48 1.08.63L16 21h2l.3-1.49c.4-.15.76-.36 1.08-.63l1.45.49 1-1.73-1.14-1.01c.03-.21.06-.41.06-.63zM17 18c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"},"1")],"ManageAccounts"),Qe=t=>{const c=Fe(t==null?void 0:t.ciphertext,t==null?void 0:t.iv);if(c&&Array.isArray(c)){const a=c==null?void 0:c.map(m=>De(m)),s=Le(a,"id","cardUserNumber")||[];return{data:s,meta:{total:(s==null?void 0:s.length)??0}}}throw new Error("No se pueden obtener las tarjetas")};var F={},Ye=ye;Object.defineProperty(F,"__esModule",{value:!0});var K=F.default=void 0,Ge=Ye(Ie()),Je=e,Xe=(0,Ge.default)((0,Je.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");K=F.default=Xe;const Q=({open:t,anchorEl:c,handlePopoverClose:a,data:s})=>{var m,i,g;return s?e.jsx(pe,{id:"mouse-over-popover",sx:{pointerEvents:"none"},open:t,anchorEl:c,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},onClose:a,disableRestoreFocus:!0,slotProps:{paper:{sx:{mt:1.5,ml:.5,overflow:"inherit",boxShadow:u=>u.customShadows.z20,border:u=>`solid 1px ${u.palette.grey[5008]}`,width:200}}},children:e.jsxs(A,{spacing:2,p:2,children:[e.jsxs(A,{spacing:.5,flex:1,children:[e.jsx(S,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s):"}),e.jsx(S,{variant:"body2",children:((m=s==null?void 0:s.assignUser)==null?void 0:m.name)??"-"})]}),e.jsxs(A,{spacing:.5,flex:1,children:[e.jsx(S,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos:"}),e.jsx(S,{variant:"body2",children:((i=s==null?void 0:s.assignUser)==null?void 0:i.lastName)??"-"})]}),e.jsxs(A,{spacing:.5,flex:1,children:[e.jsx(S,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono:"}),e.jsx(S,{variant:"body2",children:((g=s==null?void 0:s.assignUser)==null?void 0:g.phone)??"-"})]})]})}):null};Q.propTypes={anchorEl:x.any,data:x.shape({assignUser:x.shape({lastName:x.string,name:x.string,phone:x.string})}),handlePopoverClose:x.any,open:x.any};const Ze=f.memo(Q),es=async(t,c)=>{const{columnFilters:a,globalFilter:s,pageIndex:m,pageSize:i,sorting:g}=t,u=new URL("/api/cards/commerce",window.location.origin);u.searchParams.set("start",`${m*i}`),u.searchParams.set("size",`${i}`),u.searchParams.set("filters",JSON.stringify(a??[])),u.searchParams.set("globalFilter",s??""),u.searchParams.set("sorting",JSON.stringify(g??[]));const{data:I}=await T.get(u.href,{signal:c});return Qe(I)},ys=async t=>(await T.put("/api/assign/commerce-card/to/user",t),t),bs=async t=>{const{data:c}=await T.put("/api/card-owner/data/update",t);return c},_s=async t=>{const{data:c}=await T.put(`/api/card-owner/password/reset/${t.id}`);return c},ss=(t={},c={})=>{const{columnFilters:a,globalFilter:s,pageIndex:m,pageSize:i,sorting:g}=t,[u,I]=f.useState(null);return{...me({queryKey:[W.LIST,a,s,m,i,g],queryFn:async({signal:j})=>es(t,j),keepPreviousData:!0,onError:j=>{const w=ge(j,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");I(w)},staleTime:6e4,refetchOnWindowFocus:!1,...c}),error:u||null}},rs={cardInfo:null,openUserInfo:!1,hoverInfo:null,hoverElement:null},ts=(t,c)=>({...rs,setOpenUserInfo:a=>{t(s=>({openUserInfo:a}),!1,"SET_OPEN_USER_INFO_MODAL")},setCardInfo:a=>{t(s=>({cardInfo:a}),!1,"SET_CARD_INFO")},setHoverInfo:a=>{t(s=>({hoverInfo:a}),!1,"SET_HOVER_INFO")},setHoverElement:a=>{t(s=>({hoverElement:a}),!1,"SET_HOVER_ElEMENT")}}),Y=B(ts),ns={cards:[],rows:[],openAssign:!1},as=(t,c)=>({...ns,setSelectedCard:a=>{const{cards:s}=c(),m=s.indexOf(a);let i=[];m===-1?i=i.concat(s,a):m===0?i=i.concat(s.slice(1)):m===s.length-1?i=i.concat(s.slice(0,-1)):m>0&&(i=i.concat(s.slice(0,m),s.slice(m+1))),t(g=>({cards:i}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{t(s=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{t(s=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{t(s=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),D=B(as),os=({refCommerceCardsTable:t})=>{var k;const[c,a]=f.useState([]),[s,m]=f.useState(""),[i,g]=f.useState([]),[u,I]=f.useState({pageIndex:0,pageSize:10}),[L,j]=f.useState({}),{setOpenUserInfo:w,setCardInfo:G}=Y(r=>r),J=D(r=>r.setOpenAssign),X=D(r=>r.setAllCards),Z=he(),{data:E,isLoading:y,isFetching:ee,isError:z,error:se,refetch:re}=ss({columnFilters:c??[],globalFilter:s??"",pageIndex:(u==null?void 0:u.pageIndex)??0,pageSize:(u==null?void 0:u.pageSize)??10,sorting:i??[]}),{mutate:te,isLoading:ne}=ve(),[N,M]=f.useState(null),[ae,R]=f.useState(null),[oe,P]=f.useState(null),le=r=>{M(r.currentTarget)},U=()=>{M(null),R(null)},V=!!N,C=f.useMemo(()=>[{id:"cardNumber",accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,size:120,Cell:({cell:r,column:l,row:o})=>{var h,p;const{original:n}=o;return e.jsxs(A,{direction:"row",spacing:1,alignItems:"center",children:[(n==null?void 0:n.cardType)==="Carnet"?e.jsx(be,{sx:{width:25,height:25}}):e.jsx(ze,{sx:{width:25,height:25}}),e.jsx(S,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:(p=n==null?void 0:n.cardNumber)==null?void 0:p.substr(((h=n==null?void 0:n.cardNumber)==null?void 0:h.length)-4)})]})}},{id:"assigned",accessorFn:r=>{var l;return((l=r==null?void 0:r.assignUser)==null?void 0:l.fullName)||null},Cell:({cell:r,column:l,row:o,renderedCellValue:n})=>{const{original:h}=o;return n!=="-"?e.jsx(A,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(qe,{color:"info.main",underline:"none",variant:"subtitle2",component:S,"aria-owns":V?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:p=>{le(p),R(h)},onMouseLeave:U,children:n})}):n},header:"Asignado",minSize:150},{id:"methods",accessorKey:"methods",header:"Métodos de Fondeo",minSize:120,Cell:({cell:r,column:l,row:o})=>{const n=[],h=["SPEI","PAYCASH"];return h==null||h.forEach(p=>{const d=Ne(p);d&&n.push({component:d==null?void 0:d.component,width:p==="PAYCASH"?50:30,height:p==="PAYCASH"?50:30})}),e.jsx(A,{flexDirection:"row",alignItems:"center",gap:1,children:n==null?void 0:n.map(({component:p,width:d,height:b},de)=>e.jsx(p,{sx:{width:d,height:b}},de))})}},{id:"status",accessorFn:r=>{var l;return((l=r==null?void 0:r.cardStatus)==null?void 0:l.name)||null},header:"Estado",filterVariant:"select",minSize:100,Cell:({cell:r,column:l,row:o,renderedCellValue:n})=>{var p;const{original:h}=o;return n?e.jsx(v,{sx:{display:"flex",pt:1},children:e.jsx(He,{variant:Z.palette.mode==="light"?"ghost":"filled",color:(p=h==null?void 0:h.cardStatus)!=null&&p.isActive?"success":"error",sx:{textTransform:"capitalize"},children:n})}):null}}],[]),ie=r=>()=>{var p;const l=((p=r.getSelectedRowModel().flatRows)==null?void 0:p.map(d=>d.original))??[],o=l.some(d=>(d==null?void 0:d.cvv)==="")&&(l==null?void 0:l.length)>1,n=l.some(d=>{var b;return((b=d==null?void 0:d.assignUser)==null?void 0:b.id)!==""});l.every(d=>(d==null?void 0:d.cvv)==="")&&(l==null?void 0:l.length)>1?O.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):o?O.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):n?O.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):(X(l),J(!0))},ce=r=>()=>{try{const l=r.getSortedRowModel().rows.map(o=>(C==null?void 0:C.map(n=>o.getValue(n.accessorKey)))||[])??[];Oe((C==null?void 0:C.map(o=>o.header))||[],l,"Stock del comercio")}catch{}};return e.jsx(v,{maxWidth:"lg",children:e.jsxs($e,{children:[e.jsx(Ze,{anchorEl:N,open:V,handlePopoverClose:U,data:ae}),e.jsx(Me,{tableInstanceRef:t,enablePinning:!0,enableColumnOrdering:!1,enableColumnFilterModes:!1,enableStickyHeader:!0,enableRowVirtualization:!0,enableRowActions:!0,positionActionsColumn:"last",enableDensityToggle:!1,enableFacetedValues:!0,columns:C,data:(E==null?void 0:E.data)||[],isError:z,textError:se,selectAllMode:"all",onRowSelectionChange:j,rowCount:((k=E==null?void 0:E.meta)==null?void 0:k.total)??0,initialState:{density:"compact",sorting:[{id:"assigned",desc:!0}]},state:{isLoading:y,showAlertBanner:z,showProgressBars:ee,rowSelection:L??{}},enableRowSelection:!0,displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:100},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:r})=>e.jsx(v,{sx:{display:"flex",gap:"1rem"},children:e.jsx(fe,{onClick:ie(r),disabled:!r.getIsSomeRowsSelected(),startIcon:e.jsx(We,{width:24,height:24}),children:"Asociar"})}),muiTableBodyRowProps:({row:r})=>({sx:l=>({backgroundColor:l.palette.background.paper})}),renderToolbarInternalActions:({table:r})=>e.jsxs(v,{children:[e.jsx(H,{arrow:!0,title:"Actualizar",children:e.jsx(_,{onClick:()=>re(),children:e.jsx(K,{})})}),e.jsx(Re,{table:r}),e.jsx(H,{title:"Descargar",children:e.jsx(_,{disabled:r.getPrePaginationRowModel().rows.length===0,onClick:ce(r),children:e.jsx(Pe,{})})}),e.jsx(Ue,{table:r}),e.jsx(Ve,{table:r}),e.jsx(ke,{table:r})]}),renderRowActions:({row:r,table:l})=>{var p,d;const{original:o}=r,n=(p=o==null?void 0:o.cardStatus)==null?void 0:p.isActive,h=ne&&oe===(o==null?void 0:o.id);return e.jsxs(v,{sx:{display:"flex",flex:1,justifyContent:"flex-start",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:[e.jsx(_,{size:"small",color:"primary",disabled:y,children:e.jsx(we,{})}),((d=o==null?void 0:o.assignUser)==null?void 0:d.fullName)!=="-"&&e.jsx(_,{size:"small",color:"primary",disabled:y,onClick:()=>{G(o),w(!0)},children:e.jsx(Ke,{})}),h?e.jsx(xe,{size:15,containerProps:{display:"flex",ml:1}}):e.jsx(Be,{disabled:y,size:"sm",color:n?"success":"error",checked:n||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{P(o==null?void 0:o.id),te({...o,cardON:!n},{onSuccess:()=>{P(null)},onError:()=>{P(null)}})}})]})}})]})})},ls=q(f.lazy(()=>$(()=>import("./build-3e3168be.js"),["assets/js/build-3e3168be.js","assets/js/index-ceb2a577.js","assets/css/build-f63bc8fe.css","assets/js/build-4656f9d7.js","assets/js/build-90e07471.js","assets/js/build-1ec4edbf.js","assets/js/build-e0e5ce32.js","assets/js/build-252ef4a4.js","assets/js/build-e2ee1bad.js","assets/js/build-38cc5667.js","assets/js/build-d7898e7a.js","assets/js/build-4a33b954.js","assets/js/build-83b0b9da.js","assets/js/build-bee6630b.js","assets/js/build-642c4299.js","assets/js/build-72da39ef.js","assets/js/build-b9f1d6f1.js","assets/js/build-0370a01b.js","assets/js/build-34807897.js","assets/js/build-63b2c701.js","assets/js/build-315820ab.js","assets/js/build-6206e84c.js","assets/js/build-ec731fa0.js","assets/js/build-67c91909.js","assets/js/build-b598a037.js","assets/js/build-83d17a75.js","assets/js/build-899176f2.js","assets/js/build-b5ba967f.js","assets/js/build-e79f5646.js","assets/js/build-f80ec623.js","assets/js/build-7c32511c.js","assets/js/build-4a0ca7ff.js","assets/js/build-aec21bfe.js","assets/js/build-917d21e8.js","assets/js/build-fdbefae6.js","assets/js/build-911a84ff.js"]))),is=q(f.lazy(()=>$(()=>import("./build-a0f0f48b.js"),["assets/js/build-a0f0f48b.js","assets/js/index-ceb2a577.js","assets/css/build-f63bc8fe.css","assets/js/build-4656f9d7.js","assets/js/build-90e07471.js","assets/js/build-1ec4edbf.js","assets/js/build-e0e5ce32.js"])));function cs(){const{openAssign:t,setOpenAssign:c}=D(g=>g),{openUserInfo:a,setOpenUserInfo:s}=Y(g=>g),m=Se(),i=f.useRef(null);return f.useEffect(()=>()=>{const g=Object.values(W);m.cancelQueries(g)},[]),e.jsx(e.Fragment,{children:e.jsx(Ce,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(_e,{sx:{height:"100%"},children:[e.jsx(Te,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Ae.root},{name:"Viabo Card",href:Ee.allCards},{name:je.allCards.name}]}),e.jsx(os,{refCommerceCardsTable:i}),e.jsx(ls,{open:t,handleClose:()=>{c(!1)},handleSuccess:()=>{var g;c(!1),(g=i==null?void 0:i.current)==null||g.resetRowSelection()}}),e.jsx(is,{open:a,handleClose:()=>{s(!1)},handleSuccess:()=>{s(!1)}})]})})})}const Ts=Object.freeze(Object.defineProperty({__proto__:null,default:cs},Symbol.toStringTag,{value:"Module"}));export{Ts as A,ys as a,bs as b,Y as c,_s as r,D as u};
