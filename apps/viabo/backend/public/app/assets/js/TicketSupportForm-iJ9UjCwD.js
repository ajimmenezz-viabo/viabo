import{c as L,f as I,a9 as j,s as A,P as f,i as o,S as m,T as h,m as B,B as v,a0 as D}from"./vendor-FSZoD0Ty.js";import{u as P}from"./formik.esm--ft-gNTR.js";import{c as C,a as N}from"./index.esm-ZMwb309P.js";import{c as S}from"./getColorName-MAOZYUOa.js";import{g as W,a as z}from"./index-s6HyWPbs.js";import{i as F}from"./matchTypes-_pBEYOAq.js";import{T as w}from"./tickets-support-list-keys-ThL685Ct.js";import{n as G}from"./TicketSupportDrawer-oRRy70P4.js";import{F as O,R as V,d as _}from"./TextMaxLine-PpgibfDP.js";import"./UploadSingleFile-RRpuU-ga.js";import"./fade-HpdRXKiE.js";import"./transition-Uc7vb3zK.js";import"./formatNumber-IeezKRXK.js";const k=r=>{var i,n;const t=new FormData,s={supportReasonId:(i=r==null?void 0:r.cause)==null?void 0:i.id,description:r==null?void 0:r.description};return(n=Object.entries(s))==null||n.forEach(([p,l])=>{t.append(p,l)}),r!=null&&r.file&&t.append("files",r==null?void 0:r.file),t},M=(r={})=>{const t=L(),s=I(G,r);return{...s,mutate:async(n,p)=>{const{onSuccess:l,onError:u,mutationOptions:a}=p;try{const d=await j.promise(s.mutateAsync(n,a),{pending:"Generando ticket de soporte ...",success:{render({data:c}){return F(l)&&l(c),"Se genero el ticket con éxito"}}});t.invalidateQueries([w.ASSIGNED_LIST]),t.invalidateQueries([w.GENERATED_LIST])}catch(d){const c=W(d,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");F(u)&&u(c),j.error(c,{type:z(d)})}}}},Q=A("span")(({theme:r,ownerState:t})=>{const s=r.palette.mode==="light",{color:i,variant:n}=t,p=a=>({color:S(a)||r.palette.text.primary,backgroundColor:a}),l=a=>({color:S(a)||r.palette.text.primary,backgroundColor:"transparent",border:`1px solid ${a}`}),u=a=>{const d=a;return{color:S(d),backgroundColor:a?d:"inherit"}};return{height:22,minWidth:22,lineHeight:0,borderRadius:8,cursor:"default",alignItems:"center",whiteSpace:"nowrap",display:"inline-flex",justifyContent:"center",padding:r.spacing(0,1),color:r.palette.grey[800],fontSize:r.typography.pxToRem(12),fontFamily:r.typography.fontFamily,backgroundColor:r.palette.grey[300],fontWeight:r.typography.fontWeightBold,...i!=="default"?{...n==="filled"&&{...p(i)},...n==="outlined"&&{...l(i)},...n==="ghost"&&{...u(i)}}:{...n==="outlined"&&{backgroundColor:"transparent",color:r.palette.text.primary,border:`1px solid ${r.palette.grey[50032]}`},...n==="ghost"&&{color:s?r.palette.text.secondary:r.palette.common.white,backgroundColor:r.palette.grey[50016]}}}});E.propTypes={children:f.node,color:f.string,variant:f.oneOf(["filled","outlined","ghost"])};function E({color:r="default",variant:t="ghost",children:s,...i}){return o.jsx(Q,{ownerState:{color:r,variant:t},...i,children:s})}const $=({causes:r=[],onSuccess:t})=>{var b;const{mutate:s,isLoading:i}=M(),n=C().shape({cause:C().nullable().required("La causa es necesaria"),description:N().trim().max(200,"Máximo 200 caracteres").required("La descripción del ticket es necesaria")}),p=P({initialValues:{cause:null,description:"",file:null},validationSchema:n,onSubmit:(e,{setSubmitting:x,setFieldValue:y})=>{const g=k(e);s(g,{onSuccess:()=>{x(!1),t()},onError:()=>{x(!1)}})}}),{values:l,setFieldValue:u,setTouched:a,isSubmitting:d,errors:c}=p,T=d||i,R=e=>{u("cause",e)};return o.jsx(O,{formik:p,children:o.jsxs(m,{spacing:2,children:[o.jsxs(m,{spacing:1,children:[o.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Seleccione una Causa"}),o.jsx(m,{flexDirection:"row",flexWrap:"wrap",gap:1,children:r==null?void 0:r.map(e=>{var y;const x=((y=l.cause)==null?void 0:y.id)===(e==null?void 0:e.id);return o.jsx(E,{variant:x?"ghost":"filled",color:e==null?void 0:e.color,sx:{textTransform:"uppercase",marginRight:1,marginBottom:2,cursor:"pointer",...!(e!=null&&e.color)&&{border:"2px dashed",borderColor:g=>g.palette.text.disabled},...x&&{border:"3px solid",borderColor:g=>g.palette.primary.main}},children:o.jsx(B.div,{onClick:()=>R(e),whileHover:{scale:1.03},whileTap:{scale:.8},children:e==null?void 0:e.cause},e==null?void 0:e.id)},e==null?void 0:e.id)})}),o.jsxs(m,{spacing:1,children:[o.jsxs(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Causa:"," ",o.jsx(v,{component:"span",color:"error.main",children:"*"})]}),o.jsx(h,{fontWeight:"bold",color:c.cause?"error.main":"text.primary",variant:"subtitle1",children:((b=l.cause)==null?void 0:b.cause)||c.cause})]})]}),o.jsxs(m,{spacing:1,children:[o.jsxs(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:["Descripción"," ",o.jsx(v,{component:"span",color:"error.main",children:"*"})]}),o.jsx(V,{size:"small",name:"description",multiline:!0,rows:4,disabled:T,inputProps:{maxLength:"200"},placeholder:"Descripción del ticket..."})]}),o.jsxs(m,{spacing:1,children:[o.jsx(h,{variant:"overline",sx:{color:"text.disabled",width:1},children:"Archivo (Max - 3MB):"}),o.jsx(_,{name:"file",maxSize:3145728,accept:{"image/*":[".jpeg",".jpg",".png"],"application/pdf":[".pdf"]}})]}),o.jsx(m,{sx:{pt:1},children:o.jsx(D,{loading:T,variant:"contained",size:"large",color:"primary",fullWidth:!0,type:"submit",children:"Generar Ticket"})})]})})};$.propTypes={causes:f.array,onSuccess:f.func};export{$ as default};
//# sourceMappingURL=TicketSupportForm-iJ9UjCwD.js.map
