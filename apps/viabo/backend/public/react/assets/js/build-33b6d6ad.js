import{r as E,k as N,aq as X,aK as Y,j as e,ao as L,aL as J,aM as ee,aN as V,t as te,a as O,b as ne,g as M,a7 as se,n as oe,a8 as b,o as re,c as ie,ax as ae,S as u,T as g,d as le,X as ce,ad as P,a0 as de,L as me,B as ue,ak as pe,f as xe,a4 as he,aI as ge,aJ as fe}from"./build-9dc23fd9.js";import{a as Ce,H as je}from"./build-64074d19.js";import{C as ve,b as Ee,c as ye,D as be,a as Se,M as Ae}from"./build-3a6bce7a.js";import{C as B}from"./build-7ce00c67.js";import{b as Te,c as we,C as Ie,A as Re,F as Le,a as De}from"./build-20d241f0.js";import{C as Ve}from"./build-d1aa88c6.js";import{u as _e}from"./build-d9d6fc9b.js";import{F as ke,M as Ne}from"./build-c86a048d.js";import{c as Oe,a as w}from"./build-8545d663.js";import{s as Me}from"./build-9563ddbe.js";import{C as Pe}from"./build-dea445ee.js";import{C as Be}from"./build-c8b3c979.js";import{R as D}from"./build-1517a09b.js";import{M as Fe}from"./build-d12c03e8.js";import{g as Ue,C as qe}from"./build-ba3c1f3e.js";import{C as We}from"./build-c7ce8ef2.js";import{I as _}from"./build-c3cf2243.js";import{E as He}from"./build-64e1c261.js";import{V as $e,A as ze}from"./build-1c58f0ba.js";import{C as Ge}from"./build-91f0622b.js";import{T as Qe,a as k}from"./build-4d835f96.js";import"./build-b8eff164.js";import"./build-ecaf0d13.js";import"./build-f50814e2.js";import"./build-bee6630b.js";import"./build-25455e46.js";import"./build-041f94ad.js";import"./build-ba7988c0.js";import"./build-b1913ba4.js";import"./build-e232e522.js";const Ke=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],Ze={entering:{transform:"none"},entered:{transform:"none"}},Xe=E.forwardRef(function(n,a){const l=N(),s={enter:l.transitions.duration.enteringScreen,exit:l.transitions.duration.leavingScreen},{addEndListener:i,appear:m=!0,children:d,easing:c,in:o,onEnter:h,onEntered:r,onEntering:C,onExit:v,onExited:f,onExiting:A,style:I,timeout:R=s,TransitionComponent:U=J}=n,q=X(n,Ke),T=E.useRef(null),W=Y(T,d.ref,a),y=p=>j=>{if(p){const S=T.current;j===void 0?p(S):p(S,j)}},H=y(C),$=y((p,j)=>{ee(p);const S=V({style:I,timeout:R,easing:c},{mode:"enter"});p.style.webkitTransition=l.transitions.create("transform",S),p.style.transition=l.transitions.create("transform",S),h&&h(p,j)}),z=y(r),G=y(A),Q=y(p=>{const j=V({style:I,timeout:R,easing:c},{mode:"exit"});p.style.webkitTransition=l.transitions.create("transform",j),p.style.transition=l.transitions.create("transform",j),v&&v(p)}),K=y(f),Z=p=>{i&&i(T.current,p)};return e.jsx(U,L({appear:m,in:o,nodeRef:T,onEnter:$,onEntered:z,onEntering:H,onExit:Q,onExited:K,onExiting:G,addEndListener:Z,timeout:R},q,{children:(p,j)=>E.cloneElement(d,L({style:L({transform:"scale(0)",visibility:p==="exited"&&!o?"hidden":void 0},Ze[p],I,d.props.style),ref:W},j))}))}),Ye=Xe,Je=te(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),F={LIST:"unassignedCardsCommerce"},et=(t,n,a)=>{var d;const{phone:l,email:s,name:i}=t,m={name:i,phone:l,email:s,cards:a?[{id:(d=n[0])==null?void 0:d.id,cvv:t==null?void 0:t.cvv}]:(n==null?void 0:n.map(c=>({id:c==null?void 0:c.id,cvv:c==null?void 0:c.cvv})))||[]};return Ue(m)},tt=async()=>{const{data:t}=await O.get("/api/disabled-cards/commerce");return ve(t)},nt=async t=>(await O.put("/api/assign/commerce-card/to/user",t),t),st=(t={})=>{const[n,a]=E.useState(null);return{...ne([F.LIST],tt,{staleTime:6e4,onError:s=>{const i=M(s,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");a(i)},...t}),error:n||null}},ot=(t={})=>{const n=se(),a=oe(nt,t);return{...a,mutate:async(s,i)=>{const{onSuccess:m,onError:d,mutationOptions:c}=i;try{await b.promise(a.mutateAsync(s,c),{pending:"Asignando Tarjetas ...",success:{render({data:o}){return n.invalidateQueries([F.LIST]),n.invalidateQueries([We.CARDS_COMMERCE_LIST]),m(),"Se asignaron las tarjetas con éxito"}}})}catch(o){const h=M(o,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(h),b.error(h,{type:re(o)})}}}},rt={cards:[],rows:[],openAssign:!1},it=(t,n)=>({...rt,setSelectedCard:a=>{const{cards:l}=n(),s=l.indexOf(a);let i=[];s===-1?i=i.concat(l,a):s===0?i=i.concat(l.slice(1)):s===l.length-1?i=i.concat(l.slice(0,-1)):s>0&&(i=i.concat(l.slice(0,s),l.slice(s+1))),t(m=>({cards:i}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{t(l=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{t(l=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{t(l=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),x=ie(it);function at({cards:t}){const n=x(o=>o.cards),a=x(o=>o.setAllCards),l=x(o=>o.resetCards),s=x(o=>o.setOpenAssign),i=(n==null?void 0:n.length)||0,m=(t==null?void 0:t.length)||0,d=o=>{if(o){a(t);return}l()},c=()=>{const o=n.some(r=>(r==null?void 0:r.cvv)==="")&&(n==null?void 0:n.length)>1;n.every(r=>(r==null?void 0:r.cvv)==="")&&(n==null?void 0:n.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):o?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):s(!0)};return e.jsx(e.Fragment,{children:e.jsx(ae,{sx:o=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:o.customShadows.z8,backgroundColor:o.palette.info.lighter,color:"white"}),children:e.jsxs(u,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(u,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(B,{indeterminate:i>0&&i<m,checked:m>0&&i===m,onChange:o=>d(o.target.checked),color:"success"}),e.jsx(g,{color:"success.main",variant:"subtitle1",children:i===1?`${i} Tarjeta`:`${i} Tarjetas`})]}),e.jsx(u,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(le,{startIcon:e.jsx(Te,{}),variant:"outlined",color:"info",onClick:c,children:"Asignar"})})]})})})}function lt({card:t}){const n=x(i=>i.setSelectedCard),a=x(i=>i.cards),l=a==null?void 0:a.some(i=>(i==null?void 0:i.id)===(t==null?void 0:t.id)),s=i=>{i.stopPropagation(),n(t)};return e.jsx(ce.div,{onClick:s,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(Ee,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(u,{flexDirection:"row",gap:1,children:[e.jsx(B,{onClick:s,edge:"start",checked:l,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",sx:{opacity:.72},children:"Viabo Card"}),e.jsx(g,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(Ve,{card:t,disableShow:!0}),e.jsxs(u,{direction:"row",spacing:5,children:[e.jsxs(u,{children:[e.jsx(g,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(g,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(we,{card:t,disableShow:!0})]})]})})}function ct({cards:t,onSuccess:n}){const{mutate:a,isLoading:l}=ot(),s=E.useMemo(()=>(t==null?void 0:t.length)>0&&t[0].cvv==="",[t]),i=Oe({name:w().required("El nombre es requerido"),email:w().email("Ingresa un correo valido").required("El correo es requerido"),phone:w().test("longitud","El telefono es muy corto",f=>!(f&&f.replace(/[\s+]/g,"").length<10)),...s&&{cvv:w().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),m=_e({initialValues:{name:"",phone:"",email:"",...s&&{cvv:""}},validationSchema:i,onSubmit:f=>{const A=et(f,t,s);a(A,{onSuccess:()=>{C(!1),n()},onError:()=>{C(!1)}})}}),{errors:d,touched:c,isSubmitting:o,setFieldValue:h,values:r,setSubmitting:C}=m,v=o||l;return e.jsx(P,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(ke,{formik:m,children:e.jsxs(u,{spacing:3,sx:{p:3},children:[s&&e.jsx(de,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(g,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(u,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:v})]}),e.jsxs(u,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:v,InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx(He,{})})}})]}),e.jsxs(u,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Fe,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:r.phone||"+52",disabled:v,onChange:(f,A)=>{h("phone",f)},error:c.phone&&!!d.phone,helperText:c.phone&&d.phone})]}),s&&e.jsxs(u,{children:[e.jsx(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(D,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(_,{position:"start",children:e.jsx($e,{})}),inputComponent:Ne,inputProps:{mask:"000",onAccept:f=>{h("cvv",f)},value:r.cvv}},disabled:v})]}),e.jsx(u,{sx:{pt:3},children:e.jsx(me,{loading:o,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(ze,{}),children:"Asociar"})})]})})})}function dt({open:t,handleClose:n,handleSuccess:a}){const l=x(s=>s.cards);return e.jsxs(ye,{open:t,handleClose:n,title:(l==null?void 0:l.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(u,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:l==null?void 0:l.map(s=>e.jsx(qe,{icon:e.jsx(Ge,{}),label:s==null?void 0:s.cardNumberHidden},s==null?void 0:s.id))}),e.jsx(ct,{cards:l,onSuccess:a})]})}function mt({unassignedCards:t}){const n=t==null?void 0:t.data,a=x(d=>d.cards),l=x(d=>d.setIndexCards,Me),s=N(),i=E.useMemo(()=>(a==null?void 0:a.map(d=>n.findIndex(c=>c.id===d.id)))||[],[a,n]);E.useEffect(()=>{l(i)},[i]);const m={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen};return e.jsx(u,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(u,{sx:d=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(Ye,{in:(a==null?void 0:a.length)>0,timeout:m,style:{transitionDelay:`${(a==null?void 0:a.length)>0?m.exit:0}ms`},unmountOnExit:!0,children:e.jsx(ue,{children:e.jsx(at,{cards:t==null?void 0:t.data})})}),e.jsx(P,{children:e.jsx(Ie,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:lt,my:3})})]})})}function ut({isLoading:t,cards:n=[],rows:a=[]}){const l=x(o=>o.setAllCards),s=x(o=>o.cards),i=x(o=>o.setOpenAssign),m=x(o=>o.setIndexCards),d=()=>{const o=s.some(r=>(r==null?void 0:r.cvv)==="")&&(s==null?void 0:s.length)>1;s.every(r=>(r==null?void 0:r.cvv)==="")&&(s==null?void 0:s.length)>1?b.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):o?b.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):i(!0)};console.log(n);const c=[{name:"cardNumberMoreDigits",label:"Tarjeta",options:{customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsx(g,{variant:"subtitle2",fontWeight:"bold",children:r==null?void 0:r.cardNumberMoreDigits})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsxs(u,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(pe,{sx:C=>({width:45,height:45,color:C.palette.primary.contrastText,backgroundColor:C.palette.primary.light}),children:(r==null?void 0:r.cardType)==="Carnet"?e.jsx(Se,{sx:{width:30},color:"white"}):e.jsx(Ae,{sx:{width:30}})}),e.jsx(g,{variant:"subtitle2",children:r==null?void 0:r.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"emptyCVV",label:"CVV",options:{filterType:"checkbox",customBodyRenderLite:(o,h)=>{const r=n[o];return(r==null?void 0:r.cvv)===""||!(r!=null&&r.cvv)?e.jsx(Be,{color:"error"}):e.jsx(Je,{color:"success"})}}},{name:"register",label:"Fecha de Registro",options:{filterType:"textField",customBodyRenderLite:(o,h)=>{const r=n[o];return e.jsxs(u,{children:[e.jsx(g,{variant:"subtitle2",children:r==null?void 0:r.registerDate}),e.jsx(g,{variant:"body2",sx:{color:"text.secondary"},children:r==null?void 0:r.registerTime})]})}}}];return e.jsx(Pe,{children:e.jsx(be,{isLoading:t,data:n||[],columns:c,options:{responsive:"simple",rowsSelected:a,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(o,h,r)=>{const C=n==null?void 0:n.filter((v,f)=>r.includes(f));l(C),m(r)},customToolbarSelect:o=>e.jsx(Re,{handleAssign:d})}})})}function Wt(){const t=st(),[n,a]=E.useState("1"),l=(c,o)=>{a(o)},s=x(c=>c.rows),i=x(c=>c.openAssign),m=x(c=>c.setOpenAssign),d=x(c=>c.resetCards);return e.jsx(e.Fragment,{children:e.jsx(xe,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(Ce,{sx:{height:"100%"},children:[e.jsx(je,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:he.root},{name:"Administracion",href:ge.cards},{name:fe.unassignedCards.name}],buttons:e.jsxs(Qe,{size:"small",color:"primary",value:n,exclusive:!0,onChange:l,"aria-label":"Platform",children:[e.jsx(k,{value:"1",children:e.jsx(Le,{})}),e.jsx(k,{value:"2",children:e.jsx(De,{})})]})}),n==="2"&&e.jsx(mt,{unassignedCards:t}),n==="1"&&e.jsx(ut,{cards:t.data,isLoading:t.isLoading,rows:s}),e.jsx(dt,{open:i,handleClose:()=>{m(!1)},handleSuccess:()=>{m(!1),d()}})]})})})}export{Wt as default};
