import{y as k,j as s,af as L,av as C,be as y,bf as H,S as p,T as h,ax as N,ay as V,ah as b,k as K,a as _,a0 as f,g as S,b as j,r as M,d as E,O as G,B as U,P as W,a5 as Q}from"./index-225b8590.js";import{V as Y}from"./build-579884c9.js";import{G as F}from"./build-b576546c.js";import{M as w,a as $}from"./build-e18cb1a2.js";import{a as T}from"./build-299a3a6a.js";import{g as q}from"./build-97755ebe.js";import{L as J}from"./build-7cb1f9a9.js";import"./build-3f013ad2.js";import{f as X}from"./build-4b3e21cb.js";import{f as Z,b as ee,H as te}from"./build-b4972649.js";import{C as I}from"./build-76b72f32.js";import{a as ne}from"./build-4ade4230.js";import"./build-bf0d9dea.js";import"./build-b558b3a6.js";import"./build-d4376901.js";import"./build-b8a746d1.js";import"./build-3a361562.js";import"./build-ac511f54.js";import"./build-12ff8f8e.js";import"./build-53a1bd2d.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-bee6630b.js";import"./build-447406f9.js";import"./build-c8520ba8.js";const se=k(s.jsx("path",{d:"M22 5.18 10.59 16.6l-4.24-4.24 1.41-1.41 2.83 2.83 10-10L22 5.18zM12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8c1.57 0 3.04.46 4.28 1.25l1.45-1.45C16.1 2.67 14.13 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10c1.73 0 3.36-.44 4.78-1.22l-1.5-1.5c-1 .46-2.11.72-3.28.72zm7-5h-3v2h3v3h2v-3h3v-2h-3v-3h-2v3z"}),"AddTask"),ae=[{id:6,name:"PENDIENTE",color:"warning"},{id:7,name:"PAGADA",color:"primary"},{id:8,name:"CANCELADA",color:"error"},{id:9,name:"LIQUIDADA",color:"success"}],ie=a=>{var e;return((e=ae.find(t=>{var n;return t.name===((n=a==null?void 0:a.toLowerCase())==null?void 0:n.toUpperCase())}))==null?void 0:e.color)||"info"},oe={openConciliateModal:!1,fundingOrder:null},ce=(a,e)=>({...oe,setOpenConciliateModal:t=>{a(n=>({openConciliateModal:t}),!1,"SET_OPEN_CONCILIATE_MODAL")},setFundingOrder:t=>{a(n=>({fundingOrder:t}),!1,"SET_FUNDING_ORDER")}}),g=L(ce);function le(a,e){const{original:t}=a,{status:n}=t,i=n==="Pendiente",o=n==="Pagada",m=g(u=>u.setOpenConciliateModal),l=g(u=>u.setFundingOrder),r=[s.jsxs(C,{onClick:()=>{l(t),e()},sx:{m:0},children:[s.jsx(y,{children:s.jsx(Y,{color:"info"})}),"Ver Detalles"]},0)];return o&&r.push(s.jsxs(C,{onClick:()=>{l(t),m(!0),e()},sx:{m:0},children:[s.jsx(y,{children:s.jsx(se,{color:"success"})}),"Conciliar"]},1)),i&&r.push(s.jsxs(C,{onClick:()=>{l(t),e()},sx:{m:0},children:[s.jsx(y,{children:s.jsx(H,{color:"error"})}),"Cancelar"]},2)),r}function re(a){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zM4 12c0-1.846.634-3.542 1.688-4.897l11.209 11.209A7.946 7.946 0 0 1 12 20c-4.411 0-8-3.589-8-8zm14.312 4.897L7.103 5.688A7.948 7.948 0 0 1 12 4c4.411 0 8 3.589 8 8a7.954 7.954 0 0 1-1.688 4.897z"}}]})(a)}function ue(a){return F({tag:"svg",attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{fillRule:"evenodd",d:"M10.354 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708 0z"}},{tag:"path",attr:{d:"m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911l-1.318.016z"}}]})(a)}const me=[{accessorKey:"referenceNumber",header:"Referencia",enableHiding:!1,size:100},{accessorKey:"paymentProcessorName",header:"Cuenta",size:100,filterVariant:"multi-select",Cell:({cell:a,column:e,row:t})=>{const{original:n}=t,i=T(n==null?void 0:n.paymentProcessorName),o=i==null?void 0:i.component;return s.jsx(p,{flexDirection:"row",alignItems:"center",gap:1,children:i&&s.jsx(o,{sx:{width:30,height:30}})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:a,column:e,row:t,renderedCellValue:n})=>s.jsx(h,{variant:"subtitle2",fontWeight:"bold",children:n})},{accessorKey:"date",header:"Fecha",size:100,Cell:({cell:a,column:e,row:t})=>{var i,o;const{original:n}=t;return s.jsxs(p,{children:[s.jsx(h,{variant:"subtitle2",children:(i=n==null?void 0:n.registerDate)==null?void 0:i.date}),s.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:(o=n==null?void 0:n.registerDate)==null?void 0:o.time})]})}},{accessorKey:"paymentMethods",header:"Método(s)",size:100,filterVariant:"multi-select",Cell:({cell:a,column:e,row:t})=>{var m;const{original:n}=t,i=[],o=((m=n==null?void 0:n.paymentMethods)==null?void 0:m.split(","))||[];return o==null||o.forEach(l=>{const r=q(l);r&&i.push({component:r==null?void 0:r.component,width:l==="PAYCASH"?50:30,height:l==="PAYCASH"?50:30})}),s.jsx(p,{flexDirection:"row",alignItems:"center",gap:1,children:i==null?void 0:i.map(({component:l,width:r,height:u},d)=>s.jsx(l,{sx:{width:r,height:u}},d))})}},{accessorKey:"status",header:"Estado",filterVariant:"multi-select",size:100,Cell:({cell:a,column:e,row:t})=>{const{original:n}=t,i=ie(n==null?void 0:n.status);return s.jsx(p,{flexDirection:"row",alignItems:"center",gap:1,children:s.jsx(J,{variant:"ghost",color:i,sx:{textTransform:"capitalize"},children:n==null?void 0:n.status})})}},{accessorKey:"conciliatedName",header:"¿Conciliada?",filterVariant:"multi-select",size:110,Cell:({cell:a,column:e,row:t})=>{const{original:n}=t;return s.jsx(p,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,color:"primary",children:n!=null&&n.conciliated?s.jsx(ue,{color:"green",fontWeight:"bold",fontSize:"20px"}):s.jsx(re,{fontSize:"20px",color:"red"})})}}],pe=(a,e)=>({reference:a==null?void 0:a.referenceNumber,movementId:e==null?void 0:e.id}),de=a=>[{description:"Movimiento 1",concept:"Concepto 1",date:"17 ago 2023 10:33",amount:"$200.00"},{description:"Movimiento 2",concept:"Concepto 2",date:"17 ago 2023 10:29",amount:"$2,500.00"},{description:"Movimiento 3",concept:"",date:"09 ago 2023 16:46",amount:"$10,783.00"}],ge=a=>a==null?void 0:a.map(e=>{var o;let t="";e!=null&&e.spei&&(e!=null&&e.referencePayCash)&&e.spei!==""&&e.referencePayCash!==""?t="SPEI,PAYCASH":e!=null&&e.spei&&e.spei!==""?t="SPEI":e!=null&&e.referencePayCash&&e.referencePayCash!==""&&(t="PAYCASH");const n=e!=null&&e.registerDate?N(new Date(e==null?void 0:e.registerDate),"dd MMM yyyy",{locale:V}):"",i=e!=null&&e.registerDate?N(new Date(e==null?void 0:e.registerDate),"p"):"";return{id:e==null?void 0:e.id,cardId:e==null?void 0:e.cardId,cardNumber:e==null?void 0:e.cardNumber,paymentProcessorName:e==null?void 0:e.paymentProcessorName,paymentMethods:t,referenceNumber:e==null?void 0:e.referenceNumber,amount:X(e==null?void 0:e.amount),status:e==null?void 0:e.statusName,date:e==null?void 0:e.registerDate,registerDate:{fullDate:Z(e==null?void 0:e.registerDate),time:i,date:n},spei:e==null?void 0:e.spei,payCash:e==null?void 0:e.referencePayCash,emails:(o=e==null?void 0:e.emails)==null?void 0:o.split(","),conciliatedName:(e==null?void 0:e.conciliated)!=="No"?"Conciliada":"Sin Conciliar",conciliated:(e==null?void 0:e.conciliated)!=="No"}}),O={LIST:"funding-orders-list",MOVEMENTS:"conciliate-movements"},he=async()=>{const{data:a}=await b.get("/api/anchoring-orders");return ge(a)},fe=async a=>(await b.get("/api/main-cards/information"),de()),xe=async a=>{const{data:e}=await b.get("/api/main-cards/information");return e},Ce=(a={})=>{const e=K(),t=_(xe,a);return{...t,mutate:async(i,o)=>{const{onSuccess:m,onError:l,mutationOptions:r}=o;try{await f.promise(t.mutateAsync(i,r),{pending:"Conciliando orden de fondeo ...",success:{render({data:u}){return e.invalidateQueries([O.LIST]),m(u),"Se creó la conciliación con éxito"}}})}catch(u){const d=S(u,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");l(d),f.error(d,{type:j(u)})}}}},ye=(a={})=>{const[e,t]=M.useState(null);return{...E([O.MOVEMENTS],fe,{staleTime:6e4,refetchOnWindowFocus:!1,onError:i=>{const o=S(i,"No se puede obtener los movimientos de la cuenta");t(o),f.error(o,{type:j(i)})},...a}),error:e||null}},be=(a={})=>{const[e,t]=M.useState(null);return{...E([O.LIST],he,{staleTime:6e4,refetchOnWindowFocus:!1,onError:i=>{const o=S(i,"No se puede obtener las ordenes de fondeo");t(o),f.error(o,{type:j(i)})},...a}),error:e||null}},Se=()=>{const{data:a,isError:e,isLoading:t,isFetching:n,error:i}=be(),o=me;return s.jsx(I,{children:s.jsx(w,{enablePinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,positionActionsColumn:"last",enableDensityToggle:!1,columns:o,data:a||[],isError:e,textError:i,selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:t,showAlertBanner:e,showProgressBars:n},displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:80},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderRowActionMenuItems:({closeMenu:m,row:l})=>le(l,m)})})},je=()=>{const a=g(c=>c.openConciliateModal),e=g(c=>c.setOpenConciliateModal),t=g(c=>c.fundingOrder),n=g(c=>c.setFundingOrder),{mutate:i,isLoading:o}=Ce(),m=M.useRef(null),l=[{accessorKey:"description",header:"Movimiento",size:100},{accessorKey:"date",header:"Fecha",size:100},{accessorKey:"amount",header:"Monto",size:100}],{data:r,isError:u,error:d,isLoading:v,isFetching:D}=ye({enabled:!!t}),x=T(t==null?void 0:t.paymentProcessorName),z=x==null?void 0:x.component,R=()=>{var P;const c=(P=m.current)==null?void 0:P.getSelectedRowModel().rows;if((c==null?void 0:c.length)>0){const B=pe(t,c[0]);i(B,{onSuccess:()=>{A()},onError:()=>{}})}else f.warn("Debe seleccionar un movimiento para conciliar la orden de fondeo")},A=()=>{e(!1),n(null)};return s.jsx(ne,{onClose:A,onSuccess:R,isSubmitting:o,fullWidth:!0,scrollType:"body",title:"Conciliar",textButtonSuccess:"Conciliar",open:a,children:s.jsxs(p,{spacing:3,sx:{py:3},children:[s.jsx(G,{severity:"info",sx:{display:"flex",flexGrow:1,"& .MuiAlert-message":{display:"flex",flexGrow:1}},children:s.jsxs(p,{flexGrow:1,spacing:2,direction:"row",justifyContent:"space-between",alignItems:"center",children:[s.jsxs(p,{children:[s.jsxs(h,{variant:"subtitle2",children:["Orden #",t==null?void 0:t.referenceNumber]}),s.jsx(h,{variant:"subtitle2",fontWeight:"bold",children:t==null?void 0:t.amount})]}),s.jsx(p,{children:x&&s.jsx(z,{sx:{width:30,height:30}})})]})}),s.jsx(p,{children:s.jsx(I,{children:s.jsx(w,{enablePinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,tableInstanceRef:m,columns:l||[],data:r||[],isError:u,textError:d,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:v,showAlertBanner:u,showProgressBars:D},muiTablePaperProps:{elevation:0,sx:c=>({borderRadius:0,backgroundColor:c.palette.background.neutral})},muiBottomToolbarProps:{sx:c=>({backgroundColor:c.palette.background.neutral})},muiTopToolbarProps:{sx:c=>({backgroundColor:c.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{size:12,header:""}},renderToolbarInternalActions:({table:c})=>s.jsx(U,{children:s.jsx($,{table:c})}),muiTableContainerProps:{sx:{maxHeight:"md"}}})})})]})})},Ye=()=>s.jsx(W,{title:"Ordenes de Fondeo",children:s.jsxs(ee,{children:[s.jsx(te,{name:"Ordenes de Fondeo",links:[{name:"Inicio",href:Q.root},{name:"Ordenes de Fondeo"}]}),s.jsx(Se,{}),s.jsx(je,{})]})});export{Ye as default};
