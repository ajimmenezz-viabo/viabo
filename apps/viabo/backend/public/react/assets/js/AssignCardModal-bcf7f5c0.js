import{s as M,T as b,r as m,an as F,ah as k,j as a,ae as N,ao as O,ap as P,p as u,G as q,aI as B,c as p,d as K,L as w,u as Q,k as $,o as G,g as H,t as U,aN as E,S as T,$ as W}from"./index-70a88a68.js";import{u as Y}from"./formik.esm-08fe098b.js";import{c as v,e as V}from"./index.esm-4f526a47.js";import{R as z}from"./RFTextField-970346e2.js";import{D as J,g as X,a as Z,b as ee,c as te,M as C,d as re,u as A,R as j}from"./StockCards-5add3bdd.js";import{F as oe}from"./FormProvider-ca55416b.js";import{a as se}from"./cardsAdapter-368e40bf.js";import"./TextField-1dd7ffce.js";import"./ManagementBreadcrumbs-c9afdc5d.js";import"./transition-bee6630b.js";import"./filterSearch-b52c629c.js";import"./Container-a053da6d.js";import"./middleware-ef02c0e0.js";import"./Card-0aeafab0.js";import"./InputAdornment-a71dc068.js";import"./matchTypes-ecaf0d13.js";import"./Grid-85fa03b8.js";import"./formatNumber-025aaee5.js";import"./VisibilityOff-4ebdd3d4.js";const ae=["className","id"],ie=e=>{const{classes:r}=e;return P({root:["root"]},X,r)},ne=M(b,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,r)=>r.root})({padding:"16px 24px",flex:"0 0 auto"}),le=m.forwardRef(function(r,t){const s=F({props:r,name:"MuiDialogTitle"}),{className:n,id:i}=s,l=k(s,ae),c=s,f=ie(c),{titleId:g=i}=m.useContext(J);return a(ne,N({component:"h2",className:O(f.root,n),ownerState:c,ref:t,variant:"h6",id:i??g},l))}),ce=le;R.propTypes={onClose:u.func,onSuccess:u.func,children:u.node,open:u.bool,isSubmitting:u.bool,scrollType:u.string,title:u.string,textButtonSuccess:u.string,disableLoadingIndicator:u.bool};function R(e){const{title:r,textButtonSuccess:t,isSubmitting:s,open:n,scrollType:i="paper",onClose:l,onSuccess:c,disableLoadingIndicator:f=!1,children:g,...h}=e,x=q();B(x.breakpoints.between("xs","sm"));const y=m.useRef(null);return m.useEffect(()=>{if(n){const{current:d}=y;d!==null&&d.focus()}},[n]),p(Z,{open:n,onClose:(d,o)=>{o&&o==="backdropClick"||o&&o==="escapeKeyDown"||l()},scroll:i,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",...h,children:[a(ce,{sx:{mb:i==="paper"?3:0},id:"scroll-dialog-title",children:r}),a(ee,{id:"croll-dialog-description",dividers:i==="paper",children:g}),p(te,{children:[!s&&a(K,{variant:"outlined",color:"inherit",onClick:l,children:"Cerrar"}),a(w,{onClick:c,loading:s,color:"primary",variant:"contained",children:t})]})]})}const ue=(e={})=>{const{enqueueSnackbar:r}=Q(),[t,s]=m.useState(null),n=$();return{...G(re,{onSuccess:()=>{s(null),n.invalidateQueries([C.STOCK_CARDS_LIST]),r("Se asignaron las tarjetas al comercio",{variant:"success",autoHideDuration:5e3})},onError:l=>{n.invalidateQueries([C.STOCK_CARDS_LIST]);const c=H(l,"No se puede asignar las tarjetas al comercio");r(c,{variant:U(l),autoHideDuration:5e3}),s(c)},...e}),error:t||null}},de=e=>{var t,s;const r=((t=e==null?void 0:e.commerce)==null?void 0:t.value)||"";return e!=null&&e.cardId?{cardId:e==null?void 0:e.cardId,commerceId:r}:{amount:e==null?void 0:e.numberOfCards.toString(),paymentProcessorId:((s=e==null?void 0:e.cardType)==null?void 0:s.value)||"",commerceId:r}};function Me(){const e=A(o=>o.setOpen),r=A(o=>o.setCard),t=A(o=>o.card),s=E([C.AFFILIATED_COMMERCES_LIST])||[],n=E([C.STOCK_CARDS_LIST])||[],i=E([C.CARD_TYPES_LIST])||[],{mutate:l,isLoading:c}=ue(),f=m.useMemo(()=>{const o={commerce:v().nullable().required("El comercio es requerido")};return t?{...o}:{...o,cardType:v().nullable().required("El tipo de tarjeta es requerido"),numberOfCards:V().min(1,"Al menos debe existir una tarjeta").test("maxCards","El maximo de tarjetas",function(S){const{cardType:D}=this.parent,I=n.filter(L=>L.cardTypeId===D.id).length;return S>I?this.createError({message:`No se pueden agregar más tarjetas que las disponibles (${I} tarjetas)`}):!0}).required("El número de tarjetas es requerido")}},[t,n]),g=m.useMemo(()=>t?{cardId:t==null?void 0:t.id,commerce:null}:{numberOfCards:1,cardType:i&&i.length>0&&i[0]||null,commerce:null},[t]),h=Y({initialValues:g,validationSchema:v().shape(f),onSubmit:(o,{setSubmitting:S})=>{const D=de(o);l(D,{onSuccess:()=>{e(!1),r(null),S(!1)},onError:()=>{S(!1)}})}}),{isSubmitting:x,handleSubmit:y,resetForm:_}=h,d=x||c;return a(R,{onClose:()=>{e(!1),r(null)},onSuccess:y,isSubmitting:d,fullWidth:!0,scrollType:"body",title:t?"Asignar Tarjeta":"Asignar Tarjetas",textButtonSuccess:"Guardar",open:!0,children:a(oe,{formik:h,children:p(T,{spacing:3,sx:{py:3},children:[t?a(se,{card:t}):p(W,{children:[p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta:"}),a(j,{name:"cardType",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:i,disabled:d})]}),p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de tarjetas:"}),a(z,{name:"numberOfCards",placeholder:"1",type:"number",InputLabelProps:{shrink:!0},inputProps:{inputMode:"numeric",min:"1"},disabled:d})]})]}),p(T,{children:[a(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comercio:"}),a(j,{name:"commerce",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:s,disabled:d})]})]})})})}export{Me as default};
