import{j as e,C as x,r as m,a7 as de,S as E,T as C,a8 as b,d as ue,g as pe,a9 as B,n as me,B as I,p as ge,U as H,I as w,E as he,$ as O,k as fe,P as xe,a4 as Ce,a5 as Se,a6 as Ae,aa as q,ab as $}from"./index-6715ae0f.js";import{A as W,u as Ee}from"./build-4ca2ebe5.js";import{r as ve,i as je,a as Ie,b as be,H as _e}from"./build-2f561d42.js";import{B as ye}from"./build-9c237321.js";import{F as Te,g as we}from"./build-23dfff69.js";import{C as Oe}from"./build-e74ed9e1.js";import{g as Pe}from"./build-d1b1f753.js";import{c as De}from"./build-074907a5.js";import{M as Fe,S as Le,F as Re,a as Ne,b as ze}from"./build-19ef9051.js";import{L as Ue,a as Me}from"./build-e6b3b65d.js";import{M as Ve}from"./build-c0916129.js";import{L as ke}from"./build-24bc7ae6.js";import{C as He}from"./build-72a0fd63.js";import{C as Be}from"./build-aa1d016c.js";import{A as qe}from"./build-ac5f6649.js";const $e=r=>{const l=Pe(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);if(l&&Array.isArray(l)){const a=l==null?void 0:l.map(u=>Oe(u)),s=De(a,"id","cardUserNumber")||[];return{data:s,meta:{total:(s==null?void 0:s.length)??0}}}throw new Error("No se pueden obtener las tarjetas")};var D={},We=je;Object.defineProperty(D,"__esModule",{value:!0});var K=D.default=void 0,Ke=We(ve()),Qe=e,Ge=(0,Ke.default)((0,Qe.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");K=D.default=Ge;const Q=({open:r,anchorEl:l,handlePopoverClose:a,data:s})=>{var u,n,p;return s?e.jsx(de,{id:"mouse-over-popover",sx:{pointerEvents:"none"},open:r,anchorEl:l,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},onClose:a,disableRestoreFocus:!0,slotProps:{paper:{sx:{mt:1.5,ml:.5,overflow:"inherit",boxShadow:d=>d.customShadows.z20,border:d=>`solid 1px ${d.palette.grey[5008]}`,width:200}}},children:e.jsxs(E,{spacing:2,p:2,children:[e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s):"}),e.jsx(C,{variant:"body2",children:((u=s==null?void 0:s.assignUser)==null?void 0:u.name)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos:"}),e.jsx(C,{variant:"body2",children:((n=s==null?void 0:s.assignUser)==null?void 0:n.lastName)??"-"})]}),e.jsxs(E,{spacing:.5,flex:1,children:[e.jsx(C,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"TelÃ©fono:"}),e.jsx(C,{variant:"body2",children:((p=s==null?void 0:s.assignUser)==null?void 0:p.phone)??"-"})]})]})}):null};Q.propTypes={anchorEl:x.any,data:x.shape({assignUser:x.shape({lastName:x.string,name:x.string,phone:x.string})}),handlePopoverClose:x.any,open:x.any};const Je=m.memo(Q),Ye=async(r,l)=>{const{columnFilters:a,globalFilter:s,pageIndex:u,pageSize:n,sorting:p}=r,d=new URL("/api/cards/commerce",window.location.origin);d.searchParams.set("start",`${u*n}`),d.searchParams.set("size",`${n}`),d.searchParams.set("filters",JSON.stringify(a??[])),d.searchParams.set("globalFilter",s??""),d.searchParams.set("sorting",JSON.stringify(p??[]));const{data:j}=await b.get(d.href,{signal:l});return $e(j)},vs=async r=>(await b.put("/api/assign/commerce-card/to/user",r),r),js=async r=>{const{data:l}=await b.put("/api/card-owner/data/update",r);return l},Is=async r=>{const{data:l}=await b.put(`/api/card-owner/password/reset/${r.id}`);return l},Xe=(r={},l={})=>{const{columnFilters:a,globalFilter:s,pageIndex:u,pageSize:n,sorting:p}=r,[d,j]=m.useState(null);return{...ue({queryKey:[W.LIST,a,s,u,n,p],queryFn:async({signal:v})=>Ye(r,v),keepPreviousData:!0,onError:v=>{const _=pe(v,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");j(_)},staleTime:6e4,refetchOnWindowFocus:!1,...l}),error:d||null}},Ze={cardInfo:null,openUserInfo:!1,hoverInfo:null,hoverElement:null},es=(r,l)=>({...Ze,setOpenUserInfo:a=>{r(s=>({openUserInfo:a}),!1,"SET_OPEN_USER_INFO_MODAL")},setCardInfo:a=>{r(s=>({cardInfo:a}),!1,"SET_CARD_INFO")},setHoverInfo:a=>{r(s=>({hoverInfo:a}),!1,"SET_HOVER_INFO")},setHoverElement:a=>{r(s=>({hoverElement:a}),!1,"SET_HOVER_ElEMENT")}}),G=B(es),ss={cards:[],rows:[],openAssign:!1},ts=(r,l)=>({...ss,setSelectedCard:a=>{const{cards:s}=l(),u=s.indexOf(a);let n=[];u===-1?n=n.concat(s,a):u===0?n=n.concat(s.slice(1)):u===s.length-1?n=n.concat(s.slice(0,-1)):u>0&&(n=n.concat(s.slice(0,u),s.slice(u+1))),r(p=>({cards:n}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:a=>{r(s=>({cards:a}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:a=>{r(s=>({rows:a}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:a=>{r(s=>({openAssign:a}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{r(a=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),P=B(ts),rs=({refCommerceCardsTable:r})=>{var V;const[l,a]=m.useState([]),[s,u]=m.useState(""),[n,p]=m.useState([]),[d,j]=m.useState({pageIndex:0,pageSize:10}),[F,v]=m.useState({}),{setOpenUserInfo:_,setCardInfo:J}=G(t=>t),Y=P(t=>t.setOpenAssign),X=P(t=>t.setAllCards),Z=me(),{data:A,isLoading:y,isFetching:ee,isError:L,error:se,refetch:te}=Xe({columnFilters:l??[],globalFilter:s??"",pageIndex:(d==null?void 0:d.pageIndex)??0,pageSize:(d==null?void 0:d.pageSize)??10,sorting:n??[]}),{mutate:re,isLoading:ae}=Ee(),[R,N]=m.useState(null),[ne,z]=m.useState(null),[oe,T]=m.useState(null),le=t=>{N(t.currentTarget)},U=()=>{N(null),z(null)},M=!!R,S=m.useMemo(()=>[{id:"cardNumber",accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,Cell:({cell:t,column:o,row:i})=>{const{original:c}=i;return e.jsxs(E,{direction:"row",spacing:2,alignItems:"center",children:[(c==null?void 0:c.cardType)==="Carnet"?e.jsx(Ie,{sx:{width:25,height:25}}):e.jsx(Ve,{sx:{width:25,height:25}}),e.jsx(C,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:c==null?void 0:c.cardNumberHidden})]})}},{id:"assigned",accessorFn:t=>{var o;return((o=t==null?void 0:t.assignUser)==null?void 0:o.fullName)||null},Cell:({cell:t,column:o,row:i,renderedCellValue:c})=>{const{original:f}=i;return c!=="-"?e.jsx(E,{direction:"row",spacing:2,alignItems:"center",children:e.jsx(ke,{color:"info.main",underline:"always",sx:{cursor:"pointer"},variant:"subtitle2",component:C,"aria-owns":M?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:h=>{le(h),z(f)},onMouseLeave:U,onClick:()=>{J(f),_(!0)},children:c})}):c},header:"Asignado",size:150},{id:"status",accessorFn:t=>{var o;return((o=t==null?void 0:t.cardStatus)==null?void 0:o.name)||null},header:"Estado",filterVariant:"select",size:150,Cell:({cell:t,column:o,row:i,renderedCellValue:c})=>{var h;const{original:f}=i;return c?e.jsx(I,{sx:{display:"flex",pt:1},children:e.jsx(Ue,{variant:Z.palette.mode==="light"?"ghost":"filled",color:(h=f==null?void 0:f.cardStatus)!=null&&h.isActive?"success":"error",sx:{textTransform:"capitalize"},children:c})}):null}}],[]),ie=t=>()=>{var h;const o=((h=t.getSelectedRowModel().flatRows)==null?void 0:h.map(g=>g.original))??[],i=o.some(g=>(g==null?void 0:g.cvv)==="")&&(o==null?void 0:o.length)>1,c=o.some(g=>{var k;return((k=g==null?void 0:g.assignUser)==null?void 0:k.id)!==""});o.every(g=>(g==null?void 0:g.cvv)==="")&&(o==null?void 0:o.length)>1?O.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):i?O.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):c?O.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):(X(o),Y(!0))},ce=t=>()=>{try{const o=t.getSortedRowModel().rows.map(i=>(S==null?void 0:S.map(c=>i.getValue(c.accessorKey)))||[])??[];we((S==null?void 0:S.map(i=>i.header))||[],o,"Stock del comercio")}catch{}};return e.jsx(He,{maxWidth:"lg",children:e.jsxs(Be,{children:[e.jsx(Je,{anchorEl:R,open:M,handlePopoverClose:U,data:ne}),e.jsx(Fe,{tableInstanceRef:r,enablePinning:!0,enableColumnOrdering:!1,enableColumnFilterModes:!1,enableStickyHeader:!0,enableRowVirtualization:!0,enableRowActions:!0,positionActionsColumn:"last",enableDensityToggle:!1,enableFacetedValues:!0,columns:S,data:(A==null?void 0:A.data)||[],isError:L,textError:se,selectAllMode:"all",onRowSelectionChange:v,rowCount:((V=A==null?void 0:A.meta)==null?void 0:V.total)??0,initialState:{density:"compact",sorting:[{id:"assigned",desc:!0}]},state:{isLoading:y,showAlertBanner:L,showProgressBars:ee,rowSelection:F??{}},enableRowSelection:!0,displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",minSize:15,muiTableHeadCellProps:({column:t})=>({align:"center"})},"mrt-row-select":{size:10}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:t})=>e.jsx(I,{sx:{display:"flex",gap:"1rem"},children:e.jsx(ge,{onClick:ie(t),disabled:!t.getIsSomeRowsSelected(),startIcon:e.jsx(qe,{width:24,height:24}),children:"Asociar"})}),muiTableBodyRowProps:({row:t})=>({sx:o=>({backgroundColor:o.palette.background.paper})}),renderToolbarInternalActions:({table:t})=>e.jsxs(I,{children:[e.jsx(H,{arrow:!0,title:"Actualizar",children:e.jsx(w,{onClick:()=>te(),children:e.jsx(K,{})})}),e.jsx(Le,{table:t}),e.jsx(H,{title:"Descargar",children:e.jsx(w,{disabled:t.getPrePaginationRowModel().rows.length===0,onClick:ce(t),children:e.jsx(Te,{})})}),e.jsx(Re,{table:t}),e.jsx(Ne,{table:t}),e.jsx(ze,{table:t})]}),renderRowActions:({row:t,table:o})=>{var h;const{original:i}=t,c=(h=i==null?void 0:i.cardStatus)==null?void 0:h.isActive,f=ae&&oe===(i==null?void 0:i.id);return e.jsxs(I,{sx:{display:"flex",flex:1,justifyContent:"center",alignItems:"center",flexWrap:"nowrap",gap:"8px"},children:[e.jsx(w,{size:"small",color:"primary",disabled:y,children:e.jsx(ye,{})}),f?e.jsx(he,{size:15,containerProps:{display:"flex",ml:1}}):e.jsx(Me,{disabled:y,size:"sm",color:c?"success":"error",checked:c||!1,inputProps:{"aria-label":"controlled"},onChange:()=>{T(i==null?void 0:i.id),re({...i,cardON:!c},{onSuccess:()=>{T(null)},onError:()=>{T(null)}})}})]})}})]})})},as=q(m.lazy(()=>$(()=>import("./build-5d64bbb7.js"),["assets/js/build-5d64bbb7.js","assets/js/index-6715ae0f.js","assets/css/build-f63bc8fe.css","assets/js/build-511fe48f.js","assets/js/build-aa1d016c.js","assets/js/build-1573bf43.js","assets/js/build-d599b25e.js","assets/js/build-d1b1f753.js","assets/js/build-87393033.js","assets/js/build-4ca2ebe5.js","assets/js/build-15ea2428.js","assets/js/build-e74ed9e1.js","assets/js/build-2ba33af4.js","assets/js/build-bee6630b.js","assets/js/build-cfd7d68f.js","assets/js/build-2f561d42.js","assets/js/build-72a0fd63.js","assets/js/build-24bc7ae6.js","assets/js/build-074907a5.js","assets/js/build-04a076c1.js","assets/js/build-9c237321.js","assets/js/build-8ea4ad8f.js","assets/js/build-23dfff69.js","assets/js/build-19ef9051.js","assets/js/build-f4ff894e.js","assets/js/build-3ddeaa15.js","assets/js/build-abae6bb8.js","assets/js/build-2d614291.js","assets/js/build-77073ae9.js","assets/js/build-e6b3b65d.js","assets/js/build-44f6928d.js","assets/js/build-c0916129.js","assets/js/build-ac5f6649.js"]))),ns=q(m.lazy(()=>$(()=>import("./build-489d1c40.js"),["assets/js/build-489d1c40.js","assets/js/index-6715ae0f.js","assets/css/build-f63bc8fe.css","assets/js/build-511fe48f.js","assets/js/build-aa1d016c.js","assets/js/build-1573bf43.js","assets/js/build-d599b25e.js"])));function os(){const{openAssign:r,setOpenAssign:l}=P(p=>p),{openUserInfo:a,setOpenUserInfo:s}=G(p=>p),u=fe(),n=m.useRef(null);return m.useEffect(()=>()=>{const p=Object.values(W);u.cancelQueries(p)},[]),e.jsx(e.Fragment,{children:e.jsx(xe,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(be,{sx:{height:"100%"},children:[e.jsx(_e,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Ce.root},{name:"Viabo Card",href:Se.allCards},{name:Ae.allCards.name}]}),e.jsx(rs,{refCommerceCardsTable:n}),e.jsx(as,{open:r,handleClose:()=>{l(!1)},handleSuccess:()=>{var p;l(!1),(p=n==null?void 0:n.current)==null||p.resetRowSelection()}}),e.jsx(ns,{open:a,handleClose:()=>{s(!1)},handleSuccess:()=>{s(!1)}})]})})})}const bs=Object.freeze(Object.defineProperty({__proto__:null,default:os},Symbol.toStringTag,{value:"Module"}));export{bs as A,vs as a,js as b,G as c,Is as r,P as u};
