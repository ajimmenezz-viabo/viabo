import{r as A,n as N,a8 as ae,a9 as le,j as e,aa as P,ab as ce,ac as de,ad as R,y as pe,ae as me,T as b,S as j,af as ue,B as F,p as q,V as xe,I as he,D as C,a0 as T,ag as H,k as ge,a as Ce,g as z,b as fe,d as je,a3 as W,O as ye,L as Ee,m as ve,E as Ae,P as be,a5 as Se,a6 as Te,a7 as we}from"./index-fe9cccac.js";import{M as Ie,a as Ve,F as De,b as ke,c as Le}from"./build-e56cf91f.js";import{a as _e,b as Fe,H as Pe}from"./build-13d4e6e1.js";import{M as Me}from"./build-85a1c1dd.js";import{F as Re,g as Oe}from"./build-c98e4a7b.js";import{C as Be}from"./build-041b4e1f.js";import{C as Ne}from"./build-0032fb80.js";import{A as K,C as qe,a as He,F as ze}from"./build-822b8119.js";import{u as We}from"./build-c84bd68c.js";import{$ as Ke}from"./build-ddbad902.js";import{c as $e,a as _}from"./build-b5fdbea5.js";import{g as Qe,C as Ge}from"./build-316e6977.js";import{C as Ue}from"./build-3a6b3a8b.js";import{C as Ze}from"./build-c7ce8ef2.js";import{F as Ye,M as Xe}from"./build-ae8d849a.js";import{R as M}from"./build-b0cf287d.js";import{I as O}from"./build-6567a1ef.js";import{E as Je}from"./build-103dc2b3.js";import{V as et}from"./build-b93b3d33.js";import{A as tt}from"./build-cf4eab24.js";import{R as nt,C as st}from"./build-b65c576b.js";import"./build-dc545d90.js";import{C as ot}from"./build-d48b058e.js";import{C as rt}from"./build-25312bd5.js";import{C as $}from"./build-1eee0384.js";import{s as it}from"./build-9563ddbe.js";import{T as at,a as B}from"./build-36c9e956.js";import{A as lt}from"./build-437136ed.js";import"./build-2a2deaa7.js";import"./build-ac2beafa.js";import"./build-8b850ec5.js";import"./build-cfe3475e.js";import"./build-8c12169f.js";import"./build-2d75fe1f.js";import"./build-2df2b8bf.js";import"./build-32ce52a2.js";import"./build-f8fc243b.js";import"./build-9dafeb87.js";import"./build-293fc77e.js";import"./build-ba4c2166.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";import"./build-23d329b8.js";const ct=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],dt={entering:{transform:"none"},entered:{transform:"none"}},pt=A.forwardRef(function(o,s){const r=N(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:l,appear:u=!0,children:p,easing:m,in:a,onEnter:E,onEntered:w,onEntering:x,onExit:v,onExited:g,onExiting:I,style:D,timeout:n=i,TransitionComponent:c=ce}=o,h=ae(o,ct),d=A.useRef(null),L=le(d,p.ref,s),V=f=>S=>{if(f){const k=d.current;S===void 0?f(k):f(k,S)}},ee=V(x),te=V((f,S)=>{de(f);const k=R({style:D,timeout:n,easing:m},{mode:"enter"});f.style.webkitTransition=r.transitions.create("transform",k),f.style.transition=r.transitions.create("transform",k),E&&E(f,S)}),ne=V(w),se=V(I),oe=V(f=>{const S=R({style:D,timeout:n,easing:m},{mode:"exit"});f.style.webkitTransition=r.transitions.create("transform",S),f.style.transition=r.transitions.create("transform",S),v&&v(f)}),re=V(g),ie=f=>{l&&l(d.current,f)};return e.jsx(c,P({appear:u,in:a,nodeRef:d,onEnter:te,onEntered:ne,onEntering:ee,onExit:oe,onExited:re,onExiting:se,addEndListener:ie,timeout:n},h,{children:(f,S)=>A.cloneElement(p,P({style:P({transform:"scale(0)",visibility:f==="exited"&&!a?"hidden":void 0},dt[f],D,p.props.style),ref:L},S))}))}),mt=pt,ut=pe(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),xt={cards:[],rows:[],openAssign:!1},ht=(t,o)=>({...xt,setSelectedCard:s=>{const{cards:r}=o(),i=r.indexOf(s);let l=[];i===-1?l=l.concat(r,s):i===0?l=l.concat(r.slice(1)):i===r.length-1?l=l.concat(r.slice(0,-1)):i>0&&(l=l.concat(r.slice(0,i),r.slice(i+1))),t(u=>({cards:l}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:s=>{t(r=>({cards:s}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:s=>{t(r=>({rows:s}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:s=>{t(r=>({openAssign:s}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(s=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),y=me(ht),Q=({cards:t,rows:o})=>{const{data:s,isLoading:r,isFetching:i,isError:l,error:u}=t,p=y(n=>n.setOpenAssign),m=y(n=>n.setAllCards),a=y(n=>n.cards),E=y(n=>n.setIndexCards),w=A.useMemo(()=>(o==null?void 0:o.reduce((n,c)=>(n[c]=!0,n),{}))||{},[o]),[x,v]=A.useState(w),g=A.useMemo(()=>[{accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,Cell:({cell:n,column:c,row:h})=>{const{original:d}=h;return e.jsx(b,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:d==null?void 0:d.cardNumberHidden})}},{accessorKey:"cardType",header:"Tipo",size:100,filterVariant:"multi-select",enableColumnFilterModes:!1,Cell:({cell:n,column:c,row:h})=>{const{original:d}=h;return e.jsx(j,{flexDirection:"row",alignItems:"center",gap:1,children:(d==null?void 0:d.cardType)==="Carnet"?e.jsx(_e,{sx:{width:25,height:25}}):e.jsx(Me,{sx:{width:25,height:25}})})}},{accessorKey:"expiration",header:"Vence",size:100},{accessorKey:"emptyCVV",header:"CVV",filterVariant:"select",enableColumnFilterModes:!1,size:100,Cell:({cell:n,column:c,row:h})=>{const{original:d}=h;return(d==null?void 0:d.cvv)===""||!(d!=null&&d.cvv)?e.jsx(Be,{color:"error"}):e.jsx(ut,{color:"success"})}},{accessorFn:n=>{var c;return(c=n==null?void 0:n.assignUser)==null?void 0:c.name},header:"Asignado",size:150},{accessorFn:n=>{var c;return(c=n==null?void 0:n.assignUser)==null?void 0:c.dateTime},header:"Fecha de Asignación",size:150},{accessorKey:"register",header:"Fecha de Registro",size:150}],[]);A.useEffect(()=>{if(x&&s){const n=Object.keys(x),c=s==null?void 0:s.filter((h,d)=>n.includes(d.toString()));m(c),E(n)}},[x,s]);const I=()=>{const n=a.some(d=>(d==null?void 0:d.cvv)==="")&&(a==null?void 0:a.length)>1,c=a.some(d=>{var L;return((L=d==null?void 0:d.assignUser)==null?void 0:L.id)!==""});a.every(d=>(d==null?void 0:d.cvv)==="")&&(a==null?void 0:a.length)>1?T.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):n?T.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):c?T.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):p(!0)},D=n=>{try{const c=n.getSortedRowModel().rows.map(h=>(g==null?void 0:g.map(d=>h.getValue(d.accessorKey)))||[])??[];Oe((g==null?void 0:g.map(h=>h.header))||[],c,"Stock del comercio")}catch{}};return e.jsx(Ne,{children:e.jsx(Ie,{enablePinning:!0,enableColumnDragging:!0,enableColumnOrdering:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableDensityToggle:!1,columns:g,data:s||[],isError:l,textError:u,selectAllMode:"all",onRowSelectionChange:v,initialState:{density:"compact",sorting:[{id:"register",desc:!0}]},state:{isLoading:r,showAlertBanner:l,showProgressBars:i,rowSelection:x??{}},enableRowSelection:n=>{const{assignUser:c}=n.original;return(c==null?void 0:c.id)===""},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},muiSelectCheckboxProps:({row:n})=>{const{assignUser:c}=n.original;return{disabled:(c==null?void 0:c.id)!=="",sx:{display:(c==null?void 0:c.id)!==""?"none":"flex"}}},muiTableBodyRowProps:({row:n})=>{const{assignUser:c}=n.original;return{onClick:n.getToggleSelectedHandler(),sx:h=>({cursor:(c==null?void 0:c.id)!==""?"inherit":"pointer",backgroundColor:h.palette.background.paper,"&.Mui-selected":{backgroundColor:h.palette.action.selected,"&:hover":{backgroundColor:h.palette.action.hover}}})}},muiTableBodyCellProps:({row:n})=>{const{assignUser:c}=n.original;return{sx:h=>({backgroundColor:(c==null?void 0:c.id)!==""&&!r?ue(h.palette.success.lighter,.2):"inherit",borderBottom:`dashed 1px ${h.palette.divider}`})}},renderTopToolbarCustomActions:({table:n})=>e.jsx(F,{sx:{display:"flex",gap:"1rem"},children:e.jsx(q,{onClick:I,disabled:!n.getIsSomeRowsSelected(),startIcon:e.jsx(K,{width:24,height:24}),children:"Asociar"})}),renderToolbarInternalActions:({table:n})=>e.jsxs(F,{children:[e.jsx(Ve,{table:n}),e.jsx(xe,{title:"Descargar",children:e.jsx(he,{disabled:n.getPrePaginationRowModel().rows.length===0,onClick:()=>D(n),children:e.jsx(Re,{})})}),e.jsx(De,{table:n}),e.jsx(ke,{table:n}),e.jsx(Le,{table:n})]})})})};Q.propTypes={cards:C.shape({data:C.array,error:C.any,isError:C.any,isFetching:C.any,isLoading:C.any})};const G={LIST:"commerce-all-cards"},gt=(t,o,s)=>{var p;const{phone:r,email:i,name:l}=t,u={name:l,phone:r,email:i,cards:s?[{id:(p=o[0])==null?void 0:p.id,cvv:t==null?void 0:t.cvv}]:(o==null?void 0:o.map(m=>({id:m==null?void 0:m.id,cvv:m==null?void 0:m.cvv})))||[]};return Qe(u)},Ct=async()=>{const{data:t}=await H.get("/api/cards/commerce");return Ue(t)},ft=async t=>(await H.put("/api/assign/commerce-card/to/user",t),t),jt=(t={})=>{const o=ge(),s=Ce(ft,t);return{...s,mutate:async(i,l)=>{const{onSuccess:u,onError:p,mutationOptions:m}=l;try{await T.promise(s.mutateAsync(i,m),{pending:"Asignando Tarjetas ...",success:{render({data:a}){return o.invalidateQueries([G.LIST]),o.invalidateQueries([Ze.CARDS_COMMERCE_LIST]),u(),"Se asignaron las tarjetas con éxito"}}})}catch(a){const E=z(a,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");p(E),T.error(E,{type:fe(a)})}}}},yt=(t={})=>{const[o,s]=A.useState(null);return{...je([G.LIST],Ct,{staleTime:6e4,onError:i=>{const l=z(i,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");s(l)},...t}),error:o||null}};function U({cards:t,onSuccess:o}){const{mutate:s,isLoading:r}=jt(),i=A.useMemo(()=>(t==null?void 0:t.length)>0&&t[0].cvv==="",[t]),l=$e({name:_().required("El nombre es requerido"),email:_().email("Ingresa un correo valido").required("El correo es requerido"),phone:_().test("longitud","El telefono es muy corto",g=>!(g&&g.replace(/[\s+]/g,"").length<10)),...i&&{cvv:_().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),u=We({initialValues:{name:"",phone:"",email:"",...i&&{cvv:""}},validationSchema:l,onSubmit:g=>{const I=gt(g,t,i);s(I,{onSuccess:()=>{x(!1),o()},onError:()=>{x(!1)}})}}),{errors:p,touched:m,isSubmitting:a,setFieldValue:E,values:w,setSubmitting:x}=u,v=a||r;return e.jsx(W,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Ye,{formik:u,children:e.jsxs(j,{spacing:3,sx:{p:3},children:[i&&e.jsx(ye,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(b,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(j,{children:[e.jsx(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(M,{name:"name",required:!0,placeholder:"Usuario",disabled:v})]}),e.jsxs(j,{children:[e.jsx(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(M,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:v,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Je,{})})}})]}),e.jsxs(j,{children:[e.jsx(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Ke,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:w.phone||"+52",disabled:v,onChange:(g,I)=>{E("phone",g)},error:m.phone&&!!p.phone,helperText:m.phone&&p.phone})]}),i&&e.jsxs(j,{children:[e.jsx(b,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(M,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(et,{})}),inputComponent:Xe,inputProps:{mask:"000",onAccept:g=>{E("cvv",g)},value:w.cvv}},disabled:v})]}),e.jsx(j,{sx:{pt:3},children:e.jsx(Ee,{loading:a,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(tt,{}),children:"Asociar"})})]})})})}U.propTypes={cards:C.array,onSuccess:C.func};function Z({open:t,handleClose:o,handleSuccess:s}){const r=y(i=>i.cards);return e.jsxs(nt,{open:t,handleClose:o,title:(r==null?void 0:r.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(j,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:r==null?void 0:r.map(i=>e.jsx(Ge,{icon:e.jsx(ot,{}),label:i==null?void 0:i.cardNumberHidden},i==null?void 0:i.id))}),e.jsx(U,{cards:r,onSuccess:s})]})}Z.propTypes={handleClose:C.func,handleSuccess:C.func,open:C.bool};function Y({card:t}){var l,u;const o=y(p=>p.setSelectedCard),s=y(p=>p.cards),r=s==null?void 0:s.some(p=>(p==null?void 0:p.id)===(t==null?void 0:t.id)),i=p=>{p.stopPropagation(),o(t)};return e.jsx(ve.div,{onClick:i,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(st,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(j,{flexDirection:"row",gap:1,children:[e.jsx($,{onClick:i,edge:"start",checked:r,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(j,{children:[e.jsx(b,{variant:"subtitle2",sx:{opacity:.72},children:((l=t==null?void 0:t.assignUser)==null?void 0:l.name)==="-"?"Viabo Card":(u=t==null?void 0:t.assignUser)==null?void 0:u.name}),e.jsx(b,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(rt,{card:t,disableShow:!0}),e.jsxs(j,{direction:"row",spacing:5,children:[e.jsxs(j,{children:[e.jsx(b,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(b,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(qe,{card:t,disableShow:!0})]})]})})}Y.propTypes={card:C.shape({expiration:C.any,id:C.any,register:C.any})};function X({cards:t}){const o=y(a=>a.cards),s=y(a=>a.setAllCards),r=y(a=>a.resetCards),i=y(a=>a.setOpenAssign),l=(o==null?void 0:o.length)||0,u=(t==null?void 0:t.length)||0,p=a=>{if(a){s(t);return}r()},m=()=>{const a=o.some(x=>(x==null?void 0:x.cvv)==="")&&(o==null?void 0:o.length)>1,E=o.some(x=>{var v;return((v=x==null?void 0:x.assignUser)==null?void 0:v.id)!==""});o.every(x=>(x==null?void 0:x.cvv)==="")&&(o==null?void 0:o.length)>1?T.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):a?T.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):E?T.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):i(!0)};return e.jsx(e.Fragment,{children:e.jsx(Ae,{sx:a=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:a.customShadows.z8,backgroundColor:a.palette.info.lighter,color:"white"}),children:e.jsxs(j,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(j,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx($,{indeterminate:l>0&&l<u,checked:u>0&&l===u,onChange:a=>p(a.target.checked),color:"success"}),e.jsx(b,{color:"success.main",variant:"subtitle1",children:l===1?`${l} Tarjeta`:`${l} Tarjetas`})]}),e.jsx(j,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(q,{startIcon:e.jsx(K,{}),variant:"outlined",color:"info",onClick:m,children:"Asignar"})})]})})})}X.propTypes={cards:C.array};function J({commerceCards:t}){const o=t==null?void 0:t.data,s=y(p=>p.cards),r=y(p=>p.setIndexCards,it),i=N(),l=A.useMemo(()=>(s==null?void 0:s.map(p=>o.findIndex(m=>m.id===p.id)))||[],[s,o]);A.useEffect(()=>{r(l)},[l]);const u={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen};return e.jsx(j,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(j,{sx:p=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(mt,{in:(s==null?void 0:s.length)>0,timeout:u,style:{transitionDelay:`${(s==null?void 0:s.length)>0?u.exit:0}ms`},unmountOnExit:!0,children:e.jsx(F,{children:e.jsx(X,{cards:t==null?void 0:t.data})})}),e.jsx(W,{children:e.jsx(He,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:Y,my:3})})]})})}J.propTypes={commerceCards:C.shape({data:C.array})};function pn(){const t=yt(),[o,s]=A.useState("1"),r=(m,a)=>{a&&s(a)},i=y(m=>m.rows),l=y(m=>m.openAssign),u=y(m=>m.setOpenAssign),p=y(m=>m.resetCards);return e.jsx(e.Fragment,{children:e.jsx(be,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(Fe,{sx:{height:"100%"},children:[e.jsx(Pe,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Se.root},{name:"Viabo Card",href:Te.allCards},{name:we.allCards.name}],buttons:e.jsx(F,{display:"flex",justifyContent:"center",mt:{xs:2,md:0},children:e.jsxs(at,{size:"small",color:"primary",value:o,exclusive:!0,onChange:r,"aria-label":"Platform",children:[e.jsx(B,{value:"1",children:e.jsx(ze,{})}),e.jsx(B,{value:"2",children:e.jsx(lt,{})})]})})}),o==="2"&&e.jsx(J,{commerceCards:t}),o==="1"&&e.jsx(Q,{cards:t,rows:i}),e.jsx(Z,{open:l,handleClose:()=>{u(!1)},handleSuccess:()=>{u(!1),p()}})]})})})}export{pn as default};
