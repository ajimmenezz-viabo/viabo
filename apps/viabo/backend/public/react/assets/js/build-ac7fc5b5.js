import{u as R,r as f,k as P,o as k,g as N,t as K,aQ as h,c as i,$ as x,j as t,S as u,T as g}from"./build-cb9e61a6.js";import{u as Q}from"./build-f5ddabb2.js";import{c as C,e as W}from"./build-4f526a47.js";import{R as $}from"./build-cedf7660.js";import{M as S,a as B,u as A,b as w,R as E,c as G,W as H}from"./build-c1f15090.js";import{F as V}from"./build-b1a48468.js";import{a as Y}from"./build-b424f159.js";import"./build-e4a5bb9b.js";import"./build-599fddeb.js";import"./build-014fa638.js";import"./build-9082a490.js";import"./build-b034eccf.js";import"./build-6d74ba48.js";import"./build-c3d7256c.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";import"./build-2eeceff3.js";import"./build-9c54148b.js";import"./build-c87e44af.js";const z=(e={})=>{const{enqueueSnackbar:s}=R(),[r,n]=f.useState(null),c=P();return{...k(B,{onSuccess:()=>{n(null),c.invalidateQueries([S.STOCK_CARDS_LIST]),s("Se asignaron las tarjetas al comercio",{variant:"success",autoHideDuration:5e3})},onError:l=>{c.invalidateQueries([S.STOCK_CARDS_LIST]);const o=N(l,"No se puede asignar las tarjetas al comercio");s(o,{variant:K(l),autoHideDuration:5e3}),n(o)},...e}),error:r||null}},J=e=>{var r,n;const s=((r=e==null?void 0:e.commerce)==null?void 0:r.value)||"";return e!=null&&e.cardId?{cardId:e==null?void 0:e.cardId,commerceId:s}:{amount:e==null?void 0:e.numberOfCards.toString(),paymentProcessorId:((n=e==null?void 0:e.cardType)==null?void 0:n.value)||"",commerceId:s}};function he(){const e=A(a=>a.setOpen),s=A(a=>a.setCard),r=A(a=>a.card),n=h([S.AFFILIATED_COMMERCES_LIST])||[],c=h([S.STOCK_CARDS_LIST])||[],d=h([S.CARD_TYPES_LIST])||[],[l,o]=f.useState(!1),{mutate:j,isLoading:y}=z(),v=f.useMemo(()=>{const a={commerce:C().nullable().required("El comercio es requerido")};return r?{...a}:{...a,cardType:C().nullable().required("El tipo de tarjeta es requerido"),numberOfCards:W().min(1,"Al menos debe existir una tarjeta").test("maxCards","El maximo de tarjetas",function(p){const{cardType:D}=this.parent,b=c.filter(L=>L.cardTypeId===D.id).length;return p>b?this.createError({message:`No se pueden agregar más tarjetas que las disponibles (${b} tarjetas)`}):!0}).required("El número de tarjetas es requerido")}},[r,c]),I=f.useMemo(()=>r?{cardId:r==null?void 0:r.id,commerce:null}:{numberOfCards:1,cardType:d&&d.length>0&&d[0]||null,commerce:null},[r]),T=Q({initialValues:I,validationSchema:C().shape(v),onSubmit:(a,{setSubmitting:p})=>{p(!1),o(!0)}}),{isSubmitting:O,handleSubmit:_,values:q,setSubmitting:F}=T,m=O||y,M=a=>{const p=J(a);j(p,{onSuccess:()=>{e(!1),s(null),o(!1)},onError:()=>{o(!1)}})};return i(x,{children:[t(w,{onClose:()=>{e(!1),s(null)},onSuccess:_,isSubmitting:m,fullWidth:!0,scrollType:"body",title:r?"Asignar Tarjeta":"Asignar Tarjetas",textButtonSuccess:"Asignar",open:!l,children:t(V,{formik:T,children:i(u,{spacing:3,sx:{py:3},children:[r?t(Y,{card:r}):i(x,{children:[i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta:"}),t(E,{name:"cardType",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:d,disabled:m})]}),i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de tarjetas:"}),t($,{name:"numberOfCards",placeholder:"1",type:"number",InputLabelProps:{shrink:!0},inputProps:{inputMode:"numeric",min:"1"},disabled:m})]})]}),i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comercio:"}),t(E,{name:"commerce",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:n,disabled:m})]})]})})}),l&&t(G,{title:r?"Asignar Tarjeta":"Asignar Tarjetas",typeAlert:"warning",textButtonSuccess:"Asignar",onClose:()=>{o(!1),F(!1)},open:l,isSubmitting:m,description:i(u,{spacing:2,children:[t(g,{children:r?"¿Está seguro de asignar esta tarjeta a este comercio?":"¿Está seguro de asignar estas tarjetas a este comercio?"}),i(u,{direction:"row",alignItems:"center",spacing:1,children:[t(H,{}),t(g,{variant:"caption",children:"Verifique que todos los datos esten correctos"})]})]}),onSuccess:()=>{M(q)},fullWidth:!0,maxWidth:"xs"})]})}export{he as default};
