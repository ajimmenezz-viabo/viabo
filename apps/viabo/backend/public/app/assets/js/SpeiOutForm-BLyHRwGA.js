import{r as y,a9 as L,i as r,S as s,T as u,B as $,A as m,bT as M,aX as W,bx as q,aV as E,aT as D,d$ as O,aU as U,a7 as X,bE as G,P as o}from"./vendor-CEMfbhOc.js";import{S as H,w as x,I as Z}from"./index-B-U8M-8N.js";import{u as J,d as K}from"./formik.esm-Dshy1xjd.js";import{c as h,d as Q,a as Y}from"./index.esm-C2GVbld4.js";import{b,B as S}from"./DashboardViaboSpeiByProfile-CuPFxNBw.js";import{F as _,R as A,M as v}from"./TextMaxLine-D6XZvUuW.js";import{R as rr}from"./RFSelect-B2dtP2ya.js";import"./crypto--V-xCCVf.js";import"./formatNumber-Df8NwpjV.js";import"./formatTime-mlJJpQBT.js";import"./viabo-spei-paths-CP0FcW2K.js";import"./index-BtYJ4qg-.js";import"./iconBase-D_ql85QS.js";import"./filterSearch-NGUmCbyG.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./usePagination-CDhabgJW.js";import"./spei-third-accounts-store-CIqgAlGv.js";import"./matchTypes-BFKCRNnN.js";import"./HeaderPage-DRv2GeZX.js";import"./UploadSingleFile-B0jkdwVt.js";const er=({accounts:F,setCurrentBalance:w,insufficient:I,onSuccess:R,initialValues:C})=>{var j;const f=y.useRef(null),P=window.crypto||window.msCrypto,T=new Uint32Array(1),k=P.getRandomValues(T)[0],B=h().shape({transactions:Q().of(h().shape({amount:Y().test("maxAmount","Monto máximo de transferencia $50,000",function(t){return parseFloat(t==null?void 0:t.replace(/,/g,""))<=5e4}).required("La cantidad es requerida"),account:h().nullable().required("La cuenta es requerida")}))}),g=J({initialValues:C||{transactions:[],beneficiary:null,amount:"",concept:""},validateOnChange:!1,validationSchema:B,onSubmit:(t,{setFieldValue:e,setSubmitting:a})=>I?(L.warning("Saldo insuficiente para realizar esta operación"),a(!1)):(a(!1),e("amount",""),e("beneficiary",null),R(t))}),{isSubmitting:N,setFieldValue:d,values:n}=g,p=N,V=!(n!=null&&n.beneficiary)||(n==null?void 0:n.amount)===""||Number(n==null?void 0:n.amount)<=0;y.useEffect(()=>{var a;const e=((a=n.transactions)==null?void 0:a.reduce((i,c)=>{const l=c.amount.trim()!==""?parseFloat(c.amount.replace(/,/g,"")):0;return isNaN(l)?i:i+l},0)).toFixed(2);w(e)},[n.transactions]);const z=()=>{d("amount",""),d("beneficiary",null)};return r.jsx(H,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(_,{formik:g,children:r.jsxs(s,{sx:{p:3},children:[r.jsxs(s,{gap:2,children:[r.jsxs(s,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Beneficiario:"}),r.jsx(rr,{name:"beneficiary",disabled:p,textFieldParams:{placeholder:"Seleccionar ...",size:"large"},options:F||[],onChange:(t,e)=>{d("beneficiary",e)},renderOption:(t,e)=>{const a=x((e==null?void 0:e.label)||"");return r.jsx($,{component:"li",...t,children:r.jsxs(s,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(m,{...a,sx:{...a==null?void 0:a.sx,width:25,height:25,fontSize:12}}),r.jsx("span",{children:e.label})]})})},renderInput:t=>{var a;const e=x(((a=t==null?void 0:t.inputProps)==null?void 0:a.value)||"");return r.jsx(M,{...t,size:"large",placeholder:"Seleccionar ...",inputProps:{...t.inputProps},InputProps:{...t.InputProps,startAdornment:r.jsx(W,{position:"start",children:r.jsx(m,{...e,sx:{...e==null?void 0:e.sx,width:25,height:25,fontSize:12}})}),sx:{borderRadius:i=>1,borderColor:b}}})}})]}),r.jsxs(s,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Monto:"}),r.jsx(A,{size:"large",name:"amount",placeholder:"0.00",disabled:p,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"MXN"}),inputComponent:v,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,scale:2,value:n.amount,onAccept:t=>{d("amount",t)}},sx:{borderRadius:t=>1,borderColor:b}}})]}),r.jsx(s,{direction:"row",spacing:1,children:r.jsx(S,{type:"button",startIcon:r.jsx(q,{}),disabled:p||V,onClick:()=>{f.current.push({id:k,account:n==null?void 0:n.beneficiary,amount:n==null?void 0:n.amount}),z()},sx:{flexShrink:0,color:"text.primary"},children:"Agregar Transacción"})})]}),r.jsx(K,{name:"transactions",render:t=>(f.current=t,r.jsx(E,{sx:{width:"100%",bgcolor:"background.paper"},children:n==null?void 0:n.transactions.map((e,a)=>{var i,c,l;return r.jsx(s,{children:r.jsxs(D,{sx:{px:0},secondaryAction:r.jsx(Z,{color:"error",edge:"end","aria-label":"delete",onClick:()=>t.remove(a),children:r.jsx(O,{})}),children:[r.jsx(U,{children:r.jsx(m,{title:((i=e==null?void 0:e.account)==null?void 0:i.label)||"",...x(((c=e==null?void 0:e.account)==null?void 0:c.label)||"")})}),r.jsx(X,{primary:r.jsx(u,{variant:"subtitle1",children:(l=e==null?void 0:e.account)==null?void 0:l.clabeHidden}),secondary:r.jsx(u,{variant:"subtitle1",fontWeight:"bold",children:e==null?void 0:e.amount})})]})},e.id)})}))}),r.jsx(A,{fullWidth:!0,name:"concept",multiline:!0,disabled:p,rows:2,label:"Concepto",placeholder:"Transferencia ..",InputProps:{sx:{borderRadius:t=>1,borderColor:b}}}),r.jsx(s,{sx:{pt:3},children:r.jsx(S,{variant:"contained",size:"large",color:"primary",disabled:!!((j=n==null?void 0:n.transactions)!=null&&j.length)<=0,fullWidth:!0,type:"submit",startIcon:r.jsx(G,{}),children:"Siguiente"})})]})})})};er.propTypes={accounts:o.array,initialValues:o.shape({transactions:o.array,beneficiary:o.any,amount:o.string,concept:o.string}),insufficient:o.any,onSuccess:o.func,setCurrentBalance:o.func};export{er as default};
//# sourceMappingURL=SpeiOutForm-BLyHRwGA.js.map
