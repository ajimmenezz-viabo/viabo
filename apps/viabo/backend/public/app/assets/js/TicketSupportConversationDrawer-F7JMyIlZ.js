import{g as x,a as E,L as _,_ as j,D as I,S as P,E as L}from"./index-mKe_odg3.js";import{r as d,dS as F,a9 as T,c as N,f as D,i as o,V as m,T as w,a0 as A,dT as O}from"./vendor-StReGf79.js";import"./TextMaxLine-Nybdgfc_.js";import{T as f}from"./tickets-support-list-keys-ThL685Ct.js";import{u as S,g as R,f as b}from"./SupportIncidences-TWCHxZXW.js";import{i as g}from"./matchTypes-VzXr5CmM.js";import"./formik.esm-ayHIcoJR.js";import"./UploadSingleFile-NVjHNA2_.js";import"./fade-HpdRXKiE.js";import"./transition-Uc7vb3zK.js";import"./formatNumber-D2wM-uoj.js";import"./formatTime-j4oUQxO9.js";import"./HeaderPage-fCD0eWYY.js";import"./useMaterialTable-3iMRnh5c.js";const M=(s,i={})=>{const[e,u]=d.useState(null),a=S(r=>r.setCanCloseTicket),t=F({queryKey:[f.TICKET_CONVERSATION,s],queryFn:async({pageParam:r=1})=>{const n=await R(s,r);return a(!!(n!=null&&n.canCloseTicket)),n},getNextPageParam:r=>r.next,refetchOnMount:"always",staleTime:60*5e3,...i});return d.useEffect(()=>{if(t!=null&&t.isError){const r=x(t.error,"No se puede obtener la conversación del ticket. Intente nuevamente o reporte a sistemas");u(r),T.error(r,{type:E(t.error)}),a(!1)}},[t.isError,t.error]),{...t,error:e||null}},Q=(s={})=>{const i=N(),e=D({mutationFn:b,...s});return{...e,mutate:async(a,t)=>{const{onSuccess:r,onError:n,...p}=t;try{await T.promise(e.mutateAsync(a,p),{pending:"Finalizando Ticket...",success:{render({data:c}){return i.invalidateQueries([f.ASSIGNED_LIST]),i.invalidateQueries([f.GENERATED_LIST]),g(r)&&r(c),"Se finalizo el ticket con éxito"}}})}catch(c){const l=x(c,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");g(n)&&n(l),T.error(l,{type:E(c)})}}}},z=_(d.lazy(()=>j(()=>import("./TicketConversationLayout-SGwhP0Xw.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])))),te=()=>{const{openTicketConversation:s,setOpenTicketConversation:i,ticket:e,setSupportTicketDetails:u,canCloseTicket:a}=S(),t=M(e==null?void 0:e.id,{enabled:!!(e!=null&&e.id)}),{mutate:r,isLoading:n}=Q(),{isLoading:p,error:c,isError:l,refetch:C,data:y,fetchNextPage:v}=t;d.useEffect(()=>{s&&(e!=null&&e.id)&&v({pageParam:1})},[s,e==null?void 0:e.id]);const h=()=>{i(!1),u(null)},k=()=>{r({ticketId:e==null?void 0:e.id},{onSuccess:()=>{h()}})};return o.jsxs(I,{open:s,handleClose:h,titleElement:o.jsxs(m,{justifyContent:"space-between",flex:1,flexDirection:"column",gap:1,children:[o.jsx(m,{children:o.jsx(w,{variant:"h6",children:`Ticket #${e==null?void 0:e.id}`})}),e&&y&&a&&o.jsx(m,{maxWidth:"30%",children:o.jsx(A,{endIcon:o.jsx(O,{}),variant:"contained",onClick:k,loading:p||n,color:"success",children:"Concluir"})})]}),width:{sm:"100%",lg:"50%",xl:"40%"},children:[l&&!p&&o.jsx(P,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:o.jsx(m,{spacing:3,p:3,children:o.jsx(L,{errorMessage:c,titleMessage:"Conversación del Ticket",handleButton:()=>C()})})}),!l&&s&&o.jsx(z,{queryTicketConversation:t,ticket:e})]})};export{te as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/TicketConversationLayout-SGwhP0Xw.js","assets/js/index-mKe_odg3.js","assets/js/vendor-StReGf79.js","assets/css/build-K0YT2apu.css","assets/js/formik.esm-ayHIcoJR.js","assets/js/index.esm-cYP9oANf.js","assets/js/matchTypes-VzXr5CmM.js","assets/js/tickets-support-list-keys-ThL685Ct.js","assets/js/SupportIncidences-TWCHxZXW.js","assets/js/TextMaxLine-Nybdgfc_.js","assets/js/UploadSingleFile-NVjHNA2_.js","assets/js/fade-HpdRXKiE.js","assets/js/transition-Uc7vb3zK.js","assets/js/formatNumber-D2wM-uoj.js","assets/js/formatTime-j4oUQxO9.js","assets/js/HeaderPage-fCD0eWYY.js","assets/js/useMaterialTable-3iMRnh5c.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=TicketSupportConversationDrawer-F7JMyIlZ.js.map
