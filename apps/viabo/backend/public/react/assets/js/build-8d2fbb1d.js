import{z as ie,j as e,C as J,r as a,_ as Z,B as E,D as Ce,S as c,E as ae,L as re,T as f,q as le,d as K,g as W,a as De,Q as H,b as ce,G as Oe,I as me,H as Pe,p as Y,J as ue,K as Ae,N as C,O as Fe,R as Re,U as Te,V as ke,W as ye,X as de,m as Q,Y as Le,Z as Be,$ as _e,a0 as Ve,a1 as ze,a2 as Ne,a3 as He,a4 as We,n as $e,a5 as qe,a6 as Ke,a7 as Ge,a8 as Qe,k as Ye,P as Xe,a9 as Je,aa as Ze,ab as Ue}from"./index-3809032b.js";import{C as B}from"./build-c7ce8ef2.js";import{u as y,C as et,U as tt,M as st,L as nt,F as rt}from"./build-38a50b1e.js";import{u as be}from"./build-51aa246c.js";import{C as U}from"./build-9f005fe0.js";import{u as ot}from"./build-ee266471.js";import{c as it,b as at,a as lt}from"./build-35d26722.js";import{g as ct,M as he}from"./build-7637d2c3.js";import{g as dt,a as mt,s as ut,b as ht,c as pt,d as xt}from"./build-78fd7f79.js";import{F as ft,L as gt,I as jt}from"./build-0d95e123.js";import{M as Ct}from"./build-e654ff3c.js";import{V as yt}from"./build-a4a664aa.js";import{V as bt}from"./build-3035382d.js";import{C as St,f as X,a as vt,b as It,H as wt}from"./build-2b227f05.js";import{C as Se}from"./build-adedcfe4.js";import{C as Mt}from"./build-49cea08c.js";import{R as Et}from"./build-30757a5f.js";import{B as Dt,a as Ot}from"./build-9d77b025.js";import{g as Pt}from"./build-7290ac90.js";import{M as At}from"./build-1adb5778.js";import{u as Ft}from"./build-961174a6.js";import{s as Rt}from"./build-fb129cc3.js";import{F as Tt}from"./build-4389c83a.js";import{u as kt}from"./build-579b3d74.js";import{C as Lt}from"./build-88f2b521.js";import"./build-02647ec5.js";import{S as Bt}from"./build-f831d8b4.js";import{S as _t}from"./build-bdd40095.js";import{A as Vt}from"./build-1f7146f4.js";import{G as se}from"./build-381d8d7c.js";import{M as zt}from"./build-f3f9b6e9.js";import{L as Nt}from"./build-566d20b3.js";import{L as Ht,S as Wt,a as $t,b as qt,c as ne,d as pe}from"./build-4c3fa637.js";import{s as Kt}from"./build-f8fc243b.js";import{E as xe}from"./build-d59f6763.js";import{I as Gt}from"./build-4d4aa58d.js";import{S as Qt}from"./build-62801de2.js";import{C as Yt}from"./build-5f6917c9.js";import{D as fe}from"./build-ff91dbf2.js";import{C as Xt}from"./build-2969add5.js";import"./build-26daf111.js";import"./build-6fc5dca7.js";import"./build-e69012db.js";import"./build-7041d859.js";import"./build-6fc59234.js";import"./build-8fbeaa5d.js";import"./build-627f2440.js";import"./build-5af041c1.js";import"./build-53b11780.js";import"./build-c6f78c0d.js";import"./build-e6290908.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-b0677c31.js";import"./build-46916aa3.js";import"./build-bee6630b.js";const Jt=ie(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"}),"Mail"),ge=ie(e.jsx("path",{d:"M2 17h20v2H2v-2zm1.15-4.05L4 11.47l.85 1.48 1.3-.75-.85-1.48H7v-1.5H5.3l.85-1.47L4.85 7 4 8.47 3.15 7l-1.3.75.85 1.47H1v1.5h1.7l-.85 1.48 1.3.75zm6.7-.75 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H15v-1.5h-1.7l.85-1.47-1.3-.75L12 8.47 11.15 7l-1.3.75.85 1.47H9v1.5h1.7l-.85 1.48zM23 9.22h-1.7l.85-1.47-1.3-.75L20 8.47 19.15 7l-1.3.75.85 1.47H17v1.5h1.7l-.85 1.48 1.3.75.85-1.48.85 1.48 1.3-.75-.85-1.48H23v-1.5z"}),"PasswordTwoTone"),Zt=ie(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-8 6H8v1h3c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1h-1v1H8v-1H6v-2h4v-1H7c-.55 0-1-.45-1-1V9c0-.55.45-1 1-1h1V7h2v1h2v2zm4 6.25-2-2h4l-2 2zM14 10l2-2 2 2h-4z"}),"PriceChange"),Ut=(t,s)=>{const o={spei:t==null?void 0:t.SPEI,paynet:t==null?void 0:t.PAYNET,emails:s==null?void 0:s.emails};return ct(o)},es=J(a.lazy(()=>Z(()=>import("./build-9f48140c.js"),["assets/js/build-9f48140c.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-c7ce8ef2.js","assets/js/build-566d20b3.js","assets/js/build-53b11780.js","assets/js/build-38a50b1e.js","assets/js/build-26daf111.js","assets/js/build-9d77b025.js","assets/js/build-2b227f05.js","assets/js/build-c6f78c0d.js","assets/js/build-6fc59234.js","assets/js/build-f3f9b6e9.js","assets/js/build-e6290908.js","assets/js/build-2969add5.js","assets/js/build-35d26722.js","assets/js/build-1f7146f4.js","assets/js/build-bee6630b.js","assets/js/build-0d95e123.js","assets/js/build-ee266471.js","assets/js/build-f831d8b4.js","assets/js/build-46916aa3.js","assets/js/build-4389c83a.js","assets/js/build-6fc5dca7.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-381d8d7c.js","assets/js/build-7637d2c3.js","assets/js/build-4d4aa58d.js","assets/js/build-78fd7f79.js","assets/js/build-8fbeaa5d.js","assets/js/build-627f2440.js","assets/js/build-5af041c1.js","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js","assets/js/build-e69012db.js","assets/js/build-7041d859.js","assets/js/build-adedcfe4.js","assets/js/build-49cea08c.js","assets/js/build-50ee6672.js"]))),ts=J(a.lazy(()=>Z(()=>import("./build-97d20e3e.js"),["assets/js/build-97d20e3e.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-ee266471.js","assets/js/build-0d95e123.js","assets/js/build-f831d8b4.js","assets/js/build-46916aa3.js","assets/js/build-4389c83a.js","assets/js/build-53b11780.js","assets/js/build-1f7146f4.js","assets/js/build-bee6630b.js","assets/js/build-566d20b3.js","assets/js/build-6fc59234.js","assets/js/build-7041d859.js","assets/js/build-4d4aa58d.js","assets/js/build-8adb868c.js","assets/js/build-38a50b1e.js","assets/js/build-26daf111.js","assets/js/build-9d77b025.js","assets/js/build-2b227f05.js","assets/js/build-c6f78c0d.js","assets/js/build-f3f9b6e9.js","assets/js/build-e6290908.js","assets/js/build-2969add5.js","assets/js/build-35d26722.js","assets/js/build-6fc5dca7.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-381d8d7c.js","assets/js/build-7637d2c3.js","assets/js/build-78fd7f79.js","assets/js/build-8fbeaa5d.js","assets/js/build-627f2440.js","assets/js/build-5af041c1.js","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js","assets/js/build-e69012db.js","assets/js/build-adedcfe4.js","assets/js/build-49cea08c.js"])));function ss(){const[t,s]=a.useState(!1),[o,l]=a.useState(!1),i=y(n=>n.card),m=be([B.CARD_INFO,i==null?void 0:i.id])===1;return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx(Ce,{children:e.jsxs(c,{direction:"row",divider:e.jsx(ae,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:3},spacing:1,children:[e.jsx(c,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(re,{disabled:m,startIcon:e.jsx(Zt,{}),variant:"outlined",onClick:()=>l(!0),children:"Enviar Pago"})}),e.jsx(c,{direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:150},children:e.jsx(re,{disabled:(i==null?void 0:i.balance)===0||!(i!=null&&i.cardON)||m,startIcon:e.jsx(et,{}),variant:"outlined",onClick:()=>s(!0),children:"Transferir"})})]})})}),e.jsx(es,{setOpen:s,open:t}),e.jsx(ts,{setOpen:l,open:o})]})}function ns(){const t=y(o=>o.card),{assignUser:s}=t;return e.jsxs(U,{sx:{p:3},children:[e.jsx(f,{variant:"h6",gutterBottom:!0,children:"Asignado a:"}),e.jsxs(c,{spacing:3,children:[e.jsxs(c,{justifyContent:"space-between",gap:1,children:[e.jsx(f,{variant:"subtitle2",sx:{color:"text.secondary"},textTransform:"capitalize",children:"Nombre"}),e.jsx(f,{variant:"body2",children:s==null?void 0:s.name})]}),(s==null?void 0:s.phone)&&e.jsxs(c,{justifyContent:"space-between",gap:1,children:[e.jsx(f,{variant:"subtitle2",sx:{color:"text.secondary"},children:"Telefono"}),e.jsx(f,{variant:"body2",children:(s==null?void 0:s.phone)||"-"})]}),e.jsxs(c,{justifyContent:"space-between",gap:1,children:[e.jsx(f,{variant:"subtitle2",sx:{color:"text.secondary"},children:"Correo"}),e.jsx(f,{variant:"body2",children:s==null?void 0:s.email})]})]})]})}const je=le("div")({display:"flex",justifyContent:"space-between"});function rs({card:t,title:s}){return e.jsx(U,{sx:{p:3},children:e.jsxs(c,{spacing:2,children:[e.jsxs(c,{spacing:.5,children:[e.jsx(f,{variant:"h6",gutterBottom:!0,textTransform:"capitalize",children:s||"Balance"}),(t==null?void 0:t.monthBalance)&&e.jsx(f,{variant:"subtitle2",gutterBottom:!0,textTransform:"capitalize",children:t==null?void 0:t.monthBalance})]}),e.jsxs(c,{spacing:2,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"h4",children:t==null?void 0:t.balanceMovements}),e.jsx(f,{variant:"caption",children:"MXN"})]}),e.jsxs(je,{children:[e.jsx(f,{variant:"body2",sx:{color:"text.secondary"},children:"Ingresos"}),e.jsx(f,{sx:{color:"success.main"},variant:"body2",children:t==null?void 0:t.income})]}),e.jsxs(je,{children:[e.jsx(f,{variant:"body2",sx:{color:"text.secondary"},children:"Egresos"}),e.jsxs(f,{variant:"body2",sx:{color:"error.main"},children:["- ",t==null?void 0:t.expenses]})]})]})]})})}const os=(t,s={})=>{const[o,l]=a.useState(null);return{...K([B.CARDS_COMMERCE_LIST,t],()=>dt(t),{staleTime:6e4,refetchOnMount:"always",onError:m=>{const n=W(m,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");l(n)},...s}),error:o||null}},is=(t,s={})=>{const[o,l]=a.useState(null);return{...K([B.CARD_INFO,t],({signal:m})=>mt(t,m),{staleTime:6e4,onError:m=>{const n=W(m,"No se puede obtener la informacion de la tarjeta. Intente nuevamente o reporte a sistemas");l(n)},refetchOnWindowFocus:!1,...s}),error:o||null}},as=(t={})=>{const s=De(ut,t);return{...s,mutate:async(l,i)=>{const{onSuccess:m,onError:n,mutationOptions:r}=i;try{await H.promise(s.mutateAsync(l,r),{pending:"Enviando Correo ...",success:{render({data:u}){return m(u),"Se compartio con éxito la información"}}})}catch(u){const p=W(u,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");n(p),H.error(p,{type:ce(u)})}}}};function ls({open:t,onClose:s,card:o}){const{mutate:l,isLoading:i}=as(),[m,n]=a.useState(""),r=it().shape({emails:at().of(lt().email("Deben ser direcciones de correo válidos")).min(1,"Las correos son requeridos")}),u=ot({initialValues:{emails:[]},validationSchema:r,onSubmit:(b,{setSubmitting:g,resetForm:M})=>{const _=Ut(o,b);l(_,{onSuccess:()=>{g(!1),s(),M()},onError:()=>{g(!1)}})}}),{isSubmitting:p,handleSubmit:D,values:d,touched:j,errors:w,setFieldValue:F,resetForm:R}=u,T=p||i,$=b=>{if(b.trim().length>0&&b.includes(" ")){const g=b.trim().split(/[, ]+/);F("emails",[...d.emails,...g]),n("")}else n(b)},V=b=>{var M;const g=(M=b.target.value)==null?void 0:M.trim();g.length>0&&(F("emails",[...d.emails,g]),n(""))};return e.jsx(Ct,{onClose:()=>{s(),R()},onSuccess:D,isSubmitting:T,fullWidth:!0,maxWidth:"sm",scrollType:"body",title:"Compartir",textButtonSuccess:"Enviar",open:t,children:e.jsx(ft,{formik:u,children:e.jsx(c,{spacing:3,sx:{py:3},children:e.jsxs(c,{children:[e.jsx(f,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correos Electronicos:"}),e.jsx(tt,{disableEdition:!0,name:"emails",fullWidth:!0,disabled:T,placeholder:"Escribe los correos para compartir",value:(d==null?void 0:d.emails)||[],helperText:j.emails&&w.emails?w.emails:"",error:!!(j.emails&&w.emails),onChange:b=>{F("emails",b)},renderChip:(b,g,M)=>a.createElement(b,{...M,variant:"filled",sx:{fontWeight:"bolder",backgroundColor:Oe((M==null?void 0:M.label)||""),color:"white","& .MuiChip-deleteIcon":{color:"white"}},key:g}),onBlur:V,onInputChange:$,inputValue:m})]})})})})}function cs({disabledExpand:t=!1}){const s=y(d=>d.card),[o,l]=a.useState(t),[i,m]=a.useState(!1),[n,r]=a.useState(!1),u=y(d=>d.setOpenFundingOrder),p=y(d=>d.setFundingCard),D=y(d=>d.isMainCardSelected);return e.jsxs(e.Fragment,{children:[e.jsxs(U,{sx:{p:3},children:[e.jsxs(c,{display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(f,{variant:"h6",children:D?"Fondear Comercio":"Fondear Tarjeta"}),e.jsx(E,{sx:{flex:"1 1 auto"}}),!t&&e.jsx(me,{onClick:()=>{l(d=>!d)},children:o?e.jsx(yt,{sx:{color:"text.disabled"}}):e.jsx(bt,{sx:{color:"text.disabled"}})})]}),e.jsx(St,{in:o,timeout:"auto",children:e.jsxs(c,{spacing:2,children:[e.jsxs(c,{flexDirection:"column",justifyContent:"space-between",alignItems:"baseline",gap:1,sx:{display:"flex",flexWrap:"wrap"},children:[e.jsxs(c,{flexDirection:"row",alignItems:"center",justifyContent:"center",sx:{flexGrow:1,flexWrap:"wrap"},gap:1,children:[e.jsx(f,{variant:"subtitle1",sx:{color:"text.secondary"},children:"SPEI"}),e.jsx(me,{variant:"outlined",color:i?"success":"inherit",onClick:()=>{m(!0),Pe(s==null?void 0:s.SPEI),setTimeout(()=>{m(!1)},1e3)},children:i?e.jsx(Se,{sx:{color:"success"}}):e.jsx(Mt,{sx:{color:"text.disabled"}})})]}),e.jsx(f,{variant:"body1",children:s==null?void 0:s.SPEI})]}),e.jsxs(c,{flexDirection:"row",flexWrap:"wrap",gap:3,alignItems:"center",children:[e.jsx(Y,{fullWidth:!0,color:"primary",variant:"outlined",startIcon:e.jsx(Jt,{}),onClick:()=>r(!0),children:"Compartir"}),e.jsx(Y,{fullWidth:!0,color:"primary",variant:"contained",startIcon:e.jsx(Et,{}),onClick:()=>{u(!0),p(s)},children:"Orden Fondeo"})]})]})})]}),e.jsx(ls,{card:s,open:n,onClose:()=>{r(!1)}})]})}const ds=(t,s,o,l={})=>{if(!s||!o)return null;const i=ue(s,"yyyy-MM-dd"),m=ue(o,"yyyy-MM-dd"),n=`${X(s)} - ${X(o)}`,[r,u]=a.useState(null),p=y(d=>d.addInfoCard);return{...K([B.CARD_MOVEMENTS,t],({signal:d})=>ht(t,i,m,d),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:d=>{const j=W(d,"No se puede obtener la lista de movimientos de la tarjeta. Intente nuevamente o reporte a sistemas");u(j),H.error(j,{type:ce(d)}),p({monthBalance:n,movements:[],expenses:"$0.00",income:"$0.00",balanceMovements:"$0.00"})},...l}),error:r||null}},ms=J(a.lazy(()=>Z(()=>import("./build-b35d2678.js"),["assets/js/build-b35d2678.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-2b227f05.js","assets/js/build-53b11780.js","assets/js/build-c6f78c0d.js","assets/js/build-6fc59234.js","assets/js/build-ee266471.js","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js","assets/js/build-0d95e123.js","assets/js/build-f831d8b4.js","assets/js/build-46916aa3.js","assets/js/build-4389c83a.js","assets/js/build-1f7146f4.js","assets/js/build-bee6630b.js","assets/js/build-566d20b3.js","assets/js/build-e69012db.js","assets/js/build-1adb5778.js","assets/js/build-b0677c31.js","assets/js/build-381d8d7c.js","assets/js/build-7637d2c3.js","assets/js/build-4d4aa58d.js","assets/js/build-7041d859.js","assets/js/build-8adb868c.js"]))),us=J(a.lazy(()=>Z(()=>import("./build-a9f8f40e.js"),["assets/js/build-a9f8f40e.js","assets/js/index-3809032b.js","assets/css/build-c23c9e36.css","assets/js/build-02647ec5.js","assets/js/build-9f005fe0.js","assets/js/build-ff91dbf2.js","assets/js/build-d59f6763.js"])));function hs(){var q;const[t,s]=a.useState(!1),[o,l]=a.useState(!1),[i,m]=a.useState(null),n=new Date,r=Rt(n,{days:30}),u=n,[p,D]=a.useState(r),[d,j]=a.useState(u),w=y(h=>h.card),F=y(h=>h.addInfoCard),{data:R,isLoading:T,refetch:$,remove:V,isFetching:b,isError:g,error:M}=ds(w==null?void 0:w.id,p,d,{enabled:!1}),_=(R==null?void 0:R.movements)||[],G=a.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,minSize:200,Cell:({cell:h,column:v,row:S})=>{const{original:x}=S;return e.jsx(st,{row:x})}},{accessorKey:"serverDate",header:"Fecha",size:120,Cell:({cell:h,column:v,row:S})=>{const{original:x}=S;return e.jsx(c,{children:e.jsx(f,{variant:"subtitle2",children:x==null?void 0:x.fullDate})})}},{accessorKey:"operationType",header:"Tipo",filterVariant:"multi-select",size:100,Cell:({cell:h,column:v,row:S})=>{const{original:x}=S,P=Pt(x==null?void 0:x.operationType),I=P==null?void 0:P.component;return e.jsx(E,{children:P?e.jsx(I,{sx:{width:25,height:25}}):e.jsx(nt,{size:22})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:h,column:v,row:S})=>{const{original:x}=S,P=(x==null?void 0:x.type)==="ingreso",I=(x==null?void 0:x.type)==="terminal";return e.jsx(f,{variant:"subtitle2",fontWeight:"bold",color:P||I?"success.main":"error",children:P||I?`+ ${x==null?void 0:x.amountFormat}`:`- ${x==null?void 0:x.amountFormat}`})}},{accessorKey:"verified",header:"Comprobación",size:80,Cell:({cell:h,column:v,row:S})=>{const{original:x}=S;return e.jsx(c,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,mr:2,color:"primary",children:x!=null&&x.verified?e.jsx(Dt,{color:"green",fontWeight:"bold",fontSize:"18px"}):e.jsx(Ot,{fontSize:"18px",color:"red"})})}}],[]);a.useEffect(()=>{p&&d&&$()},[p,d]),a.useEffect(()=>{D(r),j(u)},[w==null?void 0:w.id]),a.useEffect(()=>{if(R){const h=`${X(p)} - ${X(d)}`??null;F({...R,monthBalance:h})}},[R,w==null?void 0:w.id,p,d]);const z=h=>{d!==null&&h>d&&j(h),D(h)},N=h=>{p!==null&&h<p&&D(h),j(h)},ee=h=>()=>{var P;const v=((P=h==null?void 0:h.getSelectedRowModel().flatRows)==null?void 0:P.map(I=>I.original))??[],S=v==null?void 0:v.some(I=>I==null?void 0:I.verified),x=v==null?void 0:v.some(I=>(I==null?void 0:I.operationType)!=="OTROS CARGOS");return S?H.warn("Existen movimientos que ya se encuentran comprobados, verifique los movimientos seleccionados."):x?H.warn("Existen movimientos que no se pueden comprobar, verifique el tipo de movimiento."):l(!0)},O=Ft(g,M,{columns:G,data:_||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,positionActionsColumn:"last",enableDensityToggle:!1,selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:T,showAlertBanner:g,showProgressBars:b},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:h})=>e.jsx(E,{sx:{display:"flex",gap:"1rem"},children:e.jsx(re,{loading:b,onClick:ee(h),disabled:te(),startIcon:e.jsx(Se,{width:24,height:24}),variant:"outlined",children:"Comprobar"})}),renderRowActionMenuItems:({row:h,closeMenu:v})=>[e.jsx(Ae,{onClick:()=>{const{original:S}=h;m(S),v(),s(!0)},children:"Incidencia"},"incidence")]}),A=((q=O==null?void 0:O.getSelectedRowModel().flatRows)==null?void 0:q.map(h=>h.original))??[],te=a.useCallback(()=>{var S;const h=A.length>0?(S=A[0])==null?void 0:S.paymentProcessor:null;return!!!(A.every(x=>x.paymentProcessor===h)&&(O!=null&&O.getIsSomeRowsSelected()))},[A,O]);return e.jsxs(e.Fragment,{children:[e.jsxs(U,{children:[e.jsxs(c,{p:2,direction:"row",justifyContent:"center",alignItems:"center",spacing:2,children:[e.jsx(he,{size:"small",value:p,onChange:z,maxDate:d,slotProps:{textField:{size:"small",required:!0}},disabled:b,format:"dd MMMM yyyy"}),e.jsx(Tt,{children:"-"}),e.jsx(he,{size:"small",value:d,onChange:N,minDate:p,slotProps:{textField:{size:"small",required:!0}},disabled:b,format:"dd MMMM yyyy"})]}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsx(At,{table:O})]}),e.jsx(ms,{open:t,setOpen:s,selectedMovement:i}),e.jsx(us,{open:o,setOpen:l,movements:A??[]})]})}const ps=le(t=>e.jsx(Bt,{focusVisibleClassName:".Mui-focusVisible",disableRipple:!0,...t}))(({theme:t})=>({width:42,height:26,padding:0,"& .MuiSwitch-switchBase":{padding:0,margin:2,transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .MuiSwitch-track":{backgroundColor:t.palette.mode==="dark"?"#2ECA45":"#65C466",opacity:1,border:0},"&.Mui-disabled + .MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .MuiSwitch-thumb":{color:"#33cf4d",border:"6px solid #fff"},"&.Mui-disabled .MuiSwitch-thumb":{color:t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[600]},"&.Mui-disabled + .MuiSwitch-track":{opacity:t.palette.mode==="light"?.7:.3}},"& .MuiSwitch-thumb":{boxSizing:"border-box",width:22,height:22},"& .MuiSwitch-track":{borderRadius:26/2,backgroundColor:t.palette.error.main,opacity:1,transition:t.transitions.create(["background-color"],{duration:500})}}));function ve({card:t}){const[s,o]=a.useState(!1),[l,i]=a.useState(!1),{mutate:m,isLoading:n}=kt(),r=be([B.CARD_INFO,t==null?void 0:t.id])===1;a.useEffect(()=>{o(!1),i(!1)},[t==null?void 0:t.id]);const u=p=>{m({...t,cardON:!(t!=null&&t.cardON)})};return e.jsx(Fe,{sx:p=>({borderRadius:1,position:"relative",zIndex:1,backgroundColor:p.palette.primary.light,color:p.palette.primary.contrastText,minHeight:"auto!important",height:{xs:1,sm:"auto"},py:{xs:0,sm:2}}),children:e.jsxs(c,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(c,{flexDirection:"column",spacing:0,alignItems:{xs:"center",md:"start"},children:[e.jsxs(c,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(f,{variant:"subtitle2",children:"Disponible"}),n||r?e.jsx(Re,{size:30,containerProps:{display:"flex",ml:1}}):e.jsx(ps,{disabled:n,color:t!=null&&t.cardON?"success":"error",checked:(t==null?void 0:t.cardON)||!1,onChange:u,sx:{m:1},inputProps:{"aria-label":"controlled"}})]}),e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(f,{variant:"h3",children:t==null?void 0:t.balanceFormatted}),e.jsx(f,{variant:"caption",children:"MXN"})]})]}),e.jsxs(c,{justifyContent:"flex-end",spacing:1,alignItems:{xs:"center",md:"end"},children:[e.jsx(Lt,{card:t}),e.jsxs(c,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",gap:1,divider:e.jsx(ae,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),children:[e.jsx(f,{variant:"subtitle2",children:t==null?void 0:t.expiration}),e.jsx(Y,{startIcon:s?e.jsx(oe,{handleFinish:()=>o(!1)}):e.jsx(ge,{}),color:"inherit",onClick:()=>o(p=>!p),sx:{px:0,mx:0},children:s?e.jsx(c,{px:1,children:t==null?void 0:t.cvv}):"CVV"}),e.jsx(Y,{startIcon:l?e.jsx(oe,{handleFinish:()=>i(!1)}):e.jsx(ge,{}),color:"inherit",onClick:()=>i(p=>!p),children:l?e.jsx(c,{px:1,children:t==null?void 0:t.nip}):"NIP"})]})]})]})})}ve.propTypes={card:C.shape({balanceFormatted:C.any,cardON:C.bool,cvv:C.any,expiration:C.any,id:C.any,nip:C.any})};function oe({handleFinish:t,duration:s=10}){const[o,l]=a.useState(100);return a.useEffect(()=>{let i;return o>0?i=setInterval(()=>{l(m=>m-100/s)},1e3):t(),()=>clearInterval(i)},[o,s]),e.jsxs(E,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(Te,{color:"secondary",variant:"determinate",value:o}),e.jsx(E,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(f,{variant:"caption",component:"div",color:"text.primary.contrastText",children:`${Math.ceil(s*o/100)} `})})]})}oe.propTypes={duration:C.number,handleFinish:C.func};function xs(){const t=y(u=>u.card),s=y(u=>u.addInfoCard),{data:o,isLoading:l,isError:i,error:m,refetch:n}=is(t==null?void 0:t.id,{enabled:!!(t!=null&&t.id)}),{isCollapse:r}=ke();return a.useEffect(()=>{o&&s(o)},[o]),e.jsx(c,{sx:u=>({pl:{xs:0,sm:2,lg:2},overflow:"hidden",flexDirection:"column",flexGrow:1}),children:e.jsxs(Vt,{children:[l&&t&&e.jsx(ye,{}),i&&!o&&!l&&e.jsx(de,{sx:{justifyContent:"flex-start"},errorMessage:m,handleButton:n}),t&&!l&&!i&&o&&e.jsxs(e.Fragment,{children:[e.jsx(Q.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsxs(c,{sx:u=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(ve,{card:t}),e.jsx(ss,{})]})}),e.jsx(E,{sx:{overflowY:"auto"},children:e.jsx(Q.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsx(c,{pt:2,pb:4,px:2,children:e.jsxs(se,{container:!0,spacing:3,sx:{p:0,pb:3},children:[e.jsx(se,{item:!0,xs:12,sm:12,md:12,lg:r?4:12,xl:3,children:e.jsxs(c,{spacing:3,children:[e.jsx(rs,{card:t}),e.jsx(cs,{}),e.jsx(ns,{})]})}),e.jsx(se,{item:!0,xs:12,sm:12,md:12,lg:r?8:12,xl:9,children:e.jsx(hs,{})})]})})})})]}),!t&&e.jsx(Q.div,{exit:{opacity:0},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e.jsxs(c,{spacing:3,sx:{height:"100%",width:"100%"},children:[e.jsx(Le,{variant:"filled",severity:"info",children:"Debe seleccionar una tarjeta para ver sus detalles!"}),e.jsx(c,{alignItems:"center",children:e.jsx(_t,{sx:{width:"30%"}})})]})})]})})}const fs=le(Be)(({theme:t})=>({borderRadius:"8px!important",width:1,justifyContent:"center",display:"flex",alignItems:"center",mb:1}));Ie.propTypes={isOpenSidebar:C.bool,card:C.object,onOpenDetails:C.func};function Ie({isOpenSidebar:t,card:s,onOpenDetails:o}){const{id:l,cardUserNumber:i,cardType:m}=s,n=y(j=>j.setCard),r=y(j=>j.card),u=y(j=>j.addInfoCard),p=l===(r==null?void 0:r.id)&&r?(r==null?void 0:r.cardON)===!0?"online":"offline":"invisible",D=l===(r==null?void 0:r.id),d=j=>{var F;!((F=j.target)==null?void 0:F.type)&&!D&&(n(s),u({movements:[],expenses:"$0.00",income:"$0.00",balanceMovements:"$0.00"}),o())};return e.jsx(_e,{title:t?"":i,arrow:!0,placement:"right",children:e.jsx(Nt,{sx:{mb:1,padding:0,borderRadius:1,"& :hover":{color:"text.primary"}},disablePadding:!0,children:e.jsxs(fs,{onClick:d,sx:{...D&&{bgcolor:"secondary.light",color:"text.primary.contrastText","& :hover":{color:"text.primary"}},"& :hover":{color:"text.primary"},width:1,py:1,gap:1},children:[e.jsx(Ht,{sx:{ml:2,m:0},children:e.jsxs(E,{sx:{position:"relative"},children:[e.jsx(Ve,{sx:j=>({width:30,height:30,m:0,color:j.palette.primary.contrastText,backgroundColor:j.palette.primary.light}),children:m==="Carnet"?e.jsx(vt,{basedOnTheme:!0,sx:{width:20}}):e.jsx(zt,{sx:{width:20}})}),e.jsx(ze,{status:p,sx:{right:0,bottom:0,position:"absolute"}})]})}),t&&e.jsx(e.Fragment,{children:e.jsx(c,{sx:{width:1},children:e.jsx(f,{noWrap:!0,variant:"subtitle2",children:i})})})]})})})}const gs=a.memo(Ie);we.propTypes={cards:C.array,isOpenSidebar:C.bool,onOpenDetails:C.func,isLoading:C.bool,sx:C.object};function we({cards:t,isOpenSidebar:s,isLoading:o,sx:l,onOpenDetails:i,...m}){return e.jsx(Ne,{disablePadding:!0,sx:l,...m,children:(o?[...Array(5)]:t).map((n,r)=>n!=null&&n.id?e.jsx(gs,{isOpenSidebar:s,card:n,onOpenDetails:i},n==null?void 0:n.id):e.jsx(Wt,{isOpenSideBar:s},r))})}function Me({cardTypes:t,isLoading:s,isError:o,refetch:l}){const i=y(r=>r.setCardTypeSelected),m=y(r=>r.cardTypeSelected),n=r=>{i(r==null?void 0:r.id)};return e.jsxs(E,{display:"flex",children:[s&&e.jsx(ye,{}),o&&!s&&e.jsx(de,{errorMessage:"No existen tipos de tarjetas para este comercio",handleButton:l}),!s&&!o&&(t==null?void 0:t.map(r=>{const u=m===(r==null?void 0:r.id);return e.jsx(gt,{variant:u?"ghost":"filled",color:He((r==null?void 0:r.name)||"inherit"),sx:{textTransform:"uppercase",marginRight:1,marginBottom:2,cursor:"pointer",border:u?3:0,borderColor:u?p=>p.palette.primary.main:"inherit"},children:e.jsx(Q.div,{onClick:()=>n(r),whileHover:{scale:1.03},whileTap:{scale:.8},children:r==null?void 0:r.name},r==null?void 0:r.id)},r==null?void 0:r.id)}))]})}Me.propTypes={cardTypes:C.array,isError:C.any,isLoading:C.any,refetch:C.any};const js=(t={})=>{const[s,o]=a.useState(null),l=y(n=>n.setCardTypeSelected),i=y(n=>n.cardTypeSelected);return{...K([B.PAYMENT_PROCESSORS],pt,{staleTime:6e4,refetchOnMount:"always",onError:n=>{const r=W(n,"No se puede obtener la lista de los tipos de tarjetas. Intente nuevamente o reporte a sistemas");o(r)},onSuccess:n=>{const r=(n==null?void 0:n.find(u=>(u==null?void 0:u.id)==="2"))||Array.isArray(n)&&(n==null?void 0:n.length)>0&&n[0]||null;r&&!i&&l(r==null?void 0:r.id)},...t}),error:s||null}},Cs=(t,s={})=>{const[o,l]=a.useState(null),i=y(n=>n.setMainCard);return{...K([B.MAIN_CARD],({signal:n})=>xt(t,n),{staleTime:6e4,refetchOnWindowFocus:!1,onError:n=>{const r=W(n,"No se puede obtener la informacion de la tarjeta principal");l(r),i(null),H.error(r,{type:ce(n)})},onSuccess:n=>{i(n)},...s}),error:o||null}};function ys(){const t=y(k=>{var L;return(L=k.card)==null?void 0:L.id}),s=y(k=>k.cardTypeSelected),{data:o,isLoading:l,isError:i,refetch:m}=js(),{data:n,isLoading:r,isRefetching:u,isError:p,error:D,refetch:d,isSuccess:j}=os(s,{enabled:!1}),{data:w,refetch:F,isLoading:R}=Cs(s,{enabled:!1}),T=We(),$=(T==null?void 0:T.permissions)??[],V=r||u,b=$e(),[g,M]=a.useState(!0),[_,G]=a.useState(""),[z,N]=a.useState(n||[]),[ee,O]=a.useState(!1),A=qe("up","md"),te=_&&ee,q=A&&!g;a.useEffect(()=>{s&&d(),s&&$.includes(Ke.COMMERCE_CARDS)&&F()},[s]),a.useEffect(()=>{if(!A)return h()},[A,t]),a.useEffect(()=>{if(!g)return O(!1)},[g]),a.useEffect(()=>{n&&N(n)},[n]);const h=()=>{M(!1)},v=()=>{M(k=>(k&&(G(""),N(n)),!k))},S=()=>{O(!1)},x=async k=>{try{const{value:L}=k.target;if(G(L),L){const Ee=Kt(n,L)||[];N(Ee)}else N(n)}catch(L){console.error(L)}},P=()=>{O(!0)},I=e.jsxs(e.Fragment,{children:[e.jsxs(c,{children:[g&&e.jsx(Me,{cardTypes:o,isLoading:l,isError:i,refetch:m}),!s&&g&&!l&&e.jsx(xe,{pt:2.5,message:"Seleccione un tipo de tarjeta para obtener la lista de tarjetas"})]}),s&&!l&&!i&&e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:{p:2,px:0},children:e.jsxs(c,{direction:"row",justifyContent:g?"flex-end":"center",alignItems:"center",spacing:2,children:[!q&&e.jsx(Xt,{onClickAway:S,children:e.jsx(jt,{fullWidth:!0,size:"small",value:_,onFocus:P,onChange:x,placeholder:"Buscar Tarjetas...",InputProps:{startAdornment:e.jsx(Gt,{position:"start",children:e.jsx(Qt,{sx:{color:"text.disabled",width:20,height:20}})})}})}),e.jsx(c,{direction:"row",alignItems:"center",justifyContent:"center",children:e.jsx($t,{size:"small",sx:{...!g&&{transform:"rotate(180deg)"}},onClick:v,children:Ge})})]})}),p&&g&&!n&&!V&&e.jsx(de,{errorMessage:D,handleButton:d}),n&&g&&(n==null?void 0:n.length)===0&&!V&&e.jsx(xe,{pt:2.5,message:"No hay tarjetas activas en este tipo de tarjeta"}),e.jsx(Ce,{sx:{height:.98},children:e.jsxs(e.Fragment,{children:[e.jsx(we,{isOpenSidebar:g,cards:z||[],isLoading:V,onOpenDetails:h}),te&&(z==null?void 0:z.length)===0&&(n==null?void 0:n.length)>0&&e.jsx(Qe,{sx:{p:1,display:"flex",flexDirection:"column",alignItems:"center"},searchQuery:_})]})})]})]});return e.jsxs(e.Fragment,{children:[!A&&!g&&e.jsx(qt,{onClick:v,children:e.jsx(Yt,{sx:{width:16,height:16}})}),A?e.jsx(fe,{open:g,variant:"persistent",PaperProps:{sx:{height:1,borderRightStyle:"none",bgcolor:"background.default"}},sx:{height:1,width:ne,transition:b.transitions.create("width"),"& .MuiDrawer-paper":{position:"static",backgroundColor:"transparent!important",width:ne},...q&&{width:pe,"& .MuiDrawer-paper":{width:pe,backgroundColor:"transparent!important",position:"static",transform:"none !important",visibility:"visible !important"}}},children:I}):e.jsx(fe,{ModalProps:{keepMounted:!0},open:g,onClose:h,sx:{height:1,"& .MuiDrawer-paper":{width:ne,p:2}},children:I})]})}function In(){const t=Ye();return a.useEffect(()=>()=>{const s=Object.values(B);t.cancelQueries(s)},[]),e.jsx(Xe,{title:"Lista de Tarjetas",children:e.jsxs(It,{children:[e.jsxs(E,{display:"flex",overflow:"hidden",sx:{height:"100vH",maxHeight:"100%",flexDirection:"column"},children:[e.jsx(E,{px:1,children:e.jsx(wt,{name:"Lista de Tarjetas",links:[{name:"Inicio",href:Je.root},{name:"Viabo Card",href:Ze.cards},{name:Ue.cards.name}]})}),e.jsxs(E,{display:"flex",overflow:"hidden",sx:{flex:"1 1 0%"},children:[e.jsx(E,{display:"block",width:1,position:"absolute"}),e.jsx(ys,{}),e.jsx(xs,{})]})]}),e.jsx(rt,{})]})})}export{In as default};
