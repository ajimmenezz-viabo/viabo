import{k as R,a as v,a0 as p,g as f,b as S,r as M,d as B,j as t,S as c,O as N,T as C,B as k}from"./index-f2af7371.js";import{M as A,a as P}from"./build-3f37fb88.js";import{c as I,F as j,g as z,u as m}from"./build-f493af2f.js";import{g as D}from"./build-95ec7180.js";import{M as L}from"./build-ade453cc.js";import{C as G}from"./build-74b4ea0f.js";import"./build-3c5f06b6.js";import"./build-d4372400.js";import"./build-a8f3b92a.js";import"./build-f3c24bda.js";import"./build-1bce752b.js";import"./build-448d52f7.js";import"./build-7ee28246.js";import"./build-4dacb7f8.js";import"./build-1bc4e94a.js";import"./build-28635606.js";import"./build-af74c0c6.js";import"./build-31cbfc99.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-eda310a1.js";import"./build-933bfd48.js";import"./build-422e6a56.js";import"./build-bee6630b.js";import"./build-2d4bd382.js";import"./build-fadd9025.js";const K=(r,n)=>({reference:r==null?void 0:r.referenceNumber,movementId:n==null?void 0:n.id}),Q=(r={})=>{const n=R(),o=v(I,r);return{...o,mutate:async(a,i)=>{const{onSuccess:l,onError:x,mutationOptions:b}=i;try{await p.promise(o.mutateAsync(a,b),{pending:"Conciliando orden de fondeo ...",success:{render({data:s}){return n.invalidateQueries([j.LIST]),l(s),"Se creó la conciliación con éxito"}}})}catch(s){const d=f(s,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");x(d),p.error(d,{type:S(s)})}}}},V=(r={})=>{const[n,o]=M.useState(null);return{...B([j.MOVEMENTS],z,{staleTime:6e4,refetchOnWindowFocus:!1,onError:a=>{const i=f(a,"No se puede obtener los movimientos de la cuenta");o(i),p.error(i,{type:S(a)})},...r}),error:n||null}},be=()=>{const r=m(e=>e.openConciliateModal),n=m(e=>e.setOpenConciliateModal),o=m(e=>e.fundingOrder),g=m(e=>e.setFundingOrder),{mutate:a,isLoading:i}=Q(),l=M.useRef(null),x=[{accessorKey:"description",header:"Movimiento",size:100},{accessorKey:"date",header:"Fecha",size:100},{accessorKey:"amount",header:"Monto",size:100}],{data:b,isError:s,error:d,isLoading:w,isFetching:T}=V({enabled:!!o}),u=D(o==null?void 0:o.paymentProcessorName),E=u==null?void 0:u.component,F=()=>{var y;const e=(y=l.current)==null?void 0:y.getSelectedRowModel().rows;if((e==null?void 0:e.length)>0){const O=K(o,e[0]);a(O,{onSuccess:()=>{h()},onError:()=>{}})}else p.warn("Debe seleccionar un movimiento para conciliar la orden de fondeo")},h=()=>{n(!1),g(null)};return t.jsx(L,{onClose:h,onSuccess:F,isSubmitting:i,fullWidth:!0,scrollType:"body",title:"Conciliar",textButtonSuccess:"Conciliar",open:r,children:t.jsxs(c,{spacing:3,sx:{py:3},children:[t.jsx(N,{severity:"info",sx:{display:"flex",flexGrow:1,"& .MuiAlert-message":{display:"flex",flexGrow:1}},children:t.jsxs(c,{flexGrow:1,spacing:2,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t.jsxs(c,{children:[t.jsxs(C,{variant:"subtitle2",children:["Orden #",o==null?void 0:o.referenceNumber]}),t.jsx(C,{variant:"subtitle2",fontWeight:"bold",children:o==null?void 0:o.amount})]}),t.jsx(c,{children:u&&t.jsx(E,{sx:{width:30,height:30}})})]})}),t.jsx(c,{children:t.jsx(G,{children:t.jsx(A,{enablePinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,tableInstanceRef:l,columns:x||[],data:b||[],isError:s,textError:d,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:w,showAlertBanner:s,showProgressBars:T},muiTablePaperProps:{elevation:0,sx:e=>({borderRadius:0,backgroundColor:e.palette.background.neutral})},muiBottomToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},muiTopToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{size:12,header:""}},renderToolbarInternalActions:({table:e})=>t.jsx(k,{children:t.jsx(P,{table:e})}),muiTableContainerProps:{sx:{maxHeight:"md"}}})})})]})})};export{be as default};
