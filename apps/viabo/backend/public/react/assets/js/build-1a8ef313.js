import{r as j,i as O,as as J,al as ee,j as e,aq as w,aX as te,aY as se,aZ as _,q as R,a as N,b as ne,g as P,a8 as oe,m as re,a9 as L,n as ie,a3 as ae,S as u,T as x,c as le,V as ce,X as B,L as de,B as M,aB as me,I as ue,aC as pe,e as he,a5 as xe,aR as ge,aS as fe}from"./build-bd106f3f.js";import{a as Ce,H as je}from"./build-3fd10419.js";import{g as Ee,C as Se,f as ve,e as Ae,R as Te,c as be,M as ye}from"./build-f16e01c8.js";import{c as we,d as Ie}from"./build-3df7d10a.js";import{C as k}from"./build-67411f80.js";import{a as Re,C as _e}from"./build-ae888455.js";import{u as Le}from"./build-7122b208.js";import{F as De}from"./build-bae479f0.js";import{c as ze,a as I}from"./build-f590a2bc.js";import{s as Oe}from"./build-9563ddbe.js";import{C as Ne,D as Pe}from"./build-5da0523f.js";import{C as Be}from"./build-3625df71.js";import{R as D}from"./build-6201b366.js";import{M as Me}from"./build-f989caba.js";import{I as ke}from"./build-200f548c.js";import{E as He}from"./build-badce359.js";import{A as Ve}from"./build-b563e77e.js";import{a as Fe,C as Ue}from"./build-a614d788.js";import{T as qe,a as z}from"./build-456543a2.js";import"./build-fecf758a.js";import"./build-ecaf0d13.js";import"./build-785a4db1.js";import"./build-bee6630b.js";import"./build-bc51bc70.js";import"./build-ce849df6.js";import"./build-9e94644c.js";import"./build-d3be50c2.js";const We=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],$e={entering:{transform:"none"},entered:{transform:"none"}},Ge=j.forwardRef(function(o,n){const r=O(),i={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},{addEndListener:s,appear:d=!0,children:l,easing:a,in:c,onEnter:h,onEntered:S,onEntering:C,onExit:g,onExited:A,onExiting:F,style:b,timeout:y=i,TransitionComponent:U=te}=o,q=J(o,We),T=j.useRef(null),W=ee(T,l.ref,n),E=m=>f=>{if(m){const v=T.current;f===void 0?m(v):m(v,f)}},$=E(C),G=E((m,f)=>{se(m);const v=_({style:b,timeout:y,easing:a},{mode:"enter"});m.style.webkitTransition=r.transitions.create("transform",v),m.style.transition=r.transitions.create("transform",v),h&&h(m,f)}),Q=E(S),Z=E(F),X=E(m=>{const f=_({style:b,timeout:y,easing:a},{mode:"exit"});m.style.webkitTransition=r.transitions.create("transform",f),m.style.transition=r.transitions.create("transform",f),g&&g(m)}),Y=E(A),K=m=>{s&&s(T.current,m)};return e.jsx(U,w({appear:d,in:c,nodeRef:T,onEnter:G,onEntered:Q,onEntering:$,onExit:X,onExited:Y,onExiting:Z,addEndListener:K,timeout:y},q,{children:(m,f)=>j.cloneElement(l,w({style:w({transform:"scale(0)",visibility:m==="exited"&&!c?"hidden":void 0},$e[m],b,l.props.style),ref:W},f))}))}),Qe=Ge,Ze=R(e.jsx("path",{d:"M4 8h4V4H4v4zm6 12h4v-4h-4v4zm-6 0h4v-4H4v4zm0-6h4v-4H4v4zm6 0h4v-4h-4v4zm6-10v4h4V4h-4zm-6 4h4V4h-4v4zm6 6h4v-4h-4v4zm0 6h4v-4h-4v4z"}),"Apps"),H=R(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"}),"AssignmentIndRounded"),Xe=R(e.jsx("path",{d:"M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"}),"FormatListBulleted"),V={LIST:"unassignedCardsCommerce"},Ye=(t,o)=>{const{phone:n,email:r,name:i}=t,s={name:i,phone:n,email:r,cards:(o==null?void 0:o.map(d=>d==null?void 0:d.id))||[]};return Ee(s)},Ke=async()=>{const{data:t}=await N.get("/api/disabled-cards/commerce");return Se(t)},Je=async t=>(await N.put("/api/assign/commerce-card/to/user",t),t),et=(t={})=>{const[o,n]=j.useState(null);return{...ne([V.LIST],Ke,{staleTime:6e4,onError:i=>{const s=P(i,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");n(s)},...t}),error:o||null}},tt=(t={})=>{const o=oe(),n=re(Je,t);return{...n,mutate:async(i,s)=>{const{onSuccess:d,onError:l,mutationOptions:a}=s;try{await L.promise(n.mutateAsync(i,a),{pending:"Asignando Tarjetas ...",success:{render({data:c}){return o.invalidateQueries([V.LIST]),o.invalidateQueries([Ne.CARDS_COMMERCE_LIST]),d(),"Se asignaron las tarjetas con éxito"}}})}catch(c){const h=P(c,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");l(h),L.error(h,{type:ie(c)})}}}},st=(t,o)=>({cards:[],rows:[],openAssign:!1,setSelectedCard:n=>{const{cards:r}=o(),i=r.indexOf(n);let s=[];i===-1?s=s.concat(r,n):i===0?s=s.concat(r.slice(1)):i===r.length-1?s=s.concat(r.slice(0,-1)):i>0&&(s=s.concat(r.slice(0,i),r.slice(i+1))),t(d=>({cards:s}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:n=>{t(r=>({cards:n}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:n=>{t(r=>({rows:n}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:n=>{t(r=>({openAssign:n}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(n=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),p=we(Ie(st));function nt({cards:t}){const o=p(a=>a.cards),n=p(a=>a.setAllCards),r=p(a=>a.resetCards),i=p(a=>a.setOpenAssign),s=(o==null?void 0:o.length)||0,d=(t==null?void 0:t.length)||0,l=a=>{if(a){n(t);return}r()};return e.jsx(e.Fragment,{children:e.jsx(ae,{sx:a=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:a.customShadows.z8,backgroundColor:a.palette.info.lighter,color:"white"}),children:e.jsxs(u,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(u,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(k,{indeterminate:s>0&&s<d,checked:d>0&&s===d,onChange:a=>l(a.target.checked),color:"success"}),e.jsx(x,{color:"success.main",variant:"subtitle1",children:s===1?`${s} Tarjeta`:`${s} Tarjetas`})]}),e.jsx(u,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(le,{startIcon:e.jsx(H,{}),variant:"outlined",color:"info",onClick:()=>i(!0),children:"Asignar"})})]})})})}function ot({card:t}){const o=p(s=>s.setSelectedCard),n=p(s=>s.cards),r=n==null?void 0:n.some(s=>(s==null?void 0:s.id)===(t==null?void 0:t.id)),i=s=>{s.stopPropagation(),o(t)};return e.jsx(ce.div,{onClick:i,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(ve,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(u,{flexDirection:"row",gap:1,children:[e.jsx(k,{onClick:i,edge:"start",checked:r,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(u,{children:[e.jsx(x,{variant:"subtitle2",sx:{opacity:.72},children:"Viabo Card"}),e.jsx(x,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(Ae,{card:t,disableShow:!0}),e.jsxs(u,{direction:"row",spacing:5,children:[e.jsxs(u,{children:[e.jsx(x,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(x,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(Re,{card:t,disableShow:!0})]})]})})}function rt({cards:t,onSuccess:o}){const{mutate:n,isLoading:r}=tt(),i=ze({name:I().required("El nombre es requerido"),email:I().email("Ingresa un correo valido").required("El correo es requerido"),phone:I().test("longitud","El telefono es muy corto",g=>!(g&&g.replace(/[\s+]/g,"").length<10))}),s=Le({initialValues:{name:"",phone:"",email:""},validationSchema:i,onSubmit:g=>{const A=Ye(g,t);n(A,{onSuccess:()=>{S(!1),o()},onError:()=>{S(!1)}})}}),{errors:d,touched:l,isSubmitting:a,setFieldValue:c,values:h,setSubmitting:S}=s,C=a||r;return e.jsx(B,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(De,{formik:s,children:e.jsxs(u,{spacing:3,sx:{p:3},children:[e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:C})]}),e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:C,InputProps:{startAdornment:e.jsx(ke,{position:"start",children:e.jsx(He,{})})}})]}),e.jsxs(u,{children:[e.jsx(x,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Me,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:h.phone||"+52",disabled:C,onChange:(g,A)=>{c("phone",g)},error:l.phone&&!!d.phone,helperText:l.phone&&d.phone})]}),e.jsx(u,{sx:{pt:3},children:e.jsx(de,{loading:a,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Ve,{}),children:"Asignar"})})]})})})}function it({open:t,handleClose:o,handleSuccess:n}){const r=p(i=>i.cards);return e.jsxs(Te,{open:t,handleClose:o,title:"Asignar Tarjetas",children:[e.jsx(u,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",p:3,children:r==null?void 0:r.map(i=>e.jsx(Fe,{icon:e.jsx(Ue,{}),label:i==null?void 0:i.cardNumberHidden},i==null?void 0:i.id))}),e.jsx(rt,{cards:r,onSuccess:n})]})}function at({unassignedCards:t}){const o=t==null?void 0:t.data,n=p(l=>l.cards),r=p(l=>l.setIndexCards,Oe),i=O(),s=j.useMemo(()=>(n==null?void 0:n.map(l=>o.findIndex(a=>a.id===l.id)))||[],[n,o]);j.useEffect(()=>{r(s)},[s]);const d={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen};return e.jsx(u,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(u,{sx:l=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(Qe,{in:(n==null?void 0:n.length)>0,timeout:d,style:{transitionDelay:`${(n==null?void 0:n.length)>0?d.exit:0}ms`},unmountOnExit:!0,children:e.jsx(M,{children:e.jsx(nt,{cards:t==null?void 0:t.data})})}),e.jsx(B,{children:e.jsx(_e,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:ot,my:3})})]})})}function lt({handleAssign:t}){return e.jsx(M,{sx:{marginRight:3},children:e.jsx(me,{title:"Asginar",children:e.jsx(ue,{onClick:t,children:e.jsx(H,{sx:{color:o=>o.palette.info.main},width:24,height:24})})})})}function ct({isLoading:t,cards:o=[],rows:n=[]}){const r=p(l=>l.setAllCards),i=p(l=>l.setOpenAssign),s=p(l=>l.setIndexCards),d=[{name:"cardNumberHidden",label:"Tarjeta",options:{customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsx(x,{variant:"subtitle2",fontWeight:"bold",children:c==null?void 0:c.cardNumberHidden})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsxs(u,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(pe,{sx:h=>({width:45,height:45,color:h.palette.primary.contrastText,backgroundColor:h.palette.primary.light}),children:(c==null?void 0:c.cardType)==="Carnet"?e.jsx(be,{sx:{width:30},color:"white"}):e.jsx(ye,{sx:{width:30}})}),e.jsx(x,{variant:"subtitle2",children:c==null?void 0:c.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"register",label:"Fecha",options:{filterType:"textField",customBodyRenderLite:(l,a)=>{const c=o[l];return e.jsxs(u,{children:[e.jsx(x,{variant:"subtitle2",children:c==null?void 0:c.registerDate}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:c==null?void 0:c.registerTime})]})}}}];return e.jsx(Be,{children:e.jsx(Pe,{isLoading:t,data:o||[],columns:d,options:{responsive:"simple",rowsSelected:n,rowHover:!0,selectableRows:"multiple",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_sin_asignar.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(l,a,c)=>{const h=o==null?void 0:o.filter((S,C)=>c.includes(C));r(h),s(c)},customToolbarSelect:l=>e.jsx(lt,{handleAssign:()=>{i(!0)}})}})})}function Bt(){const t=et(),[o,n]=j.useState("1"),r=(a,c)=>{n(c)},i=p(a=>a.rows),s=p(a=>a.openAssign),d=p(a=>a.setOpenAssign),l=p(a=>a.resetCards);return e.jsx(e.Fragment,{children:e.jsx(he,{title:"Tarjetas Sin Asignar del Comercio",children:e.jsxs(Ce,{sx:{height:"100%"},children:[e.jsx(je,{name:"Tarjetas Sin Asignar",links:[{name:"Inicio",href:xe.root},{name:"Administracion",href:ge.cards},{name:fe.unassignedCards.name}],buttons:e.jsxs(qe,{size:"small",color:"primary",value:o,exclusive:!0,onChange:r,"aria-label":"Platform",children:[e.jsx(z,{value:"1",children:e.jsx(Xe,{})}),e.jsx(z,{value:"2",children:e.jsx(Ze,{})})]})}),o==="2"&&e.jsx(at,{unassignedCards:t}),o==="1"&&e.jsx(ct,{cards:t.data,isLoading:t.isLoading,rows:i}),e.jsx(it,{open:s,handleClose:()=>{d(!1)},handleSuccess:()=>{d(!1),l()}})]})})})}export{Bt as default};
