import{ag as L,J as z,b1 as R,b2 as K,r as x,d as V,g as _,Q as W,b as $,j as r,S as d,T as b,I as v,E as q,P as X,a9 as D}from"./index-3809032b.js";import{g as Q,B as U,a as G,c as J,d as Y}from"./build-9d77b025.js";import{b as Z}from"./build-a490463b.js";import{C as w}from"./build-5af041c1.js";import{M as ee}from"./build-1adb5778.js";import{s as re}from"./build-fb129cc3.js";import{L as T}from"./build-6fc59234.js";import{C as se}from"./build-9f005fe0.js";import{F as oe}from"./build-4389c83a.js";import{M as k}from"./build-7637d2c3.js";import{b as te,H as ne}from"./build-2b227f05.js";import"./build-26daf111.js";import"./build-f3f9b6e9.js";import"./build-e6290908.js";import"./build-566d20b3.js";import"./build-53b11780.js";import"./build-b0677c31.js";import"./build-46916aa3.js";import"./build-381d8d7c.js";import"./build-4d4aa58d.js";import"./build-f831d8b4.js";import"./build-c6f78c0d.js";const ie={MOVEMENTS:"expenses-card-movements-commerce"},le=async(p,f,g)=>{const i=new URL("/api/cards/movements/commerce",window.location.origin),m=[{field:"date",operator:">=",value:p},{field:"date",operator:"<=",value:f},{field:"operationType",operator:"=",value:"OTROS CARGOS"}];m==null||m.forEach((h,t)=>{Object.entries(h).forEach(([c,M])=>{i.searchParams.set(`filters[${t}][${c}]`,M)})});const{data:l}=await L.get(i.href,{signal:g});return w(l)},ae=(p,f,g={})=>{if(!p||!f)return null;const i=z(R(p),"yyyy-MM-dd HH:mm:ss"),m=z(K(f),"yyyy-MM-dd HH:mm:ss"),[l,h]=x.useState(null),t=V({queryKey:[ie.MOVEMENTS],queryFn:({signal:c})=>le(i,m,c),refetchOnWindowFocus:!1,retry:!1,staleTime:3e5,...g});return x.useEffect(()=>{if(t!=null&&t.isError){const c=_(t.error,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");h(c),W.error(c,{type:$(t.error)})}},[t.isError,t.error]),{...t,error:l||null}},ce=()=>{const p=new Date,f=re(p,{days:30}),g=p,[i,m]=x.useState(f),[l,h]=x.useState(g),{data:t,isError:c,isLoading:M,isFetching:E,error:B,refetch:A}=ae(i,l),O=s=>()=>{var n,o;(o=(n=s==null?void 0:s.expensesControl)==null?void 0:n.otherFiles)==null||o.forEach(e=>{window.open(e,"_blank").focus()})};x.useEffect(()=>{i&&l&&A()},[i,l]);const I=x.useMemo(()=>[{accessorKey:"cardNumber",header:"Tarjeta",enableHiding:!1,size:150,Cell:({cell:s,column:n,row:o})=>{var y,C;const{original:e}=o,u=e==null?void 0:e.isMainCard,a=Q(e==null?void 0:e.paymentProcessor),j=a==null?void 0:a.component;return r.jsxs(d,{direction:"row",spacing:1,alignItems:"center",children:[a&&r.jsx(j,{sx:{width:30,height:30}}),r.jsx(b,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:u?e==null?void 0:e.cardNumber:(C=e==null?void 0:e.cardNumber)==null?void 0:C.substr(((y=e==null?void 0:e.cardNumber)==null?void 0:y.length)-4)})]})}},{accessorKey:"ownerCard",header:"Tarjetahabiente",filterVariant:"multi-select",size:150,Cell:({cell:s,column:n,row:o})=>{const{original:e}=o;return r.jsx(d,{children:r.jsx(b,{variant:"subtitle2",children:e==null?void 0:e.ownerCard})})}},{accessorKey:"description",header:"Movimiento",minSize:120,Cell:({cell:s,column:n,row:o})=>{const{original:e}=o;return r.jsx(d,{children:r.jsx(b,{variant:"subtitle2",children:e==null?void 0:e.description})})}},{accessorKey:"fullDate",header:"Fecha",size:120,Cell:({cell:s,column:n,row:o})=>{const{original:e}=o;return r.jsx(d,{children:r.jsx(b,{variant:"subtitle2",children:e==null?void 0:e.fullDate})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:s,column:n,row:o})=>{const{original:e}=o,u=(e==null?void 0:e.type)==="ingreso",a=(e==null?void 0:e.type)==="terminal";return r.jsx(b,{variant:"subtitle2",fontWeight:"bold",color:u||a?"success.main":"error",children:u||a?`+ ${e==null?void 0:e.amountFormat}`:`- ${e==null?void 0:e.amountFormat}`})}},{accessorKey:"verified",header:"ComprobaciÃ³n",size:100,Cell:({cell:s,column:n,row:o})=>{const{original:e}=o;return r.jsx(d,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,mr:2,color:"primary",children:e!=null&&e.verified?r.jsx(U,{color:"green",fontWeight:"bold",fontSize:"18px"}):r.jsx(G,{fontSize:"18px",color:"red"})})}},{accessorKey:"files",header:"Archivos",size:100,enableFilters:!1,enableColumnFilter:!1,Cell:({cell:s,column:n,row:o})=>{var u,a,j,y,C,S,F,P;const{original:e}=o;return r.jsxs(d,{flexDirection:"row",color:"primary",children:[((u=e==null?void 0:e.expensesControl)==null?void 0:u.isInvoice)&&r.jsxs(d,{direction:"row",spacing:.5,children:[r.jsx(v,{title:"Descargar PDF",LinkComponent:T,href:(j=(a=e==null?void 0:e.expensesControl)==null?void 0:a.invoiceFiles)==null?void 0:j.pdf,target:"_blank",color:"error",children:r.jsx(J,{fontSize:"18px"})}),r.jsx(v,{title:"Descargar XML",LinkComponent:T,href:(C=(y=e==null?void 0:e.expensesControl)==null?void 0:y.invoiceFiles)==null?void 0:C.xml,target:"_blank",color:"info",children:r.jsx(Y,{fontSize:"18px"})})]}),!((S=e==null?void 0:e.expensesControl)!=null&&S.isInvoice)&&((P=(F=e==null?void 0:e.expensesControl)==null?void 0:F.otherFiles)==null?void 0:P.length)>0&&r.jsx(v,{color:"primary",title:"Descargar Archivos",onClick:O(e),children:r.jsx(Z,{fontSize:"20px"})})]})}}],[]),H=s=>{l!==null&&s>l&&h(s),m(s)},N=s=>{i!==null&&s<i&&m(s),h(s)};return r.jsx(r.Fragment,{children:r.jsxs(se,{children:[r.jsxs(d,{p:2,direction:"row",justifyContent:"center",alignItems:"center",spacing:2,children:[r.jsx(k,{size:"small",value:i,onChange:H,maxDate:l,slotProps:{textField:{size:"small",required:!0}},disabled:E,format:"dd MMMM yyyy"}),r.jsx(oe,{children:"-"}),r.jsx(k,{size:"small",value:l,onChange:N,minDate:i,slotProps:{textField:{size:"small",required:!0}},disabled:E,format:"dd MMMM yyyy"})]}),r.jsx(q,{sx:{borderStyle:"dashed"}}),r.jsx(ee,{enableColumnPinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,positionActionsColumn:"last",enableDensityToggle:!1,columns:I,data:(t==null?void 0:t.movements)||[],isError:c,textError:B,selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"fullDate",desc:!0}]},state:{isLoading:M,showAlertBanner:c,showProgressBars:E},displayColumnDefOptions:{"mrt-row-actions":{header:"Acciones",size:80},"mrt-row-select":{size:10}},muiTableBodyRowProps:({row:s})=>({sx:n=>({backgroundColor:n.palette.background.paper,"&.Mui-selected":{backgroundColor:n.palette.action.selected,"&:hover":{backgroundColor:n.palette.action.hover}}})}),muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}}})]})})},Ae=()=>r.jsx(X,{title:"Comprobaciones",children:r.jsxs(te,{children:[r.jsx(ne,{name:"Comprobaciones",links:[{name:"Inicio",href:D.root},{name:"Comprobaciones"}]}),r.jsx(ce,{})]})});export{Ae as default};
