import{j as r,B as C,t as E,P as d,S as n,i as b,T as l,a as M,n as S,E as z,Q as P,g as T,o as R,r as H,F as B,b as L,G as O,H as w,J as _,K as $,N,O as I,L as Q,R as W,f as Y,U as D}from"./build-ff249ccd.js";import{V as K}from"./build-899176f2.js";import{u as U}from"./build-c35749b2.js";import{L as X,F as G,M as A}from"./build-c7c745f5.js";import{a as J}from"./build-7b23cd65.js";import{c as Z,a as g}from"./build-21c8fd33.js";import{g as k,a as y}from"./build-2de398c6.js";import{f as ee}from"./build-7a360ede.js";import{R as j}from"./build-d4a81a0e.js";import{M as re}from"./build-bb72ca38.js";import{I as f}from"./build-d0cdcec7.js";import{C as oe}from"./build-cb8ebebb.js";import{V as se}from"./build-8380f677.js";import{P as te}from"./build-2c06b33d.js";import{E as ne}from"./build-177bd3ad.js";import{D as ie}from"./build-2446f370.js";import"./build-8afc3184.js";import"./build-bee6630b.js";import"./build-0f64fb7c.js";import"./build-d81db254.js";const ae=({sx:e,color:o})=>r.jsx(C,{sx:{display:"flex",width:50,height:50,alignItems:"center",...e},children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 999 323.68",children:r.jsx("path",{d:"M651.185.5c-70.933 0-134.322 36.766-134.322 104.694 0 77.9 112.423 83.28 112.423 122.415 0 16.478-18.884 31.229-51.137 31.229-45.773 0-79.984-20.611-79.984-20.611l-14.638 68.547s39.41 17.41 91.734 17.41c77.552 0 138.576-38.572 138.576-107.66 0-82.316-112.89-87.537-112.89-123.86 0-12.91 15.501-27.053 47.662-27.053 36.286 0 65.892 14.99 65.892 14.99l14.326-66.204S696.614.5 651.185.5zM2.218 5.497.5 15.49s29.842 5.461 56.719 16.356c34.606 12.492 37.072 19.765 42.9 42.353l63.51 244.832h85.138L379.927 5.497h-84.942L210.707 218.67l-34.39-180.696c-3.154-20.68-19.13-32.477-38.685-32.477H2.218zm411.865 0L347.449 319.03h80.999l66.4-313.534h-80.765zm451.759 0c-19.532 0-29.88 10.457-37.474 28.73L709.699 319.03h84.942l16.434-47.468h103.483l9.994 47.468H999.5L934.115 5.497h-68.273zm11.047 84.707 25.178 117.653h-67.454L876.89 90.204z",style:{fill:"#1434cb",fillOpacity:1,stroke:"none"}})})}),ce=E(r.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"}),"Lock"),le=E(r.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),de=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ue=e=>{var o;return((o=de.find(t=>(t==null?void 0:t.id)===e))==null?void 0:o.color)??"info"},V=({details:e})=>{var o,t;return r.jsx(n,{children:r.jsxs(b,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[r.jsx(C,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:r.jsx("img",{src:K,alt:"viabo-logo"})}),r.jsxs(n,{alignItems:"center",justifyContent:"center",spacing:3,children:[r.jsx(X,{variant:"ghost",color:ue((o=e==null?void 0:e.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(t=e==null?void 0:e.status)==null?void 0:t.name}),r.jsxs(n,{alignItems:"center",justifyContent:"center",children:[r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsxs(l,{variant:"h2",children:[" ",e==null?void 0:e.amount]}),r.jsx(l,{variant:"caption",children:"MXN"})]}),r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(le,{}),r.jsx(l,{variant:"subtitle1",textTransform:"capitalize",children:e==null?void 0:e.name})]})]}),r.jsx(l,{textAlign:"center",variant:"body2",children:e==null?void 0:e.description})]})]})})};V.propTypes={details:d.shape({amount:d.any,description:d.any,name:d.any,status:d.shape({id:d.any,name:d.any})})};const he=(e,o)=>{var h,m,x,a;const t=(h=e==null?void 0:e.expiration)==null?void 0:h.slice(-2),i=((m=e==null?void 0:e.expiration)==null?void 0:m.slice(0,3))+t,u={payId:o==null?void 0:o.id,cardHolder:e==null?void 0:e.name,phone:e==null?void 0:e.phone,cardNumber:e==null?void 0:e.cardNumber.replace(/\s+/g,""),expirationDate:i,expMonth:(x=e==null?void 0:e.expiration)==null?void 0:x.slice(0,2),expYear:(a=e==null?void 0:e.expiration)==null?void 0:a.slice(-2),security:e==null?void 0:e.cvv,email:e==null?void 0:e.email};return k(u)},q={INFO:"payment-link-info"},xe=e=>{const o=y(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:ee(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName}};throw new Error("Algo fallo al obtenerla informacion de la liga de pago")},me=async e=>{const{data:o}=await M.get(`/api/commerces/pay/${e}`);return xe(o)},pe=async e=>{const{data:o}=await M.post("/api/commerce/pay/generate/transaction",e);return o},ge=(e,o={})=>{const t=S(pe,o),i=z();return{...t,mutate:async(h,m)=>{const{onSuccess:x,onError:a,mutationOptions:p}=m;try{await P.promise(t.mutateAsync(h,p),{pending:"Realizando cargo ...",success:{render({data:s}){return i.invalidateQueries([q.INFO]),x(s),"Se realizo el pago con éxito"}}})}catch(s){const c=T(s,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");a(c),P.error(c,{type:R(s)})}}}},je=(e,o={})=>{const[t,i]=H.useState(null),u=B();return{...L([q.INFO,e],()=>me(e),{staleTime:6e4,onError:m=>{const x=T(m,"No se puede obtener la informacion de la liga de pago");i(x),u("/404")},...o}),error:t||null}},F=({details:e})=>{const{mutate:o}=ge(e==null?void 0:e.id),t=Z().shape({cardNumber:g().transform((s,c)=>c.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:g().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(s){const c=O(`01/${s}`,"dd/MM/yyyy",new Date),v=new Date;return w(c)&&_(c,v)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El telefono es muy corto",s=>!(s&&s.replace(/[\s+]/g,"").length<10)).required("El telefono es requerido")}),i=U({initialValues:{cardNumber:"",expiration:"",cvv:"",name:"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""},enableReinitialize:!0,validationSchema:t,onSubmit:(s,{setSubmitting:c})=>{const v=he(s,e);o(v,{onSuccess:()=>{c(!1)},onError:()=>{c(!1)}})}}),{errors:u,touched:h,isSubmitting:m,setFieldValue:x,values:a}=i,p=m;return r.jsx(G,{formik:i,children:r.jsxs(n,{spacing:3,children:[r.jsxs(n,{direction:"row",alignItems:"center",spacing:1,children:[r.jsx(l,{variant:"h6",children:"Forma de Pago"}),r.jsx(b,{sx:{px:1},children:r.jsx(re,{sx:{width:30,height:30}})}),r.jsx(b,{sx:{px:1},children:r.jsx(ae,{sx:{width:30,height:30}})})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),r.jsx(j,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(oe,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:a.cardNumber,onAccept:s=>{x("cardNumber",s)}}},disabled:p})]}),r.jsxs(n,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[r.jsxs(n,{flex:1,spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),r.jsx(ie,{disabled:p,views:["year","month"],name:"expiration",value:a!=null&&a.expiration?new Date(a.expiration):null,required:!0,onChange:s=>w(s)?i.setFieldValue("expiration",$(s,"MM/yyyy")):i.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(h.expiration&&u.expiration),required:!0,helperText:h.expiration&&u.expiration?u.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),r.jsx(j,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(se,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:s=>{x("cvv",s)},value:a.cvv}},disabled:p})]})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),r.jsx(j,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:p,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(te,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),r.jsx(j,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:p,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(ne,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),r.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:a.phone,disabled:p,required:!0,onChange:(s,c)=>{x("phone",s)},error:h.phone&&!!u.phone,helperText:h.phone&&u.phone})]}),r.jsxs(l,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",r.jsx(N,{component:I,underline:"always",target:"_blank",color:"info.main",children:"Terminos y condiciones"}),"  &  ",r.jsx(N,{component:I,underline:"always",target:"_blank",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),r.jsx(n,{children:r.jsx(Q,{loading:m,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:r.jsx(ce,{}),children:"Pagar"})})]})})};F.propTypes={details:d.shape({email:d.string,id:d.any,phone:d.string})};const Oe=()=>{var i;const{paymentId:e}=W(),{data:o,isLoading:t}=je(e,{enabled:!!e});return r.jsx(Y,{title:"Cobro",children:r.jsx(C,{component:"main",height:1,m:0,p:0,children:r.jsxs(n,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[t&&r.jsx(D,{}),!t&&o&&r.jsxs(n,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,children:[r.jsx(V,{details:o}),["6","8"].includes((i=o==null?void 0:o.status)==null?void 0:i.id)&&r.jsx(F,{details:o})]})]})})})};export{Oe as default};
