import{r as S,x as L,a9 as Z,an as K,j as e,ac as w,ab as Y,di as X,dj as R,o as J,a as N,b as ee,g as P,aC as ne,k as te,aD as _,l as se,U as re,S as c,T as h,V as k,L as oe,a2 as ie,c as ae,e as le,a4 as ce,d8 as de,d9 as me,B as ue}from"./build-7f27c717.js";import{C as pe,H as xe}from"./build-e7dc5a59.js";import{g as he,a as ge,o as fe,l as Ce,R as je,C as Ee,b as Se}from"./build-a9f3a5d8.js";import{a as ye,A as Ae,C as be}from"./build-23525ab7.js";import{c as Te,d as ve}from"./build-d97bc2ae.js";import{C as M}from"./build-b00e84f8.js";import{u as we}from"./build-d3ed2d1f.js";import{R as D}from"./build-6c1b4875.js";import{F as Ie}from"./build-fc84b402.js";import{M as Re}from"./build-ca4cdd23.js";import{c as _e,a as I}from"./build-b08818ac.js";import{C as De}from"./build-cd39def6.js";import{I as Le}from"./build-a45027d4.js";import{E as Ne}from"./build-eba0c141.js";import"./build-f50eb202.js";import"./build-ecaf0d13.js";import"./build-a26ea354.js";import"./build-bee6630b.js";import"./build-9c4a81b5.js";import"./build-db2683d3.js";import"./build-2f9ade0c.js";import"./build-375bee32.js";const Pe=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ke={entering:{transform:"none"},entered:{transform:"none"}},Me=S.forwardRef(function(i,s){const o=L(),r={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{addEndListener:n,appear:d=!0,children:m,easing:u,in:a,onEnter:f,onEntered:y,onEntering:j,onExit:p,onExited:A,onExiting:F,style:T,timeout:v=r,TransitionComponent:V=Y}=i,O=Z(i,Pe),b=S.useRef(null),B=K(b,m.ref,s),C=l=>x=>{if(l){const E=b.current;x===void 0?l(E):l(E,x)}},H=C(j),z=C((l,x)=>{X(l);const E=R({style:T,timeout:v,easing:u},{mode:"enter"});l.style.webkitTransition=o.transitions.create("transform",E),l.style.transition=o.transitions.create("transform",E),f&&f(l,x)}),q=C(y),$=C(F),Q=C(l=>{const x=R({style:T,timeout:v,easing:u},{mode:"exit"});l.style.webkitTransition=o.transitions.create("transform",x),l.style.transition=o.transitions.create("transform",x),p&&p(l)}),W=C(A),G=l=>{n&&n(b.current,l)};return e.jsx(V,w({appear:d,in:a,nodeRef:b,onEnter:z,onEntered:q,onEntering:H,onExit:Q,onExited:W,onExiting:$,addEndListener:G,timeout:v},O,{children:(l,x)=>S.cloneElement(m,w({style:w({transform:"scale(0)",visibility:l==="exited"&&!a?"hidden":void 0},ke[l],T,m.props.style),ref:B},x))}))}),Ue=Me,Fe=J(e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm0 4c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm6 12H6v-1.4c0-2 4-3.1 6-3.1s6 1.1 6 3.1V19z"}),"AssignmentIndRounded"),U={LIST:"unassignedCardsCommerce"},Ve=(t,i)=>{const{phone:s,email:o,name:r}=t,n={name:r,phone:s,email:o,cards:(i==null?void 0:i.map(d=>d==null?void 0:d.id))||[]};return he(n)},Oe=async()=>{const{data:t}=await N.get("/api/disabled-cards/commerce");return ge(t)},Be=async t=>(await N.put("/api/assign/commerce-card/to/user",t),t),He=(t={})=>{const[i,s]=S.useState(null);return{...ee([U.LIST],Oe,{staleTime:6e4,onError:r=>{const n=P(r,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");s(n)},...t}),error:i||null}},ze=(t={})=>{const i=ne(),s=te(Be,t);return{...s,mutate:async(r,n)=>{const{onSuccess:d,onError:m,mutationOptions:u}=n;try{await _.promise(s.mutateAsync(r,u),{pending:"Asignando Tarjetas ...",success:{render({data:a}){return i.invalidateQueries([U.LIST]),i.invalidateQueries([De.CARDS_COMMERCE_LIST]),d(),"Se asignaron las tarjetas con éxito"}}})}catch(a){const f=P(a,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");m(f),_.error(f,{type:se(a)})}}}},qe=(t,i)=>({cards:[],setSelectedCard:s=>{const{cards:o}=i(),r=o.indexOf(s);let n=[];r===-1?n=n.concat(o,s):r===0?n=n.concat(o.slice(1)):r===o.length-1?n=n.concat(o.slice(0,-1)):r>0&&(n=n.concat(o.slice(0,r),o.slice(r+1))),t(d=>({cards:n}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:s=>{t(o=>({cards:s}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},resetCards:()=>{t(s=>({cards:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),g=Te(ve(qe));function $e({card:t}){const i=g(n=>n.setSelectedCard),s=g(n=>n.cards),o=s==null?void 0:s.some(n=>(n==null?void 0:n.id)===(t==null?void 0:t.id)),r=n=>{n.stopPropagation(),i(t)};return e.jsx(re.div,{onClick:r,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(fe,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(c,{flexDirection:"row",gap:1,children:[e.jsx(M,{onClick:r,edge:"start",checked:o,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(c,{children:[e.jsx(h,{variant:"subtitle2",sx:{opacity:.72},children:"Viabo Card"}),e.jsx(h,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(Ce,{card:t,disableShow:!0}),e.jsxs(c,{direction:"row",spacing:5,children:[e.jsxs(c,{children:[e.jsx(h,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(h,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(ye,{card:t,disableShow:!0})]})]})})}function Qe({cards:t,onSuccess:i}){const{mutate:s,isLoading:o}=ze(),r=_e({name:I().required("El nombre es requerido"),email:I().email("Ingresa un correo valido").required("El correo es requerido"),phone:I().test("longitud","El telefono es muy corto",p=>!(p&&p.replace(/[\s+]/g,"").length<10))}),n=we({initialValues:{name:"",phone:"",email:""},validationSchema:r,onSubmit:p=>{const A=Ve(p,t);s(A,{onSuccess:()=>{y(!1),i()},onError:()=>{y(!1)}})}}),{errors:d,touched:m,isSubmitting:u,setFieldValue:a,values:f,setSubmitting:y}=n,j=u||o;return e.jsx(k,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Ie,{formik:n,children:e.jsxs(c,{spacing:3,sx:{p:3},children:[e.jsxs(c,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(D,{name:"name",required:!0,placeholder:"Usuario",disabled:j})]}),e.jsxs(c,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(D,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:j,InputProps:{startAdornment:e.jsx(Le,{position:"start",children:e.jsx(Ne,{})})}})]}),e.jsxs(c,{children:[e.jsx(h,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Re,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:f.phone||"+52",disabled:j,onChange:(p,A)=>{a("phone",p)},error:m.phone&&!!d.phone,helperText:m.phone&&d.phone})]}),e.jsx(c,{sx:{pt:3},children:e.jsx(oe,{loading:u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Ae,{}),children:"Asignar"})})]})})})}function We({open:t,setOpen:i}){const s=g(n=>n.cards),o=g(n=>n.resetCards),r=()=>{i(!1)};return e.jsxs(je,{open:t,handleClose:r,title:"Asignar Tarjetas",children:[e.jsx(c,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",p:3,children:s==null?void 0:s.map(n=>e.jsx(Ee,{icon:e.jsx(Se,{}),label:n==null?void 0:n.cardNumberHidden},n==null?void 0:n.id))}),e.jsx(Qe,{cards:s,onSuccess:()=>{i(!1),o()}})]})}function Ge({cards:t}){const i=g(a=>a.cards),s=g(a=>a.setAllCards),o=g(a=>a.resetCards),r=(i==null?void 0:i.length)||0,n=(t==null?void 0:t.length)||0,[d,m]=S.useState(!1),u=a=>{if(a){s(t);return}o()};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{sx:a=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:a.customShadows.z8,backgroundColor:a.palette.info.lighter,color:"white"}),children:e.jsxs(c,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(c,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(M,{indeterminate:r>0&&r<n,checked:n>0&&r===n,onChange:a=>u(a.target.checked),color:"success"}),e.jsx(h,{color:"success.main",variant:"subtitle1",children:r===1?`${r} Tarjeta`:`${r} Tarjetas`})]}),e.jsx(c,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(ae,{startIcon:e.jsx(Fe,{}),variant:"outlined",color:"info",onClick:()=>m(!0),children:"Asignar"})})]})}),e.jsx(We,{open:d,setOpen:m})]})}function Cn(){const t=He(),i=L(),s=g(r=>r.cards),o={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen};return e.jsx(e.Fragment,{children:e.jsx(le,{title:"Tarjetas Sin Asignar del Comercio",children:e.jsxs(pe,{sx:{height:"100%"},children:[e.jsx(xe,{name:"Tarjetas Sin Asignar",links:[{name:"Inicio",href:ce.root},{name:"Administracion",href:de.cards},{name:me.unassignedCards.name}]}),e.jsx(c,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(c,{sx:r=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(Ue,{in:(s==null?void 0:s.length)>0,timeout:o,style:{transitionDelay:`${(s==null?void 0:s.length)>0?o.exit:0}ms`},unmountOnExit:!0,children:e.jsx(ue,{children:e.jsx(Ge,{cards:t==null?void 0:t.data})})}),e.jsx(k,{children:e.jsx(be,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:$e,my:3})})]})})]})})})}export{Cn as default};
