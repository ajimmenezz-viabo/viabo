import{g as C,a as S,L as j,_ as k,G as I,S as L,E as P}from"./index-IncEwUKO.js";import{r as m,dU as F,a9 as T,c as N,f as w,i as o,V as d,T as A,a0 as D,dV as O}from"./vendor-X9cKXa3I.js";import"./TextMaxLine-SKcMsBiK.js";import{T as f}from"./tickets-support-list-keys-ThL685Ct.js";import{u as y,g as R,f as b}from"./SupportIncidences-D812oIus.js";import{i as g}from"./matchTypes-ev-w7Wi9.js";import"./formik.esm-drA_7EEr.js";import"./UploadSingleFile-v78kQPok.js";import"./fade-HpdRXKiE.js";import"./transition-Uc7vb3zK.js";import"./formatNumber-lcHsHzSd.js";import"./formatTime-_KBk1mxc.js";import"./HeaderPage-V_w2vjBb.js";import"./useMaterialTable-N56kn-M3.js";const M=(s,i={})=>{const[e,l]=m.useState(null),a=y(r=>r.setCanCloseTicket),t=F({queryKey:[f.TICKET_CONVERSATION,s],queryFn:async({pageParam:r=1})=>{const n=await R(s,r);return a(!!(n!=null&&n.canCloseTicket)),n},getNextPageParam:r=>r.next,refetchOnMount:"always",staleTime:60*5e3,...i});return m.useEffect(()=>{if(t!=null&&t.isError){const r=C(t.error,"No se puede obtener la conversación del ticket. Intente nuevamente o reporte a sistemas");l(r),T.error(r,{type:S(t.error)}),a(!1)}},[t.isError,t.error]),{...t,error:e||null}},Q=(s={})=>{const i=N(),e=w({mutationFn:b,...s});return{...e,mutate:async(a,t)=>{const{onSuccess:r,onError:n,...p}=t;try{await T.promise(e.mutateAsync(a,p),{pending:"Finalizando Ticket...",success:{render({data:c}){return i.invalidateQueries([f.ASSIGNED_LIST]),i.invalidateQueries([f.GENERATED_LIST]),g(r)&&r(c),"Se finalizo el ticket con éxito"}}})}catch(c){const u=C(c,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");g(n)&&n(u),T.error(u,{type:S(c)})}}}},z=j(m.lazy(()=>k(()=>import("./TicketConversationLayout-kN_m2rJn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16])))),re=()=>{var E;const{openTicketConversation:s,setOpenTicketConversation:i,ticket:e,setSupportTicketDetails:l,canCloseTicket:a}=y(),t=M(e==null?void 0:e.id,{enabled:!!(e!=null&&e.id)}),{mutate:r,isLoading:n}=Q(),{isLoading:p,error:c,isError:u,refetch:h,data:v,fetchNextPage:G}=t;m.useEffect(()=>{s&&(e!=null&&e.id)&&h()},[s,e==null?void 0:e.id]);const x=()=>{i(!1),l(null)},_=()=>{r({ticketId:e==null?void 0:e.id},{onSuccess:()=>{x()}})};return o.jsxs(I,{open:s,handleClose:x,titleElement:o.jsxs(d,{justifyContent:"space-between",flex:1,flexDirection:"column",gap:1,children:[o.jsx(d,{children:o.jsx(A,{variant:"h6",children:`Ticket #${e==null?void 0:e.id}`})}),e&&v&&a&&((E=e==null?void 0:e.status)==null?void 0:E.id)!=="3"&&o.jsx(d,{maxWidth:"30%",children:o.jsx(D,{endIcon:o.jsx(O,{}),variant:"contained",onClick:_,loading:p||n,color:"success",children:"Concluir"})})]}),width:{sm:"100%",lg:"50%",xl:"40%"},children:[u&&!p&&o.jsx(L,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:o.jsx(d,{spacing:3,p:3,children:o.jsx(P,{errorMessage:c,titleMessage:"Conversación del Ticket",handleButton:()=>h()})})}),!u&&s&&o.jsx(z,{queryTicketConversation:t,ticket:e})]})};export{re as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/TicketConversationLayout-kN_m2rJn.js","assets/js/index-IncEwUKO.js","assets/js/vendor-X9cKXa3I.js","assets/css/build-K0YT2apu.css","assets/js/formik.esm-drA_7EEr.js","assets/js/index.esm-87Db4h5o.js","assets/js/matchTypes-ev-w7Wi9.js","assets/js/tickets-support-list-keys-ThL685Ct.js","assets/js/SupportIncidences-D812oIus.js","assets/js/TextMaxLine-SKcMsBiK.js","assets/js/UploadSingleFile-v78kQPok.js","assets/js/fade-HpdRXKiE.js","assets/js/transition-Uc7vb3zK.js","assets/js/formatNumber-lcHsHzSd.js","assets/js/formatTime-_KBk1mxc.js","assets/js/HeaderPage-V_w2vjBb.js","assets/js/useMaterialTable-N56kn-M3.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=TicketSupportConversationDrawer-7-aWEaeQ.js.map
