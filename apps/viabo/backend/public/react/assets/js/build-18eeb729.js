import{r as S,k as N,an as le,ao as ce,j as e,ap as _,aq as de,ar as ue,as as F,at as pe,t as H,c as me,T as A,S as j,e as xe,B as M,d as q,aa as he,I as ge,P as C,Q as T,a as z,E as Ce,n as fe,g as K,o as je,b as ye,ah as W,a7 as Ee,L as ve,a6 as Se,a2 as Ae,f as be,ak as Te,al as we,am as Ie}from"./index-23ec28e1.js";import{M as Ve,a as Le,F as ke,b as De,c as Re}from"./build-8fd84771.js";import{C as Me,a as _e,H as Pe}from"./build-a67802f5.js";import{M as Fe}from"./build-60193303.js";import{C as Oe}from"./build-df81aa38.js";import{C as Be}from"./build-73909af0.js";import{A as $,C as Ne,a as He,F as qe}from"./build-fb0fa0e5.js";import{u as ze}from"./build-5f2543fb.js";import{a as Ke}from"./build-7a57c9bd.js";import{c as We,a as R}from"./build-23530379.js";import{g as $e}from"./build-4e68fd35.js";import{C as Qe}from"./build-a2464a27.js";import{C as Ue}from"./build-c7ce8ef2.js";import{F as Ge,M as Ze}from"./build-c616c612.js";import{R as P}from"./build-ba4202b0.js";import{I as O}from"./build-79fb9ca8.js";import{E as Ye}from"./build-b6087623.js";import{V as Xe}from"./build-21aac1f7.js";import{A as Je}from"./build-5a0f2ca4.js";import{R as et,C as tt}from"./build-bcba88f3.js";import{C as nt}from"./build-ece7c255.js";import{C as st}from"./build-12f241c7.js";import{C as ot}from"./build-0f832405.js";import{C as Q}from"./build-cd43da46.js";import{s as rt}from"./build-9563ddbe.js";import{T as it,a as B}from"./build-c780bbfe.js";import{A as at}from"./build-a7defbcd.js";import"./build-488f3cd2.js";import"./build-f728c994.js";import"./build-4572f792.js";import"./build-9b570ae1.js";import"./build-f8fc243b.js";import"./build-f5a2d48b.js";import"./build-addf1bbe.js";import"./build-8ab16f05.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";const lt=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ct={entering:{transform:"none"},entered:{transform:"none"}},dt=S.forwardRef(function(s,n){const o=N(),r={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{addEndListener:a,appear:m=!0,children:d,easing:p,in:l,onEnter:E,onEntered:w,onEntering:x,onExit:v,onExited:g,onExiting:I,style:L,timeout:i=r,TransitionComponent:u=de}=s,h=le(s,lt),c=S.useRef(null),D=ce(c,d.ref,n),V=f=>b=>{if(f){const k=c.current;b===void 0?f(k):f(k,b)}},te=V(x),ne=V((f,b)=>{ue(f);const k=F({style:L,timeout:i,easing:p},{mode:"enter"});f.style.webkitTransition=o.transitions.create("transform",k),f.style.transition=o.transitions.create("transform",k),E&&E(f,b)}),se=V(w),oe=V(I),re=V(f=>{const b=F({style:L,timeout:i,easing:p},{mode:"exit"});f.style.webkitTransition=o.transitions.create("transform",b),f.style.transition=o.transitions.create("transform",b),v&&v(f)}),ie=V(g),ae=f=>{a&&a(c.current,f)};return e.jsx(u,_({appear:m,in:l,nodeRef:c,onEnter:ne,onEntered:se,onEntering:te,onExit:re,onExited:ie,onExiting:oe,addEndListener:ae,timeout:i},h,{children:(f,b)=>S.cloneElement(d,_({style:_({transform:"scale(0)",visibility:f==="exited"&&!l?"hidden":void 0},ct[f],L,d.props.style),ref:D},b))}))}),ut=dt,pt=(t,s,n="archivo")=>{const o=`${n}_${new Date().toLocaleTimeString()}`,r={fieldSeparator:",",quoteStrings:'"',decimalSeparator:".",showLabels:!0,useBom:!0,useKeysAsHeaders:!1,headers:t,showTitle:!0,title:n,filename:o};return new pe.ExportToCsv(r).generateCsv(s)},mt=H(e.jsx("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done"),xt=H(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"}),"FileDownload"),ht={cards:[],rows:[],openAssign:!1},gt=(t,s)=>({...ht,setSelectedCard:n=>{const{cards:o}=s(),r=o.indexOf(n);let a=[];r===-1?a=a.concat(o,n):r===0?a=a.concat(o.slice(1)):r===o.length-1?a=a.concat(o.slice(0,-1)):r>0&&(a=a.concat(o.slice(0,r),o.slice(r+1))),t(m=>({cards:a}),!1,"SET_SELECTED_INACTIVE_CARDS")},setAllCards:n=>{t(o=>({cards:n}),!1,"SET_SELECTED_ALL_INACTIVE_CARDS")},setIndexCards:n=>{t(o=>({rows:n}),!1,"SET_SELECTED_ALL_INACTIVE_ROWS")},setOpenAssign:n=>{t(o=>({openAssign:n}),!1,"SET_OPEN_ASSIGN_SIDEBAR")},resetCards:()=>{t(n=>({cards:[],rows:[]}),!1,"RESET_SELECTED_INACTIVE_CARDS")}}),y=me(gt),U=({cards:t,rows:s})=>{const{data:n,isLoading:o,isFetching:r,isError:a,error:m}=t,d=y(i=>i.setOpenAssign),p=y(i=>i.setAllCards),l=y(i=>i.cards),E=y(i=>i.setIndexCards),w=S.useMemo(()=>(s==null?void 0:s.reduce((i,u)=>(i[u]=!0,i),{}))||{},[s]),[x,v]=S.useState(w),g=S.useMemo(()=>[{accessorKey:"cardNumber",header:"Tarjeta",enableClickToCopy:!0,enableHiding:!1,Cell:({cell:i,column:u,row:h})=>{const{original:c}=h;return e.jsx(A,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:c==null?void 0:c.cardNumberHidden})}},{accessorKey:"cardType",header:"Tipo",size:100,filterVariant:"multi-select",enableColumnFilterModes:!1,Cell:({cell:i,column:u,row:h})=>{const{original:c}=h;return e.jsx(j,{flexDirection:"row",alignItems:"center",gap:1,children:(c==null?void 0:c.cardType)==="Carnet"?e.jsx(Me,{sx:{width:25}}):e.jsx(Fe,{sx:{width:25}})})}},{accessorKey:"expiration",header:"Vence",size:100},{accessorKey:"emptyCVV",header:"CVV",filterVariant:"select",enableColumnFilterModes:!1,size:100,Cell:({cell:i,column:u,row:h})=>{const{original:c}=h;return(c==null?void 0:c.cvv)===""||!(c!=null&&c.cvv)?e.jsx(Oe,{color:"error"}):e.jsx(mt,{color:"success"})}},{accessorKey:"assignUser.name",header:"Asignado",size:150},{accessorKey:"assignUser.dateTime",header:"Fecha de Asignación",size:150},{accessorKey:"register",header:"Fecha de Registro",size:150}],[n]);S.useEffect(()=>{if(x&&n){const i=Object.keys(x),u=n==null?void 0:n.filter((h,c)=>i.includes(c.toString()));p(u),E(i)}},[x,n]);const I=()=>{const i=l.some(c=>(c==null?void 0:c.cvv)==="")&&(l==null?void 0:l.length)>1,u=l.some(c=>{var D;return((D=c==null?void 0:c.assignUser)==null?void 0:D.id)!==""});l.every(c=>(c==null?void 0:c.cvv)==="")&&(l==null?void 0:l.length)>1?T.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):i?T.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):u?T.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):d(!0)},L=i=>{try{const u=i.getSortedRowModel().rows.map(h=>(g==null?void 0:g.map(c=>h.getValue(c.accessorKey)))||[])??[];pt((g==null?void 0:g.map(h=>h.header))||[],u,"Stock del comercio")}catch{}};return e.jsx(Be,{children:e.jsx(Ve,{enablePinning:!0,enableColumnDragging:!0,enableColumnOrdering:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableDensityToggle:!1,columns:g,data:n||[],isError:a,textError:m,selectAllMode:"all",onRowSelectionChange:v,initialState:{density:"compact",sorting:[{id:"register",desc:!0}]},state:{isLoading:o,showAlertBanner:a,showProgressBars:r,rowSelection:x??{}},enableRowSelection:i=>{const{assignUser:u}=i.original;return(u==null?void 0:u.id)===""},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},muiSelectCheckboxProps:({row:i})=>{const{assignUser:u}=i.original;return{disabled:(u==null?void 0:u.id)!=="",sx:{display:(u==null?void 0:u.id)!==""?"none":"flex"}}},muiTableBodyRowProps:({row:i})=>{const{assignUser:u}=i.original;return{onClick:i.getToggleSelectedHandler(),sx:h=>({cursor:(u==null?void 0:u.id)!==""?"inherit":"pointer",backgroundColor:h.palette.background.paper,"&.Mui-selected":{backgroundColor:h.palette.action.selected,"&:hover":{backgroundColor:h.palette.action.hover}}})}},muiTableBodyCellProps:({row:i})=>{const{assignUser:u}=i.original;return{sx:h=>({backgroundColor:(u==null?void 0:u.id)!==""&&!o?xe(h.palette.success.lighter,.2):"inherit",borderBottom:`dashed 1px ${h.palette.divider}`})}},renderTopToolbarCustomActions:({table:i})=>e.jsx(M,{sx:{display:"flex",gap:"1rem"},children:e.jsx(q,{onClick:I,disabled:!i.getIsSomeRowsSelected(),startIcon:e.jsx($,{width:24,height:24}),children:"Asociar"})}),renderToolbarInternalActions:({table:i})=>e.jsxs(M,{children:[e.jsx(Le,{table:i}),e.jsx(he,{title:"Descargar",children:e.jsx(ge,{disabled:i.getPrePaginationRowModel().rows.length===0,onClick:()=>L(i),children:e.jsx(xt,{})})}),e.jsx(ke,{table:i}),e.jsx(De,{table:i}),e.jsx(Re,{table:i})]})})})};U.propTypes={cards:C.shape({data:C.array,error:C.any,isError:C.any,isFetching:C.any,isLoading:C.any})};const G={LIST:"commerce-all-cards"},Ct=(t,s,n)=>{var d;const{phone:o,email:r,name:a}=t,m={name:a,phone:o,email:r,cards:n?[{id:(d=s[0])==null?void 0:d.id,cvv:t==null?void 0:t.cvv}]:(s==null?void 0:s.map(p=>({id:p==null?void 0:p.id,cvv:p==null?void 0:p.cvv})))||[]};return $e(m)},ft=async()=>{const{data:t}=await z.get("/api/cards/commerce");return Qe(t)},jt=async t=>(await z.put("/api/assign/commerce-card/to/user",t),t),yt=(t={})=>{const s=Ce(),n=fe(jt,t);return{...n,mutate:async(r,a)=>{const{onSuccess:m,onError:d,mutationOptions:p}=a;try{await T.promise(n.mutateAsync(r,p),{pending:"Asignando Tarjetas ...",success:{render({data:l}){return s.invalidateQueries([G.LIST]),s.invalidateQueries([Ue.CARDS_COMMERCE_LIST]),m(),"Se asignaron las tarjetas con éxito"}}})}catch(l){const E=K(l,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(E),T.error(E,{type:je(l)})}}}},Et=(t={})=>{const[s,n]=S.useState(null);return{...ye([G.LIST],ft,{staleTime:6e4,onError:r=>{const a=K(r,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");n(a)},...t}),error:s||null}};function Z({cards:t,onSuccess:s}){const{mutate:n,isLoading:o}=yt(),r=S.useMemo(()=>(t==null?void 0:t.length)>0&&t[0].cvv==="",[t]),a=We({name:R().required("El nombre es requerido"),email:R().email("Ingresa un correo valido").required("El correo es requerido"),phone:R().test("longitud","El telefono es muy corto",g=>!(g&&g.replace(/[\s+]/g,"").length<10)),...r&&{cvv:R().min(3,"Debe contener 3 digitos").required("El CVV es requerido")}}),m=ze({initialValues:{name:"",phone:"",email:"",...r&&{cvv:""}},validationSchema:a,onSubmit:g=>{const I=Ct(g,t,r);n(I,{onSuccess:()=>{x(!1),s()},onError:()=>{x(!1)}})}}),{errors:d,touched:p,isSubmitting:l,setFieldValue:E,values:w,setSubmitting:x}=m,v=l||o;return e.jsx(W,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Ge,{formik:m,children:e.jsxs(j,{spacing:3,sx:{p:3},children:[r&&e.jsx(Ee,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex"},severity:"warning",children:e.jsx(A,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(j,{children:[e.jsx(A,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre"}),e.jsx(P,{name:"name",required:!0,placeholder:"Usuario",disabled:v})]}),e.jsxs(j,{children:[e.jsx(A,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico"}),e.jsx(P,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:v,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Ye,{})})}})]}),e.jsxs(j,{children:[e.jsx(A,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono"}),e.jsx(Ke,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:w.phone||"+52",disabled:v,onChange:(g,I)=>{E("phone",g)},error:p.phone&&!!d.phone,helperText:p.phone&&d.phone})]}),r&&e.jsxs(j,{children:[e.jsx(A,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(P,{name:"cvv",fullWidth:!0,required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Xe,{})}),inputComponent:Ze,inputProps:{mask:"000",onAccept:g=>{E("cvv",g)},value:w.cvv}},disabled:v})]}),e.jsx(j,{sx:{pt:3},children:e.jsx(ve,{loading:l,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:e.jsx(Je,{}),children:"Asociar"})})]})})})}Z.propTypes={cards:C.array,onSuccess:C.func};function Y({open:t,handleClose:s,handleSuccess:n}){const o=y(r=>r.cards);return e.jsxs(et,{open:t,handleClose:s,title:(o==null?void 0:o.length)===1?"Asociar Tarjeta":"Asociar Tarjetas",children:[e.jsx(j,{flexDirection:"row",gap:2,flexWrap:"wrap",justifyContent:"center",alignItems:"center",px:3,pt:3,children:o==null?void 0:o.map(r=>e.jsx(nt,{icon:e.jsx(st,{}),label:r==null?void 0:r.cardNumberHidden},r==null?void 0:r.id))}),e.jsx(Z,{cards:o,onSuccess:n})]})}Y.propTypes={handleClose:C.func,handleSuccess:C.func,open:C.bool};function X({card:t}){var a,m;const s=y(d=>d.setSelectedCard),n=y(d=>d.cards),o=n==null?void 0:n.some(d=>(d==null?void 0:d.id)===(t==null?void 0:t.id)),r=d=>{d.stopPropagation(),s(t)};return e.jsx(Se.div,{onClick:r,whileHover:{scale:1.03},whileTap:{scale:.8},children:e.jsxs(tt,{sx:{m:1,cursor:"pointer"},children:[e.jsxs(j,{flexDirection:"row",gap:1,children:[e.jsx(Q,{onClick:r,edge:"start",checked:o,inputProps:{"aria-labelledby":t==null?void 0:t.id},color:"success"}),e.jsxs(j,{children:[e.jsx(A,{variant:"subtitle2",sx:{opacity:.72},children:((a=t==null?void 0:t.assignUser)==null?void 0:a.name)==="-"?"Viabo Card":(m=t==null?void 0:t.assignUser)==null?void 0:m.name}),e.jsx(A,{variant:"caption",color:"text.secondary",children:t==null?void 0:t.register})]})]}),e.jsx(ot,{card:t,disableShow:!0}),e.jsxs(j,{direction:"row",spacing:5,children:[e.jsxs(j,{children:[e.jsx(A,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(A,{sx:{typography:"subtitle1"},children:t==null?void 0:t.expiration})]}),e.jsx(Ne,{card:t,disableShow:!0})]})]})})}X.propTypes={card:C.shape({expiration:C.any,id:C.any,register:C.any})};function J({cards:t}){const s=y(l=>l.cards),n=y(l=>l.setAllCards),o=y(l=>l.resetCards),r=y(l=>l.setOpenAssign),a=(s==null?void 0:s.length)||0,m=(t==null?void 0:t.length)||0,d=l=>{if(l){n(t);return}o()},p=()=>{const l=s.some(x=>(x==null?void 0:x.cvv)==="")&&(s==null?void 0:s.length)>1,E=s.some(x=>{var v;return((v=x==null?void 0:x.assignUser)==null?void 0:v.id)!==""});s.every(x=>(x==null?void 0:x.cvv)==="")&&(s==null?void 0:s.length)>1?T.warn("Las tarjetas seleccionadas no tiene cvv , debe asignar una por una"):l?T.warn("Existe al menos una tarjeta seleccionada que no tiene cvv"):E?T.warn("Existe al menos una tarjeta seleccionada que ya esta asignada"):r(!0)};return e.jsx(e.Fragment,{children:e.jsx(Ae,{sx:l=>({position:"sticky",borderRadius:1,py:4,top:0,boxShadow:l.customShadows.z8,backgroundColor:l.palette.info.lighter,color:"white"}),children:e.jsxs(j,{flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",sx:{width:1},gap:2,alignItems:"center",children:[e.jsxs(j,{flexDirection:"row",gap:1,alignItems:"center",children:[e.jsx(Q,{indeterminate:a>0&&a<m,checked:m>0&&a===m,onChange:l=>d(l.target.checked),color:"success"}),e.jsx(A,{color:"success.main",variant:"subtitle1",children:a===1?`${a} Tarjeta`:`${a} Tarjetas`})]}),e.jsx(j,{flexDirection:"row",gap:2,justifyContent:"space-between",children:e.jsx(q,{startIcon:e.jsx($,{}),variant:"outlined",color:"info",onClick:p,children:"Asignar"})})]})})})}J.propTypes={cards:C.array};function ee({commerceCards:t}){const s=t==null?void 0:t.data,n=y(d=>d.cards),o=y(d=>d.setIndexCards,rt),r=N(),a=S.useMemo(()=>(n==null?void 0:n.map(d=>s.findIndex(p=>p.id===d.id)))||[],[n,s]);S.useEffect(()=>{o(a)},[a]);const m={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen};return e.jsx(j,{flexDirection:"row",sx:{height:"100vh",display:"flex"},children:e.jsxs(j,{sx:d=>({overflow:"hidden",flexDirection:"column",flexGrow:1}),children:[e.jsx(ut,{in:(n==null?void 0:n.length)>0,timeout:m,style:{transitionDelay:`${(n==null?void 0:n.length)>0?m.exit:0}ms`},unmountOnExit:!0,children:e.jsx(M,{children:e.jsx(J,{cards:t==null?void 0:t.data})})}),e.jsx(W,{children:e.jsx(He,{cards:t,emptyMessage:"No hay tarjetas sin asignar",cardComponent:X,my:3})})]})})}ee.propTypes={commerceCards:C.shape({data:C.array})};function rn(){const t=Et(),[s,n]=S.useState("1"),o=(p,l)=>{l&&n(l)},r=y(p=>p.rows),a=y(p=>p.openAssign),m=y(p=>p.setOpenAssign),d=y(p=>p.resetCards);return e.jsx(e.Fragment,{children:e.jsx(be,{title:"Stock de Tarjetas del Comercio",children:e.jsxs(_e,{sx:{height:"100%"},children:[e.jsx(Pe,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:Te.root},{name:"Administracion",href:we.allCards},{name:Ie.allCards.name}],buttons:e.jsx(M,{display:"flex",justifyContent:"center",mt:{xs:2,md:0},children:e.jsxs(it,{size:"small",color:"primary",value:s,exclusive:!0,onChange:o,"aria-label":"Platform",children:[e.jsx(B,{value:"1",children:e.jsx(qe,{})}),e.jsx(B,{value:"2",children:e.jsx(at,{})})]})})}),s==="2"&&e.jsx(ee,{commerceCards:t}),s==="1"&&e.jsx(U,{cards:t,rows:r}),e.jsx(Y,{open:a,handleClose:()=>{m(!1)},handleSuccess:()=>{m(!1),d()}})]})})})}export{rn as default};
