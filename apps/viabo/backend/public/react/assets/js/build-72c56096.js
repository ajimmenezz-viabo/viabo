import{a as D,$ as A,g as M,b as q,k as G,r as j,aH as H,j as t,a2 as K,S as i,W as X,T as l,L as W,C as J}from"./index-1e831042.js";import{u as Z}from"./build-277fdb64.js";import{$ as w}from"./build-e8364711.js";import{c as I,a as v}from"./build-78fa73e1.js";import{a as ee}from"./build-c813b1a2.js";import{r as te,b as re,c as se}from"./build-567e19af.js";import{i as E}from"./build-2689d7d7.js";import{A as ae}from"./build-acfbd4a7.js";import{F as ie}from"./build-c50bf5c4.js";import{R as k}from"./build-1f68b5d1.js";import{a as oe}from"./build-e20cbeb2.js";import{L as ne}from"./build-9b217c13.js";import{W as le}from"./build-3aac624a.js";import"./build-c60b1757.js";import"./build-9c7d17d1.js";import"./build-34869e3d.js";import"./build-7cff8fc1.js";import"./build-49ce4b1d.js";import"./build-d03f2487.js";import"./build-2e66f28e.js";import"./build-2d41650f.js";import"./build-1a4a1a73.js";import"./build-61e6e28b.js";import"./build-bee6630b.js";import"./build-9037075e.js";import"./build-dc8ca4d1.js";import"./build-7bfa4528.js";import"./build-6f6a8678.js";import"./build-e5eef35b.js";import"./build-809808a0.js";import"./build-7afdc1fc.js";import"./build-d005f9f7.js";import"./build-9df66b67.js";const ce=(r,e)=>{var c;const m={ownerId:(c=e==null?void 0:e.assignUser)==null?void 0:c.id,name:r==null?void 0:r.name,lastName:r==null?void 0:r.lastName,phone:r==null?void 0:r.phone};return ee(m)},me=(r={})=>{const e=D(te,r);return{...e,mutate:async(c,h={})=>{const{onSuccess:p,onError:o,...d}=h;try{await A.promise(e.mutateAsync(c,d),{pending:"Restableciendo Contraseña ...",success:{render({data:n}){return E(p)&&p(n),"Se restableció la contraseña con éxito"}}})}catch(n){const a=M(n,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(o)&&o(a),A.error(a,{type:q(n)})}}}},pe=(r={})=>{const e=G(),m=D(re,r);return{...m,mutate:async(h,p={})=>{const{onSuccess:o,onError:d,...n}=p;try{await A.promise(m.mutateAsync(h,n),{pending:"Actualizando información ...",success:{render({data:a}){return e.invalidateQueries([ae.LIST]),E(o)&&o(a),"Se actualizo con éxito"}}})}catch(a){const u=M(a,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");E(d)&&d(u),A.error(u,{type:q(a)})}}}},g={UPDATE_USER_INFO:"1",RECOVERY_PASSWORD:"2"},de=({handleSuccess:r})=>{var O,P,T,F,_,f,L,z;const e=se(s=>s.cardInfo),{mutate:m,isLoading:c}=pe(),{mutate:h,isLoading:p}=me(),[o,d]=j.useState(((O=e==null?void 0:e.assignUser)==null?void 0:O.name)||""),[n,a]=j.useState(!1),[u,b]=j.useState(null),V=I({name:v().required("El nombre es requerido"),lastName:v().required("El apellido es requerido"),phone:v().test("longitud","El teléfono es muy corto",s=>!(s&&s.replace(/[\s+]/g,"").length<10))}),R=Z({initialValues:{name:((P=e==null?void 0:e.assignUser)==null?void 0:P.name)||"",phone:((T=e==null?void 0:e.assignUser)==null?void 0:T.phone)||"",lastName:((F=e==null?void 0:e.assignUser)==null?void 0:F.lastName)||""},enableReinitialize:!0,validationSchema:V,onSubmit:(s,{setSubmitting:S})=>{if(u===g.UPDATE_USER_INFO){const Q=ce(s,e);m(Q,{onSuccess:()=>{r(),b(null)}})}u===g.RECOVERY_PASSWORD&&h(e==null?void 0:e.assignUser,{onSuccess:()=>{r(),b(null)}}),S(!1)}}),{values:y,setFieldValue:$,touched:C,errors:N,isSubmitting:Y,handleSubmit:B}=R,x=c||Y||p;j.useEffect(()=>{var s;y.name?d(y.name):d((s=e==null?void 0:e.assignUser)==null?void 0:s.name)},[y.name]);const U=j.useMemo(()=>H(o),[o]);return t.jsxs(t.Fragment,{children:[t.jsx(K,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:t.jsx(ie,{formik:R,children:t.jsxs(i,{spacing:2,sx:{p:3},children:[t.jsx(i,{spacing:.5,children:t.jsxs(i,{justifyContent:"center",alignItems:"center",spacing:1,children:[t.jsx(X,{variant:"rounded",src:"",color:"warning",alt:o,sx:{backgroundColor:s=>{var S;return(S=s.palette[U.color])==null?void 0:S.main},width:80,height:80,color:"white"},children:U.name}),t.jsx(l,{component:ne,href:`mailto:${(_=e==null?void 0:e.assignUser)==null?void 0:_.email}`,variant:"body2",children:((f=e==null?void 0:e.assignUser)==null?void 0:f.email)??"-"}),t.jsx(i,{spacing:.5,alignItems:"center",children:(L=e==null?void 0:e.assignUser)!=null&&L.lastLogged?t.jsxs(t.Fragment,{children:[t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"Último Inicio de Sesión:"}),t.jsx(l,{paragraph:!0,variant:"body2",sx:{color:"text.disabled"},children:((z=e==null?void 0:e.assignUser)==null?void 0:z.lastLogged)??"🚀"})]}):t.jsx(l,{paragraph:!0,variant:"body2",fontStyle:"italic",sx:{color:"text.disabled"},children:"No ha iniciado sesión 🚀"})}),t.jsx(i,{children:t.jsx(W,{variant:"contained",color:"secondary",loading:p,disabled:x,sx:{color:"black"},onClick:()=>{b(g.RECOVERY_PASSWORD),a(!0)},children:"Restablecer Contraseña"})})]})}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Nombre (s)"}),t.jsx(k,{name:"name",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Apellidos"}),t.jsx(k,{name:"lastName",required:!0,placeholder:"Usuario",disabled:x})]}),t.jsxs(i,{spacing:.5,children:[t.jsx(l,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Teléfono"}),t.jsx(w,{name:"phone",fullWidth:!0,langOfCountryName:"es",preferredCountries:["MX","US"],continents:["NA","SA"],value:y.phone||"+52",disabled:x,onChange:(s,S)=>{$("phone",s)},error:C.phone&&!!N.phone,helperText:C.phone&&N.phone})]}),t.jsx(i,{pt:2,children:t.jsx(W,{size:"large",variant:"contained",color:"primary",fullWidth:!0,loading:c,disabled:x,onClick:()=>{b(g.UPDATE_USER_INFO),a(!0)},children:"Actualizar"})})]})})}),n&&t.jsx(oe,{title:u===g.UPDATE_USER_INFO?"Actualizar Usuario":"Restablecer Contraseña",typeAlert:"warning",textButtonSuccess:"Si, estoy de acuerdo",onClose:()=>{a(!1)},open:n,isSubmitting:!1,description:t.jsxs(i,{spacing:2,children:[t.jsx(l,{children:u===g.UPDATE_USER_INFO?"¿Está seguro de actualizar la información de este usuario":"¿Está seguro de restablecer la contraseña de este usuario"}),t.jsxs(i,{direction:"row",alignItems:"center",spacing:1,children:[t.jsx(le,{}),t.jsx(i,{children:t.jsx(l,{variant:"caption",children:"Se enviara una notificación via correo electrónico con los cambios realizados"})})]})]}),onSuccess:()=>{a(!1),B()},fullWidth:!0,maxWidth:"xs"})]})};de.propTypes={handleSuccess:J.func};export{de as default};
