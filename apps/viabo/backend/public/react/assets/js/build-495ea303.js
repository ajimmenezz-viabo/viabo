import{t as V,j as r,a as T,n as S,E as R,Q as P,g as E,o as z,r as W,F as B,b as O,P as l,G as _,H as N,J as H,S as n,T as c,i as C,K as $,N as I,O as w,L as Q,B as j,R as Y,U as K,f as U,V as X}from"./index-50a35d25.js";import{u as G}from"./build-63cd1a66.js";import{a as J}from"./build-d6377163.js";import{c as Z,a as g}from"./build-fd3d2130.js";import{g as D,a as L}from"./build-f93cbd2b.js";import{f as k}from"./build-88f4df1c.js";import{R as f}from"./build-ff52c786.js";import{F as y,M as A,L as ee}from"./build-773241b5.js";import{M as re}from"./build-74daf15f.js";import{V as oe,L as ne}from"./build-57c276cc.js";import{I as v}from"./build-8fc2a6fe.js";import{C as ie}from"./build-4508dc39.js";import{V as se}from"./build-80e7e62a.js";import{P as ae}from"./build-1bdddf61.js";import{E as te}from"./build-f3dc9301.js";import{D as ce}from"./build-e1fe4ff8.js";import{V as le}from"./build-899176f2.js";import{R as de}from"./build-48c1d8f4.js";import"./build-5c8192a4.js";import"./build-bee6630b.js";import"./build-a339460d.js";import"./build-1ac975b6.js";const ue=V(r.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),xe=(e,o)=>{var x,m,h,d;const s=(x=e==null?void 0:e.expiration)==null?void 0:x.slice(-2),a=((m=e==null?void 0:e.expiration)==null?void 0:m.slice(0,3))+s,t={payId:o==null?void 0:o.id,cardHolder:e==null?void 0:e.name,phone:e==null?void 0:e.phone,cardNumber:e==null?void 0:e.cardNumber.replace(/\s+/g,""),expirationDate:a,expMonth:(h=e==null?void 0:e.expiration)==null?void 0:h.slice(0,2),expYear:(d=e==null?void 0:e.expiration)==null?void 0:d.slice(-2),security:e==null?void 0:e.cvv,email:e==null?void 0:e.email};return D(t)},q={INFO:"payment-link-info"},he=e=>{const o=L(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:k(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName},reference:o==null?void 0:o.reference,terminalId:o==null?void 0:o.terminalId,transaction:{reference:(o==null?void 0:o.apiReferenceNumber)!==""?o==null?void 0:o.apiReferenceNumber:"-",authCode:(o==null?void 0:o.apiAuthCode)!==""?o==null?void 0:o.apiAuthCode:"-"}};throw new Error("Algo fallo al obtenerla información de la liga de pago")},me=async e=>{const{data:o}=await T.get(`/api/commerces/pay/${e}`);return he(o)},pe=async e=>{const{data:o}=await T.post("/api/commerce/pay/generate/transaction",e);return o},ge=(e,o={})=>{const s=S(pe,o),a=R();return{...s,mutate:async(x,m)=>{const{onSuccess:h,onError:d,mutationOptions:p}=m;try{await P.promise(s.mutateAsync(x,p),{pending:"Realizando cargo ...",success:{render({data:i}){return a.invalidateQueries([q.INFO]),h(i),"Se realizo el pago con éxito"}}})}catch(i){const u=E(i,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");d(u),P.error(u,{type:z(i)})}}}},je=(e,o={})=>{const[s,a]=W.useState(null),t=B();return{...O([q.INFO,e],()=>me(e),{staleTime:6e4,onError:m=>{const h=E(m,"No se puede obtener la informacion de la liga de pago");a(h),t("/404")},...o}),error:s||null}},F=({details:e})=>{const{mutate:o}=ge(e==null?void 0:e.id),s=Z().shape({cardNumber:g().transform((i,u)=>u.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:g().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(i){const u=_(`01/${i}`,"dd/MM/yyyy",new Date),b=new Date;return N(u)&&H(u,b)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El telefono es muy corto",i=>!(i&&i.replace(/[\s+]/g,"").length<10)).required("El telefono es requerido")}),a=G({initialValues:{cardNumber:"",expiration:"",cvv:"",name:"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""},enableReinitialize:!0,validationSchema:s,onSubmit:(i,{setSubmitting:u})=>{const b=xe(i,e);o(b,{onSuccess:()=>{u(!1)},onError:()=>{u(!1)}})}}),{errors:t,touched:x,isSubmitting:m,setFieldValue:h,values:d}=a,p=m;return r.jsx(y,{formik:a,children:r.jsxs(n,{spacing:3,children:[r.jsxs(n,{direction:"row",alignItems:"center",spacing:1,children:[r.jsx(c,{variant:"h6",children:"Forma de Pago"}),r.jsx(C,{sx:{px:1},children:r.jsx(re,{sx:{width:30,height:30}})}),r.jsx(C,{sx:{px:1},children:r.jsx(oe,{sx:{width:30,height:30}})})]}),r.jsxs(n,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),r.jsx(f,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(ie,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:d.cardNumber,onAccept:i=>{h("cardNumber",i)}}},disabled:p})]}),r.jsxs(n,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[r.jsxs(n,{flex:1,spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),r.jsx(ce,{disabled:p,views:["year","month"],name:"expiration",value:d!=null&&d.expiration?new Date(d.expiration):null,required:!0,onChange:i=>N(i)?a.setFieldValue("expiration",$(i,"MM/yyyy")):a.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(x.expiration&&t.expiration),required:!0,helperText:x.expiration&&t.expiration?t.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),r.jsxs(n,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),r.jsx(f,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(se,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:i=>{h("cvv",i)},value:d.cvv}},disabled:p})]})]}),r.jsxs(n,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),r.jsx(f,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:p,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(ae,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),r.jsx(f,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:p,InputProps:{startAdornment:r.jsx(v,{position:"start",children:r.jsx(te,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(c,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),r.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:d.phone,disabled:p,required:!0,onChange:(i,u)=>{h("phone",i)},error:x.phone&&!!t.phone,helperText:x.phone&&t.phone})]}),r.jsxs(c,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",r.jsx(I,{component:w,underline:"always",target:"_blank",color:"info.main",children:"Terminos y condiciones"}),"  &  ",r.jsx(I,{component:w,underline:"always",target:"_blank",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),r.jsx(n,{children:r.jsx(Q,{loading:m,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:r.jsx(ne,{}),children:"Pagar"})})]})})};F.propTypes={details:l.shape({email:l.string,id:l.any,phone:l.string})};const fe=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ve=e=>{var o;return((o=fe.find(s=>(s==null?void 0:s.id)===e))==null?void 0:o.color)??"info"},M=({details:e})=>{var o,s,a,t;return r.jsx(n,{children:r.jsxs(C,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[r.jsx(j,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:r.jsx("img",{src:le,alt:"viabo-logo"})}),r.jsxs(n,{alignItems:"center",justifyContent:"center",spacing:2,children:[r.jsx(ee,{variant:"ghost",color:ve((o=e==null?void 0:e.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(s=e==null?void 0:e.status)==null?void 0:s.name}),r.jsx(de,{color:"primary",sx:{width:40,height:40}}),r.jsxs(n,{alignItems:"center",justifyContent:"center",children:[r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsxs(c,{variant:"h2",children:[" ",e==null?void 0:e.amount]}),r.jsx(c,{variant:"caption",children:"MXN"})]}),r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(ue,{}),r.jsx(c,{variant:"subtitle1",textTransform:"capitalize",children:e==null?void 0:e.name})]})]}),r.jsx(c,{textAlign:"center",variant:"body2",children:e==null?void 0:e.description})]}),((a=e==null?void 0:e.status)==null?void 0:a.id)==="7"&&r.jsx(r.Fragment,{children:r.jsxs(n,{divider:r.jsx(Y,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:1,alignItems:"center",justifyContent:"center",p:2,children:[r.jsx(j,{}),r.jsx(c,{variant:"subtitle1",color:"text.secondary",children:"Detalles de la Transacción"}),r.jsxs(n,{flex:1,width:1,spacing:1,children:[r.jsxs(n,{justifyContent:"space-between",direction:"row",children:[r.jsx(c,{variant:"subtitle2",children:"No. Terminal:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:e==null?void 0:e.terminalId})]}),r.jsxs(n,{justifyContent:"space-between",direction:"row",children:[r.jsx(c,{variant:"subtitle2",children:"No. Referencia:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:e==null?void 0:e.reference})]}),r.jsxs(n,{justifyContent:"space-between",direction:"row",children:[r.jsx(c,{variant:"subtitle2",children:"No. Autorización:"}),r.jsx(j,{component:"span",color:"primary.main",fontWeight:"bold",children:(t=e==null?void 0:e.transaction)==null?void 0:t.authCode})]})]})]})})]})})};M.propTypes={details:l.shape({amount:l.any,description:l.any,name:l.any,reference:l.any,status:l.shape({id:l.any,name:l.any}),terminalId:l.any,transaction:l.shape({authCode:l.any})})};const Ye=()=>{var a,t;const{paymentId:e}=K(),{data:o,isLoading:s}=je(e,{enabled:!!e});return r.jsx(U,{title:"Cobro",children:r.jsx(j,{component:"main",height:1,m:0,p:0,children:r.jsxs(n,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[s&&r.jsx(X,{}),!s&&o&&r.jsxs(n,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,maxWidth:((a=o==null?void 0:o.status)==null?void 0:a.id)==="7"?400:"sm",children:[r.jsx(M,{details:o}),["6","8"].includes((t=o==null?void 0:o.status)==null?void 0:t.id)&&r.jsx(F,{details:o})]})]})})})};export{Ye as default};
