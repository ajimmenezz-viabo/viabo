import{k as B,a as N,Z as x,g as S,b as M,r as j,d as k,j as t,S as l,O as A,T as f,B as P}from"./index-23408dd2.js";import{c as v,F as w,g as I,u as g}from"./build-216d577d.js";import{g as z}from"./build-12c2fd0e.js";import{M as D,S as L}from"./build-0354e1de.js";import{a as G}from"./build-d00cf9da.js";import{C as K}from"./build-a63161e6.js";import"./build-89d84695.js";import"./build-67a8e4e9.js";import"./build-e79ac7d8.js";import"./build-84b07bd3.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-99db375a.js";import"./build-0d19139b.js";import"./build-2876f46a.js";import"./build-9cdd5450.js";import"./build-70633a7e.js";import"./build-c875c593.js";import"./build-68d1d76d.js";import"./build-bee6630b.js";import"./build-a1ec3a2c.js";import"./build-f2ae8137.js";import"./build-4ba3cb14.js";import"./build-26fbb83b.js";import"./build-74a1b13a.js";import"./build-2f111781.js";import"./build-79b895ac.js";import"./build-72154ec5.js";import"./build-cb395694.js";import"./build-980fd41b.js";import"./build-54e0e54c.js";const Q=(r,n)=>({fundingOrderId:r==null?void 0:r.id,conciliationNumber:n==null?void 0:n.id}),V=(r={})=>{const n=B(),o=N(v,r);return{...o,mutate:async(u,a)=>{const{onSuccess:s,onError:b,mutationOptions:c}=a;try{await x.promise(o.mutateAsync(u,c),{pending:"Conciliando orden de fondeo ...",success:{render({data:i}){return n.invalidateQueries([w.LIST]),s(i),"Se creó la conciliación con éxito"}}})}catch(i){const m=S(i,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");b(m),x.error(m,{type:M(i)})}}}},W=(r,n={})=>{const[o,d]=j.useState(null);return{...k([w.MOVEMENTS,r==null?void 0:r.id],()=>I(r),{staleTime:6e4,refetchOnWindowFocus:!1,onError:a=>{const s=S(a,"No se puede obtener los movimientos de la cuenta");d(s),x.error(s,{type:M(a)})},...n}),error:o||null}},Me=()=>{const r=g(e=>e.openConciliateModal),n=g(e=>e.setOpenConciliateModal),o=g(e=>e.fundingOrder),d=g(e=>e.setFundingOrder),{mutate:u,isLoading:a}=V(),s=j.useRef(null),b=[{accessorKey:"description",header:"Movimiento",size:100},{accessorKey:"date",header:"Fecha",size:100},{accessorKey:"amountFormat",header:"Monto",size:100}],{data:c,isError:i,error:m,isLoading:F,isFetching:T}=W(o,{enabled:!!o}),p=z(o==null?void 0:o.paymentProcessorName),E=p==null?void 0:p.component,O=()=>{var y,C;const e=(y=s.current)==null?void 0:y.getSelectedRowModel().rows;if((e==null?void 0:e.length)>0){const R=Q(o,(C=e[0])==null?void 0:C.original);u(R,{onSuccess:()=>{h()},onError:()=>{}})}else x.warn("Debe seleccionar un movimiento para conciliar la orden de fondeo")},h=()=>{n(!1),d(null)};return t.jsx(G,{onClose:h,onSuccess:O,isSubmitting:a,fullWidth:!0,scrollType:"body",title:"Conciliar",textButtonSuccess:"Conciliar",open:r,children:t.jsxs(l,{spacing:3,sx:{py:3},children:[t.jsx(A,{severity:"info",sx:{display:"flex",flexGrow:1,"& .MuiAlert-message":{display:"flex",flexGrow:1}},children:t.jsxs(l,{flexGrow:1,spacing:2,direction:"row",justifyContent:"space-between",alignItems:"center",children:[t.jsxs(l,{children:[t.jsxs(f,{variant:"subtitle2",children:["Orden #",o==null?void 0:o.referenceNumber]}),t.jsx(f,{variant:"subtitle2",fontWeight:"bold",children:o==null?void 0:o.amount})]}),t.jsx(l,{children:p&&t.jsx(E,{sx:{width:30,height:30}})})]})}),t.jsx(l,{children:t.jsx(K,{children:t.jsx(D,{enablePinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,tableInstanceRef:s,columns:b||[],data:(c==null?void 0:c.movements)||[],isError:i,textError:m,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:F,showAlertBanner:i,showProgressBars:T},muiTablePaperProps:{elevation:0,sx:e=>({borderRadius:0,backgroundColor:e.palette.background.neutral})},muiBottomToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},muiTopToolbarProps:{sx:e=>({backgroundColor:e.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{size:12,header:""}},renderToolbarInternalActions:({table:e})=>t.jsx(P,{children:t.jsx(L,{table:e})}),muiTableContainerProps:{sx:{maxHeight:"md"}}})})})]})})};export{Me as default};
