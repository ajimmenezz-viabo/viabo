import{ak as S,r as D,a as V,g as I,b as k,aV as E,aW as v,aX as F,j as e,S as s,T as c,B as M,$ as w,G as P,L as R,p as T,ai as q}from"./index-e73cf17b.js";import{u as B}from"./build-5fb868c5.js";import{c as L,a as y}from"./build-c0dc204e.js";import{a as z}from"./build-9964c057.js";import{u as h,C as j}from"./build-ef50a7a2.js";import{a as N}from"./build-6b5ec406.js";import{F as _,M as $}from"./build-c9934e06.js";import{R as U}from"./build-125e0389.js";import{I as W}from"./build-34e19a43.js";import{V as G}from"./build-5bbdacc9.js";import{A as H}from"./build-2219ff4e.js";import{D as O}from"./build-7101bc47.js";import"./build-2184f94b.js";import"./build-0c8c73a4.js";import"./build-ac55763c.js";import"./build-605ae648.js";import"./build-7c7c485c.js";import"./build-5033c3a7.js";import"./build-8193b4a1.js";import"./build-178dbaa7.js";import"./build-bee6630b.js";const K=r=>{var d,a;const p=(d=r==null?void 0:r.expiration)==null?void 0:d.slice(-2),n={expiration:((a=r==null?void 0:r.expiration)==null?void 0:a.slice(0,3))+p,cvv:r==null?void 0:r.cvv};return z(n)},X=(r={})=>{const{enqueueSnackbar:p}=S(),[o,n]=D.useState(null);return{...V(N,{onSuccess:()=>{n(null)},onError:a=>{const i=I(a,"No se puede asignar la tarjeta. Intente nuevamente o reporte a sistemas");n(i),p(i,{variant:k(a),autoHideDuration:5e3})},...r}),error:o||null}};function je(){const r=h(t=>t.setStepAssignRegister),p=h(t=>t.token),o=h(t=>t.card),{mutate:n,isLoading:d}=X(),a=L().shape({cvv:y().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:y().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(t){const l=E(`01/${t}`,"dd/MM/yyyy",new Date),x=new Date;return v(l)&&F(l,x)})}),i=B({initialValues:{expiration:"",cvv:""},validationSchema:a,onSubmit:(t,{setSubmitting:l})=>{const x=K(t);q.defaults.headers.common.Authorization=`Bearer ${p}`,n(x,{onSuccess:()=>{l(!1),r(j.CARD_ASSIGNED)},onError:()=>{l(!1)}})}}),{isSubmitting:C,values:g,setFieldValue:A,errors:u,handleSubmit:b,touched:f,resetForm:Y,setSubmitting:J}=i,m=C||d;return e.jsxs(s,{sx:{mb:3},children:[e.jsxs(s,{direction:"column",width:1,spacing:1,pb:2,children:[e.jsx(c,{variant:"h4",color:"textPrimary",align:"center",children:"Estamos a un paso de completar su registro"}),e.jsx(c,{paragraph:!0,align:"center",variant:"body1",color:"text.primary",whiteSpace:"pre-line",children:"Ingrese la información faltante de la tarjeta para asociarla a su cuenta."})]}),e.jsx(_,{formik:i,children:e.jsxs(s,{px:5,children:[e.jsx(M,{sx:{pb:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2},children:e.jsx(c,{variant:"overline",color:"primary.main",children:o==null?void 0:o.cardNumberHidden})}),e.jsx(w,{sx:{textAlign:"center",width:"100%",justifyContent:"center",display:"flex",mb:2},severity:"warning",children:e.jsx(c,{variant:"caption",fontWeight:"bold",children:"En caso de no capturar los datos correctos de la tarjeta, la información de la misma podrá ser erronea."})}),e.jsxs(s,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(s,{sx:{width:{xs:"100%",lg:"40%"}},children:[e.jsx(c,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(U,{name:"cvv",required:!0,placeholder:"123",size:"small",InputProps:{startAdornment:e.jsx(W,{position:"start",children:e.jsx(G,{})}),inputComponent:$,inputProps:{mask:"000",onAccept:t=>{A("cvv",t)},value:g.cvv}},disabled:m})]}),e.jsxs(s,{children:[e.jsx(c,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),e.jsx(O,{disabled:m,views:["year","month"],size:"small",name:"expiration",value:new Date(g.expiration)??null,onChange:t=>v(t)?i.setFieldValue("expiration",P(t,"MM/yyyy")):i.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,size:"small",error:!!(f.expiration&&u.expiration),required:!0,helperText:f.expiration&&u.expiration?u.expiration:""}},disablePast:!0,format:"MM/yy"})]})]})]})}),e.jsxs(s,{spacing:3,px:5,py:4,children:[e.jsx(R,{size:"large",loading:m,variant:"contained",color:"primary",fullWidth:!0,type:"submit",onClick:b,disabled:m,startIcon:e.jsx(H,{}),children:"Asociar"}),e.jsx(T,{size:"large",variant:"outlined",color:"inherit",onClick:()=>{r(j.CARD_VALIDATION)},children:"Cancelar"})]})]})}export{je as default};
