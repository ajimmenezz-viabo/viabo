import{z as F,j as e,k,a as L,Q as C,g as z,b as M,G as W,r as D,d as H,q as Q,B as S,S as w,D as K,T as b}from"./index-x-tL3MOy.js";import{c as G,T as y,g as _,u}from"./build-GuGAdUPH.js";import{f as R}from"./build-Q1bOWlNZ.js";import{u as j,S as $,T as q,s as Y,t as J,v as l,w as U,M as X}from"./build-yw6dnA5g.js";import{a as Z}from"./build-OIGRQKXP.js";import{u as ee}from"./build-Dae5ZSnf.js";import{G as T}from"./build-fO9Z8l-Y.js";import"./build-f4JKtdjp.js";import"./build-iPi1GP4n.js";import"./build-EUAVn8Jf.js";import"./build-zw289rNM.js";import"./build-SWnGRRxs.js";import"./build-GKTonalM.js";import"./build-r-MJ89TZ.js";import"./build-OVyPJnWA.js";import"./build-a2Rn9pG_.js";import"./build-Bb7QOPnp.js";import"./build-2TgacLCq.js";import"./build-3y5AuJst.js";import"./build-mZf3ZGCw.js";import"./build-rDZAP2eW.js";import"./build-Pt2-zlVs.js";import"./build-3JmeY1AD.js";import"./build-eCwt9U-A.js";import"./build-RTCxoqUU.js";import"./build-aXq1ykHm.js";import"./build-Kbx5ZuUJ.js";import"./build-Uc7vb3zK.js";import"./build-EckPbxwb.js";import"./build-TmPCBBAV.js";import"./build-FnpcTuzg.js";import"./build-sKE3h63b.js";import"./build-PJMT8ova.js";import"./build-G8xLV4ng.js";import"./build-P_JIiLI3.js";import"./build-KY8IQPj0.js";import"./build-oEjEmA2z.js";import"./build-WksAqt8r.js";import"./build-YUdFPXK7.js";const te=F(e.jsx("path",{d:"M9.01 14H3c-.55 0-1 .45-1 1s.45 1 1 1h6.01v1.79c0 .45.54.67.85.35l2.78-2.79c.19-.2.19-.51 0-.71l-2.78-2.79c-.31-.32-.85-.09-.85.35V14zm5.98-2.21V10H21c.55 0 1-.45 1-1s-.45-1-1-1h-6.01V6.21c0-.45-.54-.67-.85-.35l-2.78 2.79c-.19.2-.19.51 0 .71l2.78 2.79c.31.31.85.09.85-.36z"}),"CompareArrowsRounded"),ie=(o,c,s)=>{var n,p;const d=(c==null?void 0:c.map(i=>{var m,r;return{transactionId:(m=i==null?void 0:i.id)==null?void 0:m.toString(),amount:(r=i==null?void 0:i.amount)==null?void 0:r.toString()}}))??[];return{terminalId:o==null?void 0:o.terminalId,speiCardTransactionId:(n=s==null?void 0:s.id)==null?void 0:n.toString(),speiCardTransactionAmount:(p=s==null?void 0:s.amount)==null?void 0:p.toString(),transactions:d}},oe=(o={})=>{const c=k(),s=L(G,o);return{...s,mutate:async(n,p)=>{const{onSuccess:i,onError:m,mutationOptions:r}=p;try{await C.promise(s.mutateAsync(n,r),{pending:"Conciliando movimientos de la terminal ...",success:{render({data:a}){return c.invalidateQueries([y.MOVEMENTS,n==null?void 0:n.terminalId]),i(a),"Se creó la conciliación con éxito"}}})}catch(a){const x=z(a,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");m(x),C.error(x,{type:M(a)})}}}},se=(o,c,s={})=>{const d=W(c,"yyyy-MM-dd"),[n,p]=D.useState(null),i=o?[y.CONCILIATE_MOVEMENTS,o]:[y.MOVEMENTS,"global"];return{...H(i,({signal:r})=>_(o,d),{staleTime:6e4,refetchOnWindowFocus:!1,onError:r=>{const a=z(r,"No se puede obtener la lista de movimientos para conciliar la terminal. Intente nuevamente o reporte a sistemas");p(a),C.error(a,{type:M(r)})},...s}),error:n||null}},ne=Q(j)(({theme:o})=>({"& td":{paddingTop:o.spacing(.5),paddingBottom:o.spacing(.5),backgroundColor:o.palette.background.neutral}})),_e=()=>{var E;const o=u(t=>t.setOpenConciliate),c=u(t=>t.openConciliate),s=u(t=>t.setConciliateMovements),{movements:d,total:n,date:p}=u(t=>t.conciliateInfo),i=u(t=>t.terminal),{data:m,error:r,isError:a,isFetching:x,isLoading:O}=se(i==null?void 0:i.terminalId,p,{enabled:!!(i&&p)}),{mutate:B,isLoading:N}=oe(),v=k(),h=ee(a,r,{columns:[{id:"card",header:"Movimientos Tarjeta Asociada",columns:[{accessorKey:"description",header:"Movimiento",minSize:100},{accessorKey:"date",header:"Fecha",size:130},{accessorKey:"amountFormat",header:"Monto",minSize:100}]}],data:(m==null?void 0:m.movements)||[],enableColumnPinning:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowSelection:!0,enableMultiRowSelection:!1,positionActionsColumn:"last",enableDensityToggle:!1,enableColumnResizing:!1,initialState:{density:"compact",sorting:[{id:"date",desc:!0}]},state:{isLoading:O,showAlertBanner:a,showProgressBars:x},muiTablePaperProps:{elevation:0,sx:t=>({borderRadius:0,backgroundColor:t.palette.background.neutral})},muiBottomToolbarProps:{sx:t=>({backgroundColor:t.palette.background.neutral})},muiTopToolbarProps:{sx:t=>({backgroundColor:t.palette.background.neutral})},displayColumnDefOptions:{"mrt-row-select":{maxSize:10,header:""}},renderToolbarInternalActions:({table:t})=>e.jsx(S,{children:e.jsx($,{table:t})}),muiTableContainerProps:{sx:{maxHeight:"md"}}}),g=((E=h==null?void 0:h.getSelectedRowModel().flatRows)==null?void 0:E.map(t=>t.original))??[],f=()=>{o(!1),s(null),v.removeQueries([y.CONCILIATE_MOVEMENTS,i==null?void 0:i.terminalId])},V=()=>{if((g==null?void 0:g.length)>0){const t=ie(i,d,g[0]);B(t,{onSuccess:()=>{f()},onError:()=>{}})}else C.warn("Debe seleccionar un movimiento de la tarjeta para conciliar los movimientos de la terminal")};return e.jsx(Z,{onClose:f,onSuccess:V,isSubmitting:N,fullWidth:!0,scrollType:"body",title:`Conciliar Movimientos ${i==null?void 0:i.name}`,textButtonSuccess:"Conciliar",maxWidth:"md",open:c,children:e.jsx(w,{pt:3,children:e.jsxs(T,{container:!0,spacing:{xs:2},children:[e.jsx(T,{item:!0,xs:12,md:5,children:e.jsx(K,{children:e.jsx(q,{sx:{minWidth:200},children:e.jsxs(Y,{size:"small",children:[e.jsxs(J,{sx:{borderBottom:t=>`solid 1px ${t.palette.divider}`},children:[e.jsx(j,{children:e.jsx(l,{align:"center",colSpan:3,children:"Movimientos Terminal"})}),e.jsxs(j,{children:[e.jsx(l,{width:40,children:"#"}),e.jsx(l,{align:"left",children:"Descripción"}),e.jsx(l,{align:"right",children:"Monto"})]})]}),e.jsxs(U,{children:[d==null?void 0:d.map((t,I)=>{var A;return e.jsxs(j,{sx:{borderBottom:P=>`solid 1px ${P.palette.divider}`},children:[e.jsx(l,{children:I+1}),e.jsx(l,{align:"left",children:e.jsxs(S,{sx:{maxWidth:180},children:[e.jsx(b,{variant:"subtitle2",children:t==null?void 0:t.description}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},noWrap:!0,children:(A=t==null?void 0:t.transactionDate)==null?void 0:A.fullDate})]})}),e.jsx(l,{align:"right",children:R(t==null?void 0:t.amount)})]},I)}),e.jsxs(ne,{children:[e.jsx(l,{colSpan:1}),e.jsx(l,{align:"right",children:e.jsx(b,{variant:"h6",children:"Total"})}),e.jsx(l,{align:"right",width:140,children:e.jsx(b,{variant:"h6",children:R(n)})})]})]})]})})})}),e.jsx(T,{item:!0,xs:12,md:1,sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(S,{display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(te,{fontSize:"large",color:"primary"})})}),e.jsx(T,{item:!0,xs:12,md:6,children:e.jsx(X,{table:h})})]})})})};export{_e as default};
