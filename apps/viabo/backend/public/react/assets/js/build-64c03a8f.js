import{t as ue,j as e,a0 as pe,n as xe,at as H,g as me,o as he,r as S,a7 as Y,B as de,S as x,T as v,d as W,a3 as X,ad as J,aN as C,L as ee,aX as fe}from"./build-5885a497.js";import{C as D}from"./build-c7ce8ef2.js";import{f as je}from"./build-4ec2ea70.js";import{u as se,d as be}from"./build-984b3412.js";import{c as P,b as ge,a as te}from"./build-85f46b5d.js";import{g as Se,C as B}from"./build-9f964f93.js";import{R as ve}from"./build-6e151cd8.js";import{t as ye,u as k}from"./build-a3c1b3b6.js";import{F as re,R as z,M as oe}from"./build-ebd5bc51.js";import{R as Ie}from"./build-85d049c1.js";import{A as Ae}from"./build-a3405297.js";import{S as ne}from"./build-bf320aec.js";import{C as we}from"./build-9f068f25.js";import{T as Ee,a as Z}from"./build-325ec6b1.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";import"./build-009a24e3.js";import"./build-4c4ba0aa.js";import"./build-8254f016.js";import"./build-e08f604e.js";import"./build-23e0dc4d.js";import"./build-98a4c969.js";import"./build-026421cb.js";import"./build-8b042b43.js";import"./build-90d696a1.js";const Re=ue(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete"),ae=(f,o,r)=>{var n,c,p;const{transactions:s}=o;let t;return r?t={originCardId:f,destinationCards:[{cardId:(n=o==null?void 0:o.card)==null?void 0:n.value.toString(),concept:(c=o==null?void 0:o.concept)==null?void 0:c.toString(),amount:parseFloat((o==null?void 0:o.amount.toString())===""?"0":(p=o==null?void 0:o.amount)==null?void 0:p.toString().replace(/,/g,"")).toString()}]}:t={originCardId:f,destinationCards:s==null?void 0:s.map(a=>{var l,h,j,d;return{cardId:(h=(l=a==null?void 0:a.card)==null?void 0:l.value)==null?void 0:h.toString(),concept:(j=a==null?void 0:a.concept)==null?void 0:j.toString(),amount:parseFloat((a==null?void 0:a.amount.toString())===""?"0":(d=a==null?void 0:a.amount)==null?void 0:d.toString().replace(/,/g,"")).toString()}})},{cardId:t==null?void 0:t.originCardId,data:Se(t)}},le=(f={})=>{const o=pe(),r=xe(ye,f);return{...r,transaction:async(t,n)=>{const{onSuccess:c,onError:p,mutationOptions:a}=n;try{await H.promise(r.mutateAsync(t,a),{pending:"Procesando Transferencia ...",success:{render({data:l}){return o.fetchQuery([D.TRANSIT_BALANCE]),o.invalidateQueries([D.CARD_INFO,l==null?void 0:l.cardId]),o.fetchQuery([D.CARD_MOVEMENTS,l==null?void 0:l.cardId]),o.fetchQuery([D.MAIN_CARD]),c(l),"Se realizo la transferencia con Ã©xito"}}})}catch(l){const h=me(l,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");p(h),H.error(h,{type:he(l)})}}}};function K({cards:f,balance:o,setCurrentBalance:r,insufficient:s,cardOriginId:t,setOpen:n,isBinCard:c,setTransactionLoading:p}){const a=S.useRef(null),[l,h]=S.useState(f),{transaction:j,isLoading:d}=le(),m=k(u=>u==null?void 0:u.selectedCards);S.useEffect(()=>{if(m&&c){const u=m==null?void 0:m.map(i=>({...i,isDisabled:!0}));h(u)}},[m,c]);const I=P().shape({transactions:ge().of(P().shape({amount:te().required("La cantidad es requerida"),card:P().nullable().required("La tarjeta es requerida")}))}),b=se({initialValues:{transactions:(m==null?void 0:m.length)>0&&c&&(m==null?void 0:m.map(u=>({id:Math.random(),card:{value:u==null?void 0:u.value,label:u==null?void 0:u.label,...u},amount:"",concept:""})))||[{id:1,card:null,amount:"",concept:""}]},validationSchema:I,onSubmit:u=>{if(s)return R(!1);const i=ae(t,u);p(!0),j(i,{onSuccess:()=>{R(!1),n(!1),p(!1)},onError:()=>{R(!1),p(!1)}})}}),{isSubmitting:y,setFieldValue:A,values:g,setSubmitting:R}=b,T=y||d;return e.jsx(e.Fragment,{children:e.jsx(Y,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(re,{formik:b,children:e.jsxs(de,{sx:{p:3},children:[e.jsxs(x,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[e.jsx(v,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),e.jsx(x,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!c&&e.jsx(W,{type:"button",size:"small",variant:"outlined",startIcon:e.jsx(Ae,{}),disabled:T,onClick:()=>a.current.push({id:Math.random(),card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Nueva"})]}),e.jsx(be,{name:"transactions",render:u=>(a.current=u,e.jsx(x,{divider:e.jsx(X,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:g==null?void 0:g.transactions.map((i,M)=>{var V,_,$,Q,G,L;const q=`transactions[${M}].card`,F=`transactions[${M}].amount`,ie=`transactions[${M}].concept`;return e.jsxs(x,{alignItems:"flex-end",spacing:1.5,children:[((_=(V=i==null?void 0:i.card)==null?void 0:V.assignUser)==null?void 0:_.name)&&e.jsx(B,{avatar:e.jsx(J,{...C(((Q=($=i==null?void 0:i.card)==null?void 0:$.assignUser)==null?void 0:Q.name)??"")}),label:(L=(G=i==null?void 0:i.card)==null?void 0:G.assignUser)==null?void 0:L.name}),e.jsxs(x,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[e.jsx(v,{variant:"overline",color:"text.disabled",children:M+1}),e.jsx(Ie,{name:q,disabled:T||c,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:l||[],onChange:(N,w)=>{const ce=l==null?void 0:l.map(E=>{var O,U;return!(w!=null&&w.value)&&E.value===((O=i==null?void 0:i.card)==null?void 0:O.value)?{...E,isDisabled:!1}:E.value===(w==null?void 0:w.value)?{...E,isDisabled:!0}:E.value===((U=i==null?void 0:i.card)==null?void 0:U.value)?{...E,isDisabled:!1}:E});h(ce),A(q,w)},sx:{width:{xs:1,lg:.6}}}),e.jsx(z,{sx:{width:{xs:1,lg:.4}},size:"small",name:F,required:!0,label:"Cantidad",placeholder:"0.00",disabled:T,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:oe,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:i.amount,onAccept:N=>{r((parseFloat(o)-parseFloat(N===""?"0":N.replace(/,/g,""))).toFixed(2)),A(F,N)}}}})]}),e.jsx(x,{sx:{width:1},children:e.jsx(z,{name:ie,multiline:!0,disabled:T,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),M!==0&&!c&&e.jsx(W,{size:"small",color:"error",disabled:T,startIcon:e.jsx(Re,{}),onClick:()=>u.remove(M),children:"Borrar"})]},i.id)})}))}),e.jsx(X,{sx:{my:3,borderStyle:"dashed"}}),e.jsx(x,{sx:{px:3,pt:3},children:e.jsx(ee,{variant:"contained",color:"primary",loading:T,fullWidth:!0,type:"submit",startIcon:e.jsx(ne,{}),children:"Enviar"})})]})})})})}function Te({balance:f,setCurrentBalance:o,insufficient:r,cardOriginId:s,setOpen:t,mainCard:n,setTransactionLoading:c}){const{transaction:p,isLoading:a}=le(),l=P().shape({amount:te().required("La cantidad es requerida")}),h=se({initialValues:{card:n?{label:n==null?void 0:n.label,value:n==null?void 0:n.id}:null,amount:"",concept:""},validationSchema:l,onSubmit:(b,{setSubmitting:y})=>{if(r)return y(!1);const A=ae(s,b,!0);c(!0),p(A,{onSuccess:()=>{y(!1),t(!1),c(!1)},onError:()=>{y(!1),c(!1)}})}}),{isSubmitting:j,setFieldValue:d,values:m}=h,I=j||a;return e.jsx(Y,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(re,{formik:h,children:e.jsxs(x,{sx:{p:3},spacing:1,children:[e.jsx(x,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",justifyContent:"center",children:e.jsx(B,{icon:e.jsx(we,{}),label:n==null?void 0:n.cardNumberHidden})}),e.jsx(x,{children:e.jsx(z,{sx:{width:1},size:"small",name:"amount",required:!0,label:"Cantidad",placeholder:"0.00",disabled:I,autoComplete:"off",InputProps:{startAdornment:e.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:oe,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:m.amount,onAccept:b=>{o((parseFloat(f)-parseFloat(b===""?"0":b.replace(/,/g,""))).toFixed(2)),d("amount",b)}}}})}),e.jsx(x,{sx:{width:1},children:e.jsx(z,{name:"concept",multiline:!0,disabled:I,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),e.jsx(x,{sx:{px:3,pt:3},children:e.jsx(ee,{variant:"contained",color:"primary",loading:I,fullWidth:!0,type:"submit",startIcon:e.jsx(ne,{}),children:"Enviar"})})]})})})}function es({open:f,setOpen:o,isFundingCard:r}){var y,A;const s=k(g=>g.card),t=k(g=>g.mainCard),n=fe([D.CARDS_COMMERCE_LIST])||[],[c,p]=S.useState(r?t==null?void 0:t.balance:s==null?void 0:s.balance),[a,l]=S.useState("1"),[h,j]=S.useState(!1),d=S.useMemo(()=>c<0,[c]);S.useEffect(()=>{r||p(s==null?void 0:s.balance)},[s==null?void 0:s.balance,r]),S.useEffect(()=>{r&&p(t==null?void 0:t.balance)},[t==null?void 0:t.balance,r]);const m=S.useMemo(()=>n==null?void 0:n.filter(g=>g.id!==(s==null?void 0:s.id)),[n,s==null?void 0:s.id]),I=()=>{p(r?t==null?void 0:t.balance:s==null?void 0:s.balance),o(!1)},b=(g,R)=>{R&&l(R)};return e.jsxs(ve,{open:f,handleClose:I,titleElement:r?e.jsx(v,{variant:"h6",children:"Fondear"}):e.jsxs(x,{children:[e.jsxs(x,{spacing:1,alignItems:"center",direction:"row",children:[e.jsx(v,{variant:"subtitle2",children:"Origen: "}),e.jsxs(v,{variant:"subtitle2",children:[s==null?void 0:s.cardNumberMoreDigits," "]})]}),e.jsx(B,{avatar:e.jsx(J,{...C(((y=s==null?void 0:s.assignUser)==null?void 0:y.name)??"")}),label:(A=s==null?void 0:s.assignUser)==null?void 0:A.name})]}),children:[!r&&e.jsx(x,{alignItems:"flex-end",sx:{py:1,px:3},children:e.jsxs(Ee,{size:"small",color:"primary",value:a,exclusive:!0,onChange:b,"aria-label":"Platform",disabled:h,children:[e.jsx(Z,{value:"1",children:"Tarjetas"}),e.jsx(Z,{value:"2",children:"Global"})]})}),e.jsxs(x,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,py:r?3:1,children:[e.jsx(v,{variant:"subtitle1",children:"Saldo"}),e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(v,{variant:"h3",color:d?"error":"success.main",children:je(c)}),e.jsx(v,{variant:"caption",color:d?"error":"success.main",children:"MXN"})]}),d&&e.jsx(v,{variant:"caption",color:"warning.main",textAlign:"center",children:"No cuenta con suficiente saldo para realizar la(s) operacion(es)"})]}),r&&e.jsx(K,{cards:r?n:m,balance:r?t==null?void 0:t.balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:r?t==null?void 0:t.id:s==null?void 0:s.id,setOpen:o,isBinCard:r,setTransactionLoading:j}),!r&&e.jsxs(e.Fragment,{children:[a==="1"&&e.jsx(K,{cards:r?n:m,balance:r?t==null?void 0:t.balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:r?t==null?void 0:t.id:s==null?void 0:s.id,setOpen:o,isBinCard:r,setTransactionLoading:j}),a==="2"&&e.jsx(Te,{mainCard:t,balance:s==null?void 0:s.balance,setCurrentBalance:p,insufficient:d,cardOriginId:s==null?void 0:s.id,setOpen:o,setTransactionLoading:j})]})]})}export{es as default};
