import{t as V,j as r,P as d,S as n,i as b,B as I,T as l,a as T,n as S,E as R,Q as C,g as q,o as z,r as B,F as O,b as _,G as H,H as P,J as $,K as Q,N,O as A,L as W,R as Y,f as D,U as K}from"./index-07bc056d.js";import{V as U}from"./build-899176f2.js";import{u as X}from"./build-3c444f8f.js";import{L as G,F as L,M as E}from"./build-92a37797.js";import{a as J}from"./build-90baef54.js";import{c as Z,a as g}from"./build-f6a3a480.js";import{g as k,a as y}from"./build-bbb6c732.js";import{f as ee}from"./build-8ac830c6.js";import{R as j}from"./build-61a353d3.js";import{M as re}from"./build-12c39932.js";import{V as oe,L as ae}from"./build-bd27a2c3.js";import{I as f}from"./build-593470b2.js";import{C as se}from"./build-040390e9.js";import{V as ne}from"./build-fc4bfd81.js";import{P as ie}from"./build-b0e3607f.js";import{E as te}from"./build-3686c4bb.js";import{D as ce}from"./build-b9b4650b.js";import"./build-d3679b96.js";import"./build-bee6630b.js";import"./build-d6b566fb.js";import"./build-00b2c150.js";const le=V(r.jsx("path",{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56C4.61 15.07 4 16.1 4 17.22V18c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"}),"Person2Rounded"),de=[{id:"6",color:"warning"},{id:"7",color:"success"},{id:"8",color:"error"}],ue=e=>{var o;return((o=de.find(s=>(s==null?void 0:s.id)===e))==null?void 0:o.color)??"info"},w=({details:e})=>{var o,s;return r.jsx(n,{children:r.jsxs(b,{sx:{width:1,p:3,position:"relative"},elevation:0,children:[r.jsx(I,{sx:{textAlign:"center",display:"flex",position:"absolute",top:8,left:8,justifyContent:"center",width:100},children:r.jsx("img",{src:U,alt:"viabo-logo"})}),r.jsxs(n,{alignItems:"center",justifyContent:"center",spacing:3,children:[r.jsx(G,{variant:"ghost",color:ue((o=e==null?void 0:e.status)==null?void 0:o.id),sx:{textTransform:"uppercase"},children:(s=e==null?void 0:e.status)==null?void 0:s.name}),r.jsxs(n,{alignItems:"center",justifyContent:"center",children:[r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsxs(l,{variant:"h2",children:[" ",e==null?void 0:e.amount]}),r.jsx(l,{variant:"caption",children:"MXN"})]}),r.jsxs(n,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(le,{}),r.jsx(l,{variant:"subtitle1",textTransform:"capitalize",children:e==null?void 0:e.name})]})]}),r.jsx(l,{textAlign:"center",variant:"body2",children:e==null?void 0:e.description})]})]})})};w.propTypes={details:d.shape({amount:d.any,description:d.any,name:d.any,status:d.shape({id:d.any,name:d.any})})};const xe=(e,o)=>{var x,m,h,t;const s=(x=e==null?void 0:e.expiration)==null?void 0:x.slice(-2),i=((m=e==null?void 0:e.expiration)==null?void 0:m.slice(0,3))+s,u={payId:o==null?void 0:o.id,cardHolder:e==null?void 0:e.name,phone:e==null?void 0:e.phone,cardNumber:e==null?void 0:e.cardNumber.replace(/\s+/g,""),expirationDate:i,expMonth:(h=e==null?void 0:e.expiration)==null?void 0:h.slice(0,2),expYear:(t=e==null?void 0:e.expiration)==null?void 0:t.slice(-2),security:e==null?void 0:e.cvv,email:e==null?void 0:e.email};return k(u)},M={INFO:"payment-link-info"},he=e=>{const o=y(e==null?void 0:e.ciphertext,e==null?void 0:e.iv);if(o)return{id:o==null?void 0:o.id,name:o==null?void 0:o.clientName,amount:ee(o==null?void 0:o.amount),description:o==null?void 0:o.description,email:o==null?void 0:o.email,phone:o==null?void 0:o.phone,status:{id:o==null?void 0:o.statusId,name:o==null?void 0:o.statusName}};throw new Error("Algo fallo al obtenerla informacion de la liga de pago")},me=async e=>{const{data:o}=await T.get(`/api/commerces/pay/${e}`);return he(o)},pe=async e=>{const{data:o}=await T.post("/api/commerce/pay/generate/transaction",e);return o},ge=(e,o={})=>{const s=S(pe,o),i=R();return{...s,mutate:async(x,m)=>{const{onSuccess:h,onError:t,mutationOptions:p}=m;try{await C.promise(s.mutateAsync(x,p),{pending:"Realizando cargo ...",success:{render({data:a}){return i.invalidateQueries([M.INFO]),h(a),"Se realizo el pago con éxito"}}})}catch(a){const c=q(a,"No se puede realizar esta operacion en este momento. Intente nuevamente o reporte a sistemas");t(c),C.error(c,{type:z(a)})}}}},je=(e,o={})=>{const[s,i]=B.useState(null),u=O();return{..._([M.INFO,e],()=>me(e),{staleTime:6e4,onError:m=>{const h=q(m,"No se puede obtener la informacion de la liga de pago");i(h),u("/404")},...o}),error:s||null}},F=({details:e})=>{const{mutate:o}=ge(e==null?void 0:e.id),s=Z().shape({cardNumber:g().transform((a,c)=>c.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:g().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(a){const c=H(`01/${a}`,"dd/MM/yyyy",new Date),v=new Date;return P(c)&&$(c,v)}),name:g().required("El nombre es requerido"),email:g().email("Ingresa un correo valido").required("El correo es requerido"),phone:g().test("longitud","El telefono es muy corto",a=>!(a&&a.replace(/[\s+]/g,"").length<10)).required("El telefono es requerido")}),i=X({initialValues:{cardNumber:"",expiration:"",cvv:"",name:"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||""},enableReinitialize:!0,validationSchema:s,onSubmit:(a,{setSubmitting:c})=>{const v=xe(a,e);o(v,{onSuccess:()=>{c(!1)},onError:()=>{c(!1)}})}}),{errors:u,touched:x,isSubmitting:m,setFieldValue:h,values:t}=i,p=m;return r.jsx(L,{formik:i,children:r.jsxs(n,{spacing:3,children:[r.jsxs(n,{direction:"row",alignItems:"center",spacing:1,children:[r.jsx(l,{variant:"h6",children:"Forma de Pago"}),r.jsx(b,{sx:{px:1},children:r.jsx(re,{sx:{width:30,height:30}})}),r.jsx(b,{sx:{px:1},children:r.jsx(oe,{sx:{width:30,height:30}})})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta *"}),r.jsx(j,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(se,{})}),inputComponent:E,inputProps:{mask:"0000 0000 0000 0000",value:t.cardNumber,onAccept:a=>{h("cardNumber",a)}}},disabled:p})]}),r.jsxs(n,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[r.jsxs(n,{flex:1,spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence *"}),r.jsx(ce,{disabled:p,views:["year","month"],name:"expiration",value:t!=null&&t.expiration?new Date(t.expiration):null,required:!0,onChange:a=>P(a)?i.setFieldValue("expiration",Q(a,"MM/yyyy")):i.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(x.expiration&&u.expiration),required:!0,helperText:x.expiration&&u.expiration?u.expiration:""}},disablePast:!0,minDate:new Date,format:"MM/yy"})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV *"}),r.jsx(j,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(ne,{})}),inputComponent:E,inputProps:{mask:"000",onAccept:a=>{h("cvv",a)},value:t.cvv}},disabled:p})]})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tarjetahabiente *"}),r.jsx(j,{name:"name",required:!0,placeholder:"Nombre del Titular de la Tarjeta",disabled:p,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(ie,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Correo Electrónico *"}),r.jsx(j,{name:"email",required:!0,placeholder:"usuario@dominio.com",disabled:p,InputProps:{startAdornment:r.jsx(f,{position:"start",children:r.jsx(te,{})})}})]}),r.jsxs(n,{spacing:1,children:[r.jsx(l,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Telefono *"}),r.jsx(J,{name:"phone",fullWidth:!0,langOfCountryName:"es",defaultCountry:"MX",preferredCountries:["MX","US"],continents:["NA","SA"],forceCallingCode:!0,value:t.phone,disabled:p,required:!0,onChange:(a,c)=>{h("phone",a)},error:x.phone&&!!u.phone,helperText:x.phone&&u.phone})]}),r.jsxs(l,{variant:"body2",align:"center",sx:{color:"text.secondary"},children:["Al hacer clic en el botón de Pagar, accedo a los  ",r.jsx(N,{component:A,underline:"always",target:"_blank",color:"info.main",children:"Terminos y condiciones"}),"  &  ",r.jsx(N,{component:A,underline:"always",target:"_blank",color:"info.main",children:"Acuerdos de privacidad"}),"."]}),r.jsx(n,{children:r.jsx(W,{loading:m,variant:"contained",color:"primary",fullWidth:!0,type:"submit",startIcon:r.jsx(ae,{}),children:"Pagar"})})]})})};F.propTypes={details:d.shape({email:d.string,id:d.any,phone:d.string})};const $e=()=>{var i;const{paymentId:e}=Y(),{data:o,isLoading:s}=je(e,{enabled:!!e});return r.jsx(D,{title:"Cobro",children:r.jsx(I,{component:"main",height:1,m:0,p:0,children:r.jsxs(n,{p:4,alignItems:"center",justifyContent:"center",minHeight:"100vH",children:[s&&r.jsx(K,{}),!s&&o&&r.jsxs(n,{width:{xs:1,sm:.5,md:"0.4"},spacing:3,children:[r.jsx(w,{details:o}),["6","8"].includes((i=o==null?void 0:o.status)==null?void 0:i.id)&&r.jsx(F,{details:o})]})]})})})};export{$e as default};
