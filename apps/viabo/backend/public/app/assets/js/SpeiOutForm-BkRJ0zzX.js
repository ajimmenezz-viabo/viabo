import{r as y,U as L,i as r,S as s,T as u,B as q,A as x,bQ as M,aT as W,bq as $,aR as E,aP as D,e0 as O,aQ as Q,J as U,bA as G,P as o}from"./vendor-B39b6gT1.js";import{S as H,y as m,I as J}from"./index-Kl2QvVyT.js";import{u as X,d as Z}from"./formik.esm-CRn2DIxC.js";import{c as h,d as K,a as Y}from"./index.esm-DHXyn7Aa.js";import{c as b,B as S}from"./DashboardViaboSpeiByProfile-DwKkdrW4.js";import{F as _,R as A,M as v}from"./TextMaxLine-BvJpBV6_.js";import{R as rr}from"./RFSelect-CCRetmrq.js";import"./formatNumber-Byfz8vD2.js";import"./formatTime-DnNoLFDr.js";import"./viabo-spei-paths-D6KJcfc8.js";import"./filterSearch-NGUmCbyG.js";import"./fade-CViozI82.js";import"./transition-anLY3gj9.js";import"./usePagination-Bk1liHqP.js";import"./spei-third-accounts-store-CxAZWAjk.js";import"./matchTypes-E5vQDj-t.js";import"./HeaderPage-CoeRaeoE.js";import"./UploadSingleFile-BV6pleIy.js";const er=({accounts:F,setCurrentBalance:I,insufficient:R,onSuccess:w,initialValues:P})=>{var j;const f=y.useRef(null),C=window.crypto||window.msCrypto,T=new Uint32Array(1),k=C.getRandomValues(T)[0],B=h().shape({transactions:K().of(h().shape({amount:Y().test("maxAmount","Monto máximo de transferencia $50,000",function(t){return parseFloat(t==null?void 0:t.replace(/,/g,""))<=5e4}).required("La cantidad es requerida"),account:h().nullable().required("La cuenta es requerida")}))}),g=X({initialValues:P||{transactions:[],beneficiary:null,amount:"",concept:""},validateOnChange:!1,validationSchema:B,onSubmit:(t,{setFieldValue:e,setSubmitting:a})=>R?(L.warning("Saldo insuficiente para realizar esta operación"),a(!1)):(a(!1),e("amount",""),e("beneficiary",null),w(t))}),{isSubmitting:N,setFieldValue:d,values:n}=g,p=N,z=!(n!=null&&n.beneficiary)||(n==null?void 0:n.amount)===""||Number(n==null?void 0:n.amount)<=0;y.useEffect(()=>{var a;const e=((a=n.transactions)==null?void 0:a.reduce((i,c)=>{const l=c.amount.trim()!==""?parseFloat(c.amount.replace(/,/g,"")):0;return isNaN(l)?i:i+l},0)).toFixed(2);I(e)},[n.transactions]);const V=()=>{d("amount",""),d("beneficiary",null)};return r.jsx(H,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(_,{formik:g,children:r.jsxs(s,{sx:{p:3},children:[r.jsxs(s,{gap:2,children:[r.jsxs(s,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Beneficiario:"}),r.jsx(rr,{name:"beneficiary",disabled:p,textFieldParams:{placeholder:"Seleccionar ...",size:"large"},options:F||[],onChange:(t,e)=>{d("beneficiary",e)},renderOption:(t,e)=>{const a=m((e==null?void 0:e.label)||"");return r.jsx(q,{component:"li",...t,children:r.jsxs(s,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(x,{...a,sx:{...a==null?void 0:a.sx,width:25,height:25,fontSize:12}}),r.jsx("span",{children:e.label})]})})},renderInput:t=>{var a;const e=m(((a=t==null?void 0:t.inputProps)==null?void 0:a.value)||"");return r.jsx(M,{...t,size:"large",placeholder:"Seleccionar ...",inputProps:{...t.inputProps},InputProps:{...t.InputProps,startAdornment:r.jsx(W,{position:"start",children:r.jsx(x,{...e,sx:{...e==null?void 0:e.sx,width:25,height:25,fontSize:12}})}),sx:{borderRadius:i=>1,borderColor:b}}})}})]}),r.jsxs(s,{spacing:.5,children:[r.jsx(u,{variant:"caption",fontWeight:"bold",children:"Monto:"}),r.jsx(A,{size:"large",name:"amount",placeholder:"0.00",disabled:p,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),endAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"MXN"}),inputComponent:v,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,scale:2,value:n.amount,onAccept:t=>{d("amount",t)}},sx:{borderRadius:t=>1,borderColor:b}}})]}),r.jsx(s,{direction:"row",spacing:1,children:r.jsx(S,{type:"button",startIcon:r.jsx($,{}),disabled:p||z,onClick:()=>{f.current.push({id:k,account:n==null?void 0:n.beneficiary,amount:n==null?void 0:n.amount}),V()},sx:{flexShrink:0,color:"text.primary"},children:"Agregar Transacción"})})]}),r.jsx(Z,{name:"transactions",render:t=>(f.current=t,r.jsx(E,{sx:{width:"100%",bgcolor:"background.paper"},children:n==null?void 0:n.transactions.map((e,a)=>{var i,c,l;return r.jsx(s,{children:r.jsxs(D,{sx:{px:0},secondaryAction:r.jsx(J,{color:"error",edge:"end","aria-label":"delete",onClick:()=>t.remove(a),children:r.jsx(O,{})}),children:[r.jsx(Q,{children:r.jsx(x,{title:((i=e==null?void 0:e.account)==null?void 0:i.label)||"",...m(((c=e==null?void 0:e.account)==null?void 0:c.label)||"")})}),r.jsx(U,{primary:r.jsx(u,{variant:"subtitle1",children:(l=e==null?void 0:e.account)==null?void 0:l.clabeHidden}),secondary:r.jsx(u,{variant:"subtitle1",fontWeight:"bold",children:e==null?void 0:e.amount})})]})},e.id)})}))}),r.jsx(A,{fullWidth:!0,name:"concept",multiline:!0,disabled:p,rows:2,label:"Concepto",placeholder:"Transferencia ..",InputProps:{sx:{borderRadius:t=>1,borderColor:b}}}),r.jsx(s,{sx:{pt:3},children:r.jsx(S,{variant:"contained",size:"large",color:"primary",disabled:!!((j=n==null?void 0:n.transactions)!=null&&j.length)<=0,fullWidth:!0,type:"submit",startIcon:r.jsx(G,{}),children:"Siguiente"})})]})})})};er.propTypes={accounts:o.array,initialValues:o.shape({transactions:o.array,beneficiary:o.any,amount:o.string,concept:o.string}),insufficient:o.any,onSuccess:o.func,setCurrentBalance:o.func};export{er as default};
//# sourceMappingURL=SpeiOutForm-BkRJ0zzX.js.map
