import{u as V,r as D,m as k,g as R,n as F,ab as N,ac as b,ad as P,j as e,S as i,T as p,X as q,ae as w,L as T,c as M,a as L}from"./build-6c5dae0f.js";import{R as C}from"./build-b7c47381.js";import{u as z}from"./build-96295231.js";import{F as B}from"./build-09d0df69.js";import{c as U,a as g}from"./build-70ada0c8.js";import{I as _}from"./build-7d39cd77.js";import{u as f,C as S}from"./build-e091ec54.js";import{a as G}from"./build-0be95590.js";import{g as $,C as W}from"./build-25059781.js";import{I as y}from"./build-25c8c0bf.js";import{V as H,D as K}from"./build-1ca3458f.js";import{A as O}from"./build-7490e6ed.js";import"./build-769ad25e.js";import"./build-2d5e173d.js";import"./build-bee6630b.js";import"./build-94326983.js";import"./build-7293aa8f.js";import"./build-cca55233.js";const X=(r={})=>{const{enqueueSnackbar:o}=V(),[c,l]=D.useState(null);return{...k(G,{onSuccess:()=>{l(null)},onError:n=>{const a=R(n,"No se puede asignar la tarjeta. Intente nuevamente o reporte a sistemas");l(a),o(a,{variant:F(n),autoHideDuration:5e3})},...r}),error:c||null}},Y=r=>{var d,n,a;const o=(d=r==null?void 0:r.expiration)==null?void 0:d.slice(-2),c=((n=r==null?void 0:r.expiration)==null?void 0:n.slice(0,3))+o,l={cardNumber:(a=r==null?void 0:r.cardNumber)==null?void 0:a.replace(/\s+/g,""),expiration:c,cvv:r==null?void 0:r.cvv};return $(l)},A=D.forwardRef((r,o)=>e.jsx(_,{overwrite:!0,...r,inputRef:o}));function ve(){const r=f(t=>t.setStepAssignRegister),o=f(t=>t.setCard),c=f(t=>t.token),{mutate:l,isLoading:d}=X(),n=U().shape({cardNumber:g().transform((t,s)=>s.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:g().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),expiration:g().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(t){const s=N(`01/${t}`,"dd/MM/yyyy",new Date),h=new Date;return b(s)&&P(s,h)})}),a=z({initialValues:{cardNumber:"",expiration:"",cvv:""},validationSchema:n,onSubmit:(t,{setSubmitting:s})=>{const h=Y(t);L.defaults.headers.common.Authorization=`Bearer ${c}`,l(h,{onSuccess:()=>{s(!1),o(t),r(S.CARD_ASSIGNED)},onError:()=>{s(!1)}})}}),{isSubmitting:I,values:m,setFieldValue:v,errors:x,handleSubmit:E,touched:j,resetForm:J,setSubmitting:Q}=a,u=I||d;return e.jsxs(i,{sx:{display:"flex",overflow:"hidden",mb:3},children:[e.jsxs(i,{direction:"column",width:1,spacing:1,children:[e.jsx(p,{variant:"h4",color:"textPrimary",align:"center",children:"Registrar Tarjeta"}),e.jsx(p,{paragraph:!0,align:"center",variant:"body1",color:"text.secondary",whiteSpace:"pre-line",children:"Ingrese la información de la tarjeta para asociarla a su cuenta."})]}),e.jsx(q,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(B,{formik:a,children:e.jsxs(i,{spacing:2,p:3,children:[e.jsxs(i,{children:[e.jsx(p,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta"}),e.jsx(C,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,size:"small",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(W,{})}),inputComponent:A,inputProps:{mask:"0000 0000 0000 0000",value:m.cardNumber,onAccept:t=>{v("cardNumber",t)}}},disabled:u})]}),e.jsxs(i,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(i,{sx:{width:{xs:"100%",lg:"40%"}},children:[e.jsx(p,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(C,{name:"cvv",required:!0,placeholder:"123",size:"small",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(H,{})}),inputComponent:A,inputProps:{mask:"000",onAccept:t=>{v("cvv",t)},value:m.cvv}},disabled:u})]}),e.jsxs(i,{children:[e.jsx(p,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),e.jsx(K,{disabled:u,views:["year","month"],size:"small",name:"expiration",value:new Date(m.expiration)??null,onChange:t=>b(t)?a.setFieldValue("expiration",w(t,"MM/yyyy")):a.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,size:"small",error:!!(j.expiration&&x.expiration),required:!0,helperText:j.expiration&&x.expiration?x.expiration:""}},disablePast:!0,format:"MM/yy"})]})]})]})})}),e.jsxs(i,{spacing:3,p:3,children:[e.jsx(T,{loading:u,variant:"contained",color:"primary",fullWidth:!0,type:"submit",onClick:E,disabled:u,startIcon:e.jsx(O,{}),children:"Asociar"}),e.jsx(M,{variant:"outlined",color:"inherit",onClick:()=>{r(S.USER_REGISTER)},children:"Cancelar"})]})]})}export{ve as default};
