import{a as D,K as ne,k as ie,N as oe,m as q,E as le,O as ce,g as M,b as de,Q as H,S as ue,T as xe,U as z,P as pe,p as me,H as he,J as ge,L as je,_ as Ce}from"./index-Kl2QvVyT.js";import{r as g,i as e,S as l,T as j,B as I,I as P,bK as fe,bN as be,bM as _,x as J,bO as Se,M as ye,bP as ve,bg as Ae,aM as X,bj as w,bQ as Te,aT as V,aU as we,bo as Ee,aZ as Ie,c as ke,f as Re,U as W,e as O,bR as De,bS as K,bT as _e,aV as Me,bU as Pe,bV as Fe,aH as Ne,Q as ee,bW as Le,bX as Ve,o as Oe,az as Be,ai as qe,y as He,A as ze,K as We,bY as Ke,bq as Ge,bZ as Qe,b_ as G,b$ as Ye,bf as Ue}from"./vendor-B39b6gT1.js";import{u as $e}from"./formik.esm-CRn2DIxC.js";import{c as Q,a as L}from"./index.esm-DHXyn7Aa.js";import{c as se}from"./matchTypes-E5vQDj-t.js";import{a as Ze}from"./cardsAdapter-jvJTR5hj.js";import{F as Je,R as Y,M as U}from"./TextMaxLine-BvJpBV6_.js";import{R as $}from"./RFSelect-CCRetmrq.js";import{M as Xe}from"./ModalAlert-DU1WX_NF.js";import{u as A,C as es,a as ss}from"./RightPanel-2SzQigm1.js";import{v as Z}from"./fade-CViozI82.js";import{C as ts}from"./CarnetLogo-CXbiBg5q.js";import{M as as}from"./MasterCardLogo-VWsSONZB.js";import{D as rs}from"./MaterialDataTable-BLrn9vSy.js";import{C as ns}from"./CardNumber-D286Rpmx.js";import{s as is}from"./filterSearch-NGUmCbyG.js";import{u as os}from"./usePagination-Bk1liHqP.js";import{C as ls,H as cs}from"./HeaderPage-CoeRaeoE.js";const ds=s=>{const a=s.map(t=>{var r;return{id:t==null?void 0:t.id,name:(r=t==null?void 0:t.name)==null?void 0:r.toUpperCase(),statusId:t==null?void 0:t.active}})||[];return se(a,"id","name")},te={CARD_TYPES_LIST:"cardTypes"},us=async()=>{const{data:s}=await D.get("/api/payment-processors");return ds(s)};function xs({card:s,disableShow:a}){const[t,r]=g.useState(!0),c=n=>{n.stopPropagation(),r(d=>!d)};return e.jsxs(l,{position:"relative",children:[e.jsx(j,{sx:{mb:1,typography:"caption",opacity:.48},children:"CVV"}),e.jsx(l,{direction:"row",spacing:1,alignItems:"center",children:e.jsx(j,{sx:{typography:"subtitle2"},children:t?"***":s==null?void 0:s.cvv})}),!a&&e.jsx(I,{position:"absolute",sx:{left:"32px",top:"20px"},children:e.jsx(P,{size:"small",color:"inherit",onClick:c,sx:{opacity:.2},children:t?e.jsx(fe,{}):e.jsx(be,{})})})]})}function ps({card:s}){const a=A(p=>p.isReadyToAssign),t=A(p=>p.setOpen),r=A(p=>p.setCard),[c,n]=g.useState(null),d=!!c,{enqueueSnackbar:f}=_(),u=p=>{n(p.currentTarget)},x=()=>{n(null)},i=()=>{a?(t(!0),r(s)):(t(!1),f("Por el momento no se puede asignar la tarjeta. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Acciones",children:e.jsx(P,{onClick:u,sx:{ml:2},"aria-controls":d?"card-menu":void 0,"aria-haspopup":"true","aria-expanded":d?"true":void 0,children:e.jsx(Se,{width:20,height:20})})}),e.jsx(ne,{open:!!d,anchorEl:c,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},arrow:"right-start",sx:{mt:-1,mr:0,p:2,width:250,"& .MuiMenuItem-root":{px:1,typography:"body2",borderRadius:.75,"& svg":{mr:2,width:20,height:20}}},children:e.jsxs(ye,{onClick:()=>{i(),x()},sx:{color:"text.secondary"},children:[e.jsx(ve,{width:24,height:24}),"Asignar a Comercio"]})})]})}function ms({card:s}){return e.jsxs(es,{children:[e.jsx(Ae,{action:e.jsx(ps,{card:s}),title:e.jsx(j,{sx:{typography:"subtitle2",opacity:.72},children:"Viabo Card"}),subheader:s==null?void 0:s.register,sx:{p:0}}),e.jsx("div",{children:e.jsx(ns,{card:s})}),e.jsxs(l,{direction:"row",spacing:5,children:[e.jsxs(l,{children:[e.jsx(j,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e.jsx(j,{sx:{typography:"subtitle1"},children:s==null?void 0:s.expiration})]}),e.jsx(xs,{card:s})]})]})}function hs(){return e.jsxs(X,{sx:s=>({color:s.palette.common.white,display:"flex",p:3,flexDirection:"column",justifyContent:"space-between"}),children:[e.jsxs(l,{children:[e.jsx(w,{variant:"text",sx:{width:.3}}),e.jsx(w,{variant:"text",sx:{width:.5}})]}),e.jsx(l,{sx:{py:1.5},children:e.jsx(w,{variant:"text",sx:{width:.9,height:40}})}),e.jsxs(l,{direction:"row",spacing:2,children:[e.jsxs(l,{spacing:.5,children:[e.jsx(w,{variant:"text",sx:{width:100}}),e.jsx(w,{variant:"text",sx:{width:40}})]}),e.jsxs(l,{spacing:.5,children:[e.jsx(w,{variant:"text",sx:{width:100}}),e.jsxs(l,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(w,{variant:"text",sx:{width:40}}),e.jsx(w,{variant:"circular",sx:{width:16,height:16}})]})]})]})]})}function gs({cards:s,emptyMessage:a="No hay tarjetas disponibles en stock",cardComponent:t=ms,...r}){const c=ie("up","xl"),{isCollapse:n}=oe(),[d,f]=g.useState(1),[u,x]=g.useState(""),[i,p]=g.useState([]),{data:o,isLoading:S,isError:y,error:v,isSuccess:k,refetch:b}=s,C=o||[],m=S,h=c?12:9,T=g.useMemo(()=>(u!==""?i:C)||[],[u,C,i]),N=T.length||0,ae=Math.ceil(N/h),B=os(T||[],h),re=(E,R)=>{f(R),B.jump(R)};return g.useEffect(()=>{if(u){const E=is(C,u);p(E)}else p([])},[u,C]),e.jsxs(e.Fragment,{children:[k&&(C==null?void 0:C.length)>0&&e.jsxs(I,{display:"flex",mb:3,flexDirection:{xs:"column",sm:"row"},alignItems:{xs:"center"},...r,children:[e.jsx(I,{children:e.jsx(Te,{fullWidth:!0,size:"small",placeholder:"Buscar ...",value:u,onChange:E=>x(E.target.value),InputProps:{startAdornment:e.jsx(V,{position:"start",children:e.jsx(I,{sx:{color:"text.disabled"},children:e.jsx(we,{sx:{marginTop:1}})})})}})}),e.jsx(I,{sx:{flex:"1 1 auto",mb:{xs:3}}}),e.jsx(Ee,{count:ae,page:d,onChange:re})]}),!m&&k&&C.length===0&&e.jsx(q,{widthImage:"30%",message:a}),!m&&y&&e.jsx(le,{widthImage:"30%",errorMessage:v,handleButton:b}),!y&&e.jsx(I,{mb:3,sx:{display:"grid",gap:3,gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(2, 1fr)",lg:n?"repeat(3, 1fr)":"repeat(2, 1fr)",xl:"repeat(4, 1fr)"}},children:(m?[...Array(h)]:B.currentData()||[]).map((E,R)=>E?g.createElement(t,{card:E,key:R}):e.jsx(hs,{},R))}),C.length>0&&N===0&&e.jsx(q,{widthImage:"30%",message:"No hay tarjetas que coincidan con la búsqueda"})]})}function js({handleAssign:s}){return e.jsx(I,{sx:{marginRight:3},children:e.jsx(J,{title:"Asignar",children:e.jsx(P,{onClick:s,children:e.jsx(Ie,{sx:{color:a=>a.palette.info.main},width:24,height:24})})})})}const F={STOCK_CARDS_LIST:"stockCards",AFFILIATED_COMMERCES_LIST:"affiliatedCommerces"},Cs=s=>{const{cardNumber:a,cardType:t,expiration:r,cvv:c,assigned:n}=s,d=r==null?void 0:r.slice(-2),f=(r==null?void 0:r.slice(0,3))+d,u={cardNumber:a.replace(/\s+/g,""),paymentProcessorId:t==null?void 0:t.value,expirationDate:f,cvv:c,commerceId:(n==null?void 0:n.value)||""};return ce(u)},fs=s=>{const a=(s==null?void 0:s.map(t=>({id:t==null?void 0:t.id,name:t==null?void 0:t.name})))||[];return se(a,"id","name")},bs=async s=>(await D.post("/api/card/new",s),s),Ss=async()=>{const{data:s}=await D.get("/api/commerces/affiliates");return fs(s)},ys=async()=>{const{data:s}=await D.get("/api/cards/stock");return Ze(s)},$s=async s=>{const a=s!=null&&s.cardId?"/api/card/assign/commerce":"/api/cards/assign/commerce",{data:t}=await D.post(a,s);return t},vs=(s={})=>{const a=ke(),t=Re(bs,s);return{...t,registerCard:async(c,n)=>{const{onSuccess:d,onError:f,mutationOptions:u}=n;try{await W.promise(t.mutateAsync(c,u),{pending:"Registrando tarjeta ...",success:{render({data:x}){return a.invalidateQueries([F.STOCK_CARDS_LIST]),d(x),x!=null&&x.isAssigned?"Se agrego una nueva tarjeta al comercio":"Se agrego una nueva tarjeta al stock"}}})}catch(x){const i=M(x,"No se puede agregar la tarjeta al stock");f(i),W.error(i,{type:de(x)})}}}},As=(s={})=>{const{enqueueSnackbar:a}=_(),[t,r]=g.useState(null);return{...O([F.AFFILIATED_COMMERCES_LIST],Ss,{staleTime:60*5e3,onError:n=>{const d=M(n,"No se puede obtener la lista de comercios afiliados");r(d),a(d,{variant:"error",autoHideDuration:5e3})},...s}),error:t||null}},Ts=(s={})=>{const[a,t]=g.useState(null);return{...O([F.STOCK_CARDS_LIST],ys,{staleTime:6e4,onError:c=>{const n=M(c,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");t(n)},...s}),error:a||null}};function ws({setOpen:s}){const{registerCard:a,isLoading:t}=vs(),r=H([F.AFFILIATED_COMMERCES_LIST])||[],c=H([te.CARD_TYPES_LIST])||[],[n,d]=g.useState(!1),f=Q().shape({cardNumber:L().transform((m,h)=>h.replace(/\s/g,"")).min(16,"Debe contener 16 digitos").required("El número de la tarjeta es requerido"),cvv:L().min(3,"Debe contener 3 digitos").required("El CVV es requerido"),cardType:Q().nullable().required("El tipo de tarjeta es requerido"),expiration:L().required("La fecha de vencimiento es requerida").test("is-future-date","La fecha  debe ser mayor que la fecha actual",function(m){const h=De(`01/${m}`,"dd/MM/yyyy",new Date),T=new Date;return K(h)&&_e(h,T)})}),u=$e({initialValues:{cardNumber:"",cardType:c&&c.length>0&&c[0]||null,expiration:"",cvv:"",assigned:null},validationSchema:f,onSubmit:(m,{setSubmitting:h})=>{h(!1),m.assigned?d(!0):C(m)}}),{isSubmitting:x,values:i,setFieldValue:p,errors:o,handleSubmit:S,touched:y,resetForm:v,setSubmitting:k}=u,b=x||t,C=(m,h=!1)=>{const T=Cs(m);a({...T,isAssigned:h},{onSuccess:()=>{s(!1),v(),d(!1)},onError:()=>{d(!1)}})};return e.jsxs(e.Fragment,{children:[e.jsx(ue,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:e.jsx(Je,{formik:u,children:e.jsx(l,{spacing:5,sx:{p:3},children:e.jsxs(l,{spacing:3,children:[e.jsxs(l,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta"}),e.jsx($,{name:"cardType",disableClearable:!0,textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:c,disabled:b})]}),e.jsxs(l,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de Tarjeta"}),e.jsx(Y,{autoFocus:!0,name:"cardNumber",required:!0,placeholder:"5254 2700 9717 8968",fullWidth:!0,InputProps:{startAdornment:e.jsx(V,{position:"start",children:e.jsx(Me,{})}),inputComponent:U,inputProps:{mask:"0000 0000 0000 0000",value:i.cardNumber,onAccept:m=>{p("cardNumber",m)}}},disabled:b})]}),e.jsxs(l,{direction:{xs:"column",lg:"row"},spacing:3,display:"flex",children:[e.jsxs(l,{sx:{width:{xs:"100%",lg:"40%"}},children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"CVV"}),e.jsx(Y,{name:"cvv",required:!0,placeholder:"123",InputProps:{startAdornment:e.jsx(V,{position:"start",children:e.jsx(Pe,{})}),inputComponent:U,inputProps:{mask:"000",onAccept:m=>{p("cvv",m)},value:i.cvv}},disabled:b})]}),e.jsxs(l,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Vence"}),e.jsx(Fe,{disabled:b,views:["year","month"],name:"expiration",value:new Date(i.expiration)??null,onChange:m=>K(m)?u.setFieldValue("expiration",Ne(m,"MM/yyyy")):u.setFieldValue("expiration",""),slotProps:{textField:{fullWidth:!0,error:!!(y.expiration&&o.expiration),required:!0,helperText:y.expiration&&o.expiration?o.expiration:""}},disablePast:!0,format:"MM/yy"})]})]}),e.jsxs(l,{children:[e.jsx(j,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Asignar:"}),e.jsx($,{name:"assigned",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:r,disabled:b})]})]})})})}),e.jsx(l,{sx:{px:3,pt:3},children:e.jsx(ee,{loading:b,variant:"contained",color:"primary",fullWidth:!0,type:"submit",onClick:S,disabled:b,startIcon:e.jsx(Le,{}),children:"Crear"})}),n&&e.jsx(Xe,{title:"Asignar Tarjeta",typeAlert:"warning",textButtonSuccess:"Asignar",onClose:()=>{d(!1),k(!1)},open:n,isSubmitting:t,description:e.jsxs(l,{spacing:2,children:[e.jsx(j,{children:"¿Está seguro de asignar esta tarjeta a este comercio?"}),e.jsxs(l,{direction:"row",alignItems:"center",spacing:1,children:[e.jsx(Ve,{}),e.jsx(j,{variant:"caption",children:"Verifique que todos los datos esten correctos"})]})]}),onSuccess:()=>{C(i,!0)},fullWidth:!0,maxWidth:"xs"})]})}function Es({open:s,setOpen:a}){const{themeDirection:t}=xe(),r=t!=="rtl"?Z({distance:z.BASE_WIDTH,durationIn:.32,durationOut:.32}).inRight:Z({distance:z.BASE_WIDTH,durationIn:.32,durationOut:.32}).inLeft;g.useEffect(()=>{s?document.body.style.overflow="hidden":document.body.style.overflow="unset"},[s]);const c=()=>{a(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{open:s,onClick:c,sx:{background:"transparent",zIndex:n=>n.zIndex.drawer+1}}),e.jsx(Be,{children:s&&e.jsx(e.Fragment,{children:e.jsxs(ss,{...r,children:[e.jsxs(l,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{py:2,pr:1,pl:2.5},children:[e.jsx(j,{variant:"subtitle1",children:"Nueva Tarjeta"}),e.jsx("div",{children:e.jsx(P,{"aria-label":"close",size:"medium",onClick:c,children:e.jsx(qe,{width:20,height:20,fontSize:"inherit",color:"primary"})})})]}),e.jsx(He,{sx:{borderStyle:"dashed"}}),e.jsx(ws,{setOpen:a})]})})})]})}function Is({isLoading:s,cards:a=[]}){const t=A(i=>i.isReadyToAssign),r=A(i=>i.setOpen),c=A(i=>i.setCard),[n,d]=g.useState(null),{enqueueSnackbar:f}=_(),u=[{name:"cardNumberHidden",label:"Tarjeta",options:{customBodyRenderLite:(i,p)=>{const o=a[i];return e.jsx(j,{variant:"subtitle2",fontWeight:"bold",children:o==null?void 0:o.cardNumberHidden})}}},{name:"cardType",label:"Tipo",options:{customBodyRenderLite:(i,p)=>{const o=a[i];return e.jsxs(l,{flexDirection:"row",alignItems:"center",gap:1,children:[e.jsx(ze,{sx:S=>({width:45,height:45,color:S.palette.primary.contrastText,backgroundColor:S.palette.primary.light}),children:(o==null?void 0:o.cardType)==="Carnet"?e.jsx(ts,{sx:{width:30},color:"white"}):e.jsx(as,{sx:{width:30}})}),e.jsx(j,{variant:"subtitle2",children:o==null?void 0:o.cardType})]})}}},{name:"expiration",label:"Vence",options:{filterType:"textField"}},{name:"register",label:"Fecha",options:{filterType:"textField",customBodyRenderLite:(i,p)=>{const o=a[i];return e.jsxs(l,{children:[e.jsx(j,{variant:"subtitle2",children:o==null?void 0:o.registerDate}),e.jsx(j,{variant:"body2",sx:{color:"text.secondary"},children:o==null?void 0:o.registerTime})]})}}}],x=()=>{t?(r(!0),c(n)):(r(!1),f("Por el momento no se puede asignar la tarjeta. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return e.jsx(X,{children:e.jsx(rs,{isLoading:s,data:a||[],columns:u,options:{responsive:"simple",rowHover:!0,selectableRows:"single",selectableRowsOnClick:!0,selectToolbarPlacement:"replace",sortOrder:{name:"register",direction:"desc"},downloadOptions:{filename:"tarjetas_stock.csv",filterOptions:{useDisplayedColumnsOnly:!1}},onRowSelectionChange:(i,p,o)=>{const S=a==null?void 0:a.find((y,v)=>o.includes(v));d(S)},customToolbarSelect:i=>e.jsx(js,{handleAssign:x})}})})}const ks=(s={})=>{const{enqueueSnackbar:a}=_(),[t,r]=g.useState(null);return{...O([te.CARD_TYPES_LIST],us,{staleTime:60*5e3,onError:n=>{const d=M(n,"No se puede obtener la lista de los tipos de tarjeta");r(d),a(d,{variant:"error",autoHideDuration:5e3})},...s}),error:t||null}},Rs=je(g.lazy(()=>Ce(()=>import("./AssignCardModal-v2dIZM16.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))));function Ds(){const[s,a]=g.useState(!1),{data:t,isSuccess:r,isLoading:c}=As(),{data:n,isSuccess:d,isLoading:f}=ks(),u=Ts(),{data:x,isLoading:i}=u,p=A(h=>h.setOpen),o=A(h=>h.setReadyToAssign),S=A(h=>h.open),{enqueueSnackbar:y}=_(),[v,k]=g.useState("1"),b=(h,T)=>{k(T)},C=()=>{t&&n&&d&&r?a(!0):y("Por el momento no se puede crear una tarjeta. Intente nuevamenta o reporte a sistemas",{variant:"warning",autoHideDuration:5e3})},m=()=>{t&&t.length>0&&n&&n.length>0?p(!0):(p(!1),y("Por el momento no se puede asignar tarjetas. No hay comercios disponibles",{variant:"warning",autoHideDuration:5e3}))};return g.useEffect(()=>{t&&t.length>0?o(!0):o(!1)},[t]),e.jsx(pe,{title:"Stock de Tarjetas",children:e.jsxs(ls,{children:[e.jsx(cs,{name:"Stock de Tarjetas",links:[{name:"Inicio",href:me.root},{name:"Administracion",href:he.stock_cards},{name:ge.stock_cards.name}],buttons:e.jsxs(l,{direction:"column",spacing:2,mt:{xs:2,md:0},children:[e.jsxs(l,{spacing:2,direction:{xs:"column",md:"row"},children:[x&&(x==null?void 0:x.length)>0&&e.jsx(We,{sx:{color:"text.primary"},type:"button",color:"secondary",variant:"contained",onClick:m,startIcon:e.jsx(Ke,{}),children:"Asignar Tarjetas"}),e.jsx(ee,{loading:c||f,variant:"contained",onClick:C,startIcon:e.jsx(Ge,{}),children:"Nueva Tarjeta"})]}),e.jsx(l,{alignItems:{xs:"center",md:"flex-end"},children:e.jsxs(Qe,{size:"small",color:"primary",value:v,exclusive:!0,onChange:b,"aria-label":"Platform",children:[e.jsx(G,{value:"1",children:e.jsx(Ye,{})}),e.jsx(G,{value:"2",children:e.jsx(Ue,{})})]})})]})}),v==="2"&&e.jsx(gs,{cards:u}),v==="1"&&e.jsx(Is,{cards:x,isLoading:i}),e.jsx(Es,{open:s,setOpen:a}),S&&e.jsx(Rs,{})]})})}const Zs=Object.freeze(Object.defineProperty({__proto__:null,default:Ds},Symbol.toStringTag,{value:"Module"}));export{F as M,te as S,$s as a,Zs as b};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/js/AssignCardModal-v2dIZM16.js","assets/js/vendor-B39b6gT1.js","assets/js/formik.esm-CRn2DIxC.js","assets/js/index.esm-DHXyn7Aa.js","assets/js/index-Kl2QvVyT.js","assets/css/build-Bl0dWaDY.css","assets/js/RightPanel-2SzQigm1.js","assets/js/CardNumber-D286Rpmx.js","assets/js/CarnetLogo-CXbiBg5q.js","assets/js/MasterCardLogo-VWsSONZB.js","assets/js/formatNumber-Byfz8vD2.js","assets/js/TextMaxLine-BvJpBV6_.js","assets/js/formatTime-DnNoLFDr.js","assets/js/matchTypes-E5vQDj-t.js","assets/js/UploadSingleFile-BV6pleIy.js","assets/js/fade-CViozI82.js","assets/js/transition-anLY3gj9.js","assets/js/RFSelect-CCRetmrq.js","assets/js/ModalAlert-DU1WX_NF.js","assets/js/cardsAdapter-jvJTR5hj.js","assets/js/MaterialDataTable-BLrn9vSy.js","assets/js/filterSearch-NGUmCbyG.js","assets/js/usePagination-Bk1liHqP.js","assets/js/HeaderPage-CoeRaeoE.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=StockCards-BIFSZMD1.js.map
