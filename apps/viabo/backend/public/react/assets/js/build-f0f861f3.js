import{y as Z,j as r,r as f,a2 as J,B as K,S as i,T as P,p as j,G as V,U as Q,cA as X,C as u}from"./index-66cb75df.js";import{u as Y,b as _}from"./build-bd32fad9.js";import{c as b,d as O,a as rr}from"./build-66bff701.js";import{u as tr}from"./build-30d083c3.js";import{F as sr,M as ar}from"./build-8a357111.js";import{R as er}from"./build-4b21fb59.js";import{R as M}from"./build-f0053943.js";import{A as or}from"./build-f58640b5.js";import{C as nr}from"./build-6d8fb990.js";import{A as ir}from"./build-eac4d59e.js";import"./build-2e8706bc.js";import"./build-cb9d33cb.js";import"./build-6421e956.js";import"./build-bee6630b.js";import"./build-9d3fe41c.js";import"./build-1340cc8b.js";import"./build-33d27e57.js";import"./build-e4623447.js";import"./build-722d29d2.js";import"./build-2883e9ba.js";import"./build-708407b9.js";import"./build-1ee72508.js";import"./build-8fb582f0.js";import"./build-b463c8f6.js";import"./build-7226c475.js";import"./build-27a4b8f9.js";import"./build-a6202e80.js";import"./build-0e88a906.js";import"./build-ac9daf3f.js";import"./build-888818c8.js";import"./build-e41c3de6.js";import"./build-9d6bf1da.js";import"./build-05abe1bc.js";import"./build-fa44b97f.js";import"./build-23c3baee.js";import"./build-e5470816.js";import"./build-906e76fb.js";import"./build-1f27af78.js";import"./build-8268194d.js";import"./build-4c6c54ad.js";import"./build-7b5d6586.js";const lr=Z(r.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");function cr({cards:U,setCurrentBalance:E,insufficient:g,isBinCard:l,onSuccess:N}){const y=f.useRef(null),B=window.crypto||window.msCrypto,G=new Uint32Array(1),S=B.getRandomValues(G)[0],[x,v]=f.useState(U),a=tr(s=>s==null?void 0:s.selectedCards),H=b().shape({transactions:O().of(b().shape({amount:rr().required("La cantidad es requerida"),card:b().nullable().required("La tarjeta es requerida")}))}),w=Y({initialValues:{transactions:(a==null?void 0:a.length)>0&&l&&(a==null?void 0:a.map(s=>({id:Math.random(),card:{value:s==null?void 0:s.value,label:s==null?void 0:s.label,...s},amount:"",concept:""})))||[{id:S,card:null,amount:"",concept:""}]},validationSchema:H,onSubmit:s=>g?A(!1):(A(!1),N(s))}),{isSubmitting:L,setFieldValue:F,values:c,setSubmitting:A}=w,p=L;return f.useEffect(()=>{if(a&&l){const s=a==null?void 0:a.map(t=>({...t,isDisabled:!0}));v(s)}},[a,l]),f.useEffect(()=>{var e;const t=((e=c.transactions)==null?void 0:e.reduce((m,d)=>{const h=d.amount.trim()!==""?parseFloat(d.amount.replace(/,/g,"")):0;return isNaN(h)?m:m+h},0)).toFixed(2);E(t)},[c.transactions]),r.jsx(r.Fragment,{children:r.jsx(J,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:r.jsx(sr,{formik:w,children:r.jsxs(K,{sx:{p:3},children:[r.jsxs(i,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:"center",mb:3,children:[r.jsx(P,{variant:"subtitle1",sx:{color:"text.disabled"},children:"Transacciones:"}),r.jsx(i,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1}}),!l&&r.jsx(j,{type:"button",size:"small",variant:"outlined",startIcon:r.jsx(or,{}),disabled:p,onClick:()=>y.current.push({id:S,card:null,amount:"",concept:""}),sx:{flexShrink:0},children:"Nueva"})]}),r.jsx(_,{name:"transactions",render:s=>(y.current=s,r.jsx(i,{divider:r.jsx(V,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:c==null?void 0:c.transactions.map((t,e)=>{var I,C,R,T,k,D;const m=`transactions[${e}].card`,d=`transactions[${e}].amount`,h=`transactions[${e}].concept`;return r.jsxs(i,{alignItems:"flex-end",spacing:1.5,children:[((C=(I=t==null?void 0:t.card)==null?void 0:I.assignUser)==null?void 0:C.name)&&r.jsx(nr,{avatar:r.jsx(Q,{...X(((T=(R=t==null?void 0:t.card)==null?void 0:R.assignUser)==null?void 0:T.name)??"")}),label:(D=(k=t==null?void 0:t.card)==null?void 0:k.assignUser)==null?void 0:D.name}),r.jsxs(i,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},alignItems:"flex-start",children:[r.jsx(P,{variant:"overline",color:"text.disabled",children:e+1}),r.jsx(er,{name:m,disabled:p||l,textFieldParams:{placeholder:"Seleccionar ...",label:"Tarjeta",required:!0,size:"small"},options:x||[],onChange:($,o)=>{const W=x==null?void 0:x.map(n=>{var q,z;return!(o!=null&&o.value)&&n.value===((q=t==null?void 0:t.card)==null?void 0:q.value)?{...n,isDisabled:!1}:n.value===(o==null?void 0:o.value)?{...n,isDisabled:!0}:n.value===((z=t==null?void 0:t.card)==null?void 0:z.value)?{...n,isDisabled:!1}:n});v(W),F(m,o)},sx:{width:{xs:1,lg:.6}}}),r.jsx(M,{sx:{width:{xs:1,lg:.4}},size:"small",name:d,required:!0,label:"Cantidad",placeholder:"0.00",disabled:p,autoComplete:"off",InputProps:{startAdornment:r.jsx("span",{style:{marginRight:"5px"},children:"$"}),inputComponent:ar,inputProps:{mask:Number,radix:".",thousandsSeparator:",",padFractionalZeros:!0,min:0,max:5e4,scale:2,value:t.amount,onAccept:$=>{F(d,$)}}}})]}),r.jsx(i,{sx:{width:1},children:r.jsx(M,{name:h,multiline:!0,disabled:p,rows:2,label:"Concepto",placeholder:"Transferencia .."})}),e!==0&&!l&&r.jsx(j,{size:"small",color:"error",disabled:p,startIcon:r.jsx(lr,{}),onClick:()=>s.remove(e),children:"Borrar"})]},t.id)})}))}),r.jsx(V,{sx:{my:3,borderStyle:"dashed"}}),r.jsx(i,{sx:{pt:3},children:r.jsx(j,{variant:"outlined",color:"primary",disabled:g,fullWidth:!0,type:"submit",startIcon:r.jsx(ir,{}),children:"Siguiente"})})]})})})})}cr.propTypes={cards:u.any,insufficient:u.any,isBinCard:u.any,onSuccess:u.func,setCurrentBalance:u.func};export{cr as default};
