import{z as bs,j as s,C as K,r as u,_ as q,O as d,S as f,T as M,m as N,aP as Is,p as Es,L as os,aj as Ts,I as Ss,V as Ps,W as ws,B as V,E as Rs,G as W,K as X,ai as Q,d as J,g as Z,Q as G,b as m,H as ns,J as as,Y as Ds,N as H,P as Fs,ab as Os}from"./index-346c4534.js";import{a as _s}from"./build-b25654fe.js";import{f as j}from"./build-cb0e7475.js";import"./build-429ae8b4.js";import{u as Y,M as As,L as Bs,F as Ls}from"./build-7d848a9e.js";import{R as Ws}from"./build-ddb49d56.js";import{C as ks}from"./build-c4e15452.js";import{g as Gs,B as zs,a as $s}from"./build-a7e8e7cb.js";import{C as v}from"./build-ee9a7afc.js";import{C as ls}from"./build-5c8ea86c.js";import{C as cs}from"./build-ee11d05a.js";import{D as ss}from"./build-643b05e8.js";import{g as ps}from"./build-a20336ff.js";import{f as Hs,a as Ns,H as Vs}from"./build-40e523c6.js";import{a as Ks}from"./build-45178a4b.js";import{A as qs}from"./build-6cc29a6e.js";import{s as Us,a as Xs}from"./build-fe9707dc.js";import{g as Ys}from"./build-5932c69a.js";import{M as Qs}from"./build-6a6f2775.js";import{u as Js}from"./build-08002593.js";import"./build-2fcf14dd.js";import"./build-9177a231.js";import"./build-e96dcb11.js";import"./build-5eec7cc5.js";import"./build-737c64c4.js";import"./build-1db93dc8.js";import"./build-31883e00.js";import"./build-2a2c9560.js";import"./build-e9361a90.js";import"./build-6435c1fd.js";import"./build-f149ac76.js";import"./build-cf621495.js";import"./build-ef13f1ba.js";import"./build-c0c04b6b.js";import"./build-fe827404.js";import"./build-d933afe7.js";import"./build-4fa429fc.js";import"./build-f38e29d0.js";import"./build-515c977a.js";import"./build-905506d5.js";import"./build-24563a1e.js";import"./build-f0d75a0c.js";import"./build-bee6630b.js";import"./build-6471b759.js";import"./build-83d17a75.js";import"./build-899176f2.js";import"./build-f8f5ccb1.js";const ds=bs(s.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update"),Zs=K(u.lazy(()=>q(()=>import("./build-a5c0e1cd.js"),["assets/js/build-a5c0e1cd.js","assets/js/index-346c4534.js","assets/css/build-c23c9e36.css","assets/js/build-31883e00.js","assets/js/build-737c64c4.js","assets/js/build-7d848a9e.js","assets/js/build-e96dcb11.js","assets/js/build-a7e8e7cb.js","assets/js/build-40e523c6.js","assets/js/build-9177a231.js","assets/js/build-24563a1e.js","assets/js/build-f149ac76.js","assets/js/build-515c977a.js","assets/js/build-905506d5.js","assets/js/build-5eec7cc5.js","assets/js/build-6cc29a6e.js","assets/js/build-bee6630b.js","assets/js/build-cb0e7475.js","assets/js/build-1db93dc8.js","assets/js/build-2a2c9560.js","assets/js/build-e9361a90.js","assets/js/build-6435c1fd.js","assets/js/build-cf621495.js","assets/js/build-6a6f2775.js","assets/js/build-f8f5ccb1.js","assets/js/build-6471b759.js","assets/js/build-a20336ff.js","assets/js/build-4fa429fc.js","assets/js/build-ef13f1ba.js","assets/js/build-45178a4b.js","assets/js/build-f0d75a0c.js","assets/js/build-c0c04b6b.js","assets/js/build-b25654fe.js","assets/js/build-ee9a7afc.js","assets/js/build-2fcf14dd.js","assets/js/build-429ae8b4.js","assets/js/build-fe827404.js","assets/js/build-d933afe7.js","assets/js/build-ee11d05a.js","assets/js/build-f38e29d0.js","assets/js/build-a08d8e48.js"]))),ms=K(u.lazy(()=>q(()=>import("./build-3e44052f.js"),["assets/js/build-3e44052f.js","assets/js/index-346c4534.js","assets/css/build-c23c9e36.css","assets/js/build-a20336ff.js","assets/js/build-6435c1fd.js","assets/js/build-9177a231.js","assets/js/build-4fa429fc.js","assets/js/build-cb0e7475.js","assets/js/build-c7ce8ef2.js","assets/js/build-ef13f1ba.js","assets/js/build-45178a4b.js","assets/js/build-40e523c6.js","assets/js/build-24563a1e.js","assets/js/build-f149ac76.js","assets/js/build-f0d75a0c.js","assets/js/build-c0c04b6b.js","assets/js/build-6a6f2775.js","assets/js/build-f8f5ccb1.js","assets/js/build-e9361a90.js","assets/js/build-6471b759.js","assets/js/build-2a2c9560.js","assets/js/build-694e69f9.js"]))),us=({open:r,setOpen:a,card:t,cardList:o=[]})=>{const[i,n]=u.useState(0),h=u.useMemo(()=>t==null?void 0:t.balance,[t==null?void 0:t.balance]),[e,g]=u.useState(!1),[P,x]=u.useState(null),[b,D]=u.useState(!1),p=u.useMemo(()=>(parseFloat(h)-i).toFixed(2)<0,[i,h]),T=()=>{a(!1),n(0),g(!1),x(null),D(!1)},_=R=>{const U=t==null?void 0:t.id;x({cardOriginId:U,isGlobal:!1,transactions:(R==null?void 0:R.transactions)||[],concept:R==null?void 0:R.concept,balance:h,currentBalance:i}),g(!0)},I=()=>{g(!1)},F=s.jsx(s.Fragment,{children:s.jsx(M,{variant:"h6",children:"Fondear Tarjetas"})}),A=s.jsxs(s.Fragment,{children:[s.jsxs(f,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",spacing:0,px:3,pt:2,children:[s.jsx(M,{variant:"subtitle1",children:"Saldo"}),s.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(M,{variant:"h3",color:"success.main",children:j(h)}),s.jsx(M,{variant:"caption",color:"success.main",children:"MXN"})]}),s.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[s.jsxs(M,{variant:"subtitle1",color:"error",children:["- ",j(i)]}),s.jsx(M,{variant:"caption",color:"error",children:"MXN"})]}),p&&s.jsx(M,{variant:"caption",color:"warning.main",textAlign:"center",children:"Saldo insuficiente para realizar la(s) operacion(es)"})]}),s.jsx(Zs,{cards:o,setCurrentBalance:n,insufficient:p,isBinCard:!1,onSuccess:_})]});return s.jsx(_s,{open:r,handleClose:T,titleElement:F,children:r&&s.jsxs(s.Fragment,{children:[s.jsx(N.div,{initial:{opacity:1},animate:{opacity:e?0:1},transition:{duration:.5},style:{display:e?"none":"flex",flex:1,overflow:"hidden",flexDirection:"column"},children:A}),s.jsx(N.div,{initial:{opacity:0},animate:{opacity:e?1:0},transition:{duration:.5},style:{display:e?"flex":"none",flexDirection:"column",flex:1,overflow:"hidden"},children:s.jsx(ms,{data:P,onBack:I,setTransactionLoading:D,transactionLoading:b,onClose:T})})]})})};us.propTypes={card:d.shape({balance:d.any,id:d.any}),cardList:d.array,open:d.any,setOpen:d.func};function hs({isRefetchingCards:r,commerceCards:a,card:t}){const{isCollapse:o}=Is(),i=Y(g=>g.setOpenFundingOrder),n=Y(g=>g.setFundingCard),[h,e]=u.useState(!1);return s.jsxs(s.Fragment,{children:[s.jsxs(f,{px:2,py:1,gap:1,flexDirection:{lg:o?"row":"column",xl:"row"},justifyContent:"space-between",children:[s.jsx(Es,{color:"primary",variant:"text",startIcon:s.jsx(Ws,{}),size:"small",onClick:()=>{i(!0),n(t)},children:"Orden Fondeo"}),s.jsx(os,{size:"small",variant:"text",color:"primary",startIcon:s.jsx(ks,{}),loading:r,onClick:()=>{e(!0)},children:"Fondear Tarjetas"})]}),s.jsx(us,{setOpen:e,open:h,card:t,cardList:a})]})}hs.propTypes={card:d.any,commerceCards:d.any,isRefetchingCards:d.any};const vs={card:null,isMaster:!0,movements:[],balanceMovements:"$0.00",income:"$0.00",expenses:"$0.00",expensesWithInvoice:"$0.00",expensesWithoutInvoice:"$0.00",expensesWithoutChecked:"$0.00",totalExpensesOtherCharges:"$0.00",filterPaymentProcessor:null,filterDate:null},se=(r,a)=>({...vs,setGlobalCard:t=>{a(),r(o=>({card:t}),!1,"SET_GLOBAL_CARD")},resetGlobalCard:()=>{r(t=>({card:null}),!1,"RESET_GLOBAL_CARD")},setIsMaster:t=>{r(o=>({isMaster:t}),!1,"SET_IS_MASTER")},setMovements:t=>{r(o=>({movements:(t==null?void 0:t.movements)||[],balanceMovements:(t==null?void 0:t.balanceMovements)||"$0.00",expenses:(t==null?void 0:t.expenses)||"$0.00",income:(t==null?void 0:t.income)||"$0.00",expensesWithInvoice:(t==null?void 0:t.expensesWithInvoice)||"$0.00",expensesWithoutInvoice:(t==null?void 0:t.expensesWithoutInvoice)||"$0.00",expensesWithoutChecked:(t==null?void 0:t.expensesWithoutChecked)||"$0.00",totalExpensesOtherCharges:(t==null?void 0:t.totalExpensesOtherCharges)||"$0.00"}),!1,"SET_MASTER_MOVEMENTS")},getBalance:()=>{const{balanceMovements:t,income:o,expenses:i,expensesWithInvoice:n,expensesWithoutInvoice:h,expensesWithoutChecked:e,totalExpensesOtherCharges:g}=a();return{balanceMovements:t,income:o,expenses:i,expensesWithInvoice:n,expensesWithoutInvoice:h,expensesWithoutChecked:e,totalExpensesOtherCharges:g}},setFilterPaymentProcessor:t=>{r(o=>({filterPaymentProcessor:t}),!1,"SET_FILTER_PAYMENT_PROCESSOR")},setFilterDate:t=>{r(o=>({filterDate:t}),!1,"SET_FILTER_DATE")}}),O=Ts(se),xs=({card:r,cardSelected:a,isRefetchingCards:t,commerceCards:o,disableFilter:i=!1})=>{const[n,h]=u.useState(!1),e=Gs(r==null?void 0:r.paymentProcessor),g=e==null?void 0:e.component,P=(a==null?void 0:a.id)===(r==null?void 0:r.id),{setGlobalCard:x,setIsMaster:b,setFilterPaymentProcessor:D}=O(I=>I),p=u.useMemo(()=>o&&o[r==null?void 0:r.paymentProcessorId]||[],[o]),T=(p==null?void 0:p.length)||0,_=I=>F=>{i||(D(I==null?void 0:I.paymentProcessor),b(!1),x(I))};return s.jsx(f,{children:s.jsxs(v,{sx:{minWidth:{xs:300,md:"auto"},border:P?3:0,borderColor:I=>P?I.palette.mode==="dark"?I.palette.secondary.main:I.palette.primary.main:"inherit"},children:[s.jsx(ls,{title:s.jsxs(f,{flexDirection:"row",gap:1,alignItems:"center",justifyContent:"space-between",children:[s.jsx(M,{variant:"caption",children:T===0?"":T+" Tarjetas"}),s.jsxs(f,{flexDirection:"row",alignItems:"center",sx:{flexWrap:"wrap"},gap:1,children:[e&&s.jsx(g,{sx:{width:30,height:30}}),s.jsx(Ss,{variant:"outlined",title:`Copiar SPEI - ${r==null?void 0:r.SPEI}`,color:n?"success":"inherit",onClick:I=>{h(!0),Ps(r==null?void 0:r.SPEI),setTimeout(()=>{h(!1)},1e3)},children:n?s.jsx(cs,{sx:{color:"success",width:25,height:25}}):s.jsx(ws,{sx:{width:25,height:25}})})]})]}),sx:{px:2,py:2}}),s.jsx(V,{component:i?"div":N.div,onClick:_(r),...i?{}:{whileTap:{scale:.8},style:{cursor:"pointer"}},children:s.jsxs(f,{alignItems:"center",pb:2,px:2,children:[s.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(M,{variant:"h6",children:r==null?void 0:r.balanceFormatted}),s.jsx(M,{variant:"caption",children:"MXN"})]}),s.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(ds,{sx:{width:20,height:20,color:"text.secondary"}}),s.jsxs(f,{alignItems:"center",children:[s.jsx(M,{variant:"subtitle2",children:"En transito"}),s.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(M,{variant:"body2",children:r==null?void 0:r.inTransitFormatted}),s.jsx(M,{variant:"caption",children:"MXN"})]})]})]})]})}),s.jsx(Rs,{sx:{borderStyle:"dashed"}}),s.jsx(hs,{isRefetchingCards:t,commerceCards:p,card:r})]})},r==null?void 0:r.cardId)};xs.propTypes={card:d.shape({SPEI:d.any,balanceFormatted:d.any,cardId:d.any,id:d.any,inTransitFormatted:d.any,paymentProcessor:d.any,paymentProcessorId:d.any,spei:d.any}),cardSelected:d.shape({id:d.any}),commerceCards:d.any,disableFilter:d.bool,isRefetchingCards:d.any};const ee={"MASTER CARD":"1",MASTERCARD:"1",CARNET:"2"},re=r=>{const a=ps(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);let t=0,o=0;const i=a==null?void 0:a.map(n=>{var h;return t+=parseFloat(n==null?void 0:n.balance),o+=parseFloat(n==null?void 0:n.inTransit),{...n,paymentProcessorId:ee[(h=n==null?void 0:n.paymentProcessor)==null?void 0:h.toUpperCase()]??null,id:n==null?void 0:n.cardId,SPEI:n==null?void 0:n.spei,balanceFormatted:j(n==null?void 0:n.balance),inTransitFormatted:j(n==null?void 0:n.inTransit)}});return{master:{balance:t,inTransit:o,balanceFormatted:j(t),inTransitFormatted:j(o)},globals:i}},te=r=>{const a=ps(r==null?void 0:r.ciphertext,r==null?void 0:r.iv);let t=0,o=0,i=0,n=0,h=0;return{movements:(a==null?void 0:a.map(e=>{var _,I,F;const g=parseFloat((e==null?void 0:e.amount)||"0");(e==null?void 0:e.type.toLowerCase())==="gasto"&&(t+=g),(e==null?void 0:e.type.toLowerCase())==="ingreso"&&(o+=g);const P=e!=null&&e.receiptFiles?(_=e==null?void 0:e.receiptFiles)==null?void 0:_.split(","):[],x=P==null?void 0:P.reduce((A,R)=>(R.endsWith(".xml")?A.xml=R:R.endsWith(".pdf")&&(A.pdf=R),A),{xml:null,pdf:null}),b=(x==null?void 0:x.xml)!==null&&(x==null?void 0:x.pdf)!==null,D=e!=null&&e.date?W(new Date(e==null?void 0:e.date),"dd MMM yyyy",{locale:X}):"",p=e!=null&&e.date?W(new Date(e==null?void 0:e.date),"p"):"",T=((I=e==null?void 0:e.operationType)==null?void 0:I.toLowerCase())==="otros cargos";return T&&(e!=null&&e.checked)&&b&&(n+=g),T&&(e!=null&&e.checked)&&!b&&(i+=g),T&&!(e!=null&&e.checked)&&(h+=g),{id:e==null?void 0:e.transactionId,fullDate:Hs(e==null?void 0:e.date),date:D,time:p,serverDate:e==null?void 0:e.date,description:e==null?void 0:e.description,amount:g,amountFormat:j(g),paymentProcessor:e==null?void 0:e.cardPaymentProcessor,type:e==null?void 0:e.type.toLowerCase(),operationType:(F=e==null?void 0:e.operationType)==null?void 0:F.toUpperCase(),concept:(e==null?void 0:e.concept)??"",cardId:e==null?void 0:e.cardId,commerceId:e==null?void 0:e.cardCommerceId,verified:!!(e!=null&&e.checked),isMainCard:!!(e!=null&&e.cardMain),expensesControl:{id:e==null?void 0:e.receiptId,isInvoice:b,invoiceFiles:x,otherFiles:b?[]:P},original:e}}))??[],income:j(o),expenses:j(t),balanceMovements:j(o-t),expensesWithInvoice:j(n),expensesWithoutInvoice:j(i),expensesWithoutChecked:j(h),totalExpensesOtherCharges:j(n+i+h)}},ie=async()=>{const{data:r}=await Q.get("/api/main-cards/information");return re(r)},ne=async(r,a,t)=>{const o=new URL("/api/master-cards/movements",window.location.origin);o.searchParams.set("startDate",r),o.searchParams.set("endDate",a);const{data:i}=await Q.get(o.href);return te(i)},ae=async r=>{const a={},t=r.map(o=>Q.get(`/api/enabled-cards/commerce?paymentProcessorId=${o}`).then(i=>Ks(i.data)).then(i=>{a[o]=i}));return await Promise.all(t),a},oe=(r,a={})=>{const[t,o]=u.useState(null),i=J({queryKey:[ss.COMMERCE_CARDS],queryFn:({signal:n})=>ae(r),staleTime:6e4,...a});return u.useEffect(()=>{if(i!=null&&i.isError){const n=Z(i.error,"No se puede obtener la lista de tarjetas del comercio. Intente nuevamente o reporte a sistemas");o(n),G.error(n,{type:m(i.error)})}},[i.isError,i.error]),{...i,error:t||null}},le=(r={})=>{const[a,t]=u.useState(null),o=Y(n=>n.setMainCard);return{...J([ss.GLOBAL_CARDS],ie,{staleTime:6e4,refetchOnWindowFocus:!1,onError:n=>{const h=Z(n,"No se puede obtener la informacion de las tarjetas principales");t(h),o(null),G.error(h,{type:m(n)})},onSuccess:n=>{o(n)},...r}),error:a||null}},ce=(r,a,t={})=>{if(!r||!a)return null;const o=W(ns(r),"yyyy-MM-dd"),i=W(as(a),"yyyy-MM-dd"),[n,h]=u.useState(null),{setMovements:e,setFilterDate:g}=O(x=>x);return{...J([ss.MOVEMENTS],({signal:x})=>ne(o,i),{staleTime:6e4,retry:!1,refetchOnWindowFocus:!1,onError:x=>{const b=Z(x,"No se puede obtener la lista de movimientos. Intente nuevamente o reporte a sistemas");h(b),G.error(b,{type:m(x)}),e(null)},onSuccess:x=>{g({startDate:ns(r),endDate:as(a),text:`${W(r,"dd MMMM yyyy",{locale:X})} - ${W(a,"dd MMMM yyyy",{locale:X})}`})},...t}),error:n||null}};function ys({data:r,isLoading:a}){var D;const t=O(p=>p.card),o=O(p=>p.resetGlobalCard),i=O(p=>p.setIsMaster),n=O(p=>p.setFilterPaymentProcessor),h=O(p=>p.isMaster),e=u.useMemo(()=>{var p;return((p=r==null?void 0:r.globals)==null?void 0:p.reduce((T,_)=>(T.push(_.paymentProcessorId),T),[]))||null},[r==null?void 0:r.globals]),{data:g,isRefetching:P}=oe(e,{enabled:!!e}),x=r==null?void 0:r.master,b=r==null?void 0:r.globals;return s.jsx(qs,{children:s.jsxs(f,{spacing:2,flex:1,children:[a&&s.jsx(Ds,{}),!a&&s.jsxs(s.Fragment,{children:[((D=r==null?void 0:r.globals)==null?void 0:D.length)>1&&s.jsx(N.div,{onClick:()=>{i(!0),o(),n(null)},whileHover:{scale:1.03},whileTap:{scale:.8},children:s.jsxs(v,{sx:{p:0,cursor:"pointer",border:h?3:0,borderColor:p=>h?p.palette.mode==="dark"?p.palette.secondary.main:p.palette.primary.main:"inherit"},children:[s.jsx(ls,{title:s.jsx(f,{flexDirection:"row",gap:1,alignItems:"center",children:s.jsx(M,{variant:"subtitle2",children:"Global [Master]"})}),sx:{px:2,py:2}}),s.jsxs(f,{alignItems:"center",pb:2,px:2,children:[s.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(M,{variant:"h3",children:x==null?void 0:x.balanceFormatted}),s.jsx(M,{variant:"caption",children:"MXN"})]}),s.jsxs(f,{direction:"row",alignItems:"center",spacing:1,children:[s.jsx(ds,{sx:{width:30,height:30,color:"text.secondary"}}),s.jsxs(f,{alignItems:"center",children:[s.jsx(M,{variant:"subtitle2",children:"En transito"}),s.jsxs(f,{direction:"row",spacing:1,alignItems:"center",children:[s.jsx(M,{variant:"body1",children:x==null?void 0:x.inTransitFormatted}),s.jsx(M,{variant:"caption",children:"MXN"})]})]})]})]})]})}),b==null?void 0:b.map(p=>{var T;return s.jsx(xs,{card:p,cardSelected:t,isRefetchingCards:P,commerceCards:g,disableFilter:((T=r==null?void 0:r.globals)==null?void 0:T.length)<=1},p==null?void 0:p.id)})]})]})})}ys.propTypes={data:d.shape({globals:d.array,master:d.shape({balanceFormatted:d.any,inTransitFormatted:d.any})}),isLoading:d.any};const pe=K(u.lazy(()=>q(()=>import("./build-2184f786.js"),["assets/js/build-2184f786.js","assets/js/index-346c4534.js","assets/css/build-c23c9e36.css","assets/js/build-b25654fe.js","assets/js/build-ee9a7afc.js","assets/js/build-2fcf14dd.js","assets/js/build-429ae8b4.js"]))),de=K(u.lazy(()=>q(()=>import("./build-829df8ab.js"),["assets/js/build-829df8ab.js","assets/js/index-346c4534.js","assets/css/build-c23c9e36.css","assets/js/build-b25654fe.js","assets/js/build-ee9a7afc.js","assets/js/build-2fcf14dd.js","assets/js/build-429ae8b4.js","assets/js/build-6435c1fd.js","assets/js/build-9177a231.js","assets/js/build-6a6f2775.js","assets/js/build-f8f5ccb1.js","assets/js/build-e9361a90.js","assets/js/build-40e523c6.js","assets/js/build-24563a1e.js","assets/js/build-f149ac76.js","assets/js/build-6471b759.js","assets/js/build-a20336ff.js","assets/js/build-4fa429fc.js","assets/js/build-cb0e7475.js","assets/js/build-2a2c9560.js"])));function ue(){var es;const r=new Date,a=O(y=>y.filterPaymentProcessor),{setMovements:t,getBalance:o}=O(y=>y),i=O(y=>y.filterDate),n=O(y=>y.movements),h=u.useMemo(()=>i!=null&&i.startDate?new Date(i==null?void 0:i.startDate):Us(r,{days:30}),[i==null?void 0:i.startDate]),e=u.useMemo(()=>i!=null&&i.endDate?new Date(i==null?void 0:i.endDate):r,[i==null?void 0:i.endDate]),g=u.useMemo(()=>o(),[n]),[P,x]=u.useState(h),[b,D]=u.useState(e),[p,T]=u.useState(!1),[_,I]=u.useState(!1),{data:F,isError:A,isLoading:R,isFetching:z,error:U,refetch:gs}=ce(P,b);u.useEffect(()=>{P&&b&&gs()},[P,b]),u.useEffect(()=>{var y;if(a){let E=0,C=0,c=0,w=0,S=0;const $=(y=F==null?void 0:F.movements)==null?void 0:y.filter(l=>{var L;return((L=l==null?void 0:l.paymentProcessor)==null?void 0:L.toLowerCase())===(a==null?void 0:a.toLowerCase())});$==null||$.forEach(l=>{var rs,ts,is;(l==null?void 0:l.type.toLowerCase())==="gasto"?E+=l==null?void 0:l.amount:C+=l==null?void 0:l.amount;const L=((rs=l==null?void 0:l.operationType)==null?void 0:rs.toLowerCase())==="otros cargos";L&&(l!=null&&l.verified)&&((ts=l==null?void 0:l.expensesControl)!=null&&ts.isInvoice)&&(w+=l==null?void 0:l.amount),L&&(l!=null&&l.verified)&&!((is=l==null?void 0:l.expensesControl)!=null&&is.isInvoice)&&(c+=l==null?void 0:l.amount),L&&!(l!=null&&l.verified)&&(S+=l==null?void 0:l.amount)}),t({movements:$,income:j(C),expenses:j(E),balanceMovements:j(C-E),expensesWithInvoice:j(w),expensesWithoutInvoice:j(c),expensesWithoutChecked:j(S),totalExpensesOtherCharges:j(w+c+S)})}else t(F)},[a,F]);const fs=y=>{const{startDate:E,endDate:C}=y;C!==null&&E!==null&&(D(C),x(E))},Cs=y=>()=>{var w;const E=((w=y==null?void 0:y.getSelectedRowModel().flatRows)==null?void 0:w.map(S=>S.original))??[],C=E==null?void 0:E.some(S=>S==null?void 0:S.verified),c=E==null?void 0:E.some(S=>(S==null?void 0:S.operationType)!=="OTROS CARGOS");return C?G.warn("Existen movimientos que ya se encuentran comprobados, verifique los movimientos seleccionados."):c?G.warn("Existen movimientos que no se pueden comprobar, verifique el tipo de movimiento."):T(!0)},js=u.useMemo(()=>[{accessorKey:"description",header:"Movimiento",enableHiding:!1,size:200,Cell:({cell:y,column:E,row:C})=>{const{original:c}=C;return s.jsx(As,{row:c})}},{accessorKey:"serverDate",header:"Fecha",size:120,Cell:({cell:y,column:E,row:C})=>{const{original:c}=C;return s.jsx(f,{children:s.jsx(M,{variant:"subtitle2",children:c==null?void 0:c.fullDate})})}},{accessorKey:"operationType",header:"Tipo",filterVariant:"multi-select",size:100,Cell:({cell:y,column:E,row:C})=>{const{original:c}=C,w=Ys(c==null?void 0:c.operationType),S=w==null?void 0:w.component;return s.jsx(V,{children:w?s.jsx(S,{sx:{width:25,height:25}}):s.jsx(Bs,{size:22})})}},{accessorKey:"amount",header:"Monto",size:100,Cell:({cell:y,column:E,row:C})=>{const{original:c}=C,w=(c==null?void 0:c.type)==="ingreso",S=(c==null?void 0:c.type)==="terminal";return s.jsx(M,{variant:"subtitle2",fontWeight:"bold",color:w||S?"success.main":"error",children:w||S?`+ ${c==null?void 0:c.amountFormat}`:`- ${c==null?void 0:c.amountFormat}`})}},{accessorKey:"verified",header:"Comprobación",size:100,Cell:({cell:y,column:E,row:C})=>{const{original:c}=C;return s.jsx(f,{flexDirection:"row",width:1,justifyContent:"center",alignItems:"center",gap:1,mr:2,color:"primary",children:c!=null&&c.verified?s.jsx(zs,{color:"green",fontWeight:"bold",fontSize:"18px"}):s.jsx($s,{fontSize:"18px",color:"red"})})}}],[]),B=Js(A,U,{columns:js,data:n||[],enableColumnPinning:!0,enableColumnFilterModes:!0,enableStickyHeader:!0,enableRowVirtualization:!0,enableFacetedValues:!0,enableRowActions:!0,enableRowSelection:!0,enableDensityToggle:!1,positionActionsColumn:"last",selectAllMode:"all",initialState:{density:"compact",sorting:[{id:"serverDate",desc:!0}]},state:{isLoading:R,showAlertBanner:A,showProgressBars:z},displayColumnDefOptions:{"mrt-row-select":{maxSize:10},"mrt-row-actions":{header:"Acciones",maxSize:80}},muiTableContainerProps:{sx:{maxHeight:{md:"350px",lg:"450px",xl:"700px"}}},renderTopToolbarCustomActions:({table:y})=>s.jsx(V,{sx:{display:"flex",gap:"1rem"},children:s.jsx(os,{loading:z,onClick:Cs(y),disabled:Ms(),startIcon:s.jsx(cs,{width:24,height:24}),variant:"outlined",children:"Comprobar"})}),renderRowActionMenuItems:({row:y})=>[s.jsx(H,{onClick:()=>console.info("conciliation"),children:"Conciliación"},"conciliation"),s.jsx(H,{onClick:()=>console.info("incidence"),children:"Incidencia"},"incidence"),s.jsx(H,{onClick:()=>console.info("communication"),children:"Comunicación"},"communication"),s.jsx(H,{onClick:()=>console.info("tag"),children:"Tag"},"tag")]}),k=((es=B==null?void 0:B.getSelectedRowModel().flatRows)==null?void 0:es.map(y=>y.original))??[],Ms=u.useCallback(()=>{var C;const y=k.length>0?(C=k[0])==null?void 0:C.paymentProcessor:null;return!!!(k.every(c=>c.paymentProcessor===y)&&(B!=null&&B.getIsSomeRowsSelected()))},[k,B]);return s.jsxs(s.Fragment,{children:[s.jsxs(v,{children:[s.jsx(Xs,{startDate:P,endDate:b,onChangeDateRange:fs,onOpenBalance:()=>I(!0),loading:z}),s.jsx(Qs,{table:B})]}),s.jsx(pe,{open:p,setOpen:T,movements:k??[]}),s.jsx(de,{open:_,card:g,dateRange:i==null?void 0:i.text,onClose:()=>{I(!1)}})]})}function ar(){const{data:r,isLoading:a}=le();return s.jsx(Fs,{title:"Dashboard Master",children:s.jsxs(Ns,{children:[s.jsx(Vs,{name:"Dashboard Master",links:[{name:"Inicio",href:Os.root},{name:"Dashboard Master"}]}),s.jsx(V,{pb:4,children:s.jsxs(f,{flexDirection:{md:"row"},gap:3,children:[s.jsx(f,{minWidth:300,children:s.jsx(ys,{data:r,isLoading:a})}),s.jsx(f,{flex:1,children:s.jsx(ue,{})})]})}),s.jsx(Ls,{})]})})}export{ar as default};
