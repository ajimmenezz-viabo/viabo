import{u as R,r as f,k as P,o as k,g as N,t as K,aQ as h,c as i,$ as x,j as t,S as u,T as g}from"./build-25f10292.js";import{u as Q}from"./build-c56f1b07.js";import{c as C,e as W}from"./build-4f526a47.js";import{R as $}from"./build-c1f7a0ee.js";import{M as S,a as B,u as b,b as w,R as E,c as G,W as H}from"./build-02b0cfb5.js";import{F as V}from"./build-f6d2683e.js";import{b as Y}from"./build-cfe876ff.js";import"./build-accee91e.js";import"./build-ae4125d9.js";import"./build-2386eb4b.js";import"./build-c71d7a87.js";import"./build-1e0ab5c8.js";import"./build-08978278.js";import"./build-beff5ae9.js";import"./build-bee6630b.js";import"./build-ecaf0d13.js";import"./build-d9000c43.js";import"./build-41f5ace4.js";import"./build-7ecac2eb.js";const z=(e={})=>{const{enqueueSnackbar:s}=R(),[r,n]=f.useState(null),c=P();return{...k(B,{onSuccess:()=>{n(null),c.invalidateQueries([S.STOCK_CARDS_LIST]),s("Se asignaron las tarjetas al comercio",{variant:"success",autoHideDuration:5e3})},onError:l=>{c.invalidateQueries([S.STOCK_CARDS_LIST]);const o=N(l,"No se puede asignar las tarjetas al comercio");s(o,{variant:K(l),autoHideDuration:5e3}),n(o)},...e}),error:r||null}},J=e=>{var r,n;const s=((r=e==null?void 0:e.commerce)==null?void 0:r.value)||"";return e!=null&&e.cardId?{cardId:e==null?void 0:e.cardId,commerceId:s}:{amount:e==null?void 0:e.numberOfCards.toString(),paymentProcessorId:((n=e==null?void 0:e.cardType)==null?void 0:n.value)||"",commerceId:s}};function he(){const e=b(a=>a.setOpen),s=b(a=>a.setCard),r=b(a=>a.card),n=h([S.AFFILIATED_COMMERCES_LIST])||[],c=h([S.STOCK_CARDS_LIST])||[],d=h([S.CARD_TYPES_LIST])||[],[l,o]=f.useState(!1),{mutate:j,isLoading:y}=z(),v=f.useMemo(()=>{const a={commerce:C().nullable().required("El comercio es requerido")};return r?{...a}:{...a,cardType:C().nullable().required("El tipo de tarjeta es requerido"),numberOfCards:W().min(1,"Al menos debe existir una tarjeta").test("maxCards","El maximo de tarjetas",function(p){const{cardType:D}=this.parent,T=c.filter(L=>L.cardTypeId===D.id).length;return p>T?this.createError({message:`No se pueden agregar más tarjetas que las disponibles (${T} tarjetas)`}):!0}).required("El número de tarjetas es requerido")}},[r,c]),I=f.useMemo(()=>r?{cardId:r==null?void 0:r.id,commerce:null}:{numberOfCards:1,cardType:d&&d.length>0&&d[0]||null,commerce:null},[r]),A=Q({initialValues:I,validationSchema:C().shape(v),onSubmit:(a,{setSubmitting:p})=>{p(!1),o(!0)}}),{isSubmitting:O,handleSubmit:_,values:q,setSubmitting:F}=A,m=O||y,M=a=>{const p=J(a);j(p,{onSuccess:()=>{e(!1),s(null),o(!1)},onError:()=>{o(!1)}})};return i(x,{children:[t(w,{onClose:()=>{e(!1),s(null)},onSuccess:_,isSubmitting:m,fullWidth:!0,scrollType:"body",title:r?"Asignar Tarjeta":"Asignar Tarjetas",textButtonSuccess:"Asignar",open:!l,children:t(V,{formik:A,children:i(u,{spacing:3,sx:{py:3},children:[r?t(Y,{card:r}):i(x,{children:[i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Tipo de Tarjeta:"}),t(E,{name:"cardType",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:d,disabled:m})]}),i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Número de tarjetas:"}),t($,{name:"numberOfCards",placeholder:"1",type:"number",InputLabelProps:{shrink:!0},inputProps:{inputMode:"numeric",min:"1"},disabled:m})]})]}),i(u,{children:[t(g,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Comercio:"}),t(E,{name:"commerce",textFieldParams:{placeholder:"Seleccionar ...",required:!0},options:n,disabled:m})]})]})})}),l&&t(G,{title:r?"Asignar Tarjeta":"Asignar Tarjetas",typeAlert:"warning",textButtonSuccess:"Asignar",onClose:()=>{o(!1),F(!1)},open:l,isSubmitting:m,description:i(u,{spacing:2,children:[t(g,{children:r?"¿Está seguro de asignar esta tarjeta a este comercio?":"¿Está seguro de asignar estas tarjetas a este comercio?"}),i(u,{direction:"row",alignItems:"center",spacing:1,children:[t(H,{}),t(g,{variant:"caption",children:"Verifique que todos los datos esten correctos"})]})]}),onSuccess:()=>{M(q)},fullWidth:!0,maxWidth:"xs"})]})}export{he as default};
