import{r as g,e as _,a9 as C,P,i as s,f as F,V as c,T as u,a0 as A}from"./vendor-_TWOdD6q.js";import{q as f,g as v,a as E,r as T,L as O,_ as R,z,S as q,P as I,o as L,D}from"./index-E9ArhrQG.js";import{c as H,i as S}from"./matchTypes--uN0rjmL.js";import{u as k}from"./formik.esm-x3Ufw1qH.js";import{c as m,a as x}from"./index.esm-wEzUF-or.js";import{F as M,R as h}from"./TextMaxLine-zzikwzKJ.js";import{R as j}from"./RFSelect-ObsMjYtv.js";import{C as V,H as G}from"./HeaderPage-yXZnMBwK.js";import"./UploadSingleFile-euJ03TmY.js";import"./fade-FopuCQlG.js";import"./transition-Uc7vb3zK.js";const $={PROFILES:"profiles-catalog"},B=e=>{const a=e==null?void 0:e.map(r=>({id:r==null?void 0:r.id,status:r==null?void 0:r.active,name:r==null?void 0:r.name,initUrl:r==null?void 0:r.urlInit,level:Number(r==null?void 0:r.level)}));return H(a,"id","name","status")},K=async()=>{const{data:e}=await f.get("/api/profiles");return B(e)},Q=(e={})=>{const[a,r]=g.useState(null),t=_({queryKey:[$.PROFILES],queryFn:K,staleTime:6e4,...e});return g.useEffect(()=>{if(t!=null&&t.isError){const i=v(t.error,"No se puede obtener los perfiles del sistema. Intente nuevamente o reporte a sistemas");r(i),C.error(i,{type:E(i)})}},[t.isError,t.error]),{...t,error:a||null}},U={openNewCause:!1},W=(e,a)=>({...U,setOpenNewCause:r=>{e(t=>({openNewCause:r}),!1,"SET_OPEN_NEW_CAUSE")}}),y=T(W),Y=O(g.lazy(()=>R(()=>Promise.resolve().then(()=>ee),void 0))),b=({profiles:e})=>{const{openNewCause:a,setOpenNewCause:r}=y(i=>i),t=()=>{r(!1)};return s.jsx(z,{open:a,handleClose:t,titleElement:"Nueva Causa",children:a&&s.jsx(Y,{profiles:e,onSuccess:t})})};b.propTypes={profiles:P.any};const J=e=>{var a,r;return{reason:e==null?void 0:e.cause,description:e==null?void 0:e.description,applicantProfileId:((a=e==null?void 0:e.requesterProfile)==null?void 0:a.value)||"",assignedProfileId:((r=e==null?void 0:e.receptorProfile)==null?void 0:r.value)||"",color:e==null?void 0:e.color}},X=async e=>{const{data:a}=await f.post("/api/support-reason/new",e);return a},Z=(e={})=>{const a=F(X,e);return{...a,mutate:async(t,i)=>{const{onSuccess:d,onError:p,mutationOptions:l}=i;try{const o=await C.promise(a.mutateAsync(t,l),{pending:"Guardando nueva causa ..."});S(d)&&d(o)}catch(o){const n=v(o,"No se puede realizar esta operación en este momento. Intente nuevamente o reporte a sistemas");S(p)&&p(n),C.error(n,{type:E(o)})}}}},N=({profiles:e,onSuccess:a})=>{const{mutate:r,isLoading:t}=Z(),i=m().shape({cause:x().trim().max(100,"Máximo 100 caracteres").required("Es necesario la causa"),description:x().trim().max(250,"Máximo 250 caracteres"),requesterProfile:m().nullable().required("Es necesario el perfil solicitante"),receptorProfile:m().nullable().required("Es necesario el perfil receptor").test("not-equal","El perfil receptor no puede ser igual al perfil solicitante",function(o){const{requesterProfile:n}=this.parent;return!o||!n||o.id!==n.id}).test("higher-level","El perfil receptor debe tener un nivel más alto que el perfil solicitante",function(o){const{requesterProfile:n}=this.parent;return!o||n&&(o==null?void 0:o.level)>(n==null?void 0:n.level)}),color:x()}),d=k({initialValues:{cause:"",description:"",requesterProfile:null,receptorProfile:null,color:""},enableReinitialize:!0,validationSchema:i,onSubmit:(o,{setSubmitting:n,setFieldValue:re})=>{const w=J(o);r(w,{onSuccess:()=>{n(!1),a()},onError:()=>{n(!1)}})}}),{isSubmitting:p}=d,l=t||p;return s.jsx(q,{containerProps:{sx:{flexGrow:0,height:"auto"}},children:s.jsx(M,{formik:d,children:s.jsxs(c,{spacing:2,sx:{p:3},children:[s.jsxs(c,{spacing:1,children:[s.jsx(u,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Causa *"}),s.jsx(h,{size:"small",name:"cause",placeholder:"Nueva causa...",disabled:l})]}),s.jsxs(c,{spacing:1,children:[s.jsx(u,{paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Descripción"}),s.jsx(h,{size:"small",name:"description",multiline:!0,rows:2,disabled:l,placeholder:"Descripción de la causa..."})]}),s.jsxs(c,{spacing:1,children:[s.jsx(u,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Perfil Solicitante *"}),s.jsx(j,{size:"small",name:"requesterProfile",disabled:l,options:e||[],textFieldParams:{placeholder:"Seleccionar ...",size:"small"}})]}),s.jsxs(c,{spacing:1,children:[s.jsx(u,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Perfil Receptor *"}),s.jsx(j,{size:"small",name:"receptorProfile",disabled:l,options:e||[],textFieldParams:{placeholder:"Seleccionar ...",size:"small"}})]}),s.jsxs(c,{spacing:1,children:[s.jsx(u,{m:0,paragraph:!0,variant:"overline",sx:{color:"text.disabled"},children:"Color"}),s.jsx(h,{size:"small",type:"color",name:"color",disabled:l})]}),s.jsx(c,{sx:{pt:1},children:s.jsx(A,{size:"large",loading:l,variant:"contained",color:"primary",fullWidth:!0,type:"submit",children:"Crear"})})]})})})};N.propTypes={onSuccess:P.func,profiles:P.array};const ee=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"})),me=()=>{const{data:e,isLoading:a}=Q(),r=y(t=>t.setOpenNewCause);return s.jsxs(I,{title:"Catálogo de Causas",children:[s.jsx(V,{children:s.jsx(G,{name:"Catálogo de Causas",links:[{name:"Inicio",href:L.root},{name:"Catálogos",href:D.causes},{name:"Causas"}],buttonName:"Nueva Causa",onClick:()=>r(!0),loading:a})}),s.jsx(b,{profiles:e})]})};export{me as CatalogCauses};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
//# sourceMappingURL=CatalogCauses-9MqHZcif.js.map
