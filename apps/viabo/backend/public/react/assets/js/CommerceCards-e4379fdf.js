import{j as e,b5 as Q,a as W,r as d,b as X,g as Z,B as c,aS as J,c as i,T as a,S as l,Y as ee,Z as re,$ as L,a0 as j,a1 as _,s as te,a8 as ne,a5 as ie,a9 as oe,P as se}from"./index-70a88a68.js";import{C as ae,u as le,s as R,S as ce,P as de,E as F,a as me,H as he}from"./filterSearch-b52c629c.js";import"./formik.esm-08fe098b.js";import{L as G}from"./FormProvider-ca55416b.js";import{c as pe,C as ue,a as ge,b as xe}from"./cardsAdapter-368e40bf.js";import{c as fe,d as Ce}from"./middleware-ef02c0e0.js";import{T as Se}from"./TextField-1dd7ffce.js";import{I as be}from"./InputAdornment-a71dc068.js";import{S as ye}from"./illustration_select-0559d3fb.js";import{f as I}from"./formatNumber-025aaee5.js";import{C as ve}from"./Card-0aeafab0.js";import{G as b}from"./Grid-85fa03b8.js";import"./Container-a053da6d.js";import"./VisibilityOff-4ebdd3d4.js";const Ee={cards:"tarjetas",commerce:"comercio"};function we(){return e(Q,{friendlyPages:Ee})}const Re={CARDS_COMMERCE_LIST:"cardsCommerce"},Ie=async()=>{const{data:r}=await W.get("/api/cards/commerce");return pe(r)},Te=(r={})=>{const[o,s]=d.useState(null);return{...X([Re.CARDS_COMMERCE_LIST],Ie,{staleTime:6e4,onError:x=>{const f=Z(x,"No se puede obtener la lista de tarjetas. Intente nuevamente o reporte a sistemas");s(f)},...r}),error:o||null}},Ae=(r,o)=>({card:null,setCard:s=>{r(g=>({card:s}))}}),E=fe(Ce(Ae)),De=[{id:4,name:"Sin Asignar",color:"info"},{id:5,name:"Asignado",color:"primary"}],N=r=>{var o;return((o=De.find(s=>s.id.toString()===r.toString()))==null?void 0:o.color)||"info"};function Be({card:r}){var g,x;const o=E(f=>f.card),s=(o==null?void 0:o.id)===r.id;return e(c,{sx:f=>({p:.5,...s&&{borderRadius:2,...J(f).bgGradient({startColor:"#A100FFFF",endColor:"#71C4FFFF"})}}),children:i(ue,{children:[e(ae,{title:e(a,{sx:{typography:"subtitle2",opacity:.72},children:"Viabo Card"}),subheader:r==null?void 0:r.register,sx:{p:0}}),e(c,{sx:{p:1,position:"relative"},children:e(G,{variant:"filled",color:N((g=r==null?void 0:r.status)==null?void 0:g.id),sx:{right:0,zIndex:9,top:-50,bottom:0,position:"absolute",textTransform:"capitalize"},children:(x=r==null?void 0:r.status)==null?void 0:x.name})}),e("div",{children:e(ge,{card:r,disableShow:!0})}),i(l,{direction:"row",spacing:5,children:[i(l,{children:[e(a,{sx:{mb:1,typography:"caption",opacity:.48},children:"Vencimiento"}),e(a,{sx:{typography:"subtitle1"},children:r==null?void 0:r.expiration})]}),e(xe,{card:r,disableShow:!0})]})]})})}function Me(){var M,P;const{data:r,isLoading:o,isError:s,error:g,refetch:x,isSuccess:f}=Te(),T=E(t=>t.setCard),S=E(t=>t.card),w=d.useMemo(()=>{const t=(r==null?void 0:r.map(h=>h==null?void 0:h.status))||[],n={},C=[];return t.forEach(h=>{h&&!n[h.id]&&(n[h.id]=!0,C.push(h))}),C},[r]),[k,z]=d.useState(1),[p,O]=d.useState(""),[m,A]=d.useState(""),[V,D]=d.useState([]),[y,q]=d.useState([]),B=4,v=p?V:m?y:r,Y=(v==null?void 0:v.length)||0,U=Math.ceil(Y/B),u=le(v||[],B),$=(t,n)=>{z(n),u.jump(n)};if(d.useEffect(()=>{if(p.trim()!==""&&y&&m){const t=R(y,p);D(t)}else if(p&&r&&!m){const t=R(r,p);D(t)}},[p,r,m,y]),d.useEffect(()=>{if(r&&S){const t=r==null?void 0:r.find(n=>(n==null?void 0:n.id)===(S==null?void 0:S.id));t&&T(t)}},[r,S]),s)return e(l,{sx:{pr:{sm:2}},children:e(ee,{errorMessage:g,handleButton:x})});const K=t=>{let n="";t===m?A(""):(A(t),n=(t==null?void 0:t.name)||"");const C=R(r,n);q(C)};return i(l,{sx:{pr:{sm:2}},children:[o&&e(re,{}),(r==null?void 0:r.length)>0&&i(L,{children:[e(c,{display:"flex",children:w==null?void 0:w.map(t=>{const n=(m==null?void 0:m.id)===(t==null?void 0:t.id);return e(j.div,{onClick:()=>K(t),whileHover:{scale:1.03},whileTap:{scale:.8},children:e(G,{variant:n?"ghost":"filled",color:N(t==null?void 0:t.id),sx:{textTransform:"uppercase",marginRight:1,marginBottom:2,cursor:"pointer",border:n?3:0,borderColor:n?C=>C.palette.primary.main:"inherit"},children:t==null?void 0:t.name})},t==null?void 0:t.id)})}),i(c,{display:"flex",mb:3,flexDirection:"column",alignItems:{xs:"center"},children:[e(Se,{fullWidth:!0,size:"small",placeholder:"Buscar ...",value:p,onChange:t=>O(t.target.value),InputProps:{startAdornment:e(be,{position:"start",children:e(c,{sx:{color:"text.disabled"},children:e(ce,{sx:{marginTop:1}})})})}}),e(c,{sx:{flex:"1 1 auto",mb:{xs:3}}}),e(de,{count:U,page:k,onChange:$})]}),e(c,{sx:{maxHeight:1,minHeight:"100%",overflow:"auto"},children:e(_,{children:i(l,{direction:"column",spacing:2,sx:{p:2,cursor:"pointer"},children:[((M=u==null?void 0:u.currentData())==null?void 0:M.length)===0&&e(F,{pt:2.5,message:"Sin resultados "}),(P=u==null?void 0:u.currentData())==null?void 0:P.map((t,n)=>e(j.div,{onClick:()=>{T(t)},whileHover:{scale:1.03},whileTap:{scale:.8},children:e(Be,{card:t})},n))]})})})]}),r&&(r==null?void 0:r.length)===0&&e(F,{pt:2.5,message:"No hay tarjetas asignadas a este comercio"})]})}const H=te("div")({display:"flex",justifyContent:"space-between"});function Pe(){return i(ve,{sx:{p:3},children:[e(a,{variant:"subtitle2",gutterBottom:!0,children:"Saldo Disponible"}),i(l,{spacing:2,children:[i(l,{direction:"row",spacing:2,alignItems:"center",children:[e(a,{variant:"h3",children:I(162150)}),e(a,{variant:"caption",children:"MXN"})]}),i(H,{children:[e(a,{variant:"body2",sx:{color:"text.secondary"},children:"Ingresos"}),e(a,{variant:"body2",children:I(187650)})]}),i(H,{children:[e(a,{variant:"body2",sx:{color:"text.secondary"},children:"Egresos"}),i(a,{variant:"body2",children:["- ",I(25500)]})]})]})]})}function je(){const o=E(s=>s.card);return i(L,{children:[e(ne,{sx:{position:"sticky",top:0,zIndex:1},children:e(l,{spacing:3,direction:"row",justifyContent:"space-between",sx:{width:1},alignItems:{sm:"center"},children:e(l,{direction:"row",spacing:1,children:e(a,{variant:"h5",children:"Detalles"})})})}),o?e(c,{sx:{maxHeight:700,minHeight:"100vh",overflow:"auto"},children:e(_,{children:e(b,{container:!0,sx:{p:2},spacing:3,children:e(b,{item:!0,xs:12,sm:12,md:12,lg:7,xl:5,children:e(Pe,{})})})})}):i(l,{px:2,spacing:3,sx:{height:"100%",width:"100%"},children:[e(ie,{variant:"filled",severity:"info",children:"Debe seleccionar una tarjeta para ver sus detalles!"}),e(l,{alignItems:"center",children:e(ye,{sx:{width:"30%"}})})]})]})}function Fe(){const{isCollapse:r}=oe();return i(b,{container:!0,sx:{height:"100vH"},children:[e(b,{item:!0,xs:12,md:6,sm:6,lg:r?4:5,xl:3,sx:o=>({borderRight:{sm:`1px solid ${o.palette.divider}`},borderRightStyle:{xs:"none",sm:"dashed!important"}}),children:e(c,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e(Me,{})})}),e(b,{item:!0,xs:!1,sm:6,md:6,lg:r?8:7,xl:9,sx:{px:2,flexGrow:1,display:{xs:"none",sm:"block"}},children:e(c,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:e(je,{})})})]})}function Qe(){return e(se,{title:"Tarjetas del Comercio",children:i(me,{children:[e(he,{name:"Tarjetas del Comercio",breadcrumbs:we}),e(Fe,{})]})})}export{Qe as default};
